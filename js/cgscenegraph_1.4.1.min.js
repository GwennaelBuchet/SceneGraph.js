"use script";function cgsgIsArray(a){return(Object.prototype.toString.call(a)==="[object Array]")}Array.prototype.without=function(b){for(var a=0;a<this.length;a++){if(this[a]==b){this.splice(a,1)}}};Array.prototype.clear=function(){this.length=0};Array.prototype.clone=function(){return this.slice(0)};Array.prototype.copy=function(){var b=[];for(var c=0;c<this.length;c++){if(this[c].copy){b.push(this[c].copy())}else{b.push(this[c])}}return b};Array.prototype.contains=function(b){for(var a=0;a<this.length;a++){if(this[a]==b){return true}}return false};Array.prototype.unique=function(){var b=[],a;this.sort();for(a=0;a<this.length;a++){if(this[a]!==this[a+1]){b[b.length]=this[a]}}return b};Array.prototype.sum=function(){var b=0;for(var a=0;a<this.length;a++){b+=parseInt(this[a])}return b};Array.prototype.average=function(){return this.sum()/this.length};(function(){var a=false,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.CGSGObject=function(){};CGSGObject.extend=function(g){var f=this.prototype;a=true;var e=new this();a=false;for(var d in g){e[d]=typeof g[d]=="function"&&typeof f[d]=="function"&&b.test(g[d])?(function(h,i){return function(){var k=this._super;this._super=f[h];var j=i.apply(this,arguments);this._super=k;return j}})(d,g[d]):g[d]}function c(){if(!a&&this.initialize){this.initialize.apply(this,arguments)}}c.prototype=e;c.prototype.constructor=c;c.extend=arguments.callee;return c}})();var CGSGHashmap=CGSGObject.extend({initialize:function(){this._map={};this._map.keys=[];this._map.values=[]},getAt:function(a){return{key:this._map.keys[a],value:this._map.values[a]}},getValue:function(b){var a=this.getKeyIndex(b);if(a<0){return null}return this._map.values[a]},addOrReplace:function(b,c){var a=this.getKeyIndex(b);if(a>=0){this._map.values[a]=c}else{this._map.keys.push(b);this._map.values.push(c);a=this.getLength()}return a},remove:function(b){if(this.containsKey(b)){var a=this.getKeyIndex(b);this._map.keys.splice(a,1);this._map.values.splice(a,1)}},removeAll:function(){this._map.keys.clear();this._map.values.clear()},clone:function(){var a=new CGSGHashmap();a._map.keys=this._map.keys.clone();a._map.values=this._map.value.clone();return a},containsKey:function(a){return this._map.keys.contains(a)},getLength:function(){return this._map.keys.length},getKeyIndex:function(b){var a;for(a=0;a<this.getLength();a++){if(this._map.keys[a]===b){return a}}return -1}});var CGSGColor={rgb2hex:function(d,c,a){return"#"+this._toHex(d)+this._toHex(c)+this._toHex(a)},hex2rgb:function(a){a=this._withoutSharp(a);return{r:parseInt(a.substring(0,2),16),g:parseInt(a.substring(2,4),16),b:parseInt(a.substring(4,6),16)}},_withoutSharp:function(a){return(a.charAt(0)=="#")?a.substring(1,a.length):a},_toHex:function(b){var a=parseInt(b,10);if(isNaN(a)){return"00"}a=Math.max(0,Math.min(a,255));return"0123456789ABCDEF".charAt((a-a%16)/16)+"0123456789ABCDEF".charAt(a%16)},lerp:function(d,f,c){var e=this.hex2rgb(d);var b=this.hex2rgb(f);var a=[];a[0]=e.r+(b.r-e.r)*c;a[1]=e.g+(b.g-e.g)*c;a[2]=e.b+(b.b-e.b)*c;return this.rgb2hex(a[0],a[1],a[2])},darkenHex:function(c,b){var a=this.hex2rgb(c);a.r=this.multiplyComponent(a.r,b);a.g=this.multiplyComponent(a.g,b);a.b=this.multiplyComponent(a.b,b);return this.rgb2hex(a.r,a.g,a.b)},darkenRGB:function(e,d,a,c){return{r:this.multiplyComponent(e,c),g:this.multiplyComponent(d,c),b:this.multiplyComponent(a,c)}},litRGB:function(f,e,a,d){var c=this.rgb2hsl(f,e,a);c.l*=d;return this.hsl2rgb(c.h,c.s,c.l)},multiplyComponent:function(b,a){return Math.max(Math.min(255,b*a),0)},rgb2hsv:function(k,j,c){var f,a;k/=255;j/=255;c/=255;f=Math.min(c,Math.min(k,j));a=Math.max(c,Math.max(k,j));if(a==f){return{h:0,s:0,v:f}}var l=(k==f)?j-c:((c==f)?k-j:c-k);var i=(k==f)?3:((c==f)?1:5);var e=a-f;return{h:60*(i-l/e),s:e/a,v:a}},rgb2hsl:function(a,i,k){a/=255,i/=255,k/=255;var m=Math.max(a,i,k),e=Math.min(a,i,k);var f,n,c=(m+e)/2;if(m==e){f=n=0}else{var j=m-e;n=c>0.5?j/(2-m-e):j/(m+e);switch(m){case a:f=(i-k)/j+(i<k?6:0);break;case i:f=(k-a)/j+2;break;case k:f=(a-i)/j+4;break}f/=6}return{h:f,s:n,l:c}},hsl2rgb:function(i,m,f){var a,j,k;if(m==0){a=j=k=f}else{function e(h,g,b){if(b<0){b+=1}if(b>1){b-=1}if(b<1/6){return h+(g-h)*6*b}if(b<1/2){return g}if(b<2/3){return h+(g-h)*(2/3-b)*6}return h}var c=f<0.5?f*(1+m):f+m-f*m;var d=2*f-c;a=e(d,c,i+1/3);j=e(d,c,i);k=e(d,c,i-1/3)}return{r:a*255,g:j*255,b:k*255}},hsv2rgb:function(j,u,n){var a,k,m;var e=Math.floor(j*6);var l=j*6-e;var d=n*(1-u);var c=n*(1-l*u);var o=n*(1-(1-l)*u);switch(e%6){case 0:a=n,k=o,m=d;break;case 1:a=c,k=n,m=d;break;case 2:a=d,k=n,m=o;break;case 3:a=d,k=c,m=n;break;case 4:a=o,k=d,m=n;break;case 5:a=n,k=d,m=c;break}return{r:a*255,g:k*255,b:m*255}}};var CGSGVector2D=CGSGObject.extend({initialize:function(a,b){this.x=a;this.y=b},copy:function(){return new CGSGVector2D(this.x,this.y)},add:function(a){this.x+=a.x;this.y+=a.y},substract:function(a){this.x-=a.x;this.y-=a.y},multiply:function(a){this.x*=a.x;this.y*=a.y},divide:function(a){this.x/=a.x;this.y/=a.y},multiplyByFloat:function(a){this.x*=a;this.y*=a},divideByFloat:function(a){this.x/=a;this.y/=a},getDistance:function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))},rotate:function(c){var b=Math.cos(c);var a=Math.sin(c);this.x=this.x*b+this.y*a;this.y=this.x*a-this.y*b},getLength:function(){return Math.sqrt((this.x*this.x)+(this.y*this.y))},getSquaredLength:function(){return(this.x*this.x)+(this.y*this.y)},normalize:function(){var b;var a=this.getLength();if(a==1||a==0){return}b=1/a;this.x*=b;this.y*=b}});"use strict";var CGSGPosition=CGSGVector2D.extend({initialize:function(a,b){this._super(a,b)},copy:function(){return new CGSGPosition(this.x,this.y)},translateTo:function(b,a){this.x=b;this.y=a},translateWith:function(a,b){this.x+=a;this.y+=b},translateBy:function(a,b){this.x*=a;this.y*=b}});var CGSGScale=CGSGPosition.extend({initialize:function(a,b){this._super(a,b)}});var CGSGRotation=CGSGObject.extend({initialize:function(a){this.angle=a},copy:function(){return new CGSGRotation(this.angle)},rotateTo:function(a){this.angle=a},rotateBy:function(a){this.multiply(a)},rotateWith:function(a){this.add(a)},add:function(a){this.angle+=a},substract:function(a){this.angle-=a},multiply:function(a){this.angle*=a}});var CGSGDimension=CGSGVector2D.extend({initialize:function(b,a){this._super(b,a);this.width=this.x;this.height=this.y},copy:function(){return new CGSGDimension(this.width,this.height)},resizeTo:function(b,a){if(b>=0){this.width=b}if(a>=0){this.height=a}},resizeBy:function(b,a){if(b>=0){this.width*=b}if(a>=0){this.height*=a}},resizeWith:function(b,a){if(this.width+b>=0){this.width+=b}if(this.height+a>=0){this.height+=a}}});var CGSGRegion=CGSGObject.extend({initialize:function(b,d,c,a){this.position=new CGSGPosition(b,d);this.dimension=new CGSGDimension(c,a)},copy:function(){return new CGSGRegion(this.position.x,this.position.y,this.dimension.width,this.dimension.height)},add:function(a){this.position.translateWith(a.position.x,a.position.y);this.dimension.resizeWith(a.dimension.width,a.dimension.height)},substract:function(a){this.position.translateWith(-a.position.x,-a.position.y);this.dimension.resizeWith(-a.dimension.width,-a.dimension.height)}});var CGSG_DEFAULT_DISPLAYRATIO=new CGSGScale(1,1);var CGSG_DEFAULT_DRAG_SELECT_FILL_COLOR="#C0C0C0";var CGSG_DEFAULT_DRAG_SELECT_STROKE_COLOR="#808080";var CGSG_DEFAULT_DRAG_SELECT_ALPHA=0.6;var CGSG_DEFAULT_SELECTED_STROKE_COLOR="#FF6890";var CGSG_DEFAULT_SELECTED_STROKE_SIZE=2;var CGSG_DEFAULT_SELECTED_RESIZEHANDLE_SIZE=6;var CGSG_DEFAULT_SELECTED_RESIZEHANDLE_COLOR="#9068FF";var CGSG_DEFAULT_SELECTED_RESIZEHANDLE_THRESHOLD=3;var CGSG_DEFAULT_FRAMERATE_DELAY=30;var CGSG_DEFAULT_DBLTOUCH_DELAY=250;var CGSGTraverser=CGSGObject.extend({initialize:function(){this.lastResults=[]},traverse:function(a,c,b){this.lastResults.clear();if(cgsgExist(c)){this._check(a,c,b)}return this.lastResults},_check:function(a,f,e){if(a.isTraversable===true){var d=cgsgExist(e)&&e.length>0;if(!(d&&e.contains(a))&&f(a)===true){this.lastResults.push(a)}for(var c=a.children.length-1;c>=0;--c){var b=a.children[c];this._check(b,f,e)}}}});"use strict";var CGSGCollisionMethod={GHOSTONDEMAND:"ghostOnDemand",REGION:"region"};"use strict";var CGSGCollisionRegionTester=CGSGObject.extend({initialize:function(){this.classType="CGSGCollisionRegionTester"},isColliding:function(d,c,b){if(b===null){b=0}var a=c.getAbsoluteRight();var e=c.getAbsoluteBottom();if((d.getAbsoluteLeft()<=a+b&&d.getAbsoluteRight()>=c.getAbsoluteLeft()-b)||(d.getAbsoluteRight()>=c.getAbsoluteLeft()-b&&d.getAbsoluteLeft()<=a+b)){if(d.getAbsoluteTop()<=e+b&&d.getAbsoluteBottom()>=c.getAbsoluteTop()-b){return true}}return false}});"use strict";var CGSGCollisionGhostOnDemandTester=CGSGObject.extend({initialize:function(){this.classType="CGSGCollisionGhostOnDemandTester"},isColliding:function(c,p,d){var r=p.getAbsoluteLeft()-c.getAbsoluteLeft();var q=p.getAbsoluteTop()-c.getAbsoluteTop();var m=(r>=0)?Math.min(c.getAbsoluteWidth()-r,p.getAbsoluteWidth()):Math.min(p.getAbsoluteWidth()+r,c.getAbsoluteWidth());var l=(q>=0)?Math.min(c.getAbsoluteHeight()-q,p.getAbsoluteHeight()):Math.min(p.getAbsoluteHeight()+q,c.getAbsoluteHeight());if((m<=0)||(l<=0)){return false}var o=(r>=0)?r:0;var n=(q>=0)?q:0;var b=document.createElement("canvas");b.width=c.getAbsoluteWidth();b.height=c.getAbsoluteHeight();var j=b.getContext("2d");j.scale(c.getAbsoluteScale().x,c.getAbsoluteScale().y);var e=c.position;c.position=new CGSGPosition(0,0);c.render(j);c.position=e;var a=document.createElement("canvas");a.width=p.getAbsoluteWidth();a.height=p.getAbsoluteHeight();var k=a.getContext("2d");e=p.position;p.position=new CGSGPosition(0,0);p.render(k);p.position=e;j.globalCompositeOperation="destination-in";j.drawImage(a,r/c.getAbsoluteScale().x,q/c.getAbsoluteScale().y);var h=j.getImageData(o,n,m,l);for(var g=0;g<h.width;g++){for(var f=0;f<h.height;f++){var i=((g)+(f)*h.width)*4;if(h.data[i+3]>0){return true}}}return false}});"use strict";var CGSGCollisionTesterFactory=CGSGObject.extend({initialize:function(){this.collisionTesters=new CGSGHashmap();this.collisionTesters.addOrReplace(CGSGCollisionMethod.REGION,new CGSGCollisionRegionTester());this.collisionTesters.addOrReplace(CGSGCollisionMethod.GHOSTONDEMAND,new CGSGCollisionGhostOnDemandTester())},getCollisionTester:function(a){return this.collisionTesters.getValue(a)}});"use strict";var CGSGCollisionManager=CGSGObject.extend({initialize:function(){},isColliding:function(c,b,a){if(c.isCollisionManaged&&b.isCollisionManaged){if(cgsgExist(cgsgPerformanceKeys)){return cgsgPerformanceKeys.collisionTester.isColliding(c,b,a)}}return false},manageNode:function(a){a.isCollisionManaged=true},unManageNode:function(a){a.isCollisionManaged=false}});var CGSGPickNodeMethod={GHOST:"ghost",REGION:"region"};var cgsgVersion="1.4.1";var cgsgDisplayRatio=CGSG_DEFAULT_DISPLAYRATIO;var cgsgResizeHandleThreshold=CGSG_DEFAULT_SELECTED_RESIZEHANDLE_THRESHOLD;var cgsgExplorerParams={IE10:{name:"IE 10 or above",browserName:"",fullVersion:"",textDecalYTop:4.3,textDecalYBottom:1.26,textDecalYMiddle:1.87,textDecalYAlpha:0.983,webworker:false},IE9:{name:"IE 9",browserName:"",fullVersion:"",textDecalYTop:4.3,textDecalYBottom:1.26,textDecalYMiddle:1.87,textDecalYAlpha:0.983,webworker:false},SAFARI:{name:"Safari",browserName:"",fullVersion:"",textDecalYTop:4,textDecalYBottom:1.27,textDecalYMiddle:1.77,textDecalYAlpha:0.983,webworker:false},CHROME:{name:"Chrome",browserName:"",fullVersion:"",textDecalYTop:3.3,textDecalYBottom:1.268,textDecalYMiddle:2.09,textDecalYAlpha:0.983,webworker:false},OPERA:{name:"Opera",browserName:"",fullVersion:"",textDecalYTop:3.5,textDecalYBottom:1.28,textDecalYMiddle:2,textDecalYAlpha:0.995,webworker:false},FIREFOX:{name:"Firefox",browserName:"",fullVersion:"",textDecalYTop:10,textDecalYBottom:1.23,textDecalYMiddle:1.77,textDecalYAlpha:0.983,webworker:false},KONQUEROR:{name:"Konqueror",browserName:"",fullVersion:"",textDecalYTop:10,textDecalYBottom:1.23,textDecalYMiddle:1.77,textDecalYAlpha:0.983,webworker:false},UNKNOWN:{name:"Unknown",browserName:"",fullVersion:"",textDecalYTop:10,textDecalYBottom:1.23,textDecalYMiddle:1.77,textDecalYAlpha:0.983,webworker:false}};var cgsgCurrentExplorer=cgsgExplorerParams.UNKNOWN;var cgsgGhostContext=null;var cgsgCurrentFrame=0;var cgsgCanvas=null;var cgsgGhostColor="#FF0000";var cgsgFramerateDelay=CGSG_DEFAULT_FRAMERATE_DELAY;var cgsgCollisionManager=new CGSGCollisionManager();var cgsgPerformanceKeys={_collisionMethod:CGSGCollisionMethod.REGION,_cgsgCollisionTesterFactory:new CGSGCollisionTesterFactory(),collisionTester:new CGSGCollisionRegionTester(),setCollisionMethod:function(a){this._collisionMethod=a;this.collisionTester=this._cgsgCollisionTesterFactory.getCollisionTester(this._collisionMethod)}};function cgsgExist(a){return(a!==null&&a!==undefined)}function cgsgDetectCurrentExplorer(){cgsgCurrentExplorer=cgsgExplorerParams.UNKNOWN;var c=navigator.userAgent;var d=navigator.appName;var e=""+parseFloat(navigator.appVersion);var a,b;if((b=c.indexOf("Opera"))!=-1){cgsgCurrentExplorer=cgsgExplorerParams.OPERA;e=c.substring(b+6);if((b=c.indexOf("Version"))!=-1){e=c.substring(b+8)}}else{if((b=c.indexOf("MSIE"))!=-1){d="Microsoft Internet Explorer";cgsgCurrentExplorer=cgsgExplorerParams.IE9;e=c.substring(b+5);if(parseInt(e)>=10){cgsgCurrentExplorer=cgsgExplorerParams.IE10}}else{if((b=c.indexOf("Chrome"))!=-1){cgsgCurrentExplorer=cgsgExplorerParams.CHROME;e=c.substring(b+7)}else{if((b=c.indexOf("Safari"))!=-1){cgsgCurrentExplorer=cgsgExplorerParams.SAFARI;e=c.substring(b+7);if((b=c.indexOf("Version"))!=-1){e=c.substring(b+8)}}else{if((b=c.indexOf("Firefox"))!=-1){cgsgCurrentExplorer=cgsgExplorerParams.FIREFOX;e=c.substring(b+8)}else{if((a=c.lastIndexOf(" ")+1)<(b=c.lastIndexOf("/"))){d=c.substring(a,b);e=c.substring(b+1);if(d.toLowerCase()==d.toUpperCase()){d=navigator.appName}}}}}}}cgsgCurrentExplorer.fullVersion=e;cgsgCurrentExplorer.browserName=d;cgsgCurrentExplorer.webworker=typeof(Worker)!=="undefined"}cgsgStylePaddingLeft=0;cgsgStylePaddingTop=0;cgsgStyleBorderLeft=0;cgsgStyleBorderTop=0;function cgsgGetRealViewportDimension(){var c=window,b="inner";if(!("innerWidth" in window)){b="client";c=document.documentElement||document.body}return new CGSGDimension(c[b+"Width"],c[b+"Height"])}function cgsgGetDisplayedViewportDimension(){var a=cgsgGetRealViewportDimension();return new CGSGDimension(Math.round(a.width/cgsgDisplayRatio.x),Math.round(a.height/cgsgDisplayRatio.y))}function cgsgPointIsInRegion(b,c,a){return b.x>=(c.position.x-a)&&b.y>=(c.position.y-a)&&b.x<=(c.position.x+c.dimension.width+a)&&b.y<=(c.position.y+c.dimension.height+a)}function cgsgRegionIsInRegion(c,b,a){return c.position.x>=(b.position.x-a)&&c.position.y>=(b.position.y-a)&&(c.position.x+c.dimension.width)<=(b.position.x+b.dimension.width+a)&&(c.position.y+c.dimension.height)<=(b.position.y+b.dimension.height+a)}function cgsgGetCursorPositions(a,b){var f=b,j=0,d=0,g=[];if(f.offsetParent){do{j+=f.offsetLeft;d+=f.offsetTop}while((f=f.offsetParent))}j+=cgsgStylePaddingLeft;d+=cgsgStylePaddingTop;j+=cgsgStyleBorderLeft;d+=cgsgStyleBorderTop;var e=a;if(a.targetTouches){var h=(typeof a.targetTouches!=="undefined")?a.targetTouches:[a];for(var c=0;c<h.length;c++){e=h[c];g.push(new CGSGPosition((e.pageX-j)/cgsgDisplayRatio.x,(e.pageY-d)/cgsgDisplayRatio.y))}}else{g.push(new CGSGPosition((e.pageX-j)/cgsgDisplayRatio.x,(e.pageY-d)/cgsgDisplayRatio.y))}return g}function cgsgClearContext(a){a.setTransform(1,0,0,1,0,0);a.clearRect(0,0,cgsgCanvas.width,cgsgCanvas.height)}function cgsgFree(a){a=null};var CGSGMath={PI2:6.28318530718,deg2rad:function(a){return(a/180)*Math.PI},rad2deg:function(a){return a*57.29577951308232},fixedPoint:function(a){return(0.5+a)<<0},lerp:function(c,b,a){return c+(b-c)*a}};var CGSGHandleBox=CGSGObject.extend({initialize:function(c,d,g,e,b,a,f){this.fillColor=g;this.strokeColor=e;this.lineWidth=b;this.size=d;this._parentNode=c;this._position=new CGSGPosition(a,f)},render:function(a){a.lineWidth=this.lineWidth;a.strokeStyle=this.strokeColor;a.fillStyle=this.fillColor;a.strokeRect(this._position.x,this._position.y,this.size/this._parentNode._absoluteScale.x,this.size/this._parentNode._absoluteScale.y);a.fillRect(this._position.x,this._position.y,this.size/this._parentNode._absoluteScale.x,this.size/this._parentNode._absoluteScale.y)},checkIfSelected:function(b,a){return(b.x>=this._parentNode._absolutePosition.x+(this._position.x*this._parentNode._absoluteScale.x)-a&&b.x<=this._parentNode._absolutePosition.x+(this._position.x*this._parentNode._absoluteScale.x)+this.size+a&&b.y>=this._parentNode._absolutePosition.y+(this._position.y*this._parentNode._absoluteScale.y)-a&&b.y<=this._parentNode._absolutePosition.y+(this._position.y*this._parentNode._absoluteScale.y)+this.size+a)},translateTo:function(b,a){this._position.x=b;this._position.y=a}});"use strict";var CGSGAnimationKey=CGSGObject.extend({initialize:function(b,a){this.frame=b;this.value=a}});"use strict";var CGSGTimeline=CGSGObject.extend({initialize:function(a,b,c){this.parentNode=a;this.attribute=b;if(arguments.length===3){this.method=c}else{this.method="linear"}this.listValues=[];this._listKeys=[];this._listSteps=[];this.onAnimationStart=null;this.onAnimationEnd=null;this.onAnimate=null},addKey:function(b,a){this._listKeys.push(new CGSGAnimationKey(b,a));this.sortByFrame();if(this.getNbKeys()>1){this._computeStepsValues()}this.listValues.clear()},removeKey:function(c){var b=null,a=0;for(a;a<this._listKeys.length-1;a++){if(this._listKeys[a].frame===c){b=this._listKeys[a];break}}this._listKeys.without(b);this._computeStepsValues();if(this.listValues.length>0){this.computeValues(0)}},removeAll:function(){this.listValues.clear();this._listKeys.clear();this._listSteps.clear()},_computeStepsValues:function(){this._listSteps.clear();var a=0,b=0,c=0;for(c;c<this._listKeys.length-1;c++){a=this._listKeys[c+1].frame-this._listKeys[c].frame;b=this._listKeys[c+1].value-this._listKeys[c].value;this._listSteps.push(b/a)}},getNbKeys:function(){return this._listKeys.length},sortByFrame:function(){this._listKeys.sort(function(d,c){return d.frame-c.frame})},computeValues:function(a,h){if(arguments.length===2){this.method=h}this.listValues.clear();var g=this.getNbKeys();if(g<=1){return}var e=0,d=0,c=0,b=0;for(b;b<g-1;++b){e=this._listKeys[b+1].frame-this._listKeys[b].frame;for(d=0;d<=e;++d){this.listValues[c++]=this.computeValue(b,this._listKeys[b].frame+d,h)}}},computeValue:function(c,e,f){if(c<0){return undefined}var d=this._listKeys[c];var a=this._listKeys[c+1];if(e===d.frame){return{frame:e,value:d.value}}if(e===a.frame){return{frame:e,value:a.value}}var b=e-d.frame;if(f==="linear"){return{frame:e,value:b*this._listSteps[c]+d.value}}return undefined},getFirstKey:function(){if(this.getNbKeys()===0){return null}return this._listKeys[0]},getLastKey:function(){if(this.getNbKeys()===0){return null}return this._listKeys[this.getNbKeys()-1]},getValue:function(d){var e=this.getNbKeys();if(e===0&&this.listValues.length===0){return undefined}if(this.listValues.length===0){var c=-1;if(d<this._listKeys[0].frame){return undefined}var a;for(a=1;a<e;a++){if(d<this._listKeys[a].frame){c=a-1;break}}return this.computeValue(c,d,this.method)}if(d<this.listValues[0].frame){return undefined}if(d>=this.listValues[this.listValues.length-1].frame){return this.listValues[this.listValues.length-1]}var b;for(b=0;b<this.listValues.length;b++){if(this.listValues[b].frame===d){return this.listValues[b]}}return undefined},exportValues:function(){if(this.listValues.length===0){this.computeValues(cgsgCurrentFrame,this.method)}var a=[],b;for(b=0;b<this.listValues.length;b++){a.push(this.listValues[b].value)}return a},importValues:function(a,c){this.listValues.clear();var b;for(b=0;b<a.length;b++){this.listValues.push({frame:c+b,value:a[b]})}}});"use strict";var CGSGNode=CGSGObject.extend({initialize:function(b,f,e,a){this.name="";this.isSelected=false;this.classType="CGSGNODE";this.resizeHandles=[];this.globalAlpha=1;this.isVisible=true;this.isProportionalResize=false;this.pickNodeMethod=CGSGPickNodeMethod.REGION;this.children=[];this.regionConstraint=null;this.rotationCenter=null;this.userdata=null;this.isClickable=true;this.isResizable=false;this.isDraggable=false;this.needToKeepAbsoluteMatrix=true;this.selectionLineColor=CGSG_DEFAULT_SELECTED_STROKE_COLOR;this.selectionLineWidth=CGSG_DEFAULT_SELECTED_STROKE_SIZE;this.selectionHandleSize=CGSG_DEFAULT_SELECTED_RESIZEHANDLE_SIZE;this.selectionHandleColor=CGSG_DEFAULT_SELECTED_RESIZEHANDLE_COLOR;this.isMouseOver=false;this.isMoving=false;this.isResizing=false;this._id=0;this._parentNode=null;this.position=new CGSGPosition(0,0);this._absolutePosition=new CGSGPosition(0,0);this.dimension=new CGSGDimension(0,0);this.scale=new CGSGScale(1,1);this._absoluteScale=new CGSGScale(1,1);this.rotation=new CGSGRotation(0);this._absoluteRotation=new CGSGRotation(0);this._isDrag=false;this.isTraversable=true;this.isCollisionManaged=false;this.translateTo(b,f,true);this.resizeTo(e,a);for(var d=0;d<8;d++){var c=new CGSGHandleBox(this,this.selectionHandleSize,this.selectionHandleColor,this.selectionLineColor,this.selectionLineWidth,0,0);this.resizeHandles.push(c)}this.onMouseOver=null;this.onMouseEnter=null;this.onMouseOut=null;this.onMouseUp=null;this.onClick=null;this.onDblClick=null;this.onDrag=null;this.onDragEnd=null;this.onResize=null;this.onResizeEnd=null;this.onSelect=null;this.onDeselect=null;this.computeAbsoluteMatrix(true)},getRegion:function(){return new CGSGRegion(this.position.x,this.position.y,this.getWidth(),this.getHeight())},getAbsoluteRegion:function(){return new CGSGRegion(this.getAbsoluteLeft(),this.getAbsoluteTop(),this.getAbsoluteWidth(),this.getAbsoluteHeight())},_clearContext:function(c,a,b){c.clearRect(0,0,a,b)},render:function(a){this.beforeRender(a);this.afterRender(a)},renderGhost:function(a){this.beforeRenderGhost(a);this.afterRenderGhost(a)},renderSelected:function(c){this._absolutePosition=this.getAbsolutePosition();this._absoluteScale=this.getAbsoluteScale();c.strokeStyle=this.selectionLineColor;c.lineWidth=this.selectionLineWidth/this._absoluteScale.y;c.beginPath();c.moveTo(0,0);c.lineTo(this.dimension.width,0);c.moveTo(0,this.dimension.height);c.lineTo(this.dimension.width,this.dimension.height);c.stroke();c.closePath();c.lineWidth=this.selectionLineWidth/this._absoluteScale.x;c.beginPath();c.moveTo(0,0);c.lineTo(0,this.dimension.height);c.moveTo(this.dimension.width,0);c.lineTo(this.dimension.width,this.dimension.height);c.stroke();c.closePath();if(this.isResizable){var d=this.selectionHandleSize/(2*this._absoluteScale.x);var b=this.selectionHandleSize/(2*this._absoluteScale.y);this.resizeHandles[0].translateTo(-d,-b);this.resizeHandles[1].translateTo(this.dimension.width/2-d,-b);this.resizeHandles[2].translateTo(this.dimension.width-d,-b);this.resizeHandles[3].translateTo(-d,this.dimension.height/2-b);this.resizeHandles[4].translateTo(this.dimension.width-d,this.dimension.height/2-b);this.resizeHandles[6].translateTo(this.dimension.width/2-d,this.dimension.height-b);this.resizeHandles[5].translateTo(-d,this.dimension.height-b);this.resizeHandles[7].translateTo(this.dimension.width-d,this.dimension.height-b);for(var a=0;a<8;a++){this.resizeHandles[a].size=this.selectionHandleSize;this.resizeHandles[a].fillColor=this.selectionHandleColor;this.resizeHandles[a].strokeColor=this.selectionLineColor;this.resizeHandles[a].lineWidth=this.selectionLineWidth;this.resizeHandles[a].render(c)}}},beforeRender:function(a){a.save();a.translate(this.position.x,this.position.y);if(cgsgExist(this.rotationCenter)){a.translate(this.dimension.width*this.rotationCenter.x,this.dimension.height*this.rotationCenter.y);a.rotate(this.rotation.angle);a.translate(-this.dimension.width*this.rotationCenter.x,-this.dimension.height*this.rotationCenter.y)}else{a.rotate(this.rotation.angle)}a.scale(this.scale.x,this.scale.y)},afterRender:function(d){if(!this.isALeaf()){for(var c=0,a=this.children.length;c<a;++c){var b=this.children[c];if(b.isVisible){b.render(d)}}}d.restore()},beforeRenderGhost:function(a){a.save();a.translate(this._absolutePosition.x,this._absolutePosition.y);a.rotate(this._absoluteRotation.angle);a.scale(this._absoluteScale.x,this._absoluteScale.y)},afterRenderGhost:function(a){a.restore()},setSelected:function(a){this.isSelected=a;this._isDrag=true;if(a&&this.onSelect!==null){this.onSelect({node:this})}else{if(this.onDeselect!==null){this.onDeselect({node:this})}}},detectSelection:function(d,a,b){if(this.pickNodeMethod==CGSGPickNodeMethod.REGION){if(d.x>=this._absolutePosition.x&&d.x<this._absolutePosition.x+this.getWidth()*b.x&&d.y>=this._absolutePosition.y&&d.y<this._absolutePosition.y+this.getHeight()*b.y){return this}}else{this.renderGhost(a);var c=a.getImageData(d.x,d.y,1,1);cgsgClearContext(a);if(c.data[0]!=0||c.data[1]!=0||c.data[2]!=0){return this}}return null},detectSelectionInRegion:function(f,b,d){if(this.pickNodeMethod==CGSGPickNodeMethod.REGION){var e=this.getAbsoluteRegion();if(cgsgRegionIsInRegion(e,f,0)){return this}}else{this.renderGhost(b);var g=b.getImageData(f.position.x,f.position.y,f.dimension.width,f.dimension.height);cgsgClearContext(b);for(var c=0,a=g.length;c<a;++c){if(g.data[c]!=0){return this}}}return null},pickNode:function(k,h,c,g,d){var f=null;var b=null;if(cgsgExist(h)){b=h.copy();b.multiply(this.scale)}else{b=this.getAbsoluteScale()}if(this.isTraversable&&(this.isClickable||this.isResizable||this.isDraggable)){if(!cgsgExist(d)||d(this)===true){this.computeAbsoluteMatrix(false);f=this.detectSelection(k,c,b)}}if(this.isTraversable&&g&&!this.isALeaf()){for(var e=this.children.length-1;e>=0;--e){var a=this.children[e];var j=a.pickNode(k,b,c,g,d);if(j!==null&&j!==undefined){f=j;break}}b=null}return f},pickNodes:function(h,l,c,j,d){var k=[];var b=null;if(cgsgExist(l)){b=l.copy();b.multiply(this.scale)}else{b=this.getAbsoluteScale()}if(this.isTraversable&&(this.isResizable||this.isDraggable)){if(!cgsgExist(d)||d(this)===true){this.computeAbsoluteMatrix(false);var e=this.detectSelectionInRegion(h,c,b);if(cgsgExist(e)){k.push(e)}}}if(this.isTraversable&&j&&!this.isALeaf()){for(var f=this.children.length-1;f>=0;--f){var a=this.children[f];var g=a.pickNodes(h,b,c,j,d);if(g!==null&&g!==undefined){k=k.concat(g)}}b=null}return k},isALeaf:function(){return this.children.length<=0},translateTo:function(b,a,c){this.position.translateTo(b,a);if(this.needToKeepAbsoluteMatrix&&c!==false){this._absolutePosition=this.getAbsolutePosition()}},translateWith:function(a,c,b){this.position.translateWith(a,c);if(this.needToKeepAbsoluteMatrix&&b!==false){this._absolutePosition=this.getAbsolutePosition()}},translateBy:function(a,c,b){this.position.translateBy(a,c);if(this.needToKeepAbsoluteMatrix&&b!==false){this._absolutePosition=this.getAbsolutePosition()}},resizeTo:function(b,a){this.dimension.resizeTo(b,a)},resizeBy:function(b,a){this.dimension.resizeBy(b,a)},resizeWith:function(b,a){this.dimension.resizeWith(b,a)},scaleTo:function(b,a,c){this.scale.x=b;this.scale.y=a;if(this.needToKeepAbsoluteMatrix&&c!==false){this._absoluteScale=this.getAbsoluteScale()}},scaleBy:function(a,c,b){this.scale.x*=a;this.scale.y*=c;if(this.needToKeepAbsoluteMatrix&&b!==false){this._absoluteScale=this.getAbsoluteScale()}},scaleWith:function(a,c,b){this.scale.x+=a;this.scale.y+=c;if(this.needToKeepAbsoluteMatrix&&b!==false){this._absoluteScale=this.getAbsoluteScale()}},rotateTo:function(b,a){this.rotation.rotateTo(b);if(this.needToKeepAbsoluteMatrix&&a!==false){this._absoluteRotation=this.getAbsoluteRotation()}},rotateBy:function(a,b){this.rotation.rotateBy(a);if(this.needToKeepAbsoluteMatrix&&b!==false){this._absoluteRotation=this.getAbsoluteRotation()}},rotateWith:function(b,a){this.rotation.rotateWith(b);if(this.needToKeepAbsoluteMatrix&&a!==false){this._absoluteRotation=this.getAbsoluteRotation()}},addChild:function(a){a._parentNode=this;this.children[this.children.length]=a},addChildAt:function(c,a){if(a>this.children.length){a=this.children.length}for(var b=this.children.length;b>=a;--b){this.children[b]=this.children[b-1]}c._parentNode=this;this.children[a]=c},removeChild:function(f,b){var c=this.children.indexOf(f);if(c>=0){this.children.without(f);f.free();return true}if(b){for(var e=0,a=this.children.length;e<a;++e){var d=this.children[e];if(d.removeChild(f,true)){return true}}}return false},removeAll:function(){this.free()},detachChildAt:function(a){if(a>=0&&a<this.children.length){this.detachChild(this.children[a])}},detachChild:function(a){if(cgsgExist(a)){a._parentNode=null;this.children.without(a)}},evalSet:function(attribute,value){if(attribute=="position.x"){this.translateTo(value,this.position.y,this.needToKeepAbsoluteMatrix)}else{if(attribute=="position.y"){this.translateTo(this.position.x,value,this.needToKeepAbsoluteMatrix)}else{if(attribute=="dimension.width"){this.resizeTo(value,this.dimension.height,this.needToKeepAbsoluteMatrix)}else{if(attribute=="dimension.height"){this.resizeTo(this.dimension.width,value,this.needToKeepAbsoluteMatrix)}else{if(attribute=="scale.x"){this.scaleTo(value,this.scale.y,this.needToKeepAbsoluteMatrix)}else{if(attribute=="scale.y"){this.scaleTo(this.scale.x,value,this.needToKeepAbsoluteMatrix)}else{if(attribute=="rotation"||attribute=="rotation.angle"){this.rotateTo(value,this.needToKeepAbsoluteMatrix)}else{if(attribute=="globalAlpha"){this.globalAlpha=value}else{if(attribute=="isVisible"){this.isVisible=value}else{if(attribute=="rotationCenter.x"){this.rotationCenter.x=value}else{if(attribute=="rotationCenter.y"){this.rotationCenter.y=value}else{if(attribute=="color.r"){var rgb=CGSGColor.hex2rgb(this.color);this.color=CGSGColor.rgb2hex(value,rgb.g,rgb.b)}else{if(attribute=="color.g"){var rgb=CGSGColor.hex2rgb(this.color);this.color=CGSGColor.rgb2hex(rgb.r,value,rgb.b)}else{if(attribute=="color.b"){var rgb=CGSGColor.hex2rgb(this.color);this.color=CGSGColor.rgb2hex(rgb.r,rgb.g,value)}else{eval("this."+attribute+"="+value)}}}}}}}}}}}}}}},setRegionConstraint:function(a){this.regionConstraint=a},getAbsolutePosition:function(){var b=this;var a=this.position.copy();while(b._parentNode!==null){a.multiply(b._parentNode.scale);b=b._parentNode}if(this._parentNode!==null){a.add(this._parentNode.getAbsolutePosition())}return a},getAbsoluteScale:function(){var b=this;var a=this.scale.copy();while(b._parentNode!==null){a.multiply(b._parentNode.scale);b=b._parentNode}return a},getAbsoluteRotation:function(){var b=this;var a=this.rotation.copy();while(b._parentNode!==null){a.add(b._parentNode.rotation.angle);b=b._parentNode}return a},computeAbsoluteMatrix:function(a){this._absolutePosition=this.getAbsolutePosition();this._absoluteScale=this.getAbsoluteScale();this._absoluteRotation=this.getAbsoluteRotation();if(a!==false){for(var b=0;b<this.children.length;b++){if(cgsgExist(this.children[b])){this.children[b].computeAbsoluteMatrix(a)}}}},getAbsoluteLeft:function(){return this._absolutePosition.x},getAbsoluteRight:function(){return this._absolutePosition.x+this.getAbsoluteWidth()},getAbsoluteTop:function(){return this._absolutePosition.y},getAbsoluteBottom:function(){return this._absolutePosition.y+this.getAbsoluteHeight()},getAbsoluteWidth:function(){return this.getWidth()*this._absoluteScale.x},getAbsoluteHeight:function(){return this.getHeight()*this._absoluteScale.y},getWidth:function(){return this.dimension.width},getHeight:function(){return this.dimension.height},isColliding:function(b,a){return cgsgCollisionManager.isColliding(this,b,a)},getListOfCollidingBrothers:function(a){var d=[];var b=null;for(var c=0;c<this._parentNode.children.length;c++){b=this._parentNode.children[c];if(b!==this&&this.isColliding(b,a)){d.push(b)}}return d},isCollidingABrother:function(a){var b=null;for(var c=0;c<this._parentNode.children.length;c++){b=this._parentNode.children[c];if(b!==this&&this.isColliding(b,a)){return true}}return false},copy:function(a){if(a===null||a===undefined){a=new CGSGNode(this.position.x,this.position.y,this.dimension.width,this.dimension.height)}a.classType=this.classType;a.name=this.name;a.globalAlpha=this.globalAlpha;a.isVisible=this.isVisible;a.isProportionalResize=this.isProportionalResize;a.pickNodeMethod=this.pickNodeMethod;a.needToKeepAbsoluteMatrix=this.needToKeepAbsoluteMatrix;if(this.regionConstraint!==null){a.regionConstraint=this.regionConstraint.copy()}if(this.userdata!==null){a.userdata=this.userdata.copy()}a.isClickable=this.isClickable;a.isResizable=this.isResizable;a.isDraggable=this.isDraggable;a.isTraversable=this.isTraversable;a.selectionLineColor=this.selectionLineColor;a.selectionLineWidth=this.selectionLineWidth;a.selectionHandleSize=this.selectionHandleSize;a.selectionHandleColor=this.selectionHandleColor;a._id=this._id;a._ghostColor=cgsgGhostColor;a.translateTo(this.position.x,this.position.y);a.resizeTo(this.dimension.width,this.dimension.height);a.scaleTo(this.scale.x,this.scale.y);a.rotateTo(this.rotation.angle);a.selectableZone=new CGSGRegion(a.position.x,a.position.y,a.dimension.width,a.dimension.height);a.onMouseOver=this.onMouseOver;a.onMouseOut=this.onMouseOut;a.onClick=this.onClick;a.onDblClick=this.onDblClick;a.onDrag=this.onDrag;a.onDragEnd=this.onDragEnd;a.onResize=this.onResize;a.onResizeEnd=this.onResizeEnd;a.onSelect=this.onSelect;a.onDeselect=this.onDeselect;a.computeAbsoluteMatrix(true);return a},free:function(){for(var a=this.children.length-1;a>=0;a--){this.children[a].free()}this.children.clear();cgsgFree(this)}});var CGSG_COLORPICKER_WIDTH=256;var CGSG_COLORPICKER_HEIGHT=384;var CGSGNodeColorPicker=CGSGNode.extend({initialize:function(a,c){this._super(a,c,CGSG_COLORPICKER_WIDTH,CGSG_COLORPICKER_HEIGHT);this._imgData=null;this._tmpCanvas=null;this._initShape();var b=this;this.onMouseOver=function(d){b._onMouseOverHandler(d)};this.onMouseUp=function(d){b._onClickHandler(d)};this.onClick=function(d){b._onClickHandler(d)};this.onOverColor=null;this.onClickColor=null},_initShape:function(){this._tmpCanvas=document.createElement("canvas");this._tmpCanvas.width=this.dimension.width+2;this._tmpCanvas.height=this.dimension.height+2;var d=this._tmpCanvas.getContext("2d");this._imgData=d.createImageData(this.getWidth(),this.getHeight());var j,i,c=1,n,b=0;var g=[255,0,0],o=0,l,k,m;var f=CGSGMath.fixedPoint(Math.min(this.getWidth()*0.1,20));var a=this.getWidth()-f;var h=[{index:1,sens:1},{index:0,sens:-1},{index:2,sens:1},{index:1,sens:-1},{index:0,sens:1},{index:2,sens:-1}];n=256/(a/6);var e=this.getHeight()/2;for(j=0;j<f;j++){for(i=0;i<this.getHeight();i++){b=(i*this.getWidth()+j)*4;c=1-(i/this.getHeight());this._imgData.data[b+0]=255*c;this._imgData.data[b+1]=255*c;this._imgData.data[b+2]=255*c;this._imgData.data[b+3]=255}}for(j=f;j<this.getWidth();j++){c=1;for(i=0;i<this.getHeight();i++){b=(i*this.getWidth()+j)*4;if(i<e){c=2-(i/e);m=CGSGColor.litRGB(g[0],g[1],g[2],c)}else{c=1-((i-e)/e);m=CGSGColor.darkenRGB(g[0],g[1],g[2],c)}this._imgData.data[b+0]=m.r;this._imgData.data[b+1]=m.g;this._imgData.data[b+2]=m.b;this._imgData.data[b+3]=255}l=n*h[o].sens;k=g[h[o].index]+l;g[h[o].index]=k;if(k<=0||k>=255){g[h[o].index]=Math.min(Math.max(k,0),255);o++}}d.putImageData(this._imgData,0,0)},resizeTo:function(a,b){this._super(a,b);this._initShape()},resizeWith:function(a,b){this._super(a,b);this._initShape()},resizeBy:function(a,b){this._super(a,b);this._initShape()},_onMouseOverHandler:function(b){if(cgsgExist(this.onOverColor)){var a=this.getColorAt(b.position[0]);this.onOverColor(a)}},_onClickHandler:function(b){if(cgsgExist(this.onClickColor)){var a=this.getColorAt(b.position[0]);this.onClickColor(a)}},getColorAt:function(b){var c=this.getAbsolutePosition();var e=this.getAbsoluteWidth();var d=this._imgData.data;var a=CGSGMath.fixedPoint((b.x-c.x));var f=CGSGMath.fixedPoint((b.y-c.y));return{r:d[((e*f)+a)*4],g:d[((e*f)+a)*4+1],b:d[((e*f)+a)*4+2]}},render:function(a){this.beforeRender(a);a.globalAlpha=this.globalAlpha;a.drawImage(this._tmpCanvas,0,0);this.afterRender(a)}});var CGSGTABHEIGHT=35;var CGSGNodeTabMenu=CGSGNode.extend({initialize:function(a,e,b){this._super(a,e,b,CGSGTABHEIGHT);this.classType="CGSGNodeTabMenu";this._buttonRadius=4;this._tabsContainer=new CGSGNode(0,0,b,0);this._tabsContainer.color="#A0A0A0";this._tabsContainer.lineWidth=0;this.addChild(this._tabsContainer);var d=new CGSGNodeSquare(0,CGSGTABHEIGHT-this._buttonRadius+1,b,this._buttonRadius);d.color="white";d.lineWidth=0;this.addChild(d);var c=new CGSGNodeSquare(0,CGSGTABHEIGHT-this._buttonRadius,b,1);c.color="#A0A0A0";c.lineWidth=0;this.addChild(c);this.hideUnderline=new CGSGNodeSquare(0,CGSGTABHEIGHT-this._buttonRadius,b,1);this.hideUnderline.color="white";this.hideUnderline.lineWidth=0;this.addChild(this.hideUnderline);this._tabsBaseline=new CGSGNode(0,CGSGTABHEIGHT-this._buttonRadius+1,b,0);this.addChild(this._tabsBaseline);this.tabs=[];this.onTabChanged=null;this._selectedTab=null},addTab:function(f,a){var b=this.tabs.length;var c=new CGSGNodeButton(0,0,f);c.setHorizontalPadding(10);c.setVerticalPadding(8);c.setTextSizes([10,10,10]);c.setFirstColors(["#EAEAEA","white","white"]);c.setLastColors(["#EAEAEA","white","white"]);c.setTextColors(["#999999","#000000","#000000"]);c._lineWidth=1;c._strokeColor="#A0A0A0";c.setRadiuses([this._buttonRadius,this._buttonRadius,this._buttonRadius]);c._initShapes();var d={button:c,view:a};this.tabs.push(d);var e=this;c.onClick=function(g){e.selectTab(d)};this._tabsContainer.addChild(c);this._recomputeButtonsWidth();if(!cgsgExist(this._selectedTab)){this.selectTab(d)}return d},selectTab:function(b){if(cgsgExist(this._selectedTab)){if(cgsgExist(this._selectedTab.view)){this._selectedTab.view.isVisible=true;this._selectedTab.view.isTraversable=true}this._tabsBaseline.detachChild(this._selectedTab.view)}this._tabsBaseline.addChild(b.view);this._selectedTab=b;for(var a=0;a<this.tabs.length;a++){this.tabs[a].view.isVisible=false;this.tabs[a].view.isTraversable=false;this.tabs[a].button.setMode(CGSGButtonMode.NORMAL)}if(cgsgExist(b.view)){b.view.isVisible=true;b.view.isTraversable=true}b.button.setMode(CGSGButtonMode.SELECTED);this.hideUnderline.translateTo(b.button.position.x,this.hideUnderline.position.y);this.hideUnderline.resizeTo(b.button.getWidth(),1);if(cgsgExist(this.onTabChanged)){this.onTabChanged({tab:b})}return b},selectTabByIndex:function(a){return this.selectTab(this.tabs[a])},_recomputeButtonsWidth:function(){var a=0;var d;var e=0;for(d=0;d<this.tabs.length;d++){var c=this.tabs[d].button.getWidth();a+=c;e=Math.max(e,c)}if(a>this.getWidth()||this.tabs.length*e>this.getWidth()){var b=this.getWidth()/this.tabs.length;for(d=0;d<this.tabs.length;d++){this.tabs[d].button.setFixedSize(new CGSGDimension(b,CGSGTABHEIGHT));this.tabs[d].button.translateTo(d*b,0)}}else{for(d=0;d<this.tabs.length;d++){this.tabs[d].button.setFixedSize(new CGSGDimension(e,CGSGTABHEIGHT));this.tabs[d].button.translateTo(d*e,0)}}}});var CGSGWrapMode={WORD:{space:" "},LETTER:{space:""},SENTENCE:{space:"."}};var CGSGNodeText=CGSGNode.extend({initialize:function(a,d,c,b){this._super(a,d,-1,-1);this._text="";this.color="#444444";this._size=18;this._textAlign="left";this._textBaseline="top";this._stroke=false;this._typo="Arial";this._maxWidth=-1;this._lineHeight=this._size;this._wrapMode=CGSGWrapMode.LETTER;this._sections=[];this._tabulation="    ";this.pickNodeMethod=CGSGPickNodeMethod.GHOST;this.metrics={width:1};this._nbLines=1;this.classType="CGSGNodeText";this.setText(c,b!==false);this.resizeTo(this.getWidth(),this.getHeight())},setWrapMode:function(b,a){this._wrapMode=b;if(a!==false){this.computeRealDimension()}},setTabulationString:function(b,a){this._tabulation=b;this._text=this._text.replace(/(\t)/g,this._tabulation);if(a!==false){this.computeRealDimension()}},setStroke:function(b,a){this._stroke=b;if(a!==false){this.computeRealDimension()}},setText:function(b,a){this._text=b;this._text=this._text.replace(/(\r\n|\n\r|\r|\n)/g,"\n");this._text=this._text.replace(/(\t)/g,this._tabulation);this._sections=this._text.split("\n");if(a!==false){this.computeRealDimension()}},setSize:function(b,a){this._size=b;if(a!==false){this.computeRealDimension()}},setTextAlign:function(b){this._textAlign=b},setTextBaseline:function(a,c){this._textBaseline=a;if(c!==false){this.computeRealDimension()}},setTypo:function(b,a){this._typo=b;if(a!==false){this.computeRealDimension()}},setMaxWidth:function(a,b){this._maxWidth=a;this.resizeTo(a,this.getHeight());if(b!==false){this.computeRealDimension()}},setLineHeight:function(b,a){this._lineHeight=b;if(a!==false){this.computeRealDimension()}},computeRealDimension:function(){this.metrics.width=0;var b=document.createElement("canvas");b.height=800;b.width=1000;var a=b.getContext("2d");this._doRender(a,false);b.width=0;b.height=0;delete (b)},render:function(a){this.beforeRender(a);a.fillStyle=this.color;this._doRender(a,false);this.afterRender(a)},_doRender:function(d,h){d.font=this._size+"pt "+this._typo;d.textAlign=this._textAlign;d.textBaseline=this._textBaseline;var i=0;var f=0;var b=0;var a=0;if(isNaN(this._maxWidth)||this._maxWidth<=0){b=this._computeDecalX(this.getWidth());for(i=0;i<this._sections.length;i++){f=d.measureText(this._sections[i]).width;this._drawText(this._sections[i],b,a,d,h,f);a+=this._lineHeight}this._nbLines=this._sections.length}else{this._nbLines=0;for(i=0;i<this._sections.length;i++){var g=this._sections[i].split(this._wrapMode.space);var c=1;var e=g[0];a=0;f=0;if(g.length==1){f=d.measureText(e).width;a=this._nbLines*this._lineHeight;b=this._computeDecalX(this.getWidth());this._drawText(e,b,a,d,h,f);this._nbLines++}else{while(c<g.length){while((f=d.measureText(e).width)<this._maxWidth&&c<g.length){if(e!=""){e+=this._wrapMode.space}e+=g[c++]}f=d.measureText(e).width;a=this._nbLines*this._lineHeight;b=this._computeDecalX(this.getWidth());this._drawText(e,b,a,d,h,f);this._nbLines++;e="";f=0}}}}},_drawText:function(f,a,g,c,e,d){if(e===true){return this._drawSquare(a,g,d,c)}if(this._stroke){c.strokeText(f,a,g)}else{c.fillText(f,a,g)}var b=c.measureText(f);if(b.width>this.metrics.width){this.metrics.width=b.width}},_drawSquare:function(a,d,c,b){b.fillRect(a-this._computeDecalX(c),d+this._computeDecalY(),c,this._size)},getHeight:function(){if(this._nbLines==0){return this._nbLines}return((this._nbLines-1)*this._lineHeight)+this._size},getWidth:function(){return this.metrics.width},_computeDecalX:function(b){var a=0;if(this._textAlign=="start"||this._textAlign=="left"){a=0}else{if(this._textAlign=="center"){a=b/2}else{if(this._textAlign=="end"||this._textAlign=="right"){a=b}}}return a},_computeDecalY:function(){var a=0;if(this._textBaseline=="top"||this._textBaseline=="hanging"){a=this._size/cgsgCurrentExplorer.textDecalYTop}else{if(this._textBaseline=="middle"){a=-this._size/cgsgCurrentExplorer.textDecalYMiddle}else{if(this._textBaseline=="alphabetic"||this._textBaseline=="ideographic"){a=-this._size*cgsgCurrentExplorer.textDecalYAlpha}else{if(this._textBaseline=="bottom"){a=-this._size*cgsgCurrentExplorer.textDecalYBottom}}}}return a},renderGhost:function(a){this.beforeRenderGhost(a);a.fillStyle=cgsgGhostColor;this._doRender(a,true);this.afterRenderGhost(a)},renderSelected:function(e){var h=0;var d=this._computeDecalY();this._absolutePosition=this.getAbsolutePosition();this._absoluteScale=this.getAbsoluteScale();var a=this.getHeight();var g=this.getWidth();e.strokeStyle=this.selectionLineColor;e.lineWidth=this.selectionLineWidth/this._absoluteScale.y;e.beginPath();e.moveTo(h,d);e.lineTo(g,d);e.moveTo(h,d+a);e.lineTo(g,d+a);e.stroke();e.closePath();e.lineWidth=this.selectionLineWidth/this._absoluteScale.x;e.beginPath();e.moveTo(h,d);e.lineTo(h,d+a);e.moveTo(h+g,d);e.lineTo(h+g,d+a);e.stroke();e.closePath();if(this.isResizable){var f=this.selectionHandleSize/(2*this._absoluteScale.x);var c=this.selectionHandleSize/(2*this._absoluteScale.y);this.resizeHandles[0].translateTo(-f,-c+d);this.resizeHandles[1].translateTo(g/2-f,-c+d);this.resizeHandles[2].translateTo(g-f,-c+d);this.resizeHandles[3].translateTo(-f,a/2-c+d);this.resizeHandles[4].translateTo(g-f,a/2-c+d);this.resizeHandles[6].translateTo(g/2-f,a-c+d);this.resizeHandles[5].translateTo(-f,a-c+d);this.resizeHandles[7].translateTo(g-f,a-c+d);for(var b=0;b<8;b++){this.resizeHandles[b].size=this.selectionHandleSize;this.resizeHandles[b].color=this.selectionHandleColor;this.resizeHandles[b].render(e)}}},copy:function(){var a=new CGSGNodeText(this.position.x,this.position.y,this._text);a=this._super(a);a.color=this.color;a.setSize(this._size,false);a.setTextAlign(this._textAlign,false);a.setTextBaseline(this._textBaseline,false);a.setStroke(this._stroke,false);a.setTypo(this._typo,false);a.setMaxWidth(this._maxWidth,false);a.setLineHeight(this._lineHeight,false);a.setWrapMode(this._wrapMode,false);a.setTabulationString(this._tabulation,false);a.pickNodeMethod=this.pickNodeMethod;this.setText(this._text,true);this.resizeTo(this.getWidth(),this.getHeight());return a}});var CGSGWEBVIEWMODE={LIVE:0,PREVIEW:1};"use strict";var CGSGNodeWebview=CGSGNode.extend({initialize:function(b,e,d,a,c){this._super(b,e,CGSGMath.fixedPoint(d),CGSGMath.fixedPoint(a));this.threshold=20;this.color="lightGray";this.lineColor="Gray";this.classType="CGSGNodeWebview";this._liveContainer=null;this._previewContainer=null;this._url=c;this._previewURL=null;this._createLiveContainer();this._createPreviewContainer();this.switchMode(CGSGWEBVIEWMODE.LIVE)},_initLiveContainer:function(){if(!cgsgExist(this._liveContainer)){this._createLiveContainer()}document.body.appendChild(this._liveContainer)},_initPreviewContainer:function(){if(!cgsgExist(this._previewContainer)){this._createPreviewContainer()}this.addChild(this._previewContainer)},_createLiveContainer:function(){var a="";if(cgsgExist(this._url)){a=this._url}this._liveContainer=document.createElement("IFRAME");this._liveContainer.style.position="absolute";this._liveContainer.setAttribute("src",a)},_createPreviewContainer:function(){this._previewContainer=new CGSGNodeImage(0,0,this._previewURL);this._previewContainer.isTraversable=false},setURL:function(a){this._url=a;if(cgsgExist(this._liveContainer)){this._liveContainer.setAttribute("src",this._url)}},getURL:function(){return this._url},setPreviewURL:function(a){this._previewURL=a;this._previewContainer.setURL(this._previewURL)},switchMode:function(a){if(a===CGSGWEBVIEWMODE.LIVE){this.detachChild(this._previewContainer);this._initLiveContainer()}else{if(this._mode===CGSGWEBVIEWMODE.LIVE){document.body.removeChild(this._liveContainer)}this._initPreviewContainer()}this._mode=a},getCurrentMode:function(){return this._mode},render:function(a){this.beforeRender(a);a.globalAlpha=this.globalAlpha;if(this._mode===CGSGWEBVIEWMODE.LIVE){a.fillStyle=this.color;a.strokeStyle=this.lineColor;a.lineWidth=this.lineWidth;a.fillRect(0,0,this.dimension.width,this.dimension.height);a.strokeRect(0,0,this.dimension.width,this.dimension.height);a.strokeRect(this.threshold-2,this.threshold-2,8+this.dimension.width-this.threshold*2,8+this.dimension.height-this.threshold*2);if(cgsgExist(this._liveContainer)){this._liveContainer.style.left=(this.getAbsoluteLeft()+this.threshold)+"px";this._liveContainer.style.top=(this.getAbsoluteTop()+this.threshold)+"px";this._liveContainer.style.width=(this.getAbsoluteWidth()-this.threshold*2)+"px";this._liveContainer.style.height=(this.getAbsoluteHeight()-this.threshold*2)+"px"}}else{this._previewContainer.resizeTo(this.getWidth(),this.getHeight());a.fillStyle=this.color;a.fillRect(0,0,this.getWidth(),this.getHeight())}this.afterRender(a)},free:function(){if(cgsgExist(this._liveContainer)){cgsgCanvas.removeChild(this._liveContainer);delete (this._liveContainer)}this._super()},copy:function(){var a=new CGSGNodeWebview(this.position.x,this.position.y,this.dimension.width,this.dimension.height,this.url);a=this._super(a);a.threshold=this.threshold;a.color=this.color;a.lineColor=this.lineColor;a.switchMode(this.mode);return a}});var CGSGNodeSquare=CGSGNode.extend({initialize:function(b,d,c,a){this._super(b,d,c,a);this.color="#444444";this.lineColor="#222222";this.lineWidth=0;this.classType="CGSGNodeSquare"},render:function(a){this.beforeRender(a);a.globalAlpha=this.globalAlpha;a.fillStyle=this.color;a.fillRect(0,0,this.dimension.width,this.dimension.height);if(this.lineWidth>0){a.strokeStyle=this.lineColor;a.lineWidth=this.lineWidth;a.strokeRect(0,0,this.dimension.width,this.dimension.height)}this.afterRender(a)},copy:function(){var a=new CGSGNodeSquare(this.position.x,this.position.y,this.dimension.width,this.dimension.height);a=this._super(a);a.color=this.color;a.lineColor=this.lineColor;a.lineWidth=this.lineWidth;return a}});var CGSGNodeCircle=CGSGNode.extend({initialize:function(c,b,a){this._radius=a;this._center=new CGSGPosition(c,b);this._super(0,0,a*2,a*2);this.translateTo(c-a,b-a);this.color="#444444";this.lineColor="#222222";this.lineWidth=0;this.pickNodeMethod=CGSGPickNodeMethod.GHOST;this.isProportionalResize=true;this.classType="CGSGNodeCircle"},setRadius:function(a){this._radius=a;this.dimension.width=this._radius*2;this.dimension.height=this.dimension.width},setCenter:function(a){this._center=a;this.position.x=this._center.x-this._radius;this.position.y=this._center.y-this._radius},render:function(a){this.beforeRender(a);a.globalAlpha=this.globalAlpha;a.beginPath();a.arc(this._center.x-this._radius,this._center.y-this._radius,this._radius,0,2*Math.PI,false);a.fillStyle=this.color;a.fill();if(this.lineWidth>0){a.lineWidth=this.lineWidth;a.strokeStyle=this.lineColor;a.stroke()}this.afterRender(a)},resizeTo:function(b,a){this.dimension.resizeTo(b,a);this._computeResizedRadius()},resizeBy:function(b,a){this.dimension.resizeBy(b,a);this._computeResizedRadius()},resizeWith:function(b,a){this.dimension.resizeWith(b,a);this._computeResizedRadius()},_computeResizedRadius:function(){var a=this._radius;this._radius=Math.min(this.dimension.width,this.dimension.height)/2;a=-2*(a-this._radius);this._center.x+=a;this._center.y+=a},renderGhost:function(a){this.beforeRenderGhost(a);if(this.globalAlpha>0){a.beginPath();a.arc(this._center.x-this._radius,this._center.y-this._radius,this._radius,0,2*Math.PI,false);a.fillStyle=this.color;a.fill();if(this.lineWidth>0){a.lineWidth=this.lineWidth;a.strokeStyle=this.lineColor;a.stroke()}}this.afterRenderGhost(a)},copy:function(){var a=new CGSGNodeCircle(this.position.x,this.position.y,this.dimension.width,this.dimension.height);a=this._super(a);a.color=this.color;a.lineColor=this.lineColor;a.lineWidth=this.lineWidth;return a}});var CGSGNodeEllipse=CGSGNode.extend({initialize:function(b,d,c,a){this._super(b,d,c,a);this.color="#444444";this.lineColor="#222222";this.lineWidth=0;this.classType="CGSGNodeEllipse";this.pickNodeMethod=CGSGPickNodeMethod.GHOST},render:function(a){this.beforeRender(a);a.globalAlpha=this.globalAlpha;var c=this.dimension.width/2;var b=this.dimension.height/2;a.beginPath();a.moveTo(c,0);a.bezierCurveTo(this.dimension.width,0,this.dimension.width,this.dimension.height,c,this.dimension.height);a.bezierCurveTo(0,this.dimension.height,0,0,c,0);a.fillStyle=this.color;a.fill();if(this.lineWidth>0){a.lineWidth=this.lineWidth;a.strokeStyle=this.lineColor;a.stroke()}a.closePath();this.afterRender(a)},renderGhost:function(a){this.beforeRenderGhost(a);if(this.globalAlpha>0){var c=this.dimension.width/2;var b=this.dimension.height/2;a.beginPath();a.moveTo(c,0);a.bezierCurveTo(this.dimension.width,0,this.dimension.width,this.dimension.height,c,this.dimension.height);a.bezierCurveTo(0,this.dimension.height,0,0,c,0);a.fillStyle=this.color;a.fill();if(this.lineWidth>0){a.lineWidth=this.lineWidth;a.strokeStyle=this.lineColor;a.stroke()}a.closePath()}this.afterRenderGhost(a)},copy:function(){var a=new CGSGNodeEllipse(this.position.x,this.position.y,this.dimension.width,this.dimension.height);a=this._super(a);a.color=this.color;a.lineColor=this.lineColor;a.lineWidth=this.lineWidth;return a}});var CGSGNodeImage=CGSGNode.extend({initialize:function(a,c,b){this._super(a,c,0,0);this.classType="CGSGNodeImage";this.effect=null;this._urlImage=b;this.isProportionalResize=true;this._img=new Image();this.slice=new CGSGRegion(0,0,0,0);this.isLoaded=false;this.onLoadEnd=null;this.onLoadError=null;this.onLoadAbort=null;if(cgsgExist(this._urlImage)&&this._urlImage!=""){this.setURL(b)}},_createDelegate:function(a,b){return function(){return b.call(a)}},_onImageLoaded:function(){this._checkDimension();this.isLoaded=true;if(this.onLoadEnd!==null){this.onLoadEnd()}},_onImageError:function(){if(this.onLoadError!==null){this.onLoadError()}},_onImageAbort:function(){if(this.onLoadAbort!==null){this.onLoadAbort()}},_checkDimension:function(){if(this.dimension.width<=0&&this.dimension.height<=0){this.dimension.width=this._img.width;this.dimension.height=this._img.height}if(this.slice.dimension.width<=0||this.slice.dimension.height<=0){this.slice.dimension.width=this.dimension.width;this.slice.dimension.height=this.dimension.height}},setSlice:function(a,e,b,c,d){this.slice.position.x=a;this.slice.position.y=e;this.slice.dimension.width=b;this.slice.dimension.height=c;if(d){this.resizeTo(b,c)}},setImage:function(a){this._img=a;if(cgsgExist(this._img)){this._urlImage=this._img.src;this._checkDimension();this.isLoaded=true}},setURL:function(a){this._urlImage=a;delete (this._img);this.isLoaded=false;this._img=new Image();this._img.onload=this._createDelegate(this,this._onImageLoaded);this._img.onerror=this._createDelegate(this,this._onImageError);this._img.onabort=this._createDelegate(this,this._onImageAbort);this._img.src=this._urlImage},render:function(a){if(this.isLoaded&&this._img.src!=""){this.beforeRender(a);a.globalAlpha=this.globalAlpha;a.drawImage(this._img,this.slice.position.x,this.slice.position.y,this.slice.dimension.width,this.slice.dimension.height,0,0,this.getWidth(),this.getHeight());this.afterRender(a)}},setEffect:function(a){this.effect=a},renderGhost:function(a){if(this.isLoaded&&this._img.src!=""){this.beforeRenderGhost(a);a.drawImage(this._img,this.slice.position.x,this.slice.position.y,this.slice.dimension.width,this.slice.dimension.height,0,0,this.getWidth(),this.getHeight());this.afterRenderGhost(a)}},resizeWith:function(b,a){this._super(b,a)},copy:function(a){if(!cgsgExist(a)){a=new CGSGNodeImage(this.position.x,this.position.y,null)}a=this._super(a);a._urlImage=this._urlImage;a.effect=this.effect;a.isProportionalResize=this.isProportionalResize;a._isLoaded=this.isLoaded;a.setImage(this._img);a.setSlice(this.slice.position.x,this.slice.position.y,this.slice.dimension.width,this.slice.dimension.height,true);a.resizeTo(this.dimension.width,this.dimension.height);a.onLoadEnd=this.onLoadEnd;return a}});var CGSGNodeSprite=CGSGNode.extend({initialize:function(a,d,c,b){this._super(a,d,1,1);this.classType="CGSGNodeSprite";this.listAnimations=[];this.currentAnimation=null;this.isProportionalResize=true;this._currentFrame=0;this._isPlaying=false;this._numberOfLoops=1;this._currentLoop=0;this._urlImage=c;this._img=new Image();this._isLoaded=false;this._context=b;this.onLoadEnd=null;this.onAnimationEnd=null;this.onAnimationStart=null;this._tmpCanvas=document.createElement("canvas");if(this._urlImage!==null&&this._urlImage!=""){this._img.onload=this._createDelegate(this,this._onImageLoaded);this._img.src=this._urlImage}},_createDelegate:function(a,b){return function(){return b.call(a)}},_onImageLoaded:function(){this._checkDimension();this._isLoaded=true;if(this.onLoadEnd!==null){this.onLoadEnd()}this.render(this._context)},_onImageError:function(){console.log("Error while loading image : "+this._urlImage)},_checkDimension:function(){if(this.dimension.width<=0&&this.dimension.height<=0){this.dimension.width=this._img.width;this.dimension.height=this._img.height}},setImage:function(a){this._img=a;if(cgsgExist(this._img)){this._urlImage=this._img.src;this._isLoaded=true}},goToNextFrame:function(){this._currentFrame+=1/this.currentAnimation.speed;var a=false;if(this._currentFrame>=this.currentAnimation.frames){a=true}if(a){if(this._numberOfLoops<0||this._currentLoop<this._numberOfLoops){this._currentLoop++;this.goToFirstFrame()}else{this.goToLastFrame();this.stop()}}},goToPreviousFrame:function(){this._currentFrame-=this.currentAnimation.speed;var a=false;if(this._currentFrame<0){a=true}if(a){if(this._numberOfLoops<=0||this._currentLoop>=0){this._currentLoop--;this.goToLastFrame()}else{this.goToFirstFrame();this.stop()}}},goToFirstFrame:function(){this._currentFrame=0},goToLastFrame:function(){this._currentFrame=this.currentAnimation.frames-1},render:function(a){if(this._isLoaded&&this._img.src!=""){this.beforeRender(a);if(cgsgExist(this.currentAnimation)){a.globalAlpha=this.globalAlpha;var b=this.currentAnimation.slices[Math.floor(this._currentFrame)];a.drawImage(this._img,b.x,b.y,this.currentAnimation.width,this.currentAnimation.height,0,0,this.dimension.width,this.dimension.height);if(this._isPlaying){this.goToNextFrame()}}this.afterRender(a)}},_getSlice:function(e,d){var c=e%d.framesPerLine;var b=Math.floor(e/d.framesPerLine);var a=d.sliceX+c*d.width;var f=d.sliceY+b*d.height;return{x:a,y:f}},addAnimation:function(b,d,i,a,k,c,j,e){var g={name:b,speed:d,frames:i,sliceX:a,sliceY:k,width:c,height:j,framesPerLine:e,slices:[]};for(var h=0;h<i;h++){g.slices.push(this._getSlice(h,g))}this.listAnimations.push(g);if(this.listAnimations.length==1){this.currentAnimation=g}},play:function(c,a){if(a===undefined||a===null){a=-1}this.currentAnimation=null;for(var b=0;b<this.listAnimations.length;b++){if(this.listAnimations[b].name===c){this.currentAnimation=this.listAnimations[b];this.reset();this._numberOfLoops=a;this._isPlaying=true;this.resizeTo(this.currentAnimation.width,this.currentAnimation.height);if(this.onAnimationStart!==null){this.onAnimationStart({animationName:c,loop:a})}return true}}return false},stop:function(){this._isPlaying=false;if(this.onAnimationEnd!==null){this.onAnimationEnd({animationName:this.currentAnimation.name,loop:this._currentLoop,frame:this._currentFrame})}},reset:function(){this._currentFrame=0;this._currentLoop=1},copy:function(){var c=new CGSGNodeSprite(this.position.x,this.position.y,this._urlImage,this._context);c=this._super(c);c.listAnimations=[];for(var b=0;b<this.listAnimations.length;b++){c.addAnimation(this.listAnimations[b].name,this.listAnimations[b].speed,this.listAnimations[b].frames,this.listAnimations[b].sliceX,this.listAnimations[b].sliceY,this.listAnimations[b].width,this.listAnimations[b].height,this.listAnimations[b].framesPerLine)}c.currentAnimation=this.currentAnimation;c.isProportionalResize=this.isProportionalResize;c._currentFrame=this._currentFrame;c._isPlaying=this._isPlaying;c._numberOfLoops=this._numberOfLoops;c._currentLoop=this._currentLoop;c._img=this._img;c._isLoaded=this._isLoaded;c.onLoadEnd=this.onLoadEnd;c.onAnimationEnd=this.onAnimationEnd;c.onAnimationStart=this.onAnimationStart;if(this._urlImage!==null&&this._urlImage!=""){c._img.onload=c._createDelegate(c,c._onImageLoaded,c.context);c._img.src=c._urlImage}return c}});var CGSGButtonMode={NORMAL:{index:0,isClickable:true},OVER:{index:1,isClickable:true},DEACTIVATED:{index:2,isClickable:false},SELECTED:{index:1,isClickable:true}};var CGSGPositionMode={TOP:{index:0,decalX:0,decalY:-1,dt:1,dy:1,computeWidth:function(b,a){return Math.max(b,a)},computeHeight:function(b,a){return 0}},BOTTOM:{index:1,decalX:0,decalY:1,dt:0,dy:1,computeWidth:function(b,a){return Math.max(b,a)},computeHeight:function(b,a){return 0}},LEFT:{index:2,decalX:-1,decalY:0,dt:0,dy:0,computeWidth:function(b,a){return 0},computeHeight:function(b,a){return Math.max(b,a)}},RIGHT:{index:3,decalX:1,decalY:0,dt:1,dy:0,computeWidth:function(b,a){return 0},computeHeight:function(b,a){return Math.max(b,a)}}};var CGSGNodeButton=CGSGNode.extend({initialize:function(a,d,c){this._super(a,d,0,0);this._firstColors=["#969696","#5F5F5F","#D8D8D8"];this._lastColors=["#7F7F7F","#4B4B4B","#B5B5B5"];this._shadowColors=[null,null,null];this._radiuses=[8,8,8];this._texts=[c,c,c];this._textSizes=[12,12,12];this._textColors=["white","white","#999999"];this.textNode=new CGSGNodeText(0,0,"");this.textNode.setTextAlign("center",false);this.textNode.setTextBaseline("middle",false);this._strokeColor=null;this._lineWidth=2;this._picto=new CGSGNodeImage(0,0,null);this._slices=[];this._pictoPosition=CGSGPositionMode.LEFT;this._distancePictoText=10;this._tmpCanvas=[document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas")];this._horizontalPadding=15;this._verticalPadding=10;this._dimensions=[];this.classType="CGSGNodeButton";this._initShapes();this._currentMode=CGSGButtonMode.NORMAL;this.setMode(CGSGButtonMode.NORMAL);var b=this;this.onMouseOver=function(e){if(b.getMode()==CGSGButtonMode.NORMAL){b.setMode(CGSGButtonMode.OVER)}};this.onMouseOut=function(e){if(b.getMode()==CGSGButtonMode.OVER){b.setMode(CGSGButtonMode.NORMAL)}}},setPictoPosition:function(a){this._pictoPosition=a;this._needRedraw=true},setImage:function(a){this._picto.setImage(a);this._needRedraw=true},setImageURL:function(a){this._picto.onLoadEnd=this._onLoadImageEnd.bind(this);this._picto.setURL(a)},_onLoadImageEnd:function(){this._needRedraw=true},getSlices:function(){return this._slices},setSlices:function(a){this._slices=a;this._needRedraw=true},getFirstColors:function(){return this._firstColors},setFirstColors:function(a){this._firstColors=a;this._needRedraw=true},getLastColors:function(){return this._lastColors},setLastColors:function(a){this._lastColors=a;this._needRedraw=true},getShadowColors:function(){return this._shadowColors},setShadowColors:function(a){this._shadowColors=a;this._needRedraw=true},getRadiuses:function(){return this._radiuses},setRadiuses:function(a){this._radiuses=a;this._needRedraw=true},getTexts:function(){return this._texts},setTexts:function(b){if(!cgsgIsArray(b)){var a=b.toString();b=[a,a,a]}this._texts=b;this._needRedraw=true},getTextSizes:function(){return this._textSizes},setTextSizes:function(a){this._textSizes=a;this._needRedraw=true},getTextColors:function(){return this._textColors},setTextColors:function(a){this._textColors=a;this._needRedraw=true},getHorizontalPadding:function(){return this._horizontalPadding},setHorizontalPadding:function(a){this._horizontalPadding=a;this._needRedraw=true},getVerticalPadding:function(){return this._verticalPadding},setVerticalPadding:function(a){this._verticalPadding=a;this._needRedraw=true},setFixedSize:function(a){this._dimensions[0]=a;this._dimensions[1]=a;this._dimensions[2]=a;this._fixedSize=cgsgExist(a);this._needRedraw=true},_initShapes:function(){this._initShape(0);this._initShape(1);this._initShape(2);this._needRedraw=false},_initShape:function(l){this.textNode.setSize(this._textSizes[l],false);this.textNode.setText(this._texts[l],true);var b=this._distancePictoText;if(this._texts[l]===""){b=0}var n=0,m=0;var i=0;var e=0;if(this._picto.isLoaded){if(this._slices.length>0){this._picto.setSlice(this._slices[l].position.x,this._slices[l].position.y,this._slices[l].dimension.width,this._slices[l].dimension.height,true)}i=this._picto.slice.dimension.width;e=this._picto.slice.dimension.height;n=(i+b)*Math.abs(this._pictoPosition.decalX);m=(e+b)*Math.abs(this._pictoPosition.decalY)}if(this._fixedSize){this.resizeTo(this._dimensions[l].width,this._dimensions[l].height)}else{this.resizeTo((2*this._horizontalPadding)+n+this.textNode.getWidth()*Math.abs(this._pictoPosition.decalX)+this._pictoPosition.computeWidth(this.textNode.getWidth(),i),(2*this._verticalPadding)+m+this.textNode.getHeight()*Math.abs(this._pictoPosition.decalY)+this._pictoPosition.computeHeight(this.textNode.getHeight(),e));this._dimensions[l]=this.dimension.copy()}this._tmpCanvas[l].width=this.dimension.width+2*this._radiuses[l];this._tmpCanvas[l].height=this.dimension.height+2*this._radiuses[l];var f=this._tmpCanvas[l].getContext("2d");cgsgClearContext(f);f.save();var a=this._radiuses[l];f.translate(-a,-a);f.beginPath();f.moveTo(a,a);f.lineTo(a+this.dimension.width-a,a);f.quadraticCurveTo(a+this.dimension.width,a,a+this.dimension.width,a+a);f.lineTo(a+this.dimension.width,a+this.dimension.height-a);f.quadraticCurveTo(a+this.dimension.width,a+this.dimension.height,a+this.dimension.width-a,a+this.dimension.height);f.lineTo(a+a,a+this.dimension.height);f.quadraticCurveTo(a,a+this.dimension.height,a,a+this.dimension.height-a);f.lineTo(a,a+a);f.quadraticCurveTo(a,a,a+a,a);f.closePath();var o=f.createLinearGradient(0,0,0,this.dimension.height);o.addColorStop(0,this._firstColors[l]);o.addColorStop(1,this._lastColors[l]);f.fillStyle=o;if(cgsgExist(this._shadowColors)){f.shadowColor=this._shadowColors[l];f.shadowBlur=10;f.shadowOffsetX=0;f.shadowOffsetY=0}f.fill();if(cgsgExist(this._strokeColor)){f.strokeStyle=this._strokeColor;f.lineWidth=this._lineWidth;f.stroke()}f.restore();this.textNode.color=this._textColors[l];var p=this.textNode.getWidth();var k=this.textNode.getHeight()-this.textNode._size;var j=(-this._pictoPosition.decalX*n+this.getWidth()-p)/2;var g=(-this._pictoPosition.decalY*m+this.getHeight()-k)/2;if(this._picto.isLoaded){var d=p/2;var c=k/2;this._picto.translateTo(j+d+this._pictoPosition.decalX*(d+b+(1-this._pictoPosition.dt)*i)-this._pictoPosition.dy*i/2,(1-this._pictoPosition.dy)*(g+(k-e)/2)+this._pictoPosition.dy*(g-this.textNode._size/2-this._pictoPosition.dt*(b+e)+(1-this._pictoPosition.dt)*(this.textNode.getHeight()+b)));this._picto.render(f)}this.textNode.translateTo(j,g);this.textNode.render(f)},setMode:function(a){this._currentMode=a;this.isClickable=a.isClickable;this.resizeTo(this._dimensions[a.index].width,this._dimensions[a.index].height)},getMode:function(){return this._currentMode},render:function(a){this.beforeRender(a);a.globalAlpha=this.globalAlpha;if(this._needRedraw){this._initShapes()}a.drawImage(this._tmpCanvas[this._currentMode.index],0,0);this.afterRender(a)},copy:function(){var a=new CGSGNodeSquare(this.position.x,this.position.y,this.dimension.width,this.dimension.height);a=this._super(a);a.color=this.color;a.lineColor=this.lineColor;a.lineWidth=this.lineWidth;return a}});"use strict";var CGSGParticle=CGSGObject.extend({initialize:function(a){this.node=a;this.node.isClickable=false;this.node.isResizable=false;this.node.isDraggable=false;this.userdata=null;this.init()},init:function(){this.position=new CGSGPosition(0,0);this.mass=1000;this.initVelocity(new CGSGVector2D(1,1));this.checkCTL=null;this.isAlive=true;this.age=0;this._acceleration=new CGSGVector2D(0,0);this.speedThreshold=0},initPosition:function(a,b){this.position.x=a;this.position.y=b;this.node.translateTo(a,b)},initVelocity:function(a){this.velocity=a.copy();this.velocity.normalize()},initSpeedThreshold:function(a){this.speedThreshold=a},updatePosition:function(a,b){if(isNaN(a)){a=1}a+=this.speedThreshold;this._acceleration.x=b.x/this.mass;this._acceleration.y=b.y/this.mass;this.velocity.x+=this._acceleration.x*a;this.velocity.y+=this._acceleration.y*a;this.position.x+=this.velocity.x*a;this.position.y+=this.velocity.y*a;if(this.node!==null){this.node.translateTo(this.position.x,this.position.y)}this.age+=a;if(cgsgExist(this.checkCTL)){this.isAlive=this.checkCTL(this)}return this.isAlive}});var CGSGParticleEmitter=CGSGNode.extend({initialize:function(e,g,a,d,h,f,b,c){this._super(g.position.x,g.position.y,g.dimension.width,g.dimension.height);this.classType="CGSGParticleEmitter";this._node=e;this.region=g;this.nbParticlesMax=a;this.velocity=new CGSGVector2D(0,0);if(cgsgExist(d)){this.velocity=d}this.angle=Math.PI/5;if(cgsgExist(h)){this.angle=h}this.speed=1;if(cgsgExist(f)){this.speed=f}this.speedThreshold=1;if(cgsgExist(b)){this.speedThreshold=b}this.outflow=0;if(cgsgExist(c)){this.outflow=c}this._currentFrame=this.outflow;this._particles=[];this._isPlaying=false;this._forces=[];this._acceleration=new CGSGVector2D(0,0);this.gravity=this.addForce(new CGSGVector2D(0,9.81),null);this.onUpdateParticleEnd=null;this.onInitParticle=null;this.onInitParticlesEnd=null},start:function(){this._isPlaying=true},stop:function(){this._isPlaying=false},reset:function(){var a;this._currentFrame=0;for(a=this._particles.length-1;a>=0;a--){this.removeChild(this._particles[a].node,true);delete (this._particles[a])}this._particles.clear()},render:function(a){var b,c;this.beforeRender(a);this._acceleration.initialize(0,0);for(b=this._forces.length-1;b>=0;b--){this._acceleration.x+=this._forces[b].vector.x;this._acceleration.y+=this._forces[b].vector.y;if(this._forces[b].ctl!==null){this._forces[b].age++;if(this._forces[b].age>=this._forces[b].ctl){this.removeForce(this._forces[b])}}}for(c=0;c<this._particles.length;c++){if(this._isPlaying){if(!this.updateParticle(this._particles[c])){this.initParticle(this._particles[c],c)}}this._particles[c].node.render(a)}if(this._particles.length<this.nbParticlesMax){this._currentFrame++;if(this._currentFrame>=this.outflow){this._currentFrame=0;this._createParticle(this._particles.length)}}a.restore()},_createParticle:function(a){var b=new CGSGParticle(this._node.copy());this.initParticle(b,a);this.addChild(b.node);this._particles.push(b)},updateParticle:function(b){var a=b.updatePosition(this.speed,this._acceleration);if(this.onUpdateParticleEnd!==null){this.onUpdateParticleEnd(b)}return a},initParticle:function(d,b){d.init();d.initPosition(Math.random()*this.region.dimension.width,Math.random()*this.region.dimension.height);var c=this.velocity.copy();var a=this.angle/2;c.rotate(-a+Math.random()*this.angle);d.initVelocity(c);d.initSpeedThreshold(-this.speedThreshold+Math.random()*this.speedThreshold*2);if(this.onInitParticle!==null){this.onInitParticle({index:b,particle:d})}},addForce:function(b,a){var c={vector:b,ctl:a,age:0};this._forces.push(c);return c},removeForce:function(a){this._forces.without(a)}});var CGSGParticleSystem=CGSGNode.extend({initialize:function(a,b){this._super(a,b,1,1);this.classType="CGSGParticleSystem";this.emitters=[];this.attractors=[];this.repulsors=[];this.isClickable=false;this.isResizable=false;this.isDraggable=false;this.isTraversable=false},addForce:function(a){for(var b=0;b<this.emitters.length;b++){this.emitters[b].addForce(a)}},addEmitter:function(f,i,b,h,g,e,d,c){var a=new CGSGParticleEmitter(f,i,b,h,g,e,d,c);this.addChild(a);this.emitters.push(a);return a},removeEmitter:function(a){this.emitters.without(a);this.removeChild(a,true)},addAttractor:function(a,c,d){var b={position:a,strength:c,distance:d};this.attractors.push(b);return b},removeAttractor:function(a){this.attractors.without(a)},addRepulsor:function(a,c,d){var b={position:a,strength:c,distance:d};this.repulsors.push(b);return b},removeRepulsor:function(a){this.repulsors.without(a)},pickNode:function(e,b,a,c,d){return null},copy:function(){var a=new CGSGParticleSystem();a=this._super(a);return a}});var CGSGSceneGraph=CGSGObject.extend({initialize:function(a,b){this.root=null;this.context=b;cgsgCurrentFrame=0;this.selectedNodes=[];this._nextNodeID=1;this._listTimelines=[];this.ghostCanvas=document.createElement("canvas");this.initializeGhost(a.width,a.height);cgsgCanvas.onselectstart=function(){return false}},initializeGhost:function(b,a){this.ghostCanvas.height=a;this.ghostCanvas.width=b;cgsgGhostContext=this.ghostCanvas.getContext("2d")},render:function(){cgsgClearContext(this.context);if(this.root!==null&&this.root!==undefined){var f=null;var d=0;var a=0;var c=null;if(this._listTimelines.length>0){f=null;var g,e;for(d=this._listTimelines.length-1;d>=0;--d){e=this._listTimelines[d];f=e.parentNode;if(f.isVisible){g=e.getValue(cgsgCurrentFrame);if(g!==undefined){f.evalSet(e.attribute,g.value);if(e.onAnimate!==null){e.onAnimate({node:f})}}c=e.getFirstKey();if(c!==null&&c.frame==cgsgCurrentFrame&&e.onAnimationStart!==null){e.onAnimationStart({node:f})}c=e.getLastKey();if(c!==null&&c.frame==cgsgCurrentFrame){e.removeAll();if(e.onAnimationEnd!==null){e.onAnimationEnd({node:f})}}}}}this.context.save();this.context.scale(cgsgDisplayRatio.x,cgsgDisplayRatio.y);if(this.root.isVisible){this.root.render(this.context,cgsgCurrentFrame)}this.context.restore()}if(this.selectedNodes.length>0){for(d=this.selectedNodes.length-1;d>=0;d--){f=this.selectedNodes[d];if(f.isVisible){this.context.save();this.context.scale(cgsgDisplayRatio.x,cgsgDisplayRatio.y);var h=f;var b=h.getAbsolutePosition();this.context.translate(b.x,b.y);this.context.rotate(f._absoluteRotation);this.context.scale(f._absoluteScale.x,f._absoluteScale.y);f.renderSelected(this.context);this.context.restore()}}}cgsgCurrentFrame++},setCanvasDimension:function(a){this.initializeGhost(a.width,a.height)},selectNode:function(a){if(!a.isSelected){a.setSelected(true);a.computeAbsoluteMatrix();this.selectedNodes[this.selectedNodes.length]=a}},deselectNode:function(a){a.setSelected(false);this.selectedNodes.without(a)},deselectAll:function(b){var c=null;for(var a=this.selectedNodes.length-1;a>=0;a--){c=this.selectedNodes[a];if(!cgsgExist(b)||!b.contains(c)){this.deselectNode(c)}}this.selectedNodes.clear()},pickNode:function(b,a){cgsgClearContext(cgsgGhostContext);if(!cgsgExist(this.root)){return null}else{return this.root.pickNode(b.copy(),new CGSGScale(1,1),cgsgGhostContext,true,a)}},pickNodes:function(a,b){cgsgClearContext(cgsgGhostContext);if(!cgsgExist(this.root)){return null}else{return this.root.pickNodes(a.copy(),new CGSGScale(1,1),cgsgGhostContext,true,b)}},removeNode:function(a){if(cgsgExist(a)){this.deselectNode(a);if(this.root!==null){return this.root.removeChild(a,true)}}return false},addNode:function(b,a){b._id=this._nextNodeID++;if(this.root===null){this.root=b}else{if(a===null){a=this.root}a.addChild(b)}},addAnimationKey:function(d,c,f,e,g,b){var a=this.getTimeline(d,c);a.method=g;a.addKey(CGSGMath.fixedPoint(f),e);if(b){a.computeValues(cgsgCurrentFrame,g)}},animate:function(d,c,e,h,g,f,a,b){this.addAnimationKey(d,c,cgsgCurrentFrame+CGSGMath.fixedPoint(a),h,f,false);this.addAnimationKey(d,c,cgsgCurrentFrame+CGSGMath.fixedPoint(a+e),g,f,b)},stillHaveAnimation:function(){if(this._listTimelines.length==0){return false}else{for(var b=0,a=this._listTimelines.length;b<a;++b){if(this._listTimelines[b].getLastKey()!==null&&this._listTimelines[b].getLastKey().frame<=cgsgCurrentFrame){return true}}}return false},getTimeline:function(e,d){for(var b=0,a=this._listTimelines.length;b<a;++b){if(this._listTimelines[b].parentNode===e&&this._listTimelines[b].attribute==d){return this._listTimelines[b]}}var c=new CGSGTimeline(e,d,"linear");this._listTimelines.push(c);return c}});"use strict";var cgsgGlobalRenderingTimer=null;(function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(g,e){var d=new Date().getTime();var f=Math.max(0,17-(d-b));cgsgGlobalRenderingTimer=window.setTimeout(function(){g(d+f)},f);b=d+f}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());var CGSGScene=CGSGObject.extend({initialize:function(a){cgsgDetectCurrentExplorer();if(typeof a.style.msTouchAction!="undefined"){a.style.msTouchAction="none"}cgsgCanvas=a;this.context=cgsgCanvas.getContext("2d");this.allowMultiSelect=true;this.dragSelectFillColor=CGSG_DEFAULT_DRAG_SELECT_FILL_COLOR;this.dragSelectStrokeColor=CGSG_DEFAULT_DRAG_SELECT_STROKE_COLOR;this.dragSelectAlpha=CGSG_DEFAULT_DRAG_SELECT_ALPHA;this.sceneGraph=new CGSGSceneGraph(cgsgCanvas,this.context);this.selectedNodes=this.sceneGraph.selectedNodes;this.fps=0;this._isRunning=false;this._needRedraw=true;this._frameContainer=null;this._keyDownedCtrl=false;this._timerDblTouch=null;this.dblTouchDelay=CGSG_DEFAULT_DBLTOUCH_DELAY;this._mousePosition=[];this._mouseOldPosition=[];this._dragSelectStartMousePosition=[];this._dragSelectEndMousePosition=[];this._isDrag=false;this._isResizeDrag=false;this._isDragSelect=false;this._resizingDirection=-1;this._listCursors=["nw-resize","n-resize","ne-resize","w-resize","e-resize","sw-resize","s-resize","se-resize"];this._offsetX=0;this._offsetY=0;this._selectedNode=null;var b=this;cgsgCanvas.onmousedown=function(c){b.onMouseDown(c)};cgsgCanvas.onmouseup=function(c){b.onMouseUp(c)};cgsgCanvas.ondblclick=function(c){b.onMouseDblClick(c)};cgsgCanvas.onmousemove=function(c){b.onMouseMove(c)};document.onkeydown=function(c){b.onKeyDownHandler(c)};document.onkeyup=function(c){b.onKeyUpHandler(c)};cgsgCanvas.addEventListener("touchstart",function(c){b.onTouchStart(c)},false);cgsgCanvas.addEventListener("touchmove",function(c){b.onTouchMove(c)},false);cgsgCanvas.addEventListener("touchend",function(c){b.onTouchEnd(c)},false);cgsgCanvas.addEventListener("MSPointerDown",function(c){b.onTouchStart(c)},false);cgsgCanvas.addEventListener("MSPointerMove",function(c){b.onTouchMove(c)},false);cgsgCanvas.addEventListener("MSPointerUp",function(c){b.onTouchEnd(c)},false);this._lastUpdate=new Date().getTime();this._nodeMouseOver=null;this.onSceneClickStart=null;this.onSceneClickEnd=null;this.onSceneDblClickStart=null;this.onSceneDblClickEnd=null;this.onRenderStart=null;this.onRenderEnd=null},setCanvasDimension:function(a){cgsgCanvas.width=a.width;cgsgCanvas.height=a.height;this.sceneGraph.setCanvasDimension(a)},deleteSelected:function(){if(this.sceneGraph.selectedNodes.length>0){for(var a=this.sceneGraph.selectedNodes.length-1;a>=0;a--){this._selectedNode=this.sceneGraph.selectedNodes[a];this.sceneGraph.removeNode(this._selectedNode,true)}}},deselectAll:function(a){this._isDrag=false;this._isResizeDrag=false;this._resizingDirection=-1;this.sceneGraph.deselectAll(a);this.invalidate()},render:function(){if(this._isRunning&&this._needRedraw){if(this.onRenderStart!==null){this.onRenderStart()}this.sceneGraph.render();if(this._dragSelectStartMousePosition.length>0&&this._dragSelectEndMousePosition.length>0){var d=this._dragSelectStartMousePosition[0];var c=this._dragSelectEndMousePosition[0];var b=c.x-d.x,a=c.y-d.y;this.sceneGraph.context.save();this.sceneGraph.context.scale(cgsgDisplayRatio.x,cgsgDisplayRatio.y);this.sceneGraph.context.strokeStyle=this.dragSelectStrokeColor;this.sceneGraph.context.fillStyle=this.dragSelectFillColor;this.sceneGraph.context.globalAlpha=this.dragSelectAlpha;this.sceneGraph.context.fillRect(d.x,d.y,b,a);this.sceneGraph.context.strokeRect(d.x,d.y,b,a);this.sceneGraph.context.restore()}if(this.onRenderEnd!==null){this.onRenderEnd()}}this._updateFramerate();this._updateFramerateContainer()},startPlaying:function(){var a=this.startPlaying.bind(this);window.requestAnimationFrame(a);this._isRunning=true;this.render()},stopPlaying:function(){window.cancelAnimationFrame(cgsgGlobalRenderingTimer);this._isRunning=false},invalidate:function(){this._needRedraw=true},_updateFramerate:function(){if(!cgsgExist(this._fpss)){this._fpss=[];this.currentFps=0}var a=new Date().getTime();var b=(a-this._lastUpdate);this._fpss[this.currentFps++]=1000/b;if(this.currentFps==cgsgFramerateDelay){this.currentFps=0;this.fps=this._fpss.average()}this._lastUpdate=a},_updateFramerateContainer:function(){if(this._frameContainer!==null){this._frameContainer.innerHTML=Math.round(this.fps).toString()}},showFPS:function(a){this._frameContainer=a},setDisplayRatio:function(a){cgsgDisplayRatio=a;this.sceneGraph.initializeGhost(cgsgCanvas.width/cgsgDisplayRatio.x,cgsgCanvas.height/cgsgDisplayRatio.y)},getDisplayRatio:function(){return cgsgDisplayRatio},onMouseDown:function(a){this.onTouchStart(a)},onTouchStart:function(c){if(c.preventManipulation){c.preventManipulation()}c.preventDefault();c.stopPropagation();if(!cgsgExist(this._timerDblTouch)){this._mousePosition=cgsgGetCursorPositions(c,cgsgCanvas);this._selectedNode=this.sceneGraph.pickNode(this._mousePosition[0],function(d){return cgsgExist(d.onDblClick)});this._tmpSelectedNode=this._selectedNode}else{this._selectedNode=this._tmpSelectedNode}if(cgsgExist(this._selectedNode)){if(cgsgExist(this._timerDblTouch)){clearTimeout(this._timerDblTouch);this._timerDblTouch=null;this._dblClickOnScene(c)}else{var b=this;var a=c;this._timerDblTouch=setTimeout(function(){clearTimeout(b._timerDblTouch);b._timerDblTouch=null;b._clickOnScene(a,true)},this.dblTouchDelay)}}else{this._clickOnScene(c,true)}},_clickOnScene:function(a,b){this._mousePosition=cgsgGetCursorPositions(a,cgsgCanvas);if(this.onSceneClickStart!==null){this.onSceneClickStart({position:this._mousePosition.copy(),event:a})}if(this._resizingDirection!==-1){this._mouseOldPosition=this._mousePosition.copy();this._isResizeDrag=true;if(this.onSceneClickEnd!==null){this.onSceneClickEnd({position:this._mousePosition.copy(),event:a})}return}if(b){this._selectedNode=this.sceneGraph.pickNode(this._mousePosition[0],function(c){return(c.isTraversable===true&&(c.isClickable===true||c.isDraggable===true||c.isResizable===true))})}if(this._selectedNode!==null&&this._selectedNode!==undefined&&(this._selectedNode.isClickable||this._selectedNode.isDraggable||this._selectedNode.isResizable)){if(this._selectedNode.isDraggable||this._selectedNode.isResizable){if(this.allowMultiSelect&&this._keyDownedCtrl){if(!this._selectedNode.isSelected){this.sceneGraph.selectNode(this._selectedNode)}else{this.sceneGraph.deselectNode(this._selectedNode)}}else{if(!this._selectedNode.isSelected){this.deselectAll(null);this.sceneGraph.selectNode(this._selectedNode)}}this._isDrag=true;this._isResizeDrag=false;this.invalidate()}if(this._selectedNode.isClickable){if(cgsgExist(this._selectedNode.onClick)){this._selectedNode.onClick({node:this._selectedNode,position:this._mousePosition.copy(),event:a})}if(this._selectedNode.isDraggable===false&&this._selectedNode.isResizable===false){this.deselectAll([this._selectedNode])}}}else{if(this.allowMultiSelect){this._isDragSelect=true;this._dragSelectStartMousePosition=cgsgGetCursorPositions(a,cgsgCanvas);this._dragSelectEndMousePosition=cgsgGetCursorPositions(a,cgsgCanvas);this.deselectAll(null)}else{this.deselectAll(null)}}if(this.onSceneClickEnd!==null){this.onSceneClickEnd({position:this._mousePosition.copy(),event:a})}this._mouseOldPosition=this._mousePosition.copy()},onMouseMove:function(a){this._moveOnScene(a)},onTouchMove:function(a){if(a.preventManipulation){a.preventManipulation()}a.preventDefault();a.stopPropagation();this._moveOnScene(a)},_moveOnScene:function(a){var e,p,m;this._mousePosition=cgsgGetCursorPositions(a,cgsgCanvas);this._selectedNode=null;if(this._isDrag){if(this.sceneGraph.selectedNodes.length>0){this._offsetX=this._mousePosition[0].x-this._mouseOldPosition[0].x;this._offsetY=this._mousePosition[0].y-this._mouseOldPosition[0].y;var g=true;for(e=this.sceneGraph.selectedNodes.length-1;e>=0;e--){this._selectedNode=this.sceneGraph.selectedNodes[e];if(this._selectedNode!==null&&this._selectedNode.isDraggable){this._selectedNode.isMoving=true;p=this._offsetX/(this._selectedNode._absoluteScale.x/this._selectedNode.scale.x);m=this._offsetY/(this._selectedNode._absoluteScale.y/this._selectedNode.scale.y);if(this._selectedNode.regionConstraint!==null){var b=this._selectedNode.getRegion().copy();b.position.x+=p;b.position.y+=m;if(!cgsgRegionIsInRegion(b,this._selectedNode.regionConstraint,0)){g=false}}if(g){this._selectedNode.translateWith(p,m);if(this._selectedNode.onDrag!==null){this._selectedNode.onDrag({node:this._selectedNode,position:this._mousePosition.copy(),event:a})}}}}this._mouseOldPosition=this._mousePosition.copy();this.invalidate()}}else{if(this._isResizeDrag){if(this.sceneGraph.selectedNodes.length>0){this._offsetX=this._mousePosition[0].x-this._mouseOldPosition[0].x;this._offsetY=this._mousePosition[0].y-this._mouseOldPosition[0].y;for(e=this.sceneGraph.selectedNodes.length-1;e>=0;e--){this._selectedNode=this.sceneGraph.selectedNodes[e];if(this._selectedNode.isResizable){this._selectedNode.isResizing=true;p=this._offsetX/this._selectedNode._absoluteScale.x;m=this._offsetY/this._selectedNode._absoluteScale.y;var l=Math.max(p,m);if(l==0){l=Math.min(p,m)}var q=this._selectedNode.dimension.width*this._selectedNode._absoluteScale.x;var o=this._selectedNode.dimension.height*this._selectedNode._absoluteScale.y;var k={dW:0,dH:0};switch(this._resizingDirection){case 0:if(this._selectedNode.isProportionalResize){k=this._getDeltaOnMove(l,p,m,q,o,-1,-1);this._selectedNode.translateWith(-k.dW,-k.dH,false);this._selectedNode.resizeWith(k.dW,k.dH,false)}else{this._selectedNode.translateWith(p*this._selectedNode.scale.x,m*this._selectedNode.scale.y,false);this._selectedNode.resizeWith(-p,-m,false)}break;case 1:this._selectedNode.translateWith(0,m*this._selectedNode.scale.y,false);this._selectedNode.resizeWith(0,-m,false);break;case 2:if(this._selectedNode.isProportionalResize){k=this._getDeltaOnMove(l,p,m,q,o,1,-1);this._selectedNode.translateWith(0,-k.dH,false);this._selectedNode.resizeWith(k.dW,k.dH,false)}else{this._selectedNode.translateWith(0,m*this._selectedNode.scale.y,false);this._selectedNode.resizeWith(p,-m,false)}break;case 3:this._selectedNode.translateWith(p*this._selectedNode.scale.x,0,false);this._selectedNode.resizeWith(-p,0,false);break;case 4:this._selectedNode.resizeWith(p,0,false);break;case 5:if(this._selectedNode.isProportionalResize){k=this._getDeltaOnMove(l,p,m,q,o,1,-1);this._selectedNode.translateWith(k.dW,0,false);this._selectedNode.resizeWith(-k.dW,-k.dH,false)}else{this._selectedNode.translateWith(p*this._selectedNode.scale.x,0,false);this._selectedNode.resizeWith(-p,m,false)}break;case 6:this._selectedNode.resizeWith(0,m,false);break;case 7:if(this._selectedNode.isProportionalResize){k=this._getDeltaOnMove(l,p,m,q,o,1,1);this._selectedNode.resizeWith(k.dW,k.dH,false)}else{this._selectedNode.resizeWith(p,m,false)}break}this._selectedNode.computeAbsoluteMatrix(false);if(this._selectedNode.onResize!==null){this._selectedNode.onResize({node:this._selectedNode,position:this._mousePosition.copy(),event:a})}}}}this._mouseOldPosition=this._mousePosition.copy();this.invalidate()}else{if(this.sceneGraph.selectedNodes.length>0&&this._isResizeDrag==false){for(e=this.sceneGraph.selectedNodes.length-1;e>=0;e--){this._selectedNode=this.sceneGraph.selectedNodes[e];if(this._selectedNode.isResizable){for(var f=0;f<8;f++){var j=this._selectedNode.resizeHandles[f];if(j.checkIfSelected(this._mousePosition[0],cgsgResizeHandleThreshold)){this._resizingDirection=f;cgsgCanvas.style.cursor=this._listCursors[f];return}}}}this._isResizeDrag=false;this._resizingDirection=-1;cgsgCanvas.style.cursor="auto";this.invalidate()}else{if(this._isDragSelect){this._dragSelectEndMousePosition=this._mousePosition.copy();this.invalidate()}}}}if(!this._isDrag&&!this._isResizeDrag){var c=null;if(cgsgExist(this._nodeMouseOver)){c=this._nodeMouseOver.pickNode(this._mousePosition[0],null,cgsgGhostContext,false,null);if(c===null){this._nodeMouseOver.isMouseOver=false;if(cgsgExist(this._nodeMouseOver.onMouseOut)){this._nodeMouseOver.onMouseOut({node:this._nodeMouseOver,position:this._mousePosition.copy(),event:a})}this._nodeMouseOver=null}else{if(c===this._nodeMouseOver){if(cgsgExist(this._nodeMouseOver.onMouseOver)){this._nodeMouseOver.onMouseOver({node:this._nodeMouseOver,position:this._mousePosition.copy(),event:a})}}}}if(c===null){if((c=this.sceneGraph.pickNode(this._mousePosition[0],function(d){return(d.onMouseEnter!==null||d.onMouseOver!==null)}))!==null){c.isMouseOver=true;this._nodeMouseOver=c;this._nodeMouseOver.isMouseOver=true;if(cgsgExist(this._nodeMouseOver.onMouseEnter)){this._nodeMouseOver.onMouseEnter({node:this._nodeMouseOver,position:this._mousePosition.copy(),event:a})}}}}},_getDeltaOnMove:function(i,k,j,g,e,c,b){var d=k,a=j;var f=1;if(i==k){f=(g+c*i)/g;d=c*i;a=(f-1)*e}else{f=(e+b*i)/e;a=b*i;d=(f-1)*g}return{dW:d,dH:a}},onMouseUp:function(a){this._upOnScene(a)},onTouchEnd:function(a){if(a.preventManipulation){a.preventManipulation()}a.preventDefault();a.stopPropagation();this._upOnScene(a)},_upOnScene:function(b){var a=0;if(this._isDrag){for(a=this.sceneGraph.selectedNodes.length-1;a>=0;a--){this._selectedNode=this.sceneGraph.selectedNodes[a];if(this._selectedNode.isMoving){this._selectedNode.isMoving=false;this._selectedNode.computeAbsoluteMatrix(true);if(this._selectedNode.onDragEnd!==null){this._selectedNode.onDragEnd({node:this._selectedNode,position:this._mousePosition.copy(),event:b})}}}this._isDrag=false}else{if(this._isResizeDrag){for(a=this.sceneGraph.selectedNodes.length-1;a>=0;a--){this._selectedNode=this.sceneGraph.selectedNodes[a];if(this._selectedNode.isResizing){this._selectedNode.isResizing=false;this._selectedNode.computeAbsoluteMatrix(true);if(this._selectedNode.onResizeEnd!==null){this._selectedNode.onResizeEnd({node:this._selectedNode,position:this._mousePosition.copy(),event:b})}}}this._isResizeDrag=false}else{if(this._isDragSelect){this._isDragSelect=false;this._doDragSelect();this._dragSelectStartMousePosition=[];this._dragSelectEndMousePosition=[];this.invalidate()}else{this._selectedNode=this.sceneGraph.selectedNodes[this.sceneGraph.selectedNodes.length-1];if(cgsgExist(this._selectedNode)&&this._selectedNode.onMouseUp!==null){this._selectedNode.onMouseUp({node:this._selectedNode,position:this._mousePosition.copy(),event:b})}}}}this._resizingDirection=-1},_doDragSelect:function(){var h=this._dragSelectStartMousePosition[0];var g=this._dragSelectEndMousePosition[0];var d=g.x-h.x,c=g.y-h.y;if(d<0){d=Math.abs(d);h.x-=d}if(c<0){c=Math.abs(c);h.y-=c}var f=new CGSGRegion(h.x,h.y,d,c);var b=this.sceneGraph.pickNodes(f,function(i){return(i.isTraversable===true&&(i.isDraggable===true||i.isResizable===true))});for(var e=0,a=b.length;e<a;++e){this.sceneGraph.selectNode(b[e])}},onMouseDblClick:function(a){a.preventDefault();a.stopPropagation()},_dblClickOnScene:function(a){if(this.onSceneDblClickStart!==null){this.onSceneDblClickStart(a)}this._mousePosition=cgsgGetCursorPositions(a,cgsgCanvas);this._selectedNode=this.sceneGraph.pickNode(this._mousePosition[0],function(b){return true});if(cgsgExist(this._selectedNode)&&this._selectedNode.onDblClick!==null){this._selectedNode.onDblClick({node:this._selectedNode,position:this._mousePosition.copy(),event:a})}else{if(this.onSceneDblClickEnd!==null){this.onSceneDblClickEnd({position:this._mousePosition.copy(),event:a})}}return this._selectedNode},onKeyDownHandler:function(a){var b=(window.event)?a.keyCode:a.which;switch(b){case 17:this._keyDownedCtrl=true;break}return b},onKeyUpHandler:function(a){var b=(window.event)?a.keyCode:a.which;switch(b){case 17:this._keyDownedCtrl=false;break}return b}});