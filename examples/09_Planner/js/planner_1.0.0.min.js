var OverlayNode=CGSGNodeSquare.extend({initialize:function(a,d,b,c){this._super(a,d,b,c);this.isClickable=false;this.color="black";this.globalAlpha=0.2;this.lineWidth=0;this.classType="OverlayNode"},show:function(a){this.isVisible=true;this.isClickable=true;this.addChild(a)},hide:function(){this.isVisible=false;this.isClickable=false;for(var a=0;a<this.children.length;a++){this.detachChildAt(a)}},hide:function(a){this.detachChild(a);if(this.children.length==0){this.isVisible=false;this.isClickable=false}}});var overlayNode=null;var LoadNode=CGSGNode.extend({initialize:function(b){this._super(0,0,cgsgCanvas.width,cgsgCanvas.height);this.classType="LoadingNode";this.scene=b;this.cgsgSceneGraphSpinner=new CGSGNodeImage(10,10,"images/cgsgSceneGraph.png");this.cgsgSceneGraphSpinner.onLoadEnd=this.loadSpinner.bind(this);var a=new CGSGNodeSquare(0,0,this.getWidth(),this.getHeight());a.color="#666666";a.globalAlpha=0.5;this.addChild(a);var c=new CGSGNodeSquare(0,cgsgCanvas.height/2-50,cgsgCanvas.width,100);c.color="white";c.lineWidth=0;this.addChild(c);this.txtNode=new CGSGNodeText(0,0,T_LOADING);this.txtNode.color="#666666";this.txtNode.globalAlpha=0.5;this.txtNode.translateTo((this.getWidth()-this.txtNode.getWidth())/2,(this.getHeight()-this.txtNode.getHeight())/2);this.addChild(this.txtNode)},loadSpinner:function(b){this.addChild(this.cgsgSceneGraphSpinner);var a=new CGSGPosition(0.5,0.5);this.cgsgSceneGraphSpinner.rotationCenter=a;this.cgsgSceneGraphSpinner.translateTo(this.txtNode.position.x-this.cgsgSceneGraphSpinner.getWidth()-20,(this.getHeight()-this.cgsgSceneGraphSpinner.getHeight())/2);sceneGraph.animate(this.cgsgSceneGraphSpinner,"rotation.angle",400,0,2,"linear",0,true)},show:function(){this.scene.rootNode.addChild(this)},hide:function(){this.scene.rootNode.detachChild(this)}});var loadAnim=null;var PopupNode=CGSGNode.extend({initialize:function(j,e,g,i){j=(j<200)?200:j;e=(e<150)?150:e;this._super(Math.round((cgsgCanvas.width-j)/2),Math.round((cgsgCanvas.height-e)/2),j,e);this.classType="PopupNode";this.okButtonEvent=null;var f=e*0.1;var a=e*0.7;var b=e*0.2;var k=new CGSGDimension(80,30);var d=j*0.1;this.header=new CGSGNode(0,0,j,f);this.buttonClose=new CGSGNodeButton(this.getWidth()-39,10,"");this.buttonClose.setHorizontalPadding(0);this.buttonClose.setVerticalPadding(0);this.buttonClose.setFixedSize(new CGSGDimension(29,29));this.buttonClose.setFirstColors(["white","#5F5F5F","#D8D8D8"]);this.buttonClose.setLastColors(["white","#4B4B4B","#B5B5B5"]);this.buttonClose.setTextColors(["#666666","white","white"]);this.buttonClose.setSlices([new CGSGRegion(126,31,29,29),new CGSGRegion(126,61,29,29),new CGSGRegion(126,61,29,29)]);this.buttonClose.setRadiuses([2,2,2]);this.buttonClose._initShapes();this.header.addChild(this.buttonClose);this.buttonClose.onClick=this.onClosePopup.bind(this);this.title=new CGSGNodeText(0,0,g);this.title.setSize(20,true);this.title.translateTo((this.getWidth()-this.title.getWidth())/2,10,false);this.header.addChild(this.title);this.addChild(this.header);this.body=new CGSGNode(0,f,j,a);this.addChild(this.body);this.footer=new CGSGNode(0,e-b,j,b);if(cgsgExist(i)&&i===true){var c=new CGSGNodeSquare(d,0,j*0.8,1);this.footer.addChild(c)}this.buttonCancel=new CGSGNodeButton(d,(b-30)/2,"Cancel");this.buttonCancel.setFixedSize(k);this.buttonCancel.onClick=this.onCancelPopup.bind(this);this.buttonOk=new CGSGNodeButton(j-d-k.width,(b-30)/2,"Ok");this.buttonOk.setFixedSize(k);this.buttonOk.onClick=this.onOkPopup.bind(this);this.footer.addChild(this.buttonCancel);this.footer.addChild(this.buttonOk);this.addChild(this.footer);this.body.isClickable=false;this.header.isClickable=false;this.footer.isClickable=false;this.isDraggable=false;this._tmpCanvas=null;this._initShape()},onClosePopup:function(){},onCancelPopup:function(){},onOkPopup:function(){},_initShape:function(){this._tmpCanvas=document.createElement("canvas");this._tmpCanvas.width=this.dimension.width+30;this._tmpCanvas.height=this.dimension.height+30;var d=this._tmpCanvas.getContext("2d");d.rect(0,0,this.dimension.width,this.dimension.height);d.fillStyle="white";d.strokeStyle="lightgray";d.lineWidth=2;d.save();d.shadowColor="#888888";d.shadowBlur=10;d.shadowOffsetX=5;d.shadowOffsetY=5;d.fill();d.restore();var c=this.dimension.height;var e=this.dimension.width;var b=20;var a=0;var f=0;d.stroke()},setImage:function(a){this.buttonClose.setImage(a)},render:function(a){this.beforeRender(a);a.globalAlpha=this.globalAlpha;a.drawImage(this._tmpCanvas,0,0);this.afterRender(a)}});var WallCoatingSelector=PopupNode.extend({initialize:function(b){this._super(600,380,T_CONFIG_TAB_COLOR_TITLE,false);this.classType="WallCoatingNode";this.tabMenu=new CGSGNodeTabMenu(0,0,this.body.getWidth()*0.9);var d=new CGSGNodeSquare(this.tabMenu.position.x,this.tabMenu.position.y,1,this.body.getHeight());d.color=this.tabMenu._tabsContainer.color;var h=new CGSGNodeSquare(this.tabMenu.position.x+this.tabMenu.getWidth(),this.tabMenu.position.y+CGSGTABHEIGHT-4,1,this.body.getHeight()-CGSGTABHEIGHT+4);h.color=this.tabMenu._tabsContainer.color;var g=new CGSGNodeSquare(this.tabMenu.position.x,this.tabMenu.position.y+this.body.getHeight(),this.tabMenu.getWidth(),1);g.color=this.tabMenu._tabsContainer.color;this.tabMenu.addChild(d);this.tabMenu.addChild(h);this.tabMenu.addChild(g);this.tabMenu.translateTo(this.body.getWidth()*0.05,10,false);this.tabMenu.onTabChanged=this.onChangeTab.bind(this);var a=new CGSGNode(0,0,0,0);a.name="colorRootNode";var c=new CGSGNode(0,0,0,0);c.name="paperRootNode";var f=this.tabMenu.addTab(T_CONFIG_TAB_COLOR,a);var e=this.tabMenu.addTab(T_CONFIG_TAB_PAPER,c);this.tabMenu.selectTabByIndex(0);this.tabViewColor=f.view;this.tabViewPaper=e.view;this.config=b;this.wallPaper=[];this.nbWallPaper=0;this.remainPaperToLoad=0;this._createTabViewColor();this._loadMotifs();this.body.addChild(this.tabMenu);this._tmpCanvas=null;this._initShape()},_createTabViewColor:function(){var b=20;var a=new CGSGNodeColorPicker(10,25);a.resizeTo(460,190);a.onOverColor=this.overColor.bind(this);a.onClickColor=this.selectColor.bind(this);this.tabViewColor.addChild(a);this.sqPicker=new CGSGNodeSquare(a.position.x+a.dimension.width+b,a.position.y+b,40,40);this.sqPicker.lineColor="gray";this.sqPicker.lineWidth=2;this.sqPicker.color=this.config.getWallColor();this.tabViewColor.addChild(this.sqPicker);this.sqSelectedPicker=new CGSGNodeSquare(a.position.x+a.dimension.width+b,a.position.y+a.dimension.height-(b+40),40,40);this.sqSelectedPicker.lineColor="gray";this.sqSelectedPicker.lineWidth=2;this.sqSelectedPicker.color=this.config.getWallColor();this.tabViewColor.addChild(this.sqSelectedPicker)},_loadMotifs:function(){var a;var g=new CGSGNodeImage(0,0,"images/wall01.png");var f=new CGSGNodeImage(0,0,"images/wall02.png");var e=new CGSGNodeImage(0,0,"images/wall03.png");var d=new CGSGNodeImage(0,0,"images/wall04.png");var c=new CGSGNodeImage(0,0,"images/wall05.png");var b=new CGSGNodeImage(0,0,"images/wall06.png");this.wallPaper.push(g,f,e,d,c,b);this.nbWallPaper=this.wallPaper.length;this.remainPaperToLoad=this.nbWallPaper;for(a=0;a<this.wallPaper.length;a++){this.wallPaper[a].onLoadEnd=this._onLoadEnd.bind(this)}},_onLoadEnd:function(){this.remainPaperToLoad--;if(this.remainPaperToLoad<=0){this._createTabViewPaper()}},_createTabViewPaper:function(){var a;var b=40;var e=b;var d=b/2;for(a=0;a<this.nbWallPaper;a++){var c=this.wallPaper[a];c.resizeTo(MOTIF_SIZE,MOTIF_SIZE,false);c.translateTo(e,d);c.globalAlpha=0.8;c.onClick=this.onClickPaper.bind(this);c.onMouseEnter=this.onOverPaper.bind(this);c.onMouseOut=this.onOutPaper.bind(this);this.tabViewPaper.addChild(c);e=e+MOTIF_SIZE+b;if(e>this.tabMenu.getWidth()-MOTIF_SIZE){e=b;d=d+MOTIF_SIZE+b}}},onOverPaper:function(c){var a=c.node;var b=this.config.getWallPaper();if(a!==b){this.markAsSelected(a)}},onOutPaper:function(c){var a=c.node;var b=this.config.getWallPaper();if(a!==b){this.markAsDeselect(a)}},onClickPaper:function(c){var a=c.node;var b=this.config.getWallPaper();if(cgsgExist(b)){if(a!==b){this.markAsDeselect(b);this.markAsSelected(a)}}else{this.markAsSelected(a)}this.config.setWallPaper(a)},onChangeTab:function(a){if(a.tab.view.name==="colorRootNode"){this.title.setText(T_CONFIG_TAB_COLOR_TITLE)}else{if(a.tab.view.name==="paperRootNode"){this.title.setText(T_CONFIG_TAB_PAPER_TITLE)}}},onClosePopup:function(){overlayNode.hide(this)},onCancelPopup:function(){overlayNode.hide(this)},onOkPopup:function(){if(this.tabMenu._selectedTab.view.name==="colorRootNode"){this.config.setWallPaper(undefined)}configNode.previewWallConfig=true;configNode.updateConfig(this.config);document.dispatchEvent(evtChangeWallConfig);overlayNode.hide(this)},overColor:function(a){this.sqPicker.color=CGSGColor.rgb2hex(a.r,a.g,a.b)},selectColor:function(a){this.sqSelectedPicker.color=CGSGColor.rgb2hex(a.r,a.g,a.b);this.config.setWallColor(this.sqSelectedPicker.color)},setImage:function(a){this.buttonClose.setImage(a)},markAsSelected:function(b){var a=b.getAbsoluteScale();sceneGraph.animate(b,"scale.x",10,1,1.2,"linear",0,true);sceneGraph.animate(b,"scale.y",10,1,1.2,"linear",0,true);sceneGraph.animate(b,"globalAlpha",10,0.8,1,"linear",0,true)},markAsDeselect:function(d){var c=d.getAbsoluteScale();var b=MOTIF_SIZE/d.getWidth();var a=MOTIF_SIZE/d.getHeight();sceneGraph.animate(d,"scale.x",10,1.2,1,"linear",0,true);sceneGraph.animate(d,"scale.y",10,1.2,1,"linear",0,true);sceneGraph.animate(d,"globalAlpha",10,1,0.8,"linear",0,true)}});var FloorCoatingSelector=PopupNode.extend({initialize:function(a){this._super(600,350,T_CONFIG_TAB_COLOR_TITLE,false);this.classType="FloorCoatingNode";this.config=a;this._createColorPicker();this._tmpCanvas=null;this._initShape()},_createColorPicker:function(){var b=20;var a=new CGSGNodeColorPicker(50,30);a.resizeTo(460,190);a.onOverColor=this.overColor.bind(this);a.onClickColor=this.selectColor.bind(this);this.body.addChild(a);this.sqPicker=new CGSGNodeSquare(a.position.x+a.dimension.width+b,a.position.y+b,40,40);this.sqPicker.lineColor="gray";this.sqPicker.lineWidth=2;this.sqPicker.color=this.config.getFloorColor();this.body.addChild(this.sqPicker);this.sqSelectedPicker=new CGSGNodeSquare(a.position.x+a.dimension.width+b,a.position.y+a.dimension.height-(b+40),40,40);this.sqSelectedPicker.lineColor="gray";this.sqSelectedPicker.lineWidth=2;this.sqSelectedPicker.color=this.config.getFloorColor();this.body.addChild(this.sqSelectedPicker)},onClosePopup:function(){overlayNode.hide(this)},onCancelPopup:function(){overlayNode.hide(this)},onOkPopup:function(){configNode.previewFloorConfig=true;configNode.updateConfig(this.config);document.dispatchEvent(evtChangeFloorConfig);overlayNode.hide(this)},overColor:function(a){this.sqPicker.color=CGSGColor.rgb2hex(a.r,a.g,a.b)},selectColor:function(a){this.sqSelectedPicker.color=CGSGColor.rgb2hex(a.r,a.g,a.b);this.config.setFloorColor(this.sqSelectedPicker.color)},setImage:function(a){this.buttonClose.setImage(a)}});var ConfigNode=PopupNode.extend({initialize:function(){this._super(350,250,T_CONFIGURATION,false);this.defaultConfig=new Config("defaultConfig");this.defaultConfig.setFloorColor("#eeeeee");this.defaultConfig.setWallColor("#efefef");this.currentConfig=this.defaultConfig.copy();this.currentConfig.setConfigName("currentConfig");this.selectedConfig=this.defaultConfig.copy();this.selectedConfig.setConfigName("selectedConfig");this.classType="ConfigNode";this.previewWallConfig=false;this.previewFloorConfig=false;this.wallCoatingSelector=new WallCoatingSelector(this.selectedConfig);this.floorCoatingSelector=new FloorCoatingSelector(this.selectedConfig);this.currentSelector=undefined;var c=this;var b=new CGSGDimension(55,20);var a=new CGSGNodeText(32,56,T_CONFIG_WALLCOLOR);a.setSize(12,false);this.body.addChild(a);this.sqWallPicker=new CGSGNodeSquare(196,48,30,30);this.sqWallPicker.lineColor="gray";this.sqWallPicker.lineWidth=2;this.sqWallPicker.color=this.defaultConfig.getWallColor();this.sqWallPicker.onClick=this.chooseWallColor.bind(this);this.body.addChild(this.sqWallPicker);this.resetWallPicker=new CGSGNodeButton(246,this.sqWallPicker.position.y+(this.sqWallPicker.getHeight()/2)-(b.height/2),"Reset");this.resetWallPicker.setFixedSize(b);this.resetWallPicker.onClick=function(){c.resetWallConfig();c.updateWallAndFloor()};this.body.addChild(this.resetWallPicker);var d=new CGSGNodeText(32,114,T_CONFIG_FLOORCOLOR);d.setSize(12,false);this.body.addChild(d);this.sqFloorPicker=new CGSGNodeSquare(196,108,30,30);this.sqFloorPicker.lineColor="gray";this.sqFloorPicker.lineWidth=2;this.sqFloorPicker.color=this.defaultConfig.getFloorColor();this.sqFloorPicker.onClick=this.chooseFloorColor.bind(this);this.body.addChild(this.sqFloorPicker);this.resetFloorPicker=new CGSGNodeButton(246,this.sqFloorPicker.position.y+(this.sqFloorPicker.getHeight()/2)-(b.height/2),"Reset");this.resetFloorPicker.setFixedSize(b);this.resetFloorPicker.onClick=function(){c.resetFloorConfig();c.updateWallAndFloor()};this.body.addChild(this.resetFloorPicker);this.buttonOk.onClick=this.saveConfig.bind(this);this._tmpCanvas=null;this._initShape()},updateConfig:function(b){if(cgsgExist(b.getWallPaper())){var c=b.getWallPaper().copy();var a=new CGSGNodeImage(0,0,c._urlImage);a.setImage(c._img);a.resizeTo(28,28,true);a.translateWith(1,1);a.onClick=this.chooseWallColor.bind(this);this.sqWallPicker.addChild(a)}else{this.sqWallPicker.removeAll();this.sqWallPicker.color=b.getWallColor()}this.sqFloorPicker.color=b.getFloorColor()},saveConfig:function(){this.selectedConfig.copyTo(this.currentConfig);this.updateWallAndFloor();overlayNode.hide(this)},resetWallConfig:function(){this.previewWallConfig=true;this.selectedConfig.setWallColor(this.defaultConfig.getWallColor());this.selectedConfig.setWallPaper(undefined);this.updateConfig(this.selectedConfig)},resetFloorConfig:function(){this.previewFloorConfig=true;this.selectedConfig.setFloorColor(this.defaultConfig.getFloorColor());this.updateConfig(this.selectedConfig)},setImage:function(a){this.buttonClose.setImage(a);this.wallCoatingSelector.buttonClose.setImage(a)},chooseWallColor:function(a){this.currentSelector="Wall";overlayNode.show(this.wallCoatingSelector)},chooseFloorColor:function(a){this.currentSelector="Floor";overlayNode.show(this.floorCoatingSelector)},onClosePopup:function(){this.updateWallAndFloor();overlayNode.hide(this)},onCancelPopup:function(){this.updateWallAndFloor();overlayNode.hide(this)},updateWallAndFloor:function(){this.previewFloorConfig=false;document.dispatchEvent(evtChangeFloorConfig);this.previewWallConfig=false;document.dispatchEvent(evtChangeWallConfig)}});var configNode=null;var Position3D=CGSGPosition.extend({initialize:function(a,c,b){this._super(a,c);this.z=b},copy:function(){return new Position3D(this.x,this.y,this.z)},toString:function(){return this.x+"x"+this.y+"x"+this.z}});var evtSelect=document.createEvent("Event");evtSelect.initEvent("onVariantSelected",true,true);var evtDeselect=document.createEvent("Event");evtDeselect.initEvent("onVariantDeselected",true,true);var evtAddToBasket=document.createEvent("Event");evtAddToBasket.initEvent("onAddToBasket",true,true);var evtRemoveToBasket=document.createEvent("Event");evtRemoveToBasket.initEvent("onRemoveFromBasket",true,true);var evtChangeBasket=document.createEvent("Event");evtChangeBasket.initEvent("onChangeBasket",true,true);var evtChangeBasketAmount=document.createEvent("Event");evtChangeBasketAmount.initEvent("onChangeBasketAmount",true,true);var evtChangeWallConfig=document.createEvent("Event");evtChangeWallConfig.initEvent("onChangeWallConfig",true,true);var evtChangeFloorConfig=document.createEvent("Event");evtChangeFloorConfig.initEvent("onChangeFloorConfig",true,true);var evtZoomPlus=document.createEvent("Event");evtZoomPlus.initEvent("onZoomPlus",true,true);var evtZoomMinus=document.createEvent("Event");evtZoomMinus.initEvent("onZoomMinus",true,true);var evtDrop=document.createEvent("Event");evtDrop.initEvent("onDrop",true,true);var evtShowVariantDetails=document.createEvent("Event");evtShowVariantDetails.initEvent("onShowVariantDetails",true,true);var evtShowCategoryPanel=document.createEvent("Event");evtShowCategoryPanel.initEvent("onShowCategoryPanel",true,true);var evtHighlightSlots=document.createEvent("Event");evtHighlightSlots.initEvent("onHighlightSlots",true,true);var evtDownplaySlots=document.createEvent("Event");evtDownplaySlots.initEvent("onDownplaySlots",true,true);var T_PRODUCT_TITLE="Products";var T_COLORS_TITLE="Colors";var T_LOADING="Loading...";var T_CHECKOUT="Pay";var T_CONFIGURATION="Configuration";var T_MENU_MODIFY="Modify";var T_MENU_SHOWBASKET="Show my shopping list";var T_CONFIG_WALLCOLOR="Wall color : ";var T_CONFIG_FLOORCOLOR="Floor color : ";var T_CONFIG_TAB_COLOR_TITLE="Select a color";var T_CONFIG_TAB_PAPER_TITLE="Select a pattern";var T_CONFIG_TAB_COLOR="Color";var T_CONFIG_TAB_PAPER="Pattern";var T_PANELCATEGORY_TITLE="Add  ";var T_PRODUCT_PREVIEW_INFO="Drag your item on the wall";var T_BASKET_TITLE="My basket";var T_BASKET_EMPTY="The basket is empty";var T_MENU_MEUBLES="Furniture";var T_MENU_ELEMENTS="Elements";var T_MENU_DECO="Decorations";var T_CATEGORY_ARMOIRES="Wardrobes";var T_CATEGORY_MEUBLES_BAS="Low furniture";var T_CATEGORY_MEUBLES_HAUTS="Wall furniture";var T_CATEGORY_TABLES="Tables";var T_CATEGORY_PORTES="Doors";var T_CATEGORY_TIROIRS="Drawers";var T_CATEGORY_PLATEAUX="Shelfs";var T_CATEGORY_POINEES="Handles ";var T_CATEGORY_PIEDS="Legs";var T_CATEGORY_STICKERS="Stickers";var T_PRODUCT_ARMOIRE_1P="Ward1D";var T_PRODUCT_ARMOIRE_2P="Ward2D";var T_PRODUCT_ARMOIRE_3P="Ward3D";var T_PRODUCT_ELEMENT_L="ElmtLow";var T_PRODUCT_ELEMENT_H="ElmtHigh";var T_PRODUCT_COMMODE="Chest";var T_PRODUCT_ETAGERE="Shelf";var T_PRODUCT_TABLE="Table";var T_PRODUCT_PORTES_G="BDLeft";var T_PRODUCT_PORTES_D="BDRight";var T_PRODUCT_PORTIERES_1="WeinsD";var T_PRODUCT_PORTIERES_2="HonsB";var T_PORTIERES_TRANS_G="TranLeft";var T_PORTIERES_TRANS_D="TranRight";var T_PRODUCT_TIROIRS="Drawer";var T_PRODUCT_PLATEAU_H="KurbH";var T_PRODUCT_PLATEAU_V="KurbV";var T_PRODUCT_BARRE="Bar";var T_PRODUCT_POIGNEES_RONDES="HandC";var T_PRODUCT_POIGNEES_V="HandV";var T_PRODUCT_POIGNEES_H="HandH";var T_PRODUCT_PIEDS_ROND="LegC";var T_PRODUCT_PIEDS_RECT="LegR";var T_PRODUCT_FIX_ETGR="WallF";var T_PRODUCT_STICKER1="FlowerS";var T_PRODUCT_STICKER2="SuntenS";var T_GAUCHE="left";var T_DROITE="right";var T_RONDES="Circular";var T_VERTICALES="Vertical";var T_HORIZONTALES="Horizontal";var T_ROND="Circular";var T_RECT="Rectangular";var T_COLOR_BEECH="Beech";var T_COLOR_BLACK="Black";var T_COLOR_LIMED="Limed";var T_COLOR_WHITE="White";var T_COLOR_BLUE="Blue";var T_COLOR_GRAY="Gray";var T_COLOR_GREEN="Green";var T_COLOR_OLIVE="Olive";var T_COLOR_BLACK_AND_WHITE="Black & White";var T_COLOR_PINE="Pin";var T_COLOR_BROWN="Brown";var T_COLOR_ORANGE="Orange";var T_COLOR_VIOLET="Purple";var T_COLOR_RED="Red";var T_COLOR_MARRON="Brown";var T_COLOR_PURPLE="Dark blue";"use strict";var IkeaCollisionMethod=CGSGCollisionMethod;IkeaCollisionMethod.GHOSTPRECOMPUTE="ghostPrecompute";"use strict";var CollisionGhostPrecomputeTester=CGSGObject.extend({initialize:function(){this.classType="CollisionGhostPrecomputeTester"},isColliding:function(b,k,i){if(b.fullImageData==null||k.fullImageData==null){return false}var d=Math.round(k.getAbsoluteLeft()-b.getAbsoluteLeft());var c=Math.round(k.getAbsoluteTop()-b.getAbsoluteTop());var g=(d>=0)?Math.min(b.getAbsoluteWidth()-d,k.getAbsoluteWidth()):Math.min(k.getAbsoluteWidth()+d,b.getAbsoluteWidth());var f=(c>=0)?Math.min(b.getAbsoluteHeight()-c,k.getAbsoluteHeight()):Math.min(k.getAbsoluteHeight()+c,b.getAbsoluteHeight());if((g<=0)||(f<=0)){return false}var h=(d>=0)?d:0;var e=(c>=0)?c:0;var o=h+g;var n=e+f;var j=0,a=0;for(var m=h;m<o;m++){for(var l=e;l<n;l++){j=((m)+(l)*b.fullImageData.width)*4;a=((m-d)+(l-c)*k.fullImageData.width)*4;if(b.fullImageData.data[j+3]>0&&k.fullImageData.data[a+3]>0){return true}}}return false},preComputeNode:function(g){var b=g.getAbsoluteHeight(),f=g.getAbsoluteWidth();if(isNaN(f)||f==0||isNaN(b)||b==0){return null}var e=g.getAbsoluteScale();var a=document.createElement("canvas");a.width=f;a.height=b;var c=a.getContext("2d");c.scale(e.x,e.y);var d=g.position;g.position=new CGSGPosition(0,0);g.render(c);g.position=d;g.fullImageData=c.getImageData(0,0,f,b)}});"use strict";var IkeaCollisionManager=CGSGCollisionManager.extend({initialize:function(){this._super()},manageNode:function(a){this._super(a);if(cgsgExist(cgsgPerformanceKeys.collisionTester.preComputeNode)){cgsgPerformanceKeys.collisionTester.preComputeNode(a)}}});var MENU_HEIGHT=100;var FLOOR_POSITION_FROM_BOTTOM=110;var FLOOR_PERCENT=1;var FLOOR_POSITION=0;var CATEGORYPANEL_WIDTH=400;var CATEGORYPANEL_HEIGHT=580;var sceneRoot=null;var MOTIF_SIZE=70;var MAX_ZOOM=1.5;var MIN_ZOOM=1;var STEP_ZOOM=0.125;var ANIMATE_ZOOM_SPEED=10;var actualZoom=1;var COLLISION_TOLERANCE=15;var isRegionInRegion=function(b,a){if(b.position.x<=(a.position.x+a.dimension.width)&&(b.position.x+b.dimension.width)>=a.position.x){if(b.position.y<=(a.position.y+a.dimension.height)&&(b.position.y+b.dimension.height)>=a.position.y){return true}}return false};getTotalDimension=function(b){if(b.isALeaf()){return b.dimension.copy()}else{var c=b.dimension.copy();var e=null,d=null;for(var a=0;a<b.children.length;a++){e=b.children[a];if(e.isVisible){d=getTotalDimension(e);c.height=Math.max(c.height,e.position.y+d.height);c.width=Math.max(c.width,e.position.x+d.width)}}return c}};cgsgCollisionManager=new IkeaCollisionManager();cgsgPerformanceKeys._cgsgCollisionTesterFactory.collisionTesters.addOrReplace(IkeaCollisionMethod.GHOSTPRECOMPUTE,new CollisionGhostPrecomputeTester());cgsgPerformanceKeys.setCollisionMethod(IkeaCollisionMethod.GHOSTPRECOMPUTE);var CGSGNodeScroll=CGSGNode.extend({initialize:function(b,d,c,a){this._super(b,d,c,a);this.classType="CGSGNodeScroll";this._tmpCanvas=document.createElement("canvas");this.elevatorWidth=20;this.elevatorHeight=10;this.elevatorPositionX=0;this.elevator=new CGSGNodeSquare(0,0,this.elevatorWidth,this.elevatorHeight);this.elevator.isDraggable=true;this.elevator.onDrag=this.onElevatorDrag.bind(this);this.content=new CGSGNode(0,0,0,0);this.addChild(this.content);this._computeContentSize()},_computeContentSize:function(){if(cgsgExist(this._tmpCanvas)){this._tmpCanvas.width=this.getWidth();this._tmpCanvas.height=this.getHeight()}if(cgsgExist(this.content)){this.content.resizeTo(this.getWidth()-this.elevatorWidth,this.getHeight());this._computeElevator()}},_computeElevator:function(){var a=getTotalDimension(this).height/this.getHeight();this.elevatorHeight=this.getHeight()/a;this.elevatorPositionX=this.getWidth()-this.elevatorWidth;this.elevator.resizeTo(this.elevatorWidth,this.elevatorHeight);if(this.elevatorHeight<this.getHeight()){this.addChildAt(this.elevator,this.children.length);this.elevator.translateTo(this.elevatorPositionX,0)}else{this.detachChild(this.elevator,false)}this.content.translateTo(0,0);this._initShape()},onElevatorDrag:function(b){var c=b.node.position.y;if(c<0){c=0}else{if(c+this.elevatorHeight>this.getHeight()){c=this.getHeight()-this.elevatorHeight}}this.elevator.translateTo(this.elevatorPositionX,c);var a=getTotalDimension(this.content).height-this.content.getHeight();var d=(c/(this.getHeight()-this.elevatorHeight))*a;this.content.translateTo(0,-d,true);this._initShape()},_initShape:function(){var a=this._tmpCanvas.getContext("2d");cgsgClearContext(a);a.globalAlpha=this.globalAlpha;a.fillStyle="#FFFFFF";a.fillRect(0,0,this.dimension.width,this.dimension.height);a.globalCompositeOperation="source-atop";this.afterRender(a)},render:function(a){this.beforeRender(a);a.drawImage(this._tmpCanvas,0,0)},addElement:function(a){this.content.addChild(a);this._computeContentSize()},removeContent:function(){this.content.removeAll();this._computeContentSize()},resizeContentTo:function(b,a){this.content.resizeTo(b,a);this._computeContentSize()},resizeTo:function(b,a){this._super(b,a);this._computeContentSize()},resizeBy:function(b,a){this._super(b,a);this._computeContentSize()},resizeWith:function(b,a){this._super(b,a);this._computeContentSize()},scaleTo:function(b,a,c){this._super(b,a,c);this._computeContentSize()},scaleBy:function(a,c,b){this._super(a,c,b);this._computeContentSize()},scaleWith:function(a,c,b){this._super(a,c,b);this._computeContentSize()}});var CConstraintEngine=CGSGObject.extend({initialize:function(){},computeCreationPosition:function(a,f,e){var d=a;var c=f;var b=0;if(e.parentProduct.isOnFloorOnly){c=FLOOR_POSITION+e.parentProduct.heightToFloor-e.getHeight();b=0;e.position3d=new Position3D(d,c,0);e.position3dScale=1;return new CGSGPosition(d,c)}else{if(f>(FLOOR_POSITION-e.getHeight())){c=FLOOR_POSITION-e.getHeight()}else{c=Math.max(f,0)}e.position3d=new Position3D(d,c,0);e.position3dScale=1;return new CGSGPosition(d,c)}},computePosition:function(a,h,f){var e=a;var d=h;var c=cgsgExist(f.position3d)?f.position3d.z:0;if(f.parentProduct.isOnFloorOnly){d=FLOOR_POSITION+f.parentProduct.heightToFloor-f.getHeight();c+=(h-d);if(c>FLOOR_POSITION_FROM_BOTTOM-f.parentProduct.size.p){c=FLOOR_POSITION_FROM_BOTTOM-f.parentProduct.size.p}else{if(c<0){c=0}}var g=(f.getHeight()+c)/f.getHeight();f.scaleTo(g,g,true);cgsgCollisionManager.manageNode(f);var b=0;if(cgsgExist(f.position3dScale)){b=(f.getWidth()*(g-f.position3dScale))/2}f.position3d=new Position3D(e,d,c);f.position3dScale=g;return new CGSGPosition(e-b,d)}else{if(h>(FLOOR_POSITION-f.getHeight())){d=FLOOR_POSITION-f.getHeight()}else{d=Math.max(h,0)}f.position3d=new Position3D(e,d,0);f.position3dScale=1;return new CGSGPosition(e,d)}},computeCreationPosition:function(a,f,e){var d=a;var c=f;var b=0;if(e.parentProduct.isOnFloorOnly){c=FLOOR_POSITION+e.parentProduct.heightToFloor-e.getHeight();b=0;e.position3d=new Position3D(d,c,0);e.position3dScale=1;return new CGSGPosition(d,c)}else{if(f>(FLOOR_POSITION-e.getHeight())){c=FLOOR_POSITION-e.getHeight()}else{c=Math.max(f,0)}e.position3d=new Position3D(d,c,0);e.position3dScale=1;return new CGSGPosition(d,c)}},computeCollisionFreePosition:function(j){var e=null,c=null;var h=j.position.x,f=j.position.y;var i=0,k=0,g=0,n=0;var b=0,a=0;j.translateTo(h,f,true);if(!j.parentProduct.isOnFloorOnly){var l=FLOOR_POSITION-(j.position.y+j.getHeight());if(l<0){a=FLOOR_POSITION+l}else{a=j.position.y}}c=this.computePosition(h,f,j);if(j.isCollidingABrother(0)){j.translateTo(c.x,c.y,true);var m=true;do{i++;e=this.computePosition(j.position.x+1,j.position.y,j);j.translateTo(e.x,e.y,true);if(Math.abs(i)>COLLISION_TOLERANCE){i=50000;m=false}}while(j.isCollidingABrother(0)&&m);j.translateTo(c.x,c.y,true);var m=true;do{k--;e=this.computePosition(j.position.x-1,j.position.y,j);j.translateTo(e.x,e.y,true);if(Math.abs(k)>COLLISION_TOLERANCE){k=50000;m=false}}while(j.isCollidingABrother(0)&&m);if(!j.parentProduct.isOnFloorOnly){j.translateTo(c.x,c.y,true);var m=true;do{g--;e=this.computePosition(j.position.x,j.position.y-1,j);j.translateTo(e.x,e.y,true);if(Math.abs(g)>COLLISION_TOLERANCE){g=50000;m=false}}while(j.isCollidingABrother(0)&&m);j.translateTo(c.x,c.y,true);var m=true;do{n++;e=this.computePosition(j.position.x,j.position.y+1,j);j.translateTo(e.x,e.y,true);if(Math.abs(n)>COLLISION_TOLERANCE||n>FLOOR_POSITION){n=50000;m=false}}while(j.isCollidingABrother(0)&&m)}}if(j.parentProduct.isOnFloorOnly){b=(Math.abs(i)<Math.abs(k))?i:k;if(b==50000){return null}else{e=new CGSGPosition(c.x+b,c.y);return e}}else{b=(Math.abs(i)<Math.abs(k))?i:k;a=(Math.abs(g)<Math.abs(n))?g:n;if(b==50000&&a==50000){return null}else{e=new CGSGPosition(h+b,c.y);if(Math.abs(b)<Math.abs(a)){e=new CGSGPosition(h+b,f)}else{e=new CGSGPosition(h,f+a)}return e}}}});var constraintEngine=new CConstraintEngine();var Variant=CGSGNodeImage.extend({initialize:function(f,b,a,h,e){this._super(0,0,h);this.ref=f;this.urlImage=h;this.name=b;this.classType="Variant";this.color=a;this.isDraggable=true;this.savedPosition=null;this.position3d=new Position3D(0,0,0);this.position3dScale=null;this.savedPosition3dScale=null;this.savedPosition3d=null;this.parentProduct=e;this.selectionLineColor="#29ABE2";this.selectionLineWidth=3;if(e!=null){for(var c=0;c<e.slots.length;c++){var g=e.slots[c].copy();this.addChild(g)}}this.reOrderSlots();var d=this;this.onClick=function(i){this.savedPosition=this.position.copy();this.savedPosition3dScale=this.position3dScale;this.savedPosition3d=this.position3d.copy();evtHighlightSlots.variant=d;document.dispatchEvent(evtHighlightSlots)};this.onSelect=function(i){evtSelect.variant=d;document.dispatchEvent(evtSelect);evtHighlightSlots.variant=d;document.dispatchEvent(evtHighlightSlots)};this.onDeselect=function(i){evtDeselect.variant=d;document.dispatchEvent(evtDeselect);evtDownplaySlots.variant=d;document.dispatchEvent(evtDownplaySlots)};this.onDrag=function(l){if(d.parentProduct.isSubProduct()){d._doOnDragVariantSubProductFirstFrame(l);var n=false;var o=null;var k=sceneRoot.getAvailableSlotsForVariant(d.parentProduct);for(var j=0;j<k.length;j++){var q=k[j];if(q!=l.node&&l.node.isColliding(q,0)){n=true;o=q;break}}if(n){for(var j=0;j<k.length;j++){var q=k[j];if(o!=null&&o==q){q.highlightForHosting()}else{q.downplayForHosting()}}this.selectionLineColor="green"}else{this.selectionLineColor="red"}}else{var m=constraintEngine.computePosition(d.position.x,d.position.y,l.node);if(d.isCollidingABrother(0)){this.selectionLineColor="red"}else{this.selectionLineColor="green"}d.translateTo(m.x,m.y,true);d.reOrderParentChildren()}};this.onDragEnd=function(i){i.node._alreadyDrag=false;if(d.parentProduct.isSubProduct()){d._doOnDragEndForSubProduct(i)}else{d._doOnDragEnd(i);d.reOrderParentChildren()}this.computeAbsoluteMatrix(true)}},_doOnDragVariantSubProductFirstFrame:function(b){if(!cgsgExist(this._alreadyDrag)||!this._alreadyDrag){this._alreadyDrag=true;var a=this.getAbsolutePosition();this.translateTo(a.x/actualZoom-main.wall.position.x,a.y/actualZoom-main.wall.position.y,true);this._oldParentSlot=this._parentNode;this._parentNode.freeSlot(false);sceneRoot.addVariantNode(b.node)}},_doOnDragEnd:function(a){var b=constraintEngine.computeCollisionFreePosition(this);if(b==null){b=this.savedPosition;this.position3dScale=this.savedPosition3dScale;this.position3d=this.savedPosition3d}this.selectionLineColor="#29ABE2";this.savedPosition=b.copy();this.scaleTo(this.position3dScale,this.position3dScale,true);this.translateTo(b.x,b.y,true)},_doOnDragEndForSubProduct:function(c){var d=false;var e=null;var b=sceneRoot.getAvailableSlotsForVariant(this.parentProduct);for(var a=0;a<b.length;a++){var f=b[a];if(f!=c.node&&c.node.isColliding(f,0)){d=true;e=f;break}}if(d){for(var a=0;a<b.length;a++){f.downplayForHosting()}this._oldParentSlot=null;e.fillSlot(this)}else{this._oldParentSlot.fillSlot(this)}this.translateTo(0,0,true);evtDownplaySlots.variant=this;document.dispatchEvent(evtDownplaySlots)},getTotalPrice:function(){var b=this.parentProduct.price;for(var a=0;a<this.children.length;a++){if(this.children[a].classType==="Slot"&&!this.children[a].empty){if(cgsgExist(this.children[a].variant.getTotalPrice)){b+=this.children[a].variant.getTotalPrice()}}}return b},reOrderSlots:function(){var a=function(b,c){return b.layer-c.layer};this.children.sort(a)},reOrderParentChildren:function(){if(this._parentNode!=null){var a=function(f,e){if(f.parentProduct.productType=="Sticker"){return -1}if(e.parentProduct.productType=="Sticker"){return 1}return f.position3d.z-e.position3d.z};this._parentNode.children.sort(a);if(cgsgExist(this._parentNode.stickers)){var d=this._parentNode.stickers;var c=this._parentNode;for(var b=0;b<d.length;b++){c.detachChild(d[b]);c.addChildAt(d[b],b)}}}},copy:function(){var a=new Variant(this.ref,this.name,this.color,null,this.parentProduct);a.setImage(this._img);a.urlImage=this.urlImage;a.selectionLineColor=this.selectionLineColor;a.selectionLineWidth=this.selectionLineWidth;a.pickNodeMethod=this.pickNodeMethod;return a},isColliding:function(b,a){if(b.classType==="Variant"){if(this.isCollidingDepth(b)){return this._super(b,a)}return false}return this._super(b,a)},isCollidingDepth:function(a){var b=this.position3d.z-a.position3d.z;if(b==0){return true}else{if(b>0){return b<=a.parentProduct.size.p}else{return Math.abs(b)<=this.parentProduct.size.p}}},renderGhost:function(c){this.beforeRenderGhost(c);var d=this.getWidth();var b=this.getHeight();d=d<30?30:d;b=b<30?30:b;var e=(this.getHeight()-b)/2;var a=(this.getWidth()-d)/2;c.fillStyle=cgsgGhostColor;c.fillRect(a,e,d,b);this.afterRenderGhost(c)}});var Product=CGSGObject.extend({initialize:function(a,c,b){this.initialize(a,c,b,false)},initialize:function(a,d,c,b){this.name=a;this.price=d;this.size={w:1,h:1,p:1};this.urlPicto=c;this.heightToFloor=0;this.variants=[];this.subProduct=b;this.subProducts=[];this.slots=[];this.parentCategory=null;this.isOnFloorOnly=true;this.classType="Product";this.productType="Meuble";this.hasToBeManagedForCollision=true},setSize:function(a,b,c){this.size.w=a;this.size.h=b;this.size.p=c},addVariant:function(a){this.variants.push(a);a.parentProduct=this},removeVariant:function(a){this.variants.without(a)},addSubProduct:function(a){this.subProducts.push(a)},removeSubProduct:function(a){this.subProducts.without(a)},getSizeString:function(){return this.size.w+"x"+this.size.h+"x"+this.size.p},isSubProduct:function(){return this.subProduct},addSlot:function(a){this.slots.push(a)}});var Category=CGSGObject.extend({initialize:function(a){this.name=a;this.subCategories=[];this.slices=[];this.products=[];this.parentCategory=null},getName:function(){return this.name},setName:function(a){this.name=a},addProduct:function(a){a.parentCategory=this;this.products.push(a)},removeProduct:function(a){a.parentCategory=null;this.products.without(a)},removeAllProducts:function(){this.products.clear()},addSubCategory:function(a){a.parentCategory=this;this.subCategories.push(a)},removeCategory:function(a){a.parentCategory=null;this.subCategories.without(a)},removeAllCategories:function(){this.subCategories.clear()}});var Basket=CGSGObject.extend({initialize:function(){this.amount=0;this.variantMap=new CGSGHashmap();document.addEventListener("onAddToBasket",this.onAddToBasket.bind(this),false);document.addEventListener("onRemoveFromBasket",this.onRemoveFromBasket.bind(this),false)},onAddToBasket:function(a){this.addVariant(a.variant)},onRemoveFromBasket:function(a){this.removeVariant(a.variant)},addVariant:function(e){var b=e,d,f,h=0;for(var g=0,a=this.variantMap.getLength();g<a;++g){f=this.variantMap.getAt(g);d=f.key;if(d.ref==e.ref){h=this.variantMap.getValue(d);b=d;break}}h++;this.variantMap.addOrReplace(b,h);this.amount+=e.parentProduct.price;evtChangeBasket.amount=(Math.round(this.amount*100)/100).toFixed(2);document.dispatchEvent(evtChangeBasket)},removeVariant:function(a){if(a!=null){this.amount-=a.getTotalPrice();this._doRemoveFromVariantMap(a,true);evtChangeBasket.amount=(Math.round(this.amount*100)/100).toFixed(2);document.dispatchEvent(evtChangeBasket)}},_doRemoveFromVariantMap:function(e,h){for(var d=0;d<e.children.length;d++){this._doRemoveFromVariantMap(e.children[d],false)}var f,j=0;for(var g=0,a=this.variantMap.getLength();g<a;++g){f=this.variantMap.getAt(g);var b=f.key;if(b.ref==e.ref){j=this.variantMap.getValue(b);if(j<=1){this.variantMap.remove(b)}else{j--;this.variantMap.addOrReplace(b,j)}if(h){main.removeFromScene(e)}return}}}});var basket=null;var Slot=CGSGNodeSquare.extend({initialize:function(b,e,d,a,c){this._super(e.position.x,e.position.y,e.dimension.width,e.dimension.height);this.color="green";this.lineColor="green";this.globalAlpha=0.4;this.lineWidth=2;this.isVisible=false;this.isTraversable=false;this.classType="Slot";this.parent=b;this.region=e;this.layer=a;this.group=c;if(d!=null){this.hostableProductNames=d}else{this.hostableProductNames=[]}this.empty=true;this.variant=null;document.addEventListener("onRemoveFromBasket",this.onRemoveFromBasket.bind(this),false);document.addEventListener("onHighlightSlots",this.onHighlightSlots.bind(this),false);document.addEventListener("onDownplaySlots",this.onDownplaySlots.bind(this),false)},onRemoveFromBasket:function(a){if(!this.empty&&a.variant===this.variant){this.freeSlot(true)}},onHighlightSlots:function(a){if(this.canHostProduct(a.variant.parentProduct)){this.highlight()}},onDownplaySlots:function(a){if(a.variant!=null&&this.canHostProduct(a.variant.parentProduct)){this.downplay()}},fillSlot:function(a){if(!this.canHostProduct(a.parentProduct)){throw"the given variant cannot be hosted by this slot, "+a.parentProduct}if(a._parentNode!=null){a._parentNode.detachChild(a)}this.empty=false;this.variant=a;this.addChild(a)},freeSlot:function(a){if(this.empty){throw"the slot is already empty..."}this.empty=true;if(a!=null&&a!=undefined&&a==true){this.removeChild(this.variant);this.downplay()}else{this.detachChild(this.variant)}this.variant=null},canHostProduct:function(c){var d=false;if(this.empty&&this.hostableProductNames.contains(c.name)){d=true;if(cgsgExist(this._parentNode)){var b=this._parentNode.children;for(var a=0;a<b.length;a++){if(b[a].classType==="Slot"&&(b[a].layer==this.layer&&b[a].group!=this.group&&!b[a].empty)){d=false;break}}}else{d=false}}return d},highlight:function(){cgsgCollisionManager.manageNode(this);this.isVisible=true;this.isTraversable=true;main.sceneGraph.animate(this,"globalAlpha",4,0.4,1,"linear",0,true);main.sceneGraph.animate(this,"globalAlpha",2,1,0.4,"linear",4,true);main.sceneGraph.animate(this,"globalAlpha",6,0.4,1,"linear",6,true);main.sceneGraph.animate(this,"globalAlpha",2,1,0.4,"linear",12,true);main.sceneGraph.animate(this,"globalAlpha",5,0,0.4,"linear",14,true)},downplay:function(){this.isVisible=false;this.isTraversable=false},highlightForHosting:function(){this.globalAlpha=0.8},downplayForHosting:function(){this.globalAlpha=0.4},copy:function(){var a=new Slot(this.parent,this.region,this.hostableProductNames,this.layer,this.group);return a},render:function(a){this.beforeRender(a);if(this.empty){a.globalAlpha=this.globalAlpha;a.fillStyle=this.color;a.strokeStyle=this.lineColor;a.lineWidth=this.lineWidth;a.fillRect(0,0,this.dimension.width,this.dimension.height);a.strokeRect(0,0,this.dimension.width,this.dimension.height)}this.afterRender(a)}});var Config=CGSGObject.extend({initialize:function(a){this.classType="ConfigEntity";this._configName=a;this._wallColor="#FEFE00";this._floorColor="#EEEEEE";this._wallPaper=undefined;this._floorPaper=undefined},copy:function(){var a=new Config(this._configName);a.setFloorColor(this._floorColor);a.setFloorPaper(this._floorPaper);a.setWallColor(this._wallColor);a.setWallPaper(this._wallPaper);return a},copyTo:function(a){if(cgsgExist(a)){a.setFloorColor(this._floorColor);a.setFloorPaper(this._floorPaper);a.setWallColor(this._wallColor);a.setWallPaper(this._wallPaper)}return a},setConfigName:function(a){this._configName=a},setWallColor:function(a){this._wallColor=a},setFloorColor:function(a){this._floorColor=a},setWallPaper:function(a){this._wallPaper=a},setFloorPaper:function(a){this._floorPaper=a},getConfigName:function(){return this._configName},getWallColor:function(){return this._wallColor},getFloorColor:function(){return this._floorColor},getWallPaper:function(){return this._wallPaper},getFloorPaper:function(){return this._floorPaper}});var CCatalog=CGSGObject.extend({initialize:function(){this.categories=[]},addCategory:function(a){this.categories.push(a)}});var catalog=new CCatalog();var BasketNode=CGSGNode.extend({initialize:function(){this._super((cgsgCanvas.width-400)/2,(cgsgCanvas.height-300)/2,400,300);this.classType="BasketNode";var a=this;this.buttonClose=new CGSGNodeButton(this.getWidth()-10-29,10,"");this.buttonClose.setHorizontalPadding(0);this.buttonClose.setVerticalPadding(0);this.buttonClose.setFixedSize(new CGSGDimension(29,29));this.buttonClose.setFirstColors(["white","#5F5F5F","#D8D8D8"]);this.buttonClose.setLastColors(["white","#4B4B4B","#B5B5B5"]);this.buttonClose.setTextColors(["#666666","white","white"]);this.buttonClose.setSlices([new CGSGRegion(126,31,29,29),new CGSGRegion(126,61,29,29),new CGSGRegion(126,61,29,29)]);this.buttonClose.setRadiuses([2,2,2]);this.buttonClose._initShapes();this.addChild(this.buttonClose);this.buttonClose.onClick=function(c){overlayNode.hide(a)};var b=new CGSGNodeText(125,10,T_BASKET_TITLE);this.addChild(b);this.container=new CGSGNode(10,40,0,0);this.addChild(this.container);this.buttonCheckout=new CGSGNodeButton(this.getWidth()/2-40,this.getHeight()-40,T_CHECKOUT+" ");this.addChild(this.buttonCheckout);this._tmpCanvas=null;this._initShape();this._centerCheckOutButton();document.addEventListener("onChangeBasketAmount",this.onChangeBasketAmount.bind(this),false)},_initShape:function(){this._tmpCanvas=document.createElement("canvas");this._tmpCanvas.width=this.dimension.width+30;this._tmpCanvas.height=this.dimension.height+30;var a=this._tmpCanvas.getContext("2d");a.clearRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height);a.rect(0,0,this.dimension.width,this.dimension.height);a.fillStyle="white";a.strokeStyle="lightgray";a.lineWidth=2;a.save();a.shadowColor="#888888";a.shadowBlur=10;a.shadowOffsetX=5;a.shadowOffsetY=5;a.fill();a.restore();a.stroke()},setImage:function(a){this.buttonClose.setImage(a)},show:function(){this.container.removeAll();var u,z,E,j,d,l=this;var c=new CGSGHashmap();for(u=0,z=basket.variantMap.getLength();u<z;++u){E=basket.variantMap.getAt(u);j=E.key;d=j.parentProduct;var r=[];if(c.containsKey(d)==true){r=c.getValue(d)}r.push({variant:j,quantity:E.value});c.addOrReplace(d,r)}var A=60,e=0,o;var h=12,C=10;var t=CGSGMath.fixedPoint(h*0.6),g=CGSGMath.fixedPoint(C*1.7),D=h*0.01;var x=e+t;var a=c.getLength();for(u=0;u<a;++u){var E,d;var r=[];E=c.getAt(u);d=E.key;r=E.value;xProduit=A;yProduit=x;var m=new CGSGNodeText(xProduit,yProduit,d.name+"    (prix unit. = "+d.price.toFixed(2)+" €)");m.color=CGSGColor.rgb2hex(30,50,75);m.setSize(h);x=x+h+g;this.container.addChild(m);var G=new CGSGNodeImage(CGSGMath.fixedPoint(xProduit/5),yProduit,d.urlPicto);this.container.addChild(G);G.onLoadEnd=function(){this.translateTo(xProduit/2-this.getAbsoluteWidth()/2-1,this.getAbsoluteTop()+4,true)};var f=r.length;for(o=0;o<f;o++){var B,j,k;B=r[o];j=B.variant;k=B.quantity;xItem=CGSGMath.fixedPoint(xProduit*1.5);yItem=x;var s=new CGSGNodeText(xItem+5,yItem,j.name);s.setSize(C);this.container.addChild(s);var i=new CGSGNodeText(xItem+90,yItem," x"+k);i.setSize(C);this.container.addChild(i);var F=new CGSGNodeText(xItem+140,yItem,((Math.ceil((k*d.price)*100))/100).toFixed(2)+" €");F.setSize(C);this.container.addChild(F);x=x+C+g;var b=new CGSGNodeSquare(xProduit+6,yItem+1,xItem-xProduit-11,C+5);b.color=j.color;b.lineColor="#AAAAAA";b.lineWidth=1;this.container.addChild(b);var q=new CGSGNodeButton(xItem+220,yItem,"X");q.setFixedSize(new CGSGDimension(C+7,C+7));q.setFirstColors(["#7A4346","#5F5F5F","#D8D8D8"]);q.setLastColors(["#7A4346","#4B4B4B","#B5B5B5"]);q.setTextColors(["white","red","red"]);q.setHorizontalPadding(0);q.setVerticalPadding(0);q.setRadiuses([2,2,2]);q.userdata=j.ref;q.onClick=function(I){var H=this;var J=function(K){return(K.classType=="Variant"&&K.ref==H.userdata)};var v=new CGSGTraverser();var p=v.traverse(sceneRoot,J,null);evtRemoveToBasket.variant=p[0];document.dispatchEvent(evtRemoveToBasket);l.show()};this.container.addChild(q)}var n=new CGSGNodeSquare(0,x,this.getWidth()-20,1);n.globalAlpha=0.4;x=x+D+g-5;this.container.addChild(n)}var y=x+this.container.position.y+50;var w=cgsgCanvas.height-200<300?300:cgsgCanvas.height-100;if(y<300){y=300}if(y>w){y=w}this.resizeTo(this.getWidth(),y);this.translateTo(this.position.x,(cgsgCanvas.height-this.getHeight())/2);this.container.resizeTo(this.container.getWidth(),y-100);this._centerCheckOutButton();evtChangeBasketAmount.amount=(CGSGMath.fixedPoint(basket.amount*100)/100).toFixed(2);document.dispatchEvent(evtChangeBasketAmount);this._initShape()},onChangeBasketAmount:function(b){if(b.amount!=0){var a=T_CHECKOUT+" "+b.amount+" €";this.buttonCheckout.setTexts([a,a,a]);this.buttonCheckout.isTraversable=true;this.buttonCheckout.setMode(CGSGButtonMode.NORMAL)}if(b.amount==0){this.buttonCheckout.setTexts(T_BASKET_EMPTY);this.buttonCheckout.isTraversable=false;this.buttonCheckout.setMode(CGSGButtonMode.DEACTIVATED)}this._centerCheckOutButton()},_centerCheckOutButton:function(){this.buttonCheckout._initShapes();this.buttonCheckout.translateTo((this.getWidth()-this.buttonCheckout.getWidth())/2,this.getHeight()-50)},render:function(a){this.beforeRender(a);a.globalAlpha=this.globalAlpha;a.drawImage(this._tmpCanvas,0,0);this.afterRender(a)}});var basketNode=null;var VariantPreviewNode=CGSGNodeImage.extend({initialize:function(a,c,b){this._super(a,c,b)},renderGhost:function(c){this.beforeRenderGhost(c);var d=this.getWidth();var b=this.getHeight();d=d<50?50:d;b=b<50?50:b;var e=(this.getHeight()-b)/2;var a=(this.getWidth()-d)/2;c.fillStyle=cgsgGhostColor;c.fillRect(a,e,d,b);this.afterRenderGhost(c)}});var CategoryViewNode=CGSGNode.extend({initialize:function(j,f,k,b,i){this._super(j,f,k,b);this.isClickable=false;this.classType="CategoryViewNode";this.category=i;this.selectedView=null;var d=this;this.tabMenu=null;if(i.subCategories.length===0){this.selectedView=this;this._initProducts(i)}else{this.tabMenu=new CGSGNodeTabMenu(0,0,this.getWidth()-2);this.addChild(this.tabMenu);for(var e=0;e<i.subCategories.length;e++){var g=i.subCategories[e];var a=this.tabMenu.addTab(g.name,new CGSGNode(0,0,0,0));this.selectedView=a.view;this._initProducts(g)}this.tabMenu.selectTabByIndex(0);this.tabMenu.onTabChanged=function(c){d.selectProduct(null)}}},_initProducts:function(b){var a;var e=55;this.selectedView.selectedProduct=null;this.selectedView.selectedVariant=null;this.selectedView.firstProduct=null;this.selectedView.firstVariant=null;this.selectedView.rootNode=new CGSGNode(20,20,0,0);this.selectedView.addChild(this.selectedView.rootNode);var g=new CGSGNodeText(10,-7,T_PRODUCT_TITLE);g.color="#666666";g.setSize(18,true);this.selectedView.rootNode.addChild(g);this.selectedView.productsZone=new CGSGNode(0,30,0,0);this.selectedView.rootNode.addChild(this.selectedView.productsZone);var k=new CGSGNodeText(10,135+e,T_COLORS_TITLE);k.color="#666666";k.setSize(17,true);this.selectedView.rootNode.addChild(k);this.selectedView.colorsZone=new CGSGNode(110,130+e,0,0);this.selectedView.rootNode.addChild(this.selectedView.colorsZone);this.selectedView.previewZone=new CGSGNodeSquare(0,210+e,this.getWidth()-40,180);this.selectedView.previewZone.color="white";this.selectedView.previewZone.lineWidth=1;this.selectedView.previewZone.lineColor="#666666";this.selectedView.previewZone.isVisible=false;this.selectedView.previewZone.isTraversable=false;this.selectedView.previewZone.title=new CGSGNodeText(10,2,"");this.selectedView.previewZone.title.setSize(12,false);this.selectedView.previewZone.addChild(this.selectedView.previewZone.title);this.selectedView.rootNode.addChild(this.selectedView.previewZone);var d=new CGSGNodeText(0,0,T_PRODUCT_PREVIEW_INFO);d.setSize(10,true);d.translateTo(this.selectedView.previewZone.getWidth()-d.getWidth(),-20);this.selectedView.previewZone.addChild(d);var f=new VariantPreviewNode(0,0,null);f.isDraggable=true;f.selectionLineColor="#29ABE2";f.selectionLineWidth=3;this.selectedView.previewZone.addChild(f);this.selectedView.previewZone.img=f;f.onClick=this.onClickImgVariant.bind(this);f.onDrag=this.onDragVariant.bind(this);f.onDragEnd=this.onDragVariantEnd.bind(this);f.onDeselect=this.onDeselectVariant.bind(this);var i=this;var l=15,q=l,j=5,o=null;for(a=0;a<b.products.length;a++){o=b.products[a];if(a==0){this.selectedView.firstProduct=o}if(a==3){q=l;j=+80}var c=new CGSGNode(q,j,80,40);c.lineWidth=2;c.userdata={product:o,selectedView:this.selectedView};this.selectedView.productsZone.addChild(c);var h=new CGSGNodeText(0,0,o.name);h.setSize(9,true);h.isTraversable=false;h.translateTo((80-h.metrics.width)/2,43);c.addChild(h);var m=new CGSGNodeImage(0,0,o.urlPicto);m.isTraversable=false;c.addChild(m);m.onLoadEnd=function(){this.translateTo((80-this.getWidth())/2,(40-this.getHeight())/2,true)};q+=85;c.onMouseOver=function(n){if(n.node.userdata.product!==i.selectedView.selectedProduct){i.highlightPicto(n.node)}};c.onMouseOut=function(n){if(n.node.userdata.product!==i.selectedView.selectedProduct){i.resetPicto(n.node)}};c.onClick=function(n){if(n.node.userdata.product!==i.selectedView.selectedProduct){i.selectedView=n.node.userdata.selectedView;i.selectProduct(n.node.userdata.product)}}}},selectProduct:function(i){this.selectVariant(null);this.selectedView.selectedProduct=i;for(var b=0,g=this.selectedView.productsZone.children.length;b<g;b++){var d=this.selectedView.productsZone.children[b];if(i===d.userdata.product){this.highlightPicto(d)}else{this.resetPicto(d)}}this.selectedView.colorsZone.removeAll();if(cgsgExist(i)){var f=this;var e;for(var j=0;j<i.variants.length;j++){e=i.variants[j];var h=new CGSGNodeSquare(j*(40+10),0,40,40);h.color=e.color;h.lineWidth=2;h.lineColor="#A0A0A0";h.globalAlpha=0.75;h.userdata={variant:e,selectedView:this.selectedView};if(j==0){this.selectedView.firstVariant=e}h.onMouseOver=function(c){if(c.node.userdata.variant!==f.selectedView.selectedVariant){f.highlightPicto(c.node)}};h.onMouseOut=function(c){if(c.node.userdata.variant!==f.selectedView.selectedVariant){f.resetPicto(c.node)}};h.onClick=function(c){if(c.node.userdata.variant!==f.selectedView.selectedVariant){f.selectedView=c.node.userdata.selectedView;f.selectVariant(c.node.userdata.variant)}};this.selectedView.colorsZone.addChild(h)}}if(this.selectedView.colorsZone.children.length>0){var h=this.selectedView.colorsZone.children[0];var a={node:{userdata:h.userdata}};h.onClick(a)}},selectVariant:function(c){evtDownplaySlots.variant=this.selectedView.selectedVariant;document.dispatchEvent(evtDownplaySlots);this.selectedView.selectedVariant=c;for(var e=0,a=this.selectedView.colorsZone.children.length;e<a;e++){var b=this.selectedView.colorsZone.children[e];if(c===b.userdata.variant){this.highlightPicto(b)}else{this.resetPicto(b)}}if(cgsgExist(c)){var d=this;this.selectedView.previewZone.title.setText(c.parentProduct.name);this.selectedView.previewZone.isVisible=true;this.selectedView.previewZone.isTraversable=true;this.selectedView.previewZone.img.setSlice(0,0,0,0,true);this.selectedView.previewZone.img.onLoadEnd=this.onPreviewLoadEnd.bind(this);this.selectedView.previewZone.img.setURL(c.urlImage);this.selectedView.previewZone.img.pickNodeMethod=c.pickNodeMethod}else{this.selectedView.previewZone.img.setURL(null);this.selectedView.previewZone.isVisible=false;this.selectedView.previewZone.isTraversable=false}},_selectProductView:function(c){if(cgsgExist(c)){if(this.category.subCategories.length===0){this.selectedView=this}else{for(var d=0;d<this.category.subCategories.length;d++){var b=this.category.subCategories[d];if(b===c.parentCategory){var a=this.tabMenu.selectTabByIndex(d);this.selectedView=a.view;break}}}}},onPreviewLoadEnd:function(a){this._centerPreview()},onDeselectVariant:function(a){evtDownplaySlots.variant=this.selectedView.selectedVariant;document.dispatchEvent(evtDownplaySlots)},onClickImgVariant:function(a){evtHighlightSlots.variant=this.selectedView.selectedVariant;document.dispatchEvent(evtHighlightSlots)},onDragVariant:function(b){this.onDragVariantFirstFrame(b);b.node.globalAlpha=0.5;var l=false;var h=null;var d=this.selectedView.selectedVariant.parentProduct;if(d.isSubProduct()){var j=sceneRoot.getAvailableSlotsForVariant(d);for(var g=0;g<j.length;g++){var k=j[g];if(k!=b.node&&b.node.isColliding(k,0)){l=true;h=k;break}}if(l){for(var g=0;g<j.length;g++){var k=j[g];if(h!=null&&h==k){k.highlightForHosting()}else{k.downplayForHosting()}}}}else{var a=b.node._parentNode.getAbsolutePosition();var c=constraintEngine.computeCreationPosition(b.node.position.x+a.x,b.node.position.y+a.y,this.selectedView.selectedVariant);b.node.translateTo(c.x-a.x,c.y-a.y,true);for(var e=0;e<sceneRoot.children.length;e++){var f=sceneRoot.children[e];if(f!=b.node&&b.node.isColliding(f,0)){l=true;break}}}if(l^d.isSubProduct()){b.node.selectionLineColor="red"}else{b.node.selectionLineColor="green"}},onDragVariantFirstFrame:function(b){if(!cgsgExist(b.node._alreadyDrag)||!b.node._alreadyDrag){b.node._alreadyDrag=true;var a=this.selectedView.previewZone.img._resizeRatio;this.selectedView.previewZone.img.resizeBy(1/a,1/a);if(this.selectedView.selectedVariant.parentProduct.hasToBeManagedForCollision){cgsgCollisionManager.manageNode(b.node)}else{cgsgCollisionManager.unManageNode(b.node)}}},onDragVariantEnd:function(a){a.node._alreadyDrag=false;var j=false;if(this.selectedView.selectedVariant.parentProduct.isSubProduct()){var b=this.selectedView.selectedVariant.parentProduct;var g=sceneRoot.getAvailableSlotsForVariant(b);var f=null;for(var e=0;e<g.length;e++){var h=g[e];if(h!=a.node&&a.node.isColliding(h,0)){j=true;f=h;break}}if(j){this._doOnDragVariantForSubProductEnd(a,f)}else{this._relocateInitialVariant(a.node);a.node.selectionLineColor="#29ABE2"}evtDownplaySlots.variant=this.selectedView.selectedVariant;document.dispatchEvent(evtDownplaySlots)}else{var d;for(var c=0;c<sceneRoot.children.length;c++){d=sceneRoot.children[c];if(d!=a.node&&a.node.isColliding(d,0)){j=true;break}}if(!j){this._doOnDragVariantForProductEnd(a)}else{this._relocateInitialVariant(a.node);a.node.selectionLineColor="#29ABE2"}}},_doOnDragVariantForProductEnd:function(b){var c=b.node.getAbsolutePosition();var d=this.selectedView.selectedVariant.copy();b.node.selectionLineColor="#29ABE2";sceneRoot.addVariantNode(d);d.translateTo(c.x,c.y,true);basket.addVariant(d);this._relocateInitialVariant(b.node);var a=constraintEngine.computeCollisionFreePosition(d);d.translateTo(a.x,a.y,true);d.savedPosition=a;if(d.parentProduct.hasToBeManagedForCollision){cgsgCollisionManager.manageNode(d)}d.computeAbsoluteMatrix(true);d.reOrderParentChildren()},_doOnDragVariantForSubProductEnd:function(a,d){var b=a.node.getAbsolutePosition();var c=this.selectedView.selectedVariant.copy();a.node.selectionLineColor="#29ABE2";d.fillSlot(c);basket.addVariant(c);if(c.parentProduct.hasToBeManagedForCollision){cgsgCollisionManager.manageNode(c)}this._relocateInitialVariant(a.node);c.translateTo(0,0,true);c.computeAbsoluteMatrix(true)},_relocateInitialVariant:function(b){main.sceneGraph.animate(this.selectedView.previewZone.img,"globalAlpha",20,b.globalAlpha,1,"linear",10,true);main.sceneGraph.animate(this.selectedView.previewZone.img,"position.x",10,b.position.x,b.initialPosition.x,"linear",0,true);main.sceneGraph.animate(this.selectedView.previewZone.img,"position.y",10,b.position.y,b.initialPosition.y,"linear",0,true);var a=this.selectedView.previewZone.img._resizeRatio;this.selectedView.previewZone.img.resizeBy(a,a)},_centerPreview:function(){var b=1;if(this.selectedView.previewZone.img.getWidth()>this.selectedView.previewZone.getWidth()){b=(this.selectedView.previewZone.getWidth()-10)/this.selectedView.previewZone.img.getWidth()}if(this.selectedView.previewZone.img.getHeight()>this.selectedView.previewZone.getHeight()){b=Math.min(b,(this.selectedView.previewZone.getHeight()-(15+this.selectedView.previewZone.title.getHeight()))/this.selectedView.previewZone.img.getHeight())}this.selectedView.previewZone.img._resizeRatio=b;this.selectedView.previewZone.img.resizeBy(b,b);var a=(this.selectedView.previewZone.getWidth()-this.selectedView.previewZone.img.getWidth())/2;var c=(this.selectedView.previewZone.getHeight()-this.selectedView.previewZone.img.getHeight())/2+this.selectedView.previewZone.title.getHeight();this.selectedView.previewZone.img.translateTo(a,c-2);this.selectedView.previewZone.img.initialPosition={x:a,y:c}},resetPicto:function(b){b.scaleTo(1,1,true);b.globalAlpha=0.75;for(var d=0,a=b.children.length;d<a;d++){b.children[d].globalAlpha=0.75}},highlightPicto:function(b){b.scaleTo(1.15,1.15,true);b.globalAlpha=1;for(var d=0,a=b.children.length;d<a;d++){b.children[d].globalAlpha=1}}});var CategoryPanelNode=CGSGNode.extend({initialize:function(){this._super(0,cgsgCanvas.height-MENU_HEIGHT-CATEGORYPANEL_HEIGHT,CATEGORYPANEL_WIDTH,CATEGORYPANEL_HEIGHT);this.classType="CategoryPanelNode";this.category=null;this.variant=null;var a=this;this.buttonClose=new CGSGNodeButton(this.getWidth()-10-29,10,"");this.buttonClose.setHorizontalPadding(0);this.buttonClose.setVerticalPadding(0);this.buttonClose.setFixedSize(new CGSGDimension(29,29));this.buttonClose.setFirstColors(["white","#5F5F5F","#D8D8D8"]);this.buttonClose.setLastColors(["white","#4B4B4B","#B5B5B5"]);this.buttonClose.setTextColors(["#666666","white","white"]);this.buttonClose.setSlices([new CGSGRegion(126,31,29,29),new CGSGRegion(126,61,29,29),new CGSGRegion(126,61,29,29)]);this.buttonClose.setRadiuses([2,2,2]);this.buttonClose._initShapes();this.addChild(this.buttonClose);this.buttonClose.onClick=function(b){a.hide()};this.textTitle=new CGSGNodeText(24,14,"");this.textTitle.setSize(22,true);this.textTitle.color="#666666";this.addChild(this.textTitle);this.rootCategory=new CGSGNode(0,60,0,0);this.addChild(this.rootCategory);this._tmpCanvas=null;this._initShape();this.hide()},initCategories:function(){this.mapCategories=new CGSGHashmap();var b,e;for(b=0;b<catalog.categories.length;b++){var a=catalog.categories[b];var d=new CategoryViewNode(0,0,this.getWidth(),this.getHeight(),a);this.mapCategories.addOrReplace(a,d)}},_initShape:function(){this._tmpCanvas=document.createElement("canvas");this._tmpCanvas.width=this.dimension.width+30;this._tmpCanvas.height=this.dimension.height;var a=this._tmpCanvas.getContext("2d");a.rect(0,0,this.dimension.width,this.dimension.height);a.fillStyle="white";a.strokeStyle="lightgray";a.lineWidth=2;a.save();a.shadowColor="#888888";a.shadowBlur=10;a.shadowOffsetX=5;a.shadowOffsetY=5;a.fill();a.restore();a.stroke()},setCategory:function(b){if(cgsgExist(this.category)){this.rootCategory.detachChild(this.mapCategories.getValue(this.category))}this.category=b;this.setTitle(b.name);var a=this.mapCategories.getValue(b);this.rootCategory.addChild(a);return a},setTitle:function(a){this.textTitle.setText(T_PANELCATEGORY_TITLE+a)},setImage:function(a){this.buttonClose.setImage(a)},show:function(){this.isVisible=true;this.isTraversable=true},hide:function(){this.isVisible=false;this.isTraversable=false},render:function(a){this.beforeRender(a);a.globalAlpha=this.globalAlpha;a.drawImage(this._tmpCanvas,0,0);this.afterRender(a)}});var categoryPanel=null;var DETAILPANEL_WIDTH=330;var DetailPanelNode=CGSGNode.extend({initialize:function(a){this._super(a,-6,DETAILPANEL_WIDTH,MENU_HEIGHT+4);this.color="#29ABE2";this.classType="DetailPanelNode";this.variant=null;var b=this;this.buttonModify=new CGSGNodeButton(187,60,T_MENU_MODIFY);this.buttonModify.setHorizontalPadding(33);this.buttonModify.setVerticalPadding(16);this.buttonModify.setFirstColors(["#29ABE2","white","white"]);this.buttonModify.setLastColors(["#29ABE2","white","white"]);this.buttonModify.setTextSizes([12,12,12]);this.buttonModify.setTextColors(["white","#29ABE2","#29ABE2"]);this.buttonModify._strokeColor="white";this.buttonModify.setFixedSize(new CGSGDimension(121,37));this.buttonModify.setRadiuses([2,2,2]);this.buttonModify._initShapes();this.buttonModify.onClick=function(c){evtShowVariantDetails.variant=b.variant;document.dispatchEvent(evtShowVariantDetails)};this.buttonTrash=new CGSGNodeButton(DETAILPANEL_WIDTH-50,60,"");this.buttonTrash.setHorizontalPadding(5);this.buttonTrash.setVerticalPadding(5);this.buttonTrash.setFirstColors(["#29ABE2","white","white"]);this.buttonTrash.setLastColors(["#29ABE2","white","white"]);this.buttonTrash._strokeColor="white";this.buttonTrash.setFixedSize(new CGSGDimension(45,37));this.buttonTrash.setRadiuses([2,2,2]);this.buttonTrash.setSlices([new CGSGRegion(169,42,19,24),new CGSGRegion(169,68,19,24),new CGSGRegion(169,68,19,24)]);this.buttonTrash._initShapes();this.addChild(this.buttonTrash);this.buttonTrash.onClick=function(c){evtRemoveToBasket.variant=b.variant;document.dispatchEvent(evtRemoveToBasket)};this.textPrice=new CGSGNodeText(321,18,"");this.textPrice.setSize(22);this.textPrice.color="white";this.addChild(this.textPrice);this.textName=new CGSGNodeText(16,18,"");this.textName.setSize(22);this.textName.color="white";this.addChild(this.textName);this.textType=new CGSGNodeText(16,68,"");this.textType.setSize(10);this.textType.color="white";this.addChild(this.textType);this.textColor=new CGSGNodeText(16,82,"");this.textColor.setSize(10);this.textColor.color="white";this.addChild(this.textColor);this._tmpCanvas=null;this._initShape();this.setPrice(0);this.isVisible=false},_initShape:function(){this._tmpCanvas=document.createElement("canvas");this._tmpCanvas.width=this.dimension.width;this._tmpCanvas.height=this.dimension.height;var a=this._tmpCanvas.getContext("2d");a.fillStyle=this.color;a.lineWidth=0;a.fillRect(0,11,this.dimension.width,this.dimension.height);a.beginPath();a.moveTo(33,0);a.lineTo(44,11);a.lineTo(22,11);a.closePath();a.fill()},setVariant:function(a){this.variant=a;if(cgsgExist(this.variant)){this.setPrice(a.parentProduct.price);this.textName.setText(a.parentProduct.name);this.textType.setText(a.parentProduct.name+" "+a.parentProduct.getSizeString());this.textColor.setText(a.name)}else{this.setPrice(0);this.textName.setText("");this.textType.setText("");this.textColor.setText("")}},getVariant:function(){return this.variant},setPrice:function(a){this.textPrice.setText(a.toFixed(2)+" €");this.textPrice.translateTo(this.dimension.width-8-this.textPrice.getWidth(),18)},setImage:function(a){this.buttonTrash.setImage(a)},render:function(a){this.beforeRender(a);a.globalAlpha=this.globalAlpha;a.drawImage(this._tmpCanvas,0,0);this.afterRender(a)},copy:function(){var a=new DetailPanelNode(this.position.x,this.position.y,this.dimension.width,this.dimension.height);a=this._super(a);return a}});var MenuNode=CGSGNode.extend({initialize:function(b,c,a){this._super(b,cgsgCanvas.height-MENU_HEIGHT,c,MENU_HEIGHT);this.main=a;this.categoryButtons=[];this.classType="MenuNode";this.buttonCart=new CGSGNodeButton(cgsgCanvas.width-204,50,T_MENU_SHOWBASKET);this.buttonCart.setHorizontalPadding(33);this.buttonCart.setVerticalPadding(16);this.buttonCart.setFirstColors(["#f2f2f2","#4d4d4d","#4d4d4d"]);this.buttonCart.setLastColors(["#f2f2f2","#4d4d4d","#4d4d4d"]);this.buttonCart.setTextSizes([12,12,12]);this.buttonCart.setTextColors(["#4d4d4d","#f2f2f2","#f2f2f2"]);this.buttonCart._initShapes();this.buttonCart.translateTo(cgsgCanvas.width-this.buttonCart.getWidth()-9,50);this.addChild(this.buttonCart);this.buttonCart.onClick=function(d){overlayNode.show(basketNode);basketNode.show()};this.textPrice=new CGSGNodeText(this.buttonCart.position.x,18,"0 €");this.addChild(this.textPrice);this.detailPanel=new DetailPanelNode(CGSGMath.fixedPoint(cgsgCanvas.width-DETAILPANEL_WIDTH)/2);this.addChild(this.detailPanel);document.addEventListener("onChangeBasket",this.onChangeBasket.bind(this),false);this._tmpCanvas=null;this._initShape()},initCategories:function(){var d;for(d=0;d<catalog.categories.length;d++){var a=catalog.categories[d];var b=new CGSGNodeButton(9+97*d,6,a.name);b.setRadiuses([4,4,4]);b.setTextSizes([10,10,10]);b.setFirstColors(["white","#5F5F5F","#D8D8D8"]);b.setLastColors(["white","#4B4B4B","#B5B5B5"]);b.setTextColors(["#666666","white","white"]);b.setSlices(a.slices);b.setPictoPosition(CGSGPositionMode.TOP);b.setFixedSize(new CGSGDimension(92,92));b.userdata=a;this.addChild(b);b.onClick=function(c){evtShowCategoryPanel.category=c.node.userdata;document.dispatchEvent(evtShowCategoryPanel)};this.categoryButtons.push(b)}},onChangeBasket:function(a){this.textPrice.setText(a.amount+" €",true)},_initShape:function(){this._tmpCanvas=document.createElement("canvas");this._tmpCanvas.width=this.dimension.width;this._tmpCanvas.height=this.dimension.height;var a=this._tmpCanvas.getContext("2d");a.fillStyle="#cccccc";a.lineWidth=0;a.fillRect(0,0,this.dimension.width,this.dimension.height)},setImage:function(a){for(var b=0;b<this.categoryButtons.length;b++){this.categoryButtons[b].setImage(a)}this.detailPanel.setImage(a)},render:function(a){this.beforeRender(a);a.globalAlpha=this.globalAlpha;a.drawImage(this._tmpCanvas,0,0);this.afterRender(a)},copy:function(){var a=new MenuNode(this.position.x,this.position.y,this.dimension.width,this.dimension.height);a=this._super(a);return a}});var BackgroundWallNode=CGSGNode.extend({initialize:function(b,d,c,a){this._super(b,d,c,a);this.classType="BackgroundWallNode";this._tmpCanvas=null;this._initShape()},_initShape:function(){this._tmpCanvas=document.createElement("canvas");this._tmpCanvas.width=this.dimension.width;this._tmpCanvas.height=this.dimension.height;var e=this._tmpCanvas.getContext("2d");e.save();var f=(configNode.previewWallConfig==true)?configNode.selectedConfig.getWallColor():configNode.currentConfig.getWallColor();var h=(configNode.previewWallConfig==true)?configNode.selectedConfig.getWallPaper():configNode.currentConfig.getWallPaper();if(cgsgExist(h)){var g=e.createPattern(h._img,"repeat");e.fillStyle=g}else{e.fillStyle=f}e.fillRect(0,0,this.dimension.width,this.dimension.height);var i=e.createLinearGradient(0,0,0,this.dimension.height);var j=CGSGColor.hex2rgb("#000000");var d="rgba("+j.r+","+j.g+","+j.r+","+0.1+")";var c="rgba("+j.r+","+j.g+","+j.r+","+0+")";var b="rgba("+j.r+","+j.g+","+j.r+","+0.01+")";var a="rgba("+j.r+","+j.g+","+j.r+","+0.1+")";i.addColorStop(0,d);i.addColorStop(1-0.065,c);i.addColorStop(1-0.064,b);i.addColorStop(1,a);e.fillStyle=i;e.fillRect(0,0,this.dimension.width,this.dimension.height);e.restore();e.strokeStyle="#c4c3c2";e.moveTo(0,this.dimension.height);e.lineTo(this.dimension.width,this.dimension.height);e.stroke()},render:function(a){this.beforeRender(a);a.drawImage(this._tmpCanvas,0,0);this.afterRender(a)},copy:function(){var a=new BackgroundWallNode(this.position.x,this.position.y,this.dimension.width,this.dimension.height);a=this._super(a);return a}});var BackgroundFloorNode=CGSGNode.extend({initialize:function(b,d,c,a){this._super(b,d,c,a);this.classType="BackgroundFloorNode";this._tmpCanvas=null;this._initShape()},_initShape:function(){this._tmpCanvas=document.createElement("canvas");this._tmpCanvas.width=this.dimension.width;this._tmpCanvas.height=this.dimension.height;var d=this._tmpCanvas.getContext("2d");var h=(configNode.previewFloorConfig==true)?configNode.selectedConfig.getFloorColor():configNode.currentConfig.getFloorColor();d.save();var e;e=d.createLinearGradient(0,0,0,this.dimension.height);d.fillStyle=h;d.fillRect(0,0,this.dimension.width,this.dimension.height);d.restore();d.save();e=d.createLinearGradient(0,0,0,this.dimension.height/2);var c=CGSGColor.hex2rgb("#000000");var b="rgba("+c.r+","+c.g+","+c.r+","+0.15+")";var a="rgba("+c.r+","+c.g+","+c.r+","+0+")";var g="rgba("+c.r+","+c.g+","+c.r+","+0.1+")";var f="rgba("+c.r+","+c.g+","+c.r+","+0.01+")";e.addColorStop(0,b);e.addColorStop(0.181,g);e.addColorStop(0.6,f);d.fillStyle=e;d.fillRect(0,0,this.dimension.width,this.dimension.height)},render:function(a){this.beforeRender(a);a.drawImage(this._tmpCanvas,0,0);this.afterRender(a)},copy:function(){var a=new BackgroundFloorNode(this.position.x,this.position.y,this.dimension.width,this.dimension.height);a=this._super(a);return a}});var ZoomMenuNode=CGSGNode.extend({initialize:function(){this._super(cgsgCanvas.width-41,13,0,0);this.classType="ZoomMenuNode";this.plusButton=new CGSGNodeButton(0,0,"");this.plusButton.setHorizontalPadding(0);this.plusButton.setVerticalPadding(0);this.plusButton.setFixedSize(new CGSGDimension(28,30));this.plusButton.setFirstColors(["white","#5F5F5F","#D8D8D8"]);this.plusButton.setLastColors(["white","#4B4B4B","#B5B5B5"]);this.plusButton.setTextColors(["#666666","white","white"]);this.plusButton.setSlices([new CGSGRegion(330,1,28,30),new CGSGRegion(330,32,28,30),new CGSGRegion(330,63,28,30)]);this.plusButton.setRadiuses([2,2,2]);this.plusButton._initShapes();this.minusButton=new CGSGNodeButton(0,30,"");this.minusButton.setHorizontalPadding(0);this.minusButton.setVerticalPadding(0);this.minusButton.setFixedSize(new CGSGDimension(28,30));this.minusButton.setFirstColors(["white","#5F5F5F","#D8D8D8"]);this.minusButton.setLastColors(["white","#4B4B4B","#B5B5B5"]);this.minusButton.setTextColors(["#666666","white","white"]);this.minusButton.setSlices([new CGSGRegion(366,1,28,30),new CGSGRegion(366,32,28,30),new CGSGRegion(366,63,28,30)]);this.minusButton.setRadiuses([2,2,2]);this.minusButton._initShapes();this.checkActivate();this.addChild(this.plusButton);this.addChild(this.minusButton);this.plusButton.onClick=function(a){document.dispatchEvent(evtZoomPlus)};this.minusButton.onClick=function(a){document.dispatchEvent(evtZoomMinus)}},setImage:function(a){this.plusButton.setImage(a);this.minusButton.setImage(a)},deactivateAll:function(){this.plusButton.setMode(CGSGButtonMode.DEACTIVATED);this.minusButton.setMode(CGSGButtonMode.DEACTIVATED)},checkActivate:function(){if(actualZoom<=MIN_ZOOM){this.minusButton.setMode(CGSGButtonMode.DEACTIVATED)}else{this.minusButton.setMode(CGSGButtonMode.NORMAL)}if(actualZoom>=MAX_ZOOM){this.plusButton.setMode(CGSGButtonMode.DEACTIVATED)}else{this.plusButton.setMode(CGSGButtonMode.NORMAL)}}});var FileMenuNode=CGSGNode.extend({initialize:function(a,e){this._super(a,e,230,50);this.classType="FileMenuNode";var d=5;var b=4;var c=new CGSGNodeSquare(0,0,this.getWidth(),this.getHeight());c.color="#B3B3B3";c.globalAlpha=0.65;c.lineWidth=1;c.lineColor=configNode.defaultConfig._wallColor;this.addChild(c);this.newButton=new CGSGNodeImage(d,5,null);this.newButton.setSlice(117,109,40,40,true);this.newButton.onMouseOver=function(f){this.setSlice(167,109,40,40,true)};this.newButton.onMouseOut=function(f){this.setSlice(117,109,40,40,true)};this.openButton=new CGSGNodeImage(this.newButton.getWidth()+d,5,null);this.openButton.setSlice(4,2,40,40,true);this.openButton.onMouseOver=function(f){this.setSlice(5,55,40,40,true)};this.openButton.onMouseOut=function(f){this.setSlice(4,2,40,40,true)};this.saveButton=new CGSGNodeImage(this.openButton.position.x+this.openButton.getWidth()+d,5,null);this.saveButton.setSlice(60,52,40,40,true);this.saveButton.onMouseOver=function(f){this.setSlice(60,5,40,40,true)};this.saveButton.onMouseOut=function(f){this.setSlice(60,52,40,40,true)};this.aboutButton=new CGSGNodeImage(this.saveButton.position.x+this.saveButton.getWidth()+d,5,null);this.aboutButton.setSlice(268,72,40,40,true);this.aboutButton.onMouseOver=function(f){this.setSlice(219,72,40,40,true)};this.aboutButton.onMouseOut=function(f){this.setSlice(268,72,40,40,true)};this.configButton=new CGSGNodeImage(this.aboutButton.position.x+this.aboutButton.getWidth()+d,5,null);this.configButton.setSlice(10,107,40,40,true);this.configButton.onMouseOver=function(f){this.setSlice(68,107,40,40,true)};this.configButton.onMouseOut=function(f){this.setSlice(10,107,40,40,true)};this.configButton.onClick=function(f){configNode.updateConfig(configNode.currentConfig);main.showConfig()};this.addChild(this.newButton);this.addChild(this.openButton);this.addChild(this.saveButton);this.addChild(this.aboutButton);this.addChild(this.configButton)},setImage:function(a){this.newButton.setImage(a);this.openButton.setImage(a);this.saveButton.setImage(a);this.aboutButton.setImage(a);this.configButton.setImage(a)}});var SceneNode=CGSGNode.extend({initialize:function(b,d,c,a){this._super(b,d,c,a);this.classType="SceneNode";this.stickers=[]},getProductVariantAtPosition:function(a,b){var d=function(e){if(e.classType!="Variant"||e==b){return false}return cgsgPointIsInRegion(a,new CGSGRegion(e.getAbsolutePosition().x,e.getAbsolutePosition().y,e.getWidth(),e.getHeight()),0)};var c=new CGSGTraverser().traverse(this,d,null);return c.length>0?c[c.length-1]:null},getAvailableSlotsForVariant:function(b){var d=function(e){return(e.classType==="Slot"&&e.canHostProduct(b))};var a=new CGSGTraverser();var c=a.traverse(sceneRoot,d,null);return c},afterRender:function(a){this._super(a)},addVariantNode:function(a){if(a.parentProduct.productType=="Sticker"){this.stickers.push(a)}this.addChild(a)}});function loadAllProducts(){var g=new Category(T_MENU_MEUBLES);g.slices=[new CGSGRegion(32,165,36,52),new CGSGRegion(32,222,36,52),new CGSGRegion(32,222,36,52)];catalog.addCategory(g);var x=new Category(T_CATEGORY_ARMOIRES);g.addSubCategory(x);var n=new Category(T_CATEGORY_MEUBLES_BAS);g.addSubCategory(n);var H=new Category(T_CATEGORY_MEUBLES_HAUTS);g.addSubCategory(H);var l=new Category(T_CATEGORY_TABLES);g.addSubCategory(l);var q=new Product(T_PRODUCT_ARMOIRE_1P,89,"images/picto_001.png");q.heightToFloor=40;q.setSize(104,333,50);q.addVariant(new Variant(1,T_COLOR_BLACK,"#1A1A1A","images/black_base01.png"));q.addVariant(new Variant(2,T_COLOR_WHITE,"#FEFEFE","images/white_base01.png"));q.addVariant(new Variant(3,T_COLOR_BEECH,"#D0BFA4","images/wood_base01.png"));x.addProduct(q);var p=new Product(T_PRODUCT_ARMOIRE_2P,179,"images/picto_003.png");p.heightToFloor=40;p.setSize(202,335,50);p.addVariant(new Variant(4,T_COLOR_BLACK,"#1A1A1A","images/black_base03.png"));p.addVariant(new Variant(5,T_COLOR_WHITE,"#FEFEFE","images/white_base03.png"));p.addVariant(new Variant(6,T_COLOR_BEECH,"#D0BFA4","images/wood_base03.png"));x.addProduct(p);var o=new Product(T_PRODUCT_ARMOIRE_3P,229,"images/picto_004.png");o.heightToFloor=40;o.setSize(299,337,50);o.addVariant(new Variant(7,T_COLOR_BLACK,"#1A1A1A","images/black_base04.png"));o.addVariant(new Variant(8,T_COLOR_WHITE,"#FEFEFE","images/white_base04.png"));o.addVariant(new Variant(9,T_COLOR_BEECH,"#D0BFA4","images/wood_base04.png"));x.addProduct(o);var N=new Product(T_PRODUCT_ELEMENT_L,79,"images/picto_005.png");N.heightToFloor=40;N.setSize(326,83,40);N.addVariant(new Variant(10,T_COLOR_BLACK,"#1A1A1A","images/black_base06.png"));N.addVariant(new Variant(11,T_COLOR_WHITE,"#FEFEFE","images/white_base06.png"));N.addVariant(new Variant(12,T_COLOR_BEECH,"#D0BFA4","images/wood_base06.png"));n.addProduct(N);var L=new Product(T_PRODUCT_COMMODE,49,"images/picto_002.png");L.heightToFloor=40;L.setSize(104,122,40);L.addVariant(new Variant(13,T_COLOR_BLACK,"#1A1A1A","images/black_base02.png"));L.addVariant(new Variant(14,T_COLOR_WHITE,"#FEFEFE","images/white_base02.png"));L.addVariant(new Variant(15,T_COLOR_BEECH,"#D0BFA4","images/wood_base02.png"));n.addProduct(L);var M=new Product(T_PRODUCT_ETAGERE,29,"images/picto_006.png");M.heightToFloor=25;M.setSize(328,26,30);M.isOnFloorOnly=false;M.addVariant(new Variant(16,T_COLOR_BLACK,"#1A1A1A","images/black_base05.png"));M.addVariant(new Variant(17,T_COLOR_WHITE,"#FEFEFE","images/white_base05.png"));M.addVariant(new Variant(18,T_COLOR_BEECH,"#D0BFA4","images/wood_base05.png"));H.addProduct(M);var w=new Product(T_PRODUCT_ELEMENT_H,79,"images/picto_005.png");w.heightToFloor=40;w.setSize(326,83,40);w.isOnFloorOnly=false;w.addVariant(new Variant(19,T_COLOR_BLACK,"#1A1A1A","images/black_base06.png"));w.addVariant(new Variant(20,T_COLOR_WHITE,"#FEFEFE","images/white_base06.png"));w.addVariant(new Variant(21,T_COLOR_BEECH,"#D0BFA4","images/wood_base06.png"));H.addProduct(w);var s=new Product(T_PRODUCT_TABLE,69,"images/picto_007.png");s.heightToFloor=50;s.setSize(188,107,60);s.addVariant(new Variant(22,T_COLOR_BLACK,"#1A1A1A","images/black_base07.png"));s.addVariant(new Variant(23,T_COLOR_WHITE,"#FEFEFE","images/white_base07.png"));s.addVariant(new Variant(24,T_COLOR_BEECH,"#D0BFA4","images/wood_base07.png"));l.addProduct(s);var r=new Category(T_MENU_ELEMENTS);r.slices=[new CGSGRegion(118,165,54,52),new CGSGRegion(118,222,54,52),new CGSGRegion(118,222,54,52)];catalog.addCategory(r);var a=new Category(T_CATEGORY_PORTES);r.addSubCategory(a);var P=new Category(T_CATEGORY_TIROIRS);r.addSubCategory(P);var k=new Category(T_CATEGORY_PLATEAUX);r.addSubCategory(k);var I=new Category(T_CATEGORY_POINEES);r.addSubCategory(I);var t=new Category(T_CATEGORY_PIEDS);r.addSubCategory(t);var b=new Product(T_PRODUCT_PORTES_G,55,"images/picto_008.png",true);b.heightToFloor=1;b.setSize(100,316,1);b.addVariant(new Variant(25,T_GAUCHE+" "+T_COLOR_BROWN,"#41352E","images/add07a.png"));b.addVariant(new Variant(250,T_GAUCHE+" "+T_COLOR_PURPLE,"#213745","images/add07a_2.png"));a.addProduct(b);var c=new Product(T_PRODUCT_PORTES_D,55,"images/picto_009.png",true);c.heightToFloor=1;c.setSize(98,315,1);c.addVariant(new Variant(26,T_DROITE+" "+T_COLOR_BROWN,"#41352E","images/add07b.png"));c.addVariant(new Variant(260,T_DROITE+" "+T_COLOR_PURPLE,"#213745","images/add07b_2.png"));a.addProduct(c);var A=new Product(T_PRODUCT_PORTIERES_1,25,"images/picto_010_1.png",true);A.heightToFloor=5;A.setSize(93,77,1);A.addVariant(new Variant(27,T_COLOR_RED,"#790005","images/add01.png"));A.addVariant(new Variant(28,T_COLOR_GRAY,"#4C4742","images/add02.png"));a.addProduct(A);var d=new Product(T_PORTIERES_TRANS_G,17,"images/picto_010_3_1.png",true);d.heightToFloor=1;d.setSize(81,69,1);d.addVariant(new Variant(31,T_GAUCHE,"#9BECE0","images/add09a.png"));a.addProduct(d);var h=new Product(T_PORTIERES_TRANS_D,17,"images/picto_010_3_2.png",true);h.heightToFloor=1;h.setSize(81,69,1);h.addVariant(new Variant(32,T_DROITE,"#9BECE0","images/add09b.png"));a.addProduct(h);var y=new Product(T_PRODUCT_PORTIERES_2,19,"images/picto_010_2.png",true);y.heightToFloor=1;y.setSize(73,71,1);y.addVariant(new Variant(29,T_COLOR_RED,"#790005","images/add10.png"));y.addVariant(new Variant(30,T_COLOR_GRAY,"#D1D1D1","images/add11.png"));a.addProduct(y);var z=new Product(T_PRODUCT_TIROIRS,15,"images/picto_011.png",true);z.heightToFloor=1;z.setSize(93,40,80);z.addVariant(new Variant(33,T_COLOR_GRAY,"#564A44","images/add05.png"));P.addProduct(z);var B=new Product(T_PRODUCT_PLATEAU_H,9,"images/picto_011.png",true);B.heightToFloor=10;B.setSize(93,20,50);B.addVariant(new Variant(34,T_COLOR_BLACK,"#1A1A1A","images/black_elemnt01.png"));B.addVariant(new Variant(35,T_COLOR_WHITE,"#FEFEFE","images/white_elemnt01.png"));B.addVariant(new Variant(36,T_COLOR_BEECH,"#D0BFA4","images/wood_elemnt01.png"));k.addProduct(B);var u=new Product(T_PRODUCT_PLATEAU_V,14,"images/picto_011_2.png",true);u.heightToFloor=10;u.setSize(13,70,50);u.addVariant(new Variant(37,T_COLOR_BLACK,"#1A1A1A","images/black_elemnt02.png"));u.addVariant(new Variant(38,T_COLOR_WHITE,"#FEFEFE","images/white_elemnt02.png"));u.addVariant(new Variant(39,T_COLOR_BEECH,"#D0BFA4","images/wood_elemnt02.png"));k.addProduct(u);var v=new Product(T_PRODUCT_BARRE,12,"images/picto_011.png",true);v.heightToFloor=1;v.setSize(93,52,1);v.addVariant(new Variant(40,"","gray","images/add04.png"));k.addProduct(v);var f=new Product(T_PRODUCT_POIGNEES_RONDES,4,"images/picto_015.png",true);f.heightToFloor=1;f.setSize(6,6,1);f.addVariant(new Variant(41,T_RONDES,"gray","images/add03.png"));I.addProduct(f);var D=new Product(T_PRODUCT_POIGNEES_V,4,"images/picto_013.png",true);D.heightToFloor=1;D.setSize(6,6,1);D.addVariant(new Variant(42,T_VERTICALES,"3F3632","images/add08.png"));I.addProduct(D);var F=new Product(T_PRODUCT_POIGNEES_H,4,"images/picto_014.png",true);F.heightToFloor=1;F.setSize(6,6,1);F.addVariant(new Variant(43,T_HORIZONTALES,"#332C28","images/add06.png"));I.addProduct(F);var C=new Product(T_PRODUCT_PIEDS_ROND,7,"images/picto_015.png",true);C.heightToFloor=1;C.setSize(15,15,1);var e=new Variant(44,T_ROND,"736E6B","images/add12.png");e.pickNodeMethod=CGSGPickNodeMethod.GHOST;C.addVariant(e);t.addProduct(C);var j=new Product(T_PRODUCT_PIEDS_RECT,7,"images/picto_013.png",true);j.heightToFloor=1;j.setSize(15,15,1);var E=new Variant(45,T_RECT,"#362E2A","images/add14.png");E.pickNodeMethod=CGSGPickNodeMethod.GHOST;j.addVariant(E);t.addProduct(j);var i=new Product(T_PRODUCT_FIX_ETGR,5,"images/picto_014.png",true);i.heightToFloor=1;i.setSize(14,12,1);var O=new Variant(46,"","#362E2A","images/add13.png");O.pickNodeMethod=CGSGPickNodeMethod.GHOST;i.addVariant(O);t.addProduct(i);var G=new Category(T_MENU_DECO);G.slices=[new CGSGRegion(228,165,34,52),new CGSGRegion(228,222,34,52),new CGSGRegion(228,222,34,52)];catalog.addCategory(G);var m=new Category(T_CATEGORY_STICKERS);G.addSubCategory(m);var K=new Product(T_PRODUCT_STICKER1,8.5,"images/picto_017.png");K.heightToFloor=0;K.setSize(138,111,0);K.isOnFloorOnly=false;K.addVariant(new Variant(47,"","red","images/sticker01.png"));K.hasToBeManagedForCollision=false;K.productType="Sticker";m.addProduct(K);var J=new Product(T_PRODUCT_STICKER2,8,"images/picto_016.png");J.heightToFloor=0;J.setSize(222,216,0);J.isOnFloorOnly=false;J.addVariant(new Variant(48,"","gray","images/sticker02.png"));J.hasToBeManagedForCollision=false;J.productType="Sticker";m.addProduct(J);q.addSlot(new Slot(q,new CGSGRegion(1,8,98,321),[T_PRODUCT_PORTES_G],4,"A"));q.addSlot(new Slot(q,new CGSGRegion(3,8,98,321),[T_PRODUCT_PORTES_D],4,"AA"));q.addSlot(new Slot(q,new CGSGRegion(5,6,97,77),[T_PRODUCT_PORTIERES_1],4,"B"));q.addSlot(new Slot(q,new CGSGRegion(5,87,97,77),[T_PRODUCT_PORTIERES_1],4,"B"));q.addSlot(new Slot(q,new CGSGRegion(5,168,97,77),[T_PRODUCT_PORTIERES_1],4,"B"));q.addSlot(new Slot(q,new CGSGRegion(5,249,97,77),[T_PRODUCT_PORTIERES_1],4,"B"));q.addSlot(new Slot(q,new CGSGRegion(5,9,96,40),[T_PRODUCT_TIROIRS],4,"C"));q.addSlot(new Slot(q,new CGSGRegion(5,55,96,40),[T_PRODUCT_TIROIRS],4,"C"));q.addSlot(new Slot(q,new CGSGRegion(5,101,96,40),[T_PRODUCT_TIROIRS],4,"C"));q.addSlot(new Slot(q,new CGSGRegion(5,148,96,40),[T_PRODUCT_TIROIRS],4,"C"));q.addSlot(new Slot(q,new CGSGRegion(5,195,96,40),[T_PRODUCT_TIROIRS],4,"C"));q.addSlot(new Slot(q,new CGSGRegion(5,241,96,40),[T_PRODUCT_TIROIRS],4,"C"));q.addSlot(new Slot(q,new CGSGRegion(5,286,96,40),[T_PRODUCT_TIROIRS],4,"C"));q.addSlot(new Slot(q,new CGSGRegion(5,55,97,18),[T_PRODUCT_PLATEAU_H],2,"D"));q.addSlot(new Slot(q,new CGSGRegion(5,106,97,18),[T_PRODUCT_PLATEAU_H],2,"D"));q.addSlot(new Slot(q,new CGSGRegion(5,158,97,18),[T_PRODUCT_PLATEAU_H],2,"D"));q.addSlot(new Slot(q,new CGSGRegion(5,210,97,18),[T_PRODUCT_PLATEAU_H],2,"D"));q.addSlot(new Slot(q,new CGSGRegion(5,261,97,18),[T_PRODUCT_PLATEAU_H],2,"D"));q.addSlot(new Slot(q,new CGSGRegion(5,38,94,25),[T_PRODUCT_BARRE],1,"D"));p.addSlot(new Slot(p,new CGSGRegion(1,12,98,321),[T_PRODUCT_PORTES_G],4,"A"));p.addSlot(new Slot(p,new CGSGRegion(102,12,98,321),[T_PRODUCT_PORTES_D],3,"A"));p.addSlot(new Slot(p,new CGSGRegion(5,8,95,77),[T_PRODUCT_PORTIERES_1],4,"B"));p.addSlot(new Slot(p,new CGSGRegion(5,89,95,77),[T_PRODUCT_PORTIERES_1],4,"B"));p.addSlot(new Slot(p,new CGSGRegion(5,170,95,77),[T_PRODUCT_PORTIERES_1],4,"B"));p.addSlot(new Slot(p,new CGSGRegion(5,251,95,77),[T_PRODUCT_PORTIERES_1],4,"B"));p.addSlot(new Slot(p,new CGSGRegion(104,8,95,77),[T_PRODUCT_PORTIERES_1],3,"B"));p.addSlot(new Slot(p,new CGSGRegion(104,89,95,77),[T_PRODUCT_PORTIERES_1],3,"B"));p.addSlot(new Slot(p,new CGSGRegion(104,170,95,77),[T_PRODUCT_PORTIERES_1],3,"B"));p.addSlot(new Slot(p,new CGSGRegion(104,251,95,77),[T_PRODUCT_PORTIERES_1],3,"B"));p.addSlot(new Slot(p,new CGSGRegion(5,11,94,40),[T_PRODUCT_TIROIRS],4,"C"));p.addSlot(new Slot(p,new CGSGRegion(5,57,94,40),[T_PRODUCT_TIROIRS],4,"C"));p.addSlot(new Slot(p,new CGSGRegion(5,103,94,40),[T_PRODUCT_TIROIRS],4,"C"));p.addSlot(new Slot(p,new CGSGRegion(5,150,94,40),[T_PRODUCT_TIROIRS],4,"C"));p.addSlot(new Slot(p,new CGSGRegion(5,197,94,40),[T_PRODUCT_TIROIRS],4,"C"));p.addSlot(new Slot(p,new CGSGRegion(5,243,94,40),[T_PRODUCT_TIROIRS],4,"C"));p.addSlot(new Slot(p,new CGSGRegion(5,288,94,40),[T_PRODUCT_TIROIRS],4,"C"));p.addSlot(new Slot(p,new CGSGRegion(105,11,94,40),[T_PRODUCT_TIROIRS],3,"C"));p.addSlot(new Slot(p,new CGSGRegion(105,57,94,40),[T_PRODUCT_TIROIRS],3,"C"));p.addSlot(new Slot(p,new CGSGRegion(104,103,94,40),[T_PRODUCT_TIROIRS],3,"C"));p.addSlot(new Slot(p,new CGSGRegion(104,150,94,40),[T_PRODUCT_TIROIRS],3,"C"));p.addSlot(new Slot(p,new CGSGRegion(104,197,94,40),[T_PRODUCT_TIROIRS],3,"C"));p.addSlot(new Slot(p,new CGSGRegion(104,243,94,40),[T_PRODUCT_TIROIRS],3,"C"));p.addSlot(new Slot(p,new CGSGRegion(104,288,94,40),[T_PRODUCT_TIROIRS],3,"C"));p.addSlot(new Slot(p,new CGSGRegion(5,57,95,18),[T_PRODUCT_PLATEAU_H],2,"D"));p.addSlot(new Slot(p,new CGSGRegion(5,108,95,18),[T_PRODUCT_PLATEAU_H],2,"D"));p.addSlot(new Slot(p,new CGSGRegion(5,160,95,18),[T_PRODUCT_PLATEAU_H],2,"D"));p.addSlot(new Slot(p,new CGSGRegion(5,212,95,18),[T_PRODUCT_PLATEAU_H],2,"D"));p.addSlot(new Slot(p,new CGSGRegion(5,263,95,18),[T_PRODUCT_PLATEAU_H],2,"D"));p.addSlot(new Slot(p,new CGSGRegion(104,57,95,18),[T_PRODUCT_PLATEAU_H],1,"D"));p.addSlot(new Slot(p,new CGSGRegion(104,108,95,18),[T_PRODUCT_PLATEAU_H],1,"D"));p.addSlot(new Slot(p,new CGSGRegion(104,160,95,18),[T_PRODUCT_PLATEAU_H],1,"D"));p.addSlot(new Slot(p,new CGSGRegion(104,212,95,18),[T_PRODUCT_PLATEAU_H],1,"D"));p.addSlot(new Slot(p,new CGSGRegion(104,263,95,18),[T_PRODUCT_PLATEAU_H],1,"D"));p.addSlot(new Slot(p,new CGSGRegion(5,40,94,25),[T_PRODUCT_BARRE],2,"D"));p.addSlot(new Slot(p,new CGSGRegion(104,40,94,25),[T_PRODUCT_BARRE],1,"D"));o.addSlot(new Slot(o,new CGSGRegion(1,14,98,321),[T_PRODUCT_PORTES_G],4,"A"));o.addSlot(new Slot(o,new CGSGRegion(200,14,98,321),[T_PRODUCT_PORTES_D],3,"A"));o.addSlot(new Slot(o,new CGSGRegion(5,10,95,77),[T_PRODUCT_PORTIERES_1],4,"B"));o.addSlot(new Slot(o,new CGSGRegion(5,91,95,77),[T_PRODUCT_PORTIERES_1],4,"B"));o.addSlot(new Slot(o,new CGSGRegion(5,172,95,77),[T_PRODUCT_PORTIERES_1],4,"B"));o.addSlot(new Slot(o,new CGSGRegion(5,253,95,77),[T_PRODUCT_PORTIERES_1],4,"B"));o.addSlot(new Slot(o,new CGSGRegion(200,10,95,77),[T_PRODUCT_PORTIERES_1],3,"B"));o.addSlot(new Slot(o,new CGSGRegion(200,91,95,77),[T_PRODUCT_PORTIERES_1],3,"B"));o.addSlot(new Slot(o,new CGSGRegion(200,172,95,77),[T_PRODUCT_PORTIERES_1],3,"B"));o.addSlot(new Slot(o,new CGSGRegion(200,253,95,77),[T_PRODUCT_PORTIERES_1],3,"B"));o.addSlot(new Slot(o,new CGSGRegion(5,11,94,40),[T_PRODUCT_TIROIRS],4,"C"));o.addSlot(new Slot(o,new CGSGRegion(5,57,94,40),[T_PRODUCT_TIROIRS],4,"C"));o.addSlot(new Slot(o,new CGSGRegion(5,105,94,40),[T_PRODUCT_TIROIRS],4,"C"));o.addSlot(new Slot(o,new CGSGRegion(5,152,94,40),[T_PRODUCT_TIROIRS],4,"C"));o.addSlot(new Slot(o,new CGSGRegion(5,199,94,40),[T_PRODUCT_TIROIRS],4,"C"));o.addSlot(new Slot(o,new CGSGRegion(5,245,94,40),[T_PRODUCT_TIROIRS],4,"C"));o.addSlot(new Slot(o,new CGSGRegion(5,290,94,40),[T_PRODUCT_TIROIRS],4,"C"));o.addSlot(new Slot(o,new CGSGRegion(103,245,93,40),[T_PRODUCT_TIROIRS],2,"C"));o.addSlot(new Slot(o,new CGSGRegion(103,290,93,40),[T_PRODUCT_TIROIRS],2,"C"));o.addSlot(new Slot(o,new CGSGRegion(200,13,94,40),[T_PRODUCT_TIROIRS],3,"C"));o.addSlot(new Slot(o,new CGSGRegion(200,59,94,40),[T_PRODUCT_TIROIRS],3,"C"));o.addSlot(new Slot(o,new CGSGRegion(200,105,94,40),[T_PRODUCT_TIROIRS],3,"C"));o.addSlot(new Slot(o,new CGSGRegion(200,152,94,40),[T_PRODUCT_TIROIRS],3,"C"));o.addSlot(new Slot(o,new CGSGRegion(200,199,94,40),[T_PRODUCT_TIROIRS],3,"C"));o.addSlot(new Slot(o,new CGSGRegion(200,245,94,40),[T_PRODUCT_TIROIRS],3,"C"));o.addSlot(new Slot(o,new CGSGRegion(200,290,94,40),[T_PRODUCT_TIROIRS],3,"C"));o.addSlot(new Slot(o,new CGSGRegion(5,57,95,18),[T_PRODUCT_PLATEAU_H],1,"D"));o.addSlot(new Slot(o,new CGSGRegion(5,108,95,18),[T_PRODUCT_PLATEAU_H],1,"D"));o.addSlot(new Slot(o,new CGSGRegion(5,160,95,18),[T_PRODUCT_PLATEAU_H],1,"D"));o.addSlot(new Slot(o,new CGSGRegion(5,212,95,18),[T_PRODUCT_PLATEAU_H],1,"D"));o.addSlot(new Slot(o,new CGSGRegion(5,263,95,18),[T_PRODUCT_PLATEAU_H],1,"D"));o.addSlot(new Slot(o,new CGSGRegion(102,57,95,18),[T_PRODUCT_PLATEAU_H],1,"D"));o.addSlot(new Slot(o,new CGSGRegion(102,108,95,18),[T_PRODUCT_PLATEAU_H],1,"D"));o.addSlot(new Slot(o,new CGSGRegion(102,160,95,18),[T_PRODUCT_PLATEAU_H],1,"D"));o.addSlot(new Slot(o,new CGSGRegion(200,57,95,18),[T_PRODUCT_PLATEAU_H],1,"D"));o.addSlot(new Slot(o,new CGSGRegion(200,108,95,18),[T_PRODUCT_PLATEAU_H],1,"D"));o.addSlot(new Slot(o,new CGSGRegion(200,160,95,18),[T_PRODUCT_PLATEAU_H],1,"D"));o.addSlot(new Slot(o,new CGSGRegion(200,212,95,18),[T_PRODUCT_PLATEAU_H],1,"D"));o.addSlot(new Slot(o,new CGSGRegion(200,263,95,18),[T_PRODUCT_PLATEAU_H],1,"D"));o.addSlot(new Slot(o,new CGSGRegion(5,40,94,25),[T_PRODUCT_BARRE],1,"D"));o.addSlot(new Slot(o,new CGSGRegion(102,40,94,25),[T_PRODUCT_BARRE],1,"D"));o.addSlot(new Slot(o,new CGSGRegion(200,40,94,25),[T_PRODUCT_BARRE],1,"D"));N.addSlot(new Slot(N,new CGSGRegion(5,7,74,71),[T_PRODUCT_PORTIERES_2],4,"A"));N.addSlot(new Slot(N,new CGSGRegion(88,7,74,71),[T_PRODUCT_PORTIERES_2],4,"A"));N.addSlot(new Slot(N,new CGSGRegion(168,7,74,71),[T_PRODUCT_PORTIERES_2],4,"A"));N.addSlot(new Slot(N,new CGSGRegion(249,7,74,71),[T_PRODUCT_PORTIERES_2],4,"A"));N.addSlot(new Slot(N,new CGSGRegion(-3,7,74,71),[T_PORTIERES_TRANS_G],4,"A"));N.addSlot(new Slot(N,new CGSGRegion(248,7,74,71),[T_PORTIERES_TRANS_D],4,"A"));N.addSlot(new Slot(N,new CGSGRegion(73,7,18,70),[T_PRODUCT_PLATEAU_V],3,"B"));N.addSlot(new Slot(N,new CGSGRegion(155,7,18,70),[T_PRODUCT_PLATEAU_V],3,"B"));N.addSlot(new Slot(N,new CGSGRegion(239,7,18,70),[T_PRODUCT_PLATEAU_V],3,"B"));N.addSlot(new Slot(N,new CGSGRegion(40,82,17,14),[T_PRODUCT_PIEDS_ROND,T_PRODUCT_PIEDS_RECT],1,"C"));N.addSlot(new Slot(N,new CGSGRegion(270,82,17,14),[T_PRODUCT_PIEDS_ROND,T_PRODUCT_PIEDS_RECT],1,"C"));L.addSlot(new Slot(L,new CGSGRegion(5,48,93,18),[T_PRODUCT_PLATEAU_H],1,"A"));L.addSlot(new Slot(L,new CGSGRegion(5,9,93,40),[T_PRODUCT_TIROIRS],1,"A"));L.addSlot(new Slot(L,new CGSGRegion(5,74,93,40),[T_PRODUCT_TIROIRS],1,"A"));w.addSlot(new Slot(w,new CGSGRegion(5,7,74,71),[T_PRODUCT_PORTIERES_2],4,"A"));w.addSlot(new Slot(w,new CGSGRegion(88,7,74,71),[T_PRODUCT_PORTIERES_2],4,"A"));w.addSlot(new Slot(w,new CGSGRegion(168,7,74,71),[T_PRODUCT_PORTIERES_2],4,"A"));w.addSlot(new Slot(w,new CGSGRegion(249,7,74,71),[T_PRODUCT_PORTIERES_2],4,"A"));w.addSlot(new Slot(w,new CGSGRegion(-3,7,74,71),[T_PORTIERES_TRANS_G],4,"B"));w.addSlot(new Slot(w,new CGSGRegion(248,7,74,71),[T_PORTIERES_TRANS_D],4,"B"));w.addSlot(new Slot(w,new CGSGRegion(73,7,18,70),[T_PRODUCT_PLATEAU_V],2,"C"));w.addSlot(new Slot(w,new CGSGRegion(155,7,18,70),[T_PRODUCT_PLATEAU_V],2,"C"));w.addSlot(new Slot(w,new CGSGRegion(239,7,18,70),[T_PRODUCT_PLATEAU_V],2,"C"));w.addSlot(new Slot(w,new CGSGRegion(40,82,12,20),[T_PRODUCT_FIX_ETGR],1,"D"));w.addSlot(new Slot(w,new CGSGRegion(270,82,12,20),[T_PRODUCT_FIX_ETGR],1,"D"));b.addSlot(new Slot(b,new CGSGRegion(63,155,25,25),[T_PRODUCT_POIGNEES_RONDES,T_PRODUCT_POIGNEES_V],1,"A"));c.addSlot(new Slot(c,new CGSGRegion(-1,155,25,25),[T_PRODUCT_POIGNEES_RONDES,T_PRODUCT_POIGNEES_V],1,"A"));A.addSlot(new Slot(T_PRODUCT_PORTIERES_1,new CGSGRegion(-6,21,25,25),[T_PRODUCT_POIGNEES_RONDES,T_PRODUCT_POIGNEES_V],1,"A"));A.addSlot(new Slot(T_PRODUCT_PORTIERES_1,new CGSGRegion(63,21,25,25),[T_PRODUCT_POIGNEES_RONDES,T_PRODUCT_POIGNEES_V],1,"A"));A.addSlot(new Slot(T_PRODUCT_PORTIERES_1,new CGSGRegion(29,21,25,25),[T_PRODUCT_POIGNEES_RONDES,T_PRODUCT_POIGNEES_V],1,"A"));y.addSlot(new Slot(T_PRODUCT_PORTIERES_2,new CGSGRegion(-4,17,25,25),[T_PRODUCT_POIGNEES_RONDES,T_PRODUCT_POIGNEES_V],1,"A"));y.addSlot(new Slot(T_PRODUCT_PORTIERES_2,new CGSGRegion(42,17,25,25),[T_PRODUCT_POIGNEES_RONDES,T_PRODUCT_POIGNEES_V],1,"A"));h.addSlot(new Slot(T_PORTIERES_TRANS_D,new CGSGRegion(-7,18,25,25),[T_PRODUCT_POIGNEES_RONDES,T_PRODUCT_POIGNEES_V],1,"A"));d.addSlot(new Slot(T_PORTIERES_TRANS_G,new CGSGRegion(51,18,25,25),[T_PRODUCT_POIGNEES_RONDES,T_PRODUCT_POIGNEES_V],1,"A"));z.addSlot(new Slot(T_PRODUCT_POIGNEES_H,new CGSGRegion(28,-7,25,25),[T_PRODUCT_POIGNEES_H],1,"A"))};var CGMain=CGSGScene.extend({initialize:function(a){this._super(a);this.initializeCanvas();this.createScene();sceneGraph=this.sceneGraph;this.startPlaying()},initializeCanvas:function(){this.viewDimension=cgsgGetRealViewportDimension();this.setCanvasDimension(this.viewDimension);FLOOR_POSITION=this.viewDimension.height-(MENU_HEIGHT+FLOOR_POSITION_FROM_BOTTOM);FLOOR_PERCENT=Math.max(0,FLOOR_POSITION/this.viewDimension.height);MENU_POPUP_HEIGHT=this.viewDimension.height-MENU_HEIGHT;if(this.viewDimension.width<1024||this.viewDimension.height<768){var a=this.viewDimension.width/1024;var d=this.viewDimension.height/768;var e=this.viewDimension.width/this.viewDimension.height;var c=1024/768;var b=new CGSGScale(a,d)}},createScene:function(){basket=new Basket();categoryPanel=new CategoryPanelNode();basketNode=new BasketNode();overlayNode=new OverlayNode(0,0,cgsgCanvas.width,cgsgCanvas.height);configNode=new ConfigNode();loadAnim=new LoadNode(this);this.allowMultiSelect=false;this.rootNode=new CGSGNode(0,0,0,0);this.sceneGraph.addNode(this.rootNode,null);this.wall=new CGSGNode(0,0,cgsgCanvas.width,cgsgCanvas.height);this.wall.name="The Wall";this.rootNode.addChild(this.wall);this.wall.isDraggable=true;this.wall.selectionLineWidth=0;this.wall.onDrag=this.onDragWall.bind(this);this.wall.onClick=function(a){categoryPanel.hide()};this.backgroundWallNode=new BackgroundWallNode(0,0,cgsgCanvas.width,FLOOR_POSITION);this.backgroundWallNode.isTraversable=false;this.wall.addChild(this.backgroundWallNode);this.backgroundFloorNode=new BackgroundFloorNode(0,FLOOR_POSITION,cgsgCanvas.width,FLOOR_POSITION_FROM_BOTTOM+MENU_HEIGHT);this.backgroundFloorNode.isTraversable=false;this.wall.addChild(this.backgroundFloorNode);sceneRoot=new SceneNode(0,0,cgsgCanvas.width,cgsgCanvas.height-MENU_HEIGHT);this.wall.addChild(sceneRoot);sceneRoot.isClickable=false;this.zoomMenuNode=new ZoomMenuNode();this.rootNode.addChild(this.zoomMenuNode);this.fileMenuNode=new FileMenuNode(10,10);this.rootNode.addChild(this.fileMenuNode);this.menuNode=new MenuNode(0,cgsgCanvas.width,this);this.rootNode.addChild(this.menuNode);this.rootNode.addChild(categoryPanel);this.rootNode.addChild(overlayNode);overlayNode.isVisible=false;loadAnim.show();document.addEventListener("onVariantSelected",this.onVariantSelected.bind(this),false);document.addEventListener("onVariantDeselected",this.onVariantDeselected.bind(this),false);document.addEventListener("onShowVariantDetails",this.onShowVariantDetails.bind(this),false);document.addEventListener("onZoomPlus",this.onZoomPlus.bind(this),false);document.addEventListener("onZoomMinus",this.onZoomMinus.bind(this),false);document.addEventListener("onAddToBasket",this.onAddToBasket.bind(this),false);document.addEventListener("onShowCategoryPanel",this.onShowCategoryPanel.bind(this),false);document.addEventListener("onChangeWallConfig",this.onChangeWallConfig.bind(this),false);document.addEventListener("onChangeFloorConfig",this.onChangeFloorConfig.bind(this),false);this.loadProducts();categoryPanel.initCategories();this.menuNode.initCategories();this.img=new Image();this.img.onload=this.onImageLoaded.bind(this);this.img.src="images/board.png"},onChangeWallConfig:function(){this.backgroundWallNode._initShape()},onChangeFloorConfig:function(){this.backgroundFloorNode._initShape()},onImageLoaded:function(){this.menuNode.setImage(this.img);this.zoomMenuNode.setImage(this.img);categoryPanel.setImage(this.img);this.fileMenuNode.setImage(this.img);basketNode.setImage(this.img);configNode.setImage(this.img);loadAnim.hide()},onShowCategoryPanel:function(a){categoryPanel.setCategory(a.category);categoryPanel.show()},onDragWall:function(a){this.checkWallConstraints()},checkWallConstraints:function(){var b=this.wall.position.x;var a=this.wall.position.y;var c=this.wall.getAbsoluteWidth();var d=this.wall.getAbsoluteHeight();if(b>0){this.wall.translateTo(0,this.wall.position.y,true)}if(a>0){this.wall.translateTo(this.wall.position.x,0,true)}if(this.wall.position.x+c<cgsgCanvas.width){this.wall.translateWith(cgsgCanvas.width-(this.wall.position.x+c),0,true)}if(this.wall.position.y+d<cgsgCanvas.height){this.wall.translateWith(0,cgsgCanvas.height-(this.wall.position.y+d),true)}},onZoomPlus:function(f){categoryPanel.hide();if(actualZoom<MAX_ZOOM){this.zoomMenuNode.deactivateAll();var a=Math.min(actualZoom+STEP_ZOOM,MAX_ZOOM);var g=Math.round((this.wall.getAbsoluteWidth()*(a-actualZoom))/2);var d=this.wall.getAbsoluteLeft()-g;var c=Math.round((this.wall.getAbsoluteHeight()*(a-actualZoom))/2);var b=this.wall.getAbsoluteTop()-c;this.sceneGraph.animate(this.wall,"scale.x",ANIMATE_ZOOM_SPEED,actualZoom,a,"linear",0,true);this.sceneGraph.animate(this.wall,"scale.y",ANIMATE_ZOOM_SPEED,actualZoom,a,"linear",0,true);this.sceneGraph.animate(this.wall,"position.x",ANIMATE_ZOOM_SPEED,this.wall.getAbsoluteLeft(),d,"linear",0,true);this.sceneGraph.animate(this.wall,"position.y",ANIMATE_ZOOM_SPEED,this.wall.getAbsoluteTop(),b,"linear",0,true);actualZoom=a;var e=this;this.sceneGraph.getTimeline(this.wall,"scale.x").onAnimate=function(h){e.checkWallConstraints()};this.sceneGraph.getTimeline(this.wall,"scale.x").onAnimationEnd=function(h){e.zoomMenuNode.checkActivate()}}},onZoomMinus:function(f){categoryPanel.hide();if(actualZoom>MIN_ZOOM){this.zoomMenuNode.deactivateAll();var a=Math.max(actualZoom-STEP_ZOOM,MIN_ZOOM);var g=Math.round((this.wall.getAbsoluteWidth()*(a-actualZoom))/2);var d=this.wall.getAbsoluteLeft()-g;var c=Math.round((this.wall.getAbsoluteHeight()*(a-actualZoom))/2);var b=this.wall.getAbsoluteTop()-c;this.sceneGraph.animate(this.wall,"scale.x",ANIMATE_ZOOM_SPEED,actualZoom,a,"linear",0,true);this.sceneGraph.animate(this.wall,"scale.y",ANIMATE_ZOOM_SPEED,actualZoom,a,"linear",0,true);this.sceneGraph.animate(this.wall,"position.x",ANIMATE_ZOOM_SPEED,this.wall.getAbsoluteLeft(),d,"linear",0,true);this.sceneGraph.animate(this.wall,"position.y",ANIMATE_ZOOM_SPEED,this.wall.getAbsoluteTop(),b,"linear",0,true);actualZoom=a;var e=this;this.sceneGraph.getTimeline(this.wall,"scale.x").onAnimate=function(h){e.checkWallConstraints()};this.sceneGraph.getTimeline(this.wall,"scale.x").onAnimationEnd=function(h){e.zoomMenuNode.checkActivate()}}},onVariantSelected:function(a){this.menuNode.detailPanel.setVariant(a.variant);this.menuNode.detailPanel.isVisible=true;categoryPanel.hide()},onVariantDeselected:function(a){this.menuNode.detailPanel.setVariant(null);this.menuNode.detailPanel.isVisible=false},onShowVariantDetails:function(d){categoryPanel.show();var a=d.variant;var e=a.parentProduct;var f=e.parentCategory;var c=f.parentCategory;if(!cgsgExist(c)){c=f;f=null}var b=categoryPanel.setCategory(c);b._selectProductView(e);b.selectProduct(e);b.selectVariant(a)},onAddToBasket:function(a){sceneRoot.addVariantNode(a.variant)},onRemoveFromBasket:function(a){this.removeFromScene(a.variant)},removeFromScene:function(a){sceneRoot.removeChild(a,true);sceneRoot.stickers.without(a)},showConfig:function(){overlayNode.show(configNode)},loadProducts:function(){loadAllProducts()}});