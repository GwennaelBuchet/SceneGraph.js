"use script";function cgsgIsArray(a){return(Object.prototype.toString.call(a)==="[object Array]")}Array.prototype.without=function(b){for(var a=0;a<this.length;a++){if(this[a]==b){this.splice(a,1)}}};Array.prototype.pop=function(){this.splice(this.length-1,1)};Array.prototype.clear=function(){this.length=0};Array.prototype.isEmpty=function(){return this.length===0};Array.prototype.clone=function(){return this.slice(0)};Array.prototype.copy=function(){var b=[];for(var c=0;c<this.length;c++){if(this[c].copy){b.push(this[c].copy())}else{b.push(this[c])}}return b};Array.prototype.contains=function(b){for(var a=0;a<this.length;a++){if(this[a]==b){return true}}return false};Array.prototype.unique=function(){var b=[],a;this.sort();for(a=0;a<this.length;a++){if(this[a]!==this[a+1]){b[b.length]=this[a]}}return b};Array.prototype.sum=function(){var b=0;for(var a=0;a<this.length;a++){b+=parseInt(this[a])}return b};Array.prototype.average=function(){return this.sum()/this.length};String.prototype.without=function(a){var b=this.replace(a,"");return b};String.prototype.collapse=function(){var b=this.split("-");var d=b[0];for(var c=1,a=b.length;c<a;c++){d+=b[c].capitalize()}return d};String.prototype.addFirstDot=function(){if(this.indexOf(".")!==0){return"."+this}return this};String.prototype.capitalize=function(a){return(a?this.toLowerCase():this).replace(/(?:^|\s)\S/g,function(b){return b.toUpperCase()})};(function(){var a=false,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.CGSGObject=function(){};CGSGObject.extend=function(g){var f=this.prototype;a=true;var e=new this();a=false;for(var d in g){e[d]=typeof g[d]=="function"&&typeof f[d]=="function"&&b.test(g[d])?(function(h,i){return function(){var k=this._super;this._super=f[h];var j=i.apply(this,arguments);this._super=k;return j}})(d,g[d]):g[d]}function c(){if(!a&&this.initialize){this.initialize.apply(this,arguments)}}c.prototype=e;c.prototype.constructor=c;c.extend=arguments.callee;return c}})();var CGSGMap=CGSGObject.extend({initialize:function(){this._map={};this._map.keys=[];this._map.values=[]},getAt:function(a){return{key:this._map.keys[a],value:this._map.values[a]}},getValue:function(b){var a=this.getKeyIndex(b);if(a<0){return null}return this._map.values[a]},getValues:function(){return this._map.values.copy()},addOrReplace:function(b,c){var a=this.getKeyIndex(b);if(a>=0){this._map.values[a]=c}else{this._map.keys.push(b);this._map.values.push(c);a=this.getLength()}return a},remove:function(b){if(this.containsKey(b)){var a=this.getKeyIndex(b);this._map.keys.splice(a,1);this._map.values.splice(a,1)}},removeAll:function(){this._map.keys.clear();this._map.values.clear()},clone:function(){var a=new CGSGMap();a._map.keys=this._map.keys.clone();a._map.values=this._map.value.clone();return a},containsKey:function(a){return this._map.keys.contains(a)},getLength:function(){return this._map.keys.length},getKeyIndex:function(b){var a;for(a=0;a<this.getLength();a++){if(this._map.keys[a]===b){return a}}return -1}});var CGSGColor={rgb2hex:function(d,c,a){return"#"+this._toHex(d)+this._toHex(c)+this._toHex(a)},hex2rgb:function(a){a=this._withoutSharp(a);return{r:parseInt(a.substring(0,2),16),g:parseInt(a.substring(2,4),16),b:parseInt(a.substring(4,6),16)}},_withoutSharp:function(a){return(a.charAt(0)=="#")?a.substring(1,a.length):a},_toHex:function(b){var a=parseInt(b,10);if(isNaN(a)){return"00"}a=Math.max(0,Math.min(a,255));return"0123456789ABCDEF".charAt((a-a%16)/16)+"0123456789ABCDEF".charAt(a%16)},fromString:function(c){var e=c.indexOf("(")+1;var d=c.lastIndexOf(")");var b=c.substring(e,d);var a=b.split(",");return{r:parseInt(a[0]),g:parseInt(a[1]),b:parseInt(a[2])}},lerp:function(d,f,c){var e=this.hex2rgb(d);var b=this.hex2rgb(f);var a=[];a[0]=e.r+(b.r-e.r)*c;a[1]=e.g+(b.g-e.g)*c;a[2]=e.b+(b.b-e.b)*c;return this.rgb2hex(a[0],a[1],a[2])},darkenHex:function(c,b){var a=this.hex2rgb(c);a.r=this.multiplyComponent(a.r,b);a.g=this.multiplyComponent(a.g,b);a.b=this.multiplyComponent(a.b,b);return this.rgb2hex(a.r,a.g,a.b)},darkenRGB:function(e,d,a,c){return{r:this.multiplyComponent(e,c),g:this.multiplyComponent(d,c),b:this.multiplyComponent(a,c)}},litRGB:function(f,e,a,d){var c=this.rgb2hsl(f,e,a);c.l*=d;return this.hsl2rgb(c.h,c.s,c.l)},multiplyComponent:function(b,a){return Math.max(Math.min(255,b*a),0)},rgb2hsv:function(k,j,c){var f,a;k/=255;j/=255;c/=255;f=Math.min(c,Math.min(k,j));a=Math.max(c,Math.max(k,j));if(a==f){return{h:0,s:0,v:f}}var l=(k==f)?j-c:((c==f)?k-j:c-k);var i=(k==f)?3:((c==f)?1:5);var e=a-f;return{h:60*(i-l/e),s:e/a,v:a}},rgb2hsl:function(a,i,k){a/=255,i/=255,k/=255;var m=Math.max(a,i,k),e=Math.min(a,i,k);var f,n,c=(m+e)/2;if(m==e){f=n=0}else{var j=m-e;n=c>0.5?j/(2-m-e):j/(m+e);switch(m){case a:f=(i-k)/j+(i<k?6:0);break;case i:f=(k-a)/j+2;break;case k:f=(a-i)/j+4;break}f/=6}return{h:f,s:n,l:c}},hsl2rgb:function(e,d,c){var i,f,a;if(d==0){i=f=a=c}else{var j=c<0.5?c*(1+d):c+d-c*d;var k=2*c-j;i=this.hue2rgb(k,j,e+1/3);f=this.hue2rgb(k,j,e);a=this.hue2rgb(k,j,e-1/3)}return{r:i*255,g:f*255,b:a*255}},hue2rgb:function(c,b,a){if(a<0){a+=1}if(a>1){a-=1}if(a<1/6){return c+(b-c)*6*a}if(a<1/2){return b}if(a<2/3){return c+(b-c)*(2/3-a)*6}return c},hsv2rgb:function(j,u,n){var a,k,m;var e=Math.floor(j*6);var l=j*6-e;var d=n*(1-u);var c=n*(1-l*u);var o=n*(1-(1-l)*u);switch(e%6){case 0:a=n,k=o,m=d;break;case 1:a=c,k=n,m=d;break;case 2:a=d,k=n,m=o;break;case 3:a=d,k=c,m=n;break;case 4:a=o,k=d,m=n;break;case 5:a=n,k=d,m=c;break}return{r:a*255,g:k*255,b:m*255}}};var CGSGVector2D=CGSGObject.extend({initialize:function(a,b){this.x=a;this.y=b},copy:function(){return new CGSGVector2D(this.x,this.y)},add:function(a){return new CGSGVector2D(this.x+a.x,this.y+a.y)},addEquals:function(a){this.x+=a.x;this.y+=a.y},subtract:function(a){return new CGSGVector2D(this.x-a.x,this.y-a.y)},subtractEquals:function(a){this.x-=a.x;this.y-=a.y},multiply:function(a){return new CGSGVector2D(this.x*a.x,this.y*a.y)},multiplyEquals:function(a){this.x*=a.x;this.y*=a.y},divide:function(a){return new CGSGVector2D(this.x/a.x,this.y/a.y)},divideEquals:function(a){this.x/=a.x;this.y/=a.y},multiplyByFloat:function(a){return new CGSGVector2D(this.x*a,this.y*a)},multiplyByFloatEquals:function(a){this.x*=a;this.y*=a},divideByFloat:function(a){return new CGSGVector2D(this.x/a,this.y/a)},divideByFloatEquals:function(a){this.x/=a;this.y/=a},getDistance:function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))},rotate:function(c){var b=Math.cos(c);var a=Math.sin(c);this.x=this.x*b+this.y*a;this.y=this.x*a-this.y*b},getLength:function(){return Math.sqrt((this.x*this.x)+(this.y*this.y))},getSquaredLength:function(){return(this.x*this.x)+(this.y*this.y)},normalize:function(){var b;var a=this.getLength();if(a==1||a==0){return}b=1/a;this.x*=b;this.y*=b},sign:function(a){var b=this.perp();return b.dot(a)<0?-1:1},dot:function(a){return this.x*a.x+this.y*a.y},cross:function(a){return this.x*a.y-this.y*a.x},unit:function(){return this.divide(this.getLength())},unitFast:function(){var c=Math.abs(this.x);var b=Math.abs(this.y);var a=1/Math.max(c,b);a=a*(1.29289-(c+b)*a*0.29289);return this.multiplyByFloat(a)},unitEquals:function(){this.divideEquals(this.getLength())},perp:function(){return new CGSGVector2D(-this.y,this.x)},perpendicular:function(a){return this.subtract(this.project(a))},project:function(a){var b=this.dot(a)/a.dot(a);return a.multiply(b)},toString:function(){return this.x+","+this.y}});"use strict";var CGSGPosition=CGSGVector2D.extend({initialize:function(a,b){this._super(a,b)},equalsTo:function(a){return cgsgExist(a)&&a.x===this.x&&a.y===this.y},copy:function(){return new CGSGPosition(this.x,this.y)},translateTo:function(b,a){this.x=b;this.y=a},translateWith:function(a,b){this.x+=a;this.y+=b},translateBy:function(a,b){this.x*=a;this.y*=b},isNegative:function(){return(this.x<0||this.y<0)}});var CGSGScale=CGSGPosition.extend({initialize:function(a,b){this._super(a,b)}});var CGSGRotation=CGSGObject.extend({initialize:function(a){this.angle=a},copy:function(){return new CGSGRotation(this.angle)},rotateTo:function(a){this.angle=a},rotateBy:function(a){this.multiplyEquals(a)},rotateWith:function(a){this.addEquals(a)},addEquals:function(a){this.angle+=a},subtractEquals:function(a){this.angle-=a},multiplyEquals:function(a){this.angle*=a}});var CGSGDimension=CGSGVector2D.extend({initialize:function(b,a){this._super(b,a);this.width=this.x;this.height=this.y},copy:function(){return new CGSGDimension(this.width,this.height)},resizeTo:function(b,a){if(b>=0){this.width=b}if(a>=0){this.height=a}},resizeBy:function(b,a){if(b>=0){this.width*=b}if(a>=0){this.height*=a}},resizeWith:function(b,a){if(this.width+b>=0){this.width+=b}if(this.height+a>=0){this.height+=a}},isEmpty:function(){return(this.width<=0||this.height<=0)}});var CGSGRegion=CGSGObject.extend({initialize:function(b,d,c,a){this.position=new CGSGPosition(b,d);this.dimension=new CGSGDimension(c,a)},copy:function(){return new CGSGRegion(this.position.x,this.position.y,this.dimension.width,this.dimension.height)},addEquals:function(a){this.position.translateWith(a.position.x,a.position.y);this.dimension.resizeWith(a.dimension.width,a.dimension.height)},subtractEquals:function(a){this.position.translateWith(-a.position.x,-a.position.y);this.dimension.resizeWith(-a.dimension.width,-a.dimension.height)},isEmpty:function(){return this.dimension.isEmpty()},isNegative:function(){return(this.isEmpty()||this.position.isNegative())}});var CGSG_DEFAULT_DISPLAYRATIO=new CGSGScale(1,1);var CGSG_DEFAULT_DRAG_SELECT_FILL_COLOR="#C0C0C0";var CGSG_DEFAULT_DRAG_SELECT_STROKE_COLOR="#808080";var CGSG_DEFAULT_DRAG_SELECT_ALPHA=0.6;var CGSG_DEFAULT_SELECTED_RESIZEHANDLE_THRESHOLD=3;var CGSG_DEFAULT_FRAMERATE_DELAY=20;var CGSG_DEFAULT_MAX_FRAMERATE=NaN;var CGSG_DEFAULT_DBLTOUCH_DELAY=250;var CGSGTraverser=CGSGObject.extend({initialize:function(){this.lastResults=[]},traverse:function(a,c,b){this.lastResults.clear();if(cgsgExist(c)){this._check(a,c,b)}return this.lastResults},_check:function(a,f,e){if(a.isTraversable===true){var d=cgsgExist(e)&&e.length>0;if(!(d&&e.contains(a))&&f(a)===true){this.lastResults.push(a)}for(var c=a.children.length-1;c>=0;--c){var b=a.children[c];this._check(b,f,e)}}}});var CGSGImgManager=CGSGObject.extend({initialize:function(){this._mapURL=new CGSGMap()},get:function(a){return this._mapURL.getValue(a)},set:function(b,a){this._mapURL.addOrReplace(b,a)}});var cgsgImgManager=new CGSGImgManager();"use strict";var CGSGEvent=CGSGObject.extend({initialize:function(a,b){this.trigger=a;this.data=b;this.observable=null;this.type=null;this.propagate=true}});var CGSGBindEntry=CGSGObject.extend({initialize:function(c,a,b){this._observable=c;this._attributeName=a;this._isAdditional=b}});var CGSGEventManager=CGSGObject.extend({initialize:function(){this._handlerPropertyPrefix="cgsgEventManager_"+new Date().getTime()+"_";this._table=new CGSGMap()},replaceHandler:function(c,d){var e=c._observable;if(!c._isAdditional){e[c._attributeName]=d}else{var b=this._table.getValue(c);var a=e[c._attributeName].indexOf(b);if(a!==-1){e[c._attributeName][a]=d}}this._table.addOrReplace(c,d)},bindHandler:function(f,b,d){var a=cgsgExist(f[b]);var c;if(a){c=this._getHandlerPropertyName(b);if(!cgsgExist(f[c])){f[c]=[d]}else{f[c].push(d)}}else{c=b;f[b]=d}var e=new CGSGBindEntry(f,c,a);this._table.addOrReplace(e,d);return e},dispatch:function(e,a,d){d.observable=e;d.type=a;if(!cgsgExist(e[a])){console.log(a)}e[a](d);if(d.propagate){var c=this._getHandlerPropertyName(a);var b=e[c];if(cgsgExist(b)){cgsgIterate(b,function(f,g){g(d);return d.propagate})}}},unbindHandler:function(g,b,e){var c,a,f;if(g[b]===e){g[b]=null}else{var d=this._getHandlerPropertyName(b);c=g[d].indexOf(e);if(c!==-1){g[d].slice(c,1)}}for(c=0,a=this._table.getLength();c<a;c++){f=this._table.getAt(c);if(f.value===e){this._table.remove(f.key);break}}},unbindAll:function(c,a){c[a]=null;var b=this._getHandlerPropertyName(a);if(cgsgExist(c[b])){c[b].splice(0,c[b].length-1)}},_getHandlerPropertyName:function(a){return this._handlerPropertyPrefix+a}});var CGSGCSSManager=CGSGObject.extend({initialize:function(){this.isLoaded=false;this.onLoadEnd=null;this.onLoadError=null;this.onLoadAbort=null;this._classes=new CGSGMap();this._blacklist=[]},getAttr:function(b,a){b=b.addFirstDot();var d=this._classes.getValue(b);if(cgsgExist(d)){var c=d[a.collapse()];if(cgsgExist(c)&&c.length>0){return c}}return null},getAttrInArray:function(d,b){var e,c,f,a=d.length;for(e=a-1;e>=0;--e){c=d[e];f=this.getAttr(c,b);if(cgsgExist(f)){return f}}return null},getCls:function(a){a=a.addFirstDot();return this._classes.getValue(a)},getURL:function(a){if(!cgsgExist(a)||a.length==0){return null}var b=a.without("url(");b=b.without(")");return b},getNumber:function(a){if(!cgsgExist(a)||a.length==0){return NaN}a=this._cleanAttr(a);return parseInt(a)},getFloat:function(a){if(!cgsgExist(a)||a.length==0){return null}a=this._cleanAttr(a);return parseFloat(a)},_cleanAttr:function(a){var b=/px|pt/gi;a=a.replace(b,"");a.trim();return a},invalidateCache:function(){this._classes.removeAll();var b,a,e=document.styleSheets.length;for(var d=0;d<e;d++){if(!this._blacklist.contains(document.styleSheets[d].href)){var c=document.styleSheets[d].rules||document.styleSheets[d].cssRules;if(cgsgExist(c)){for(a=0,b=c.length;a<b;a++){this._classes.addOrReplace(c[a].selectorText,c[a].style)}}else{console.log("WARNING: '"+document.styleSheets[d].href+"' file without class. Be sure application is running under a web server and CSS file is correctly loaded.")}}}},loadCSSFile:function(c){this.isLoaded=false;this._url=c;var a=document.getElementsByTagName("head")[0];var b=document.createElement("link");b.onload=this._createDelegate(this,this._onFileLoaded);b.onerror=this._createDelegate(this,this._onFileError);b.onabort=this._createDelegate(this,this._onFileAbort);b.type="text/css";b.rel="stylesheet";b.media="screen";b.href=c;a.appendChild(b)},unloadCSSFile:function(c){var b="href";var a=document.getElementsByTagName("link");for(var d=a.length;d>=0;d--){if(a[d]&&a[d].getAttribute(b)!=null&&a[d].getAttribute(b).indexOf(c)!=-1){a[d].parentNode.removeChild(a[d])}}},ignoreCSSFile:function(a){this._blacklist.push(a)},_createDelegate:function(a,b){return function(){return b.call(a)}},_onFileLoaded:function(a){this.invalidateCache();this.isLoaded=true;if(this.onLoadEnd!==null){this.onLoadEnd({event:a})}},_onFileError:function(a){if(this.onLoadError!==null){this.onLoadError({event:a})}},_onFileAbort:function(a){if(this.onLoadAbort!==null){this.onLoadAbort({event:a})}}});"use strict";var CGSGKeyFrame=CGSGObject.extend({initialize:function(b,a){this.frame=b;this.value=a;this.inTangent=new CGSGVector2D(0,0);this.outTangent=new CGSGVector2D(0,0);this.userData=null}});var CGSGInterpolator=CGSGObject.extend({initialize:function(){},compute:function(b,a){},getLengths:function(){}});var CGSGInterpolatorLinear=CGSGInterpolator.extend({initialize:function(){},compute:function(m,d){var b,n,j=m.length,c,a,i,f,l,h;var g=[];for(b=0;b<j-1;b++){i=m[b];f=m[b+1];c=d[b];l=(f.value.x-i.value.x)/d[b];h=(f.value.y-i.value.y)/d[b];for(n=0;n<c;n++){a=n;if(a===i.frame){g.push({x:i.value.x,y:i.value.y})}else{if(a===f.frame){g.push({x:f.value.x,y:f.value.y})}else{g.push({x:m[b].value.x+n*l,y:m[b].value.y+n*h})}}}}var e=m[j-1];g.push({x:e.value.x,y:e.value.y});return g}});var CGSGInterpolatorTCB=CGSGInterpolator.extend({initialize:function(){},compute:function(f,d){var a=f.length-1;var c=new CGSGKeyFrame(a,{x:f[a].value.x,y:f[a].value.y});c.userData={t:0,c:0,b:0};f.push(c);a=f.length;var e;var b=[];for(e=0;e<a-1;e++){if(e==0){b=b.concat(this._interpolate(f[e],f[e],f[e+1],f[e+2],f[e].userData.t,f[e].userData.c,f[e].userData.b,d[e]))}else{if(e+2<a){b=b.concat(this._interpolate(f[e-1],f[e],f[e+1],f[e+2],f[e].userData.t,f[e].userData.c,f[e].userData.b,d[e]))}else{if(e+1<a){b=b.concat(this._interpolate(f[e-1],f[e],f[e+1],f[0],f[e].userData.t,f[e].userData.c,f[e].userData.b,d[e]))}else{b=b.concat(this._interpolate(f[e-1],f[e],f[0],f[1],f[e].userData.t,f[e].userData.c,f[e].userData.b,d[e]))}}}}var g=f[a-2];b.push({x:g.value.x,y:g.value.y});f.pop();return b},_interpolate:function(f,e,d,a,w,E,F,D){var r=new CGSGVector2D(f.value.x,f.value.y);var q=new CGSGVector2D(e.value.x,e.value.y);var p=new CGSGVector2D(d.value.x,d.value.y);var o=new CGSGVector2D(a.value.x,a.value.y);var z=e.value.x,y=e.value.y;var x,n,m,l,j;var k,h,B,A,v,u;var g=[];for(var C=0;C<D;C++){x=C/D;n=2*Math.pow(x,3)-3*Math.pow(x,2)+1;m=-2*Math.pow(x,3)+3*Math.pow(x,2);l=Math.pow(x,3)-2*Math.pow(x,2)+x;j=Math.pow(x,3)-Math.pow(x,2);k=(1-w)*(1+E)*(1+F)*(q.x-r.x)/2+(1-w)*(1-E)*(1-F)*(p.x-q.x)/2;h=(1-w)*(1+E)*(1+F)*(q.y-r.y)/2+(1-w)*(1-E)*(1-F)*(p.y-q.y)/2;B=(1-w)*(1-E)*(1+F)*(p.x-q.x)/2+(1-w)*(1+E)*(1-F)*(o.x-p.x)/2;A=(1-w)*(1-E)*(1+F)*(p.y-q.y)/2+(1-w)*(1+E)*(1-F)*(o.y-p.y)/2;v=n*q.x+m*p.x+l*k+j*B;u=n*q.y+m*p.y+l*h+j*A;g.push({x:v,y:u});z=v;y=u}return g}});"use strict";var CGSGTimeline=CGSGObject.extend({initialize:function(a,b){this.parentNode=a;this.attribute=b;this._method=CGSGAnimationMethod.LINEAR;this.listValues=[];this._listKeys=[];this._numberOfFrameBetweenKeys=[];this._listErpKeys=[];this.onAnimationStart=null;this.onAnimationEnd=null;this.onAnimate=null},addKey:function(b,a){this._listKeys.push(new CGSGKeyFrame(b,{x:a,y:0}));this.sortByFrame(this._listKeys);this.listValues.clear();this.addInterpolationKey(b,a)},removeKey:function(a){this._removeKeyToList(a,this._listKeys);this._removeKeyToList(a,this._listErpKeys);if(this.getNbKeys()>1){this._computeNumberOfFrameBetweenKeys()}this.listValues.clear()},removeKeysBetween:function(c,b){var a;for(a=this._listKeys.length-1;a>=0;a--){if(this._listKeys[a].frame>=c&&this._listKeys[a].frame<=b){this._listKeys.without(this._listKeys[a])}}for(a=this._listErpKeys.length-1;a>=0;a--){if(this._listErpKeys[a].frame>=c&&this._listErpKeys[a].frame<=b){this._listErpKeys.without(this._listErpKeys[a])}}this.listValues.clear()},addInterpolationKey:function(b,a){this._removeKeyToList(b,this._listErpKeys);this._listErpKeys.push(new CGSGKeyFrame(b,{x:a,y:0}));this.sortByFrame(this._listErpKeys)},removeInterpolationKey:function(a){this._removeKeyToList(a,this._listErpKeys)},_removeKeyToList:function(d,c){var b=null,a=0;for(a;a<c.length-1;a++){if(c[a].frame===d){b=c[a];break}}c.without(b)},removeAll:function(){this.listValues.clear();this._listKeys.clear();this._listErpKeys.clear();this._numberOfFrameBetweenKeys.clear()},_computeNumberOfFrameBetweenKeys:function(){this._numberOfFrameBetweenKeys.clear();var a=0,b=0;for(b;b<this._listErpKeys.length-1;b++){a=this._listErpKeys[b+1].frame-this._listErpKeys[b].frame;this._numberOfFrameBetweenKeys.push(a)}},getNbKeys:function(){return this._listKeys.length},sortByFrame:function(a){a.sort(function(d,c){return d.frame-c.frame})},compute:function(){this.listValues.clear();if(this.getNbKeys()<1){return}this._computeNumberOfFrameBetweenKeys();this.listValues=this._method.compute(this._listErpKeys,this._numberOfFrameBetweenKeys)},getFirstKey:function(){if(this.getNbKeys()===0){return null}return this._listKeys[0]},getLastKey:function(){if(this.getNbKeys()===0){return null}return this._listKeys[this.getNbKeys()-1]},getValue:function(a){var b=this.getNbKeys();if(b===0&&this.listValues.isEmpty()){return undefined}if(this.listValues.isEmpty()){if(a<this._listKeys[0].frame){return undefined}return this.compute()}if(a<this._listKeys[0].frame){return undefined}if(a>=this._listKeys[this._listKeys.length-1].frame){return this.listValues[this.listValues.length-1].x}return this.listValues[a-this._listKeys[0].frame].x},exportValues:function(){if(this.listValues.length===0){this.compute()}var a=[],b;for(b=0;b<this.listValues.length;b++){a.push(this.listValues[b])}return a},importValues:function(a,c){this.addKey(c,a[0]);this.addKey(c+a.length-1,a[a.length-1]);var b;for(b=0;b<a.length;b++){this.listValues.push(a[b])}}});var CGSGAnimationMethod={LINEAR:new CGSGInterpolatorLinear(),CUBIC_SPLINE:new CGSGInterpolatorTCB()};var CGSGAnimationManager=CGSGObject.extend({initialize:function(){this.listTimelines=[]},addAnimationKey:function(a,c,b){a.addKey(CGSGMath.fixedPoint(c),b)},removeAnimationKey:function(a,b){a.removeKey(CGSGMath.fixedPoint(b))},animate:function(d,c,e,g,h,f){var i=this.getTimeline(d,c);var b=CGSG.currentFrame+CGSGMath.fixedPoint(f);var a=CGSG.currentFrame+CGSGMath.fixedPoint(f+e);i.removeKeysBetween(b,a);this.addAnimationKey(i,b,g);this.addAnimationKey(i,a,h);this.compute(i);return i},compute:function(a){a.compute()},stillHaveAnimation:function(){if(this.listTimelines.length==0){return false}else{for(var b=0,a=this.listTimelines.length;b<a;++b){if(this.listTimelines[b].getLastKey()!==null&&this.listTimelines[b].getLastKey().frame<=CGSG.currentFrame){return true}}}return false},getTimeline:function(d,c){for(var b=0,a=this.listTimelines.length;b<a;++b){if(this.listTimelines[b].parentNode===d&&this.listTimelines[b].attribute==c){return this.listTimelines[b]}}return this._createTimeline(d,c)},_createTimeline:function(c,b){var a=new CGSGTimeline(c,b);this.listTimelines.push(a);return a}});"use strict";var CGSGCollisionMethod={GHOSTONDEMAND:"ghostOnDemand",REGION:"region"};"use strict";var CGSGCollisionRegionTester=CGSGObject.extend({initialize:function(){this.classType="CGSGCollisionRegionTester"},isColliding:function(a,h,f){if(f===null){f=0}var d=a.getAbsLeft();var e=a.getAbsRight();var g=a.getAbsBottom();var b=h.getAbsLeft();var c=h.getAbsRight();var i=h.getAbsBottom();if((d<=c+f&&e>=b-f)||(e>=b-f&&d<=c+f)){if(a.getAbsTop()<=i+f&&g>=h.getAbsTop()-f){return true}}return false}});"use strict";var CGSGCollisionGhostOnDemandTester=CGSGObject.extend({initialize:function(){this.classType="CGSGCollisionGhostOnDemandTester"},isColliding:function(e,c,i){var r=c.getAbsLeft()-e.getAbsLeft();var q=c.getAbsTop()-e.getAbsTop();var n=(r>=0)?Math.min(e.getAbsWidth()-r,c.getAbsWidth()):Math.min(c.getAbsWidth()+r,e.getAbsWidth());var m=(q>=0)?Math.min(e.getAbsHeight()-q,c.getAbsHeight()):Math.min(c.getAbsHeight()+q,e.getAbsHeight());if((n<=0)||(m<=0)){return false}var p=(r>=0)?r:0;var o=(q>=0)?q:0;var b=document.createElement("canvas");b.width=e.getAbsWidth();b.height=e.getAbsHeight();var k=b.getContext("2d");k.scale(e._absSca.x,e._absSca.y);var d=e.position;e.position=new CGSGPosition(0,0);e.render(k);e.position=d;var a=document.createElement("canvas");a.width=c.getAbsWidth();a.height=c.getAbsHeight();var l=a.getContext("2d");d=c.position;c.position=new CGSGPosition(0,0);c.render(l);c.position=d;k.globalCompositeOperation="destination-in";k.drawImage(a,r/e._absSca.x,q/e._absSca.y);var h=k.getImageData(p,o,n,m);for(var g=0;g<h.width;g++){for(var f=0;f<h.height;f++){var j=((g)+(f)*h.width)*4;if(h.data[j+3]>0){return true}}}return false}});"use strict";var CGSGCollisionTesterFactory=CGSGObject.extend({initialize:function(){this.collisionTesters=new CGSGMap();this.collisionTesters.addOrReplace(CGSGCollisionMethod.REGION,new CGSGCollisionRegionTester());this.collisionTesters.addOrReplace(CGSGCollisionMethod.GHOSTONDEMAND,new CGSGCollisionGhostOnDemandTester())},getCollisionTester:function(a){return this.collisionTesters.getValue(a)}});"use strict";var CGSGCollisionManager=CGSGObject.extend({initialize:function(){},isColliding:function(c,b,a){if(c.isCollisionManaged&&b.isCollisionManaged){if(cgsgExist(CGSG.performanceKeys)){return CGSG.performanceKeys.collisionTester.isColliding(c,b,a)}}return false},manageNode:function(a){a.isCollisionManaged=true},unManageNode:function(a){a.isCollisionManaged=false}});var CGSGPickNodeMethod={GHOST:"ghost",REGION:"region"};var cgsgExplorerParams={IE10:{name:"IE 10 or above",browserName:"",fullVersion:"",textDecalYTop:4.3,textDecalYBottom:1.26,textDecalYMiddle:1.87,textDecalYAlpha:0.983,webworker:false},IE9:{name:"IE 9",browserName:"",fullVersion:"",textDecalYTop:4.3,textDecalYBottom:1.26,textDecalYMiddle:1.87,textDecalYAlpha:0.983,webworker:false},SAFARI:{name:"Safari",browserName:"",fullVersion:"",textDecalYTop:4,textDecalYBottom:1.27,textDecalYMiddle:1.77,textDecalYAlpha:0.983,webworker:false},CHROME:{name:"Chrome",browserName:"",fullVersion:"",textDecalYTop:3.3,textDecalYBottom:1.268,textDecalYMiddle:2.09,textDecalYAlpha:0.983,webworker:false},OPERA:{name:"Opera",browserName:"",fullVersion:"",textDecalYTop:3.5,textDecalYBottom:1.28,textDecalYMiddle:2,textDecalYAlpha:0.995,webworker:false},FIREFOX:{name:"Firefox",browserName:"",fullVersion:"",textDecalYTop:10,textDecalYBottom:1.23,textDecalYMiddle:1.77,textDecalYAlpha:0.983,webworker:false},KONQUEROR:{name:"Konqueror",browserName:"",fullVersion:"",textDecalYTop:10,textDecalYBottom:1.23,textDecalYMiddle:1.77,textDecalYAlpha:0.983,webworker:false},UNKNOWN:{name:"Unknown",browserName:"",fullVersion:"",textDecalYTop:10,textDecalYBottom:1.23,textDecalYMiddle:1.77,textDecalYAlpha:0.983,webworker:false}};var cgsgCurrentExplorer=cgsgExplorerParams.UNKNOWN;var CGSG={version:"2.0.0-SNAPSHOT",sceneGraph:null,displayRatio:CGSG_DEFAULT_DISPLAYRATIO,resizeHandleThreshold:CGSG_DEFAULT_SELECTED_RESIZEHANDLE_THRESHOLD,currentFrame:0,canvas:null,context:null,ghostContext:null,ghostColor:"#FF0000",selectedNodes:[],listTimelines:[],framerateDelay:CGSG_DEFAULT_FRAMERATE_DELAY,maxFramerate:CGSG_DEFAULT_MAX_FRAMERATE,fps:0,isBoundingBoxOnTop:true,collisionManager:new CGSGCollisionManager(),cssManager:new CGSGCSSManager(),performanceKeys:{_collisionMethod:CGSGCollisionMethod.REGION,_cgsgCollisionTesterFactory:new CGSGCollisionTesterFactory(),collisionTester:new CGSGCollisionRegionTester(),setCollisionMethod:function(a){this._collisionMethod=a,this.collisionTester=this._cgsgCollisionTesterFactory.getCollisionTester(this._collisionMethod)}},animationManager:new CGSGAnimationManager(),eventManager:new CGSGEventManager(),globalDetectSelectionThreshold:0};var cgsgEventTypes={ON_BEFORE_RENDER:"onBeforeRender",ON_AFTER_RENDER:"onAfterRender",BEFORE_RENDER_END:"onBeforeRenderEnd",AFTER_RENDER_START:"onAfterRenderStart",ON_TRANSLATE:"onTranslate",ON_ROTATE:"onRotate",ON_SCALE:"onScale",ON_RESIZE:"onResize",ON_RESIZE_END:"onResizeEnd",ON_MOUSE_UP:"onMouseUp",ON_MOUSE_OVER:"onMouseOver",ON_MOUSE_OUT:"onMouseOut",ON_MOUSE_ENTER:"onMouseEnter",ON_CLICK:"onClick",ON_CLICK_START:"onClickStart",ON_DBL_CLICK:"onDblClick",ON_DRAG:"onDrag",ON_DRAG_END:"onDragEnd",ON_CHILD_ADD:"onChildAdd",ON_CHILD_REMOVED:"onChildRemove",ON_SELECT:"onSelect",ON_DESELECT:"onDeselect",ON_FREE:"onFreeEvent",ON_LOAD_END:"onLoadEnd",ON_LOAD_ERROR:"onLoadError",ON_LOAD_ABORT:"onLoadAbort",ON_RENDER_START:"onRenderStart",ON_RENDER_END:"onRenderEnd",ON_SCENE_DBL_CLICK_START:"onSceneDblClickStart",ON_SCENE_DBL_CLICK_END:"onSceneDblClickEnd",ON_SCENE_CLICK_START:"onSceneClickStart",ON_SCENE_CLICK_END:"onSceneClickEnd",ON_SCENE_AVERAGE_FPS_CHANGED:"onSceneAverageFpsChanged",ON_ANIMATE:"onAnimate",ON_ANIMATION_START:"onAnimationStart",ON_ANIMATION_END:"onAnimationEnd",ON_UPDATE_PARTICLE_END:"onUpdateParticleEnd",ON_INIT_PARTICLE:"onInitParticle",ON_TAB_CHANGED:"onTabChanged"};function cgsgExist(a){if(typeof a==="number"){return !isNaN(a)&&isFinite(a)}return(a!==null&&a!==undefined)}function cgsgDetectCurrentExplorer(){cgsgCurrentExplorer=cgsgExplorerParams.UNKNOWN;var c=navigator.userAgent;var d=navigator.appName;var e=""+parseFloat(navigator.appVersion);var a,b;if((b=c.indexOf("Opera"))!=-1){cgsgCurrentExplorer=cgsgExplorerParams.OPERA;e=c.substring(b+6);if((b=c.indexOf("Version"))!=-1){e=c.substring(b+8)}}else{if((b=c.indexOf("MSIE"))!=-1){d="Microsoft Internet Explorer";cgsgCurrentExplorer=cgsgExplorerParams.IE9;e=c.substring(b+5);if(parseInt(e)>=10){cgsgCurrentExplorer=cgsgExplorerParams.IE10}}else{if((b=c.indexOf("Chrome"))!=-1){cgsgCurrentExplorer=cgsgExplorerParams.CHROME;e=c.substring(b+7)}else{if((b=c.indexOf("Safari"))!=-1){cgsgCurrentExplorer=cgsgExplorerParams.SAFARI;e=c.substring(b+7);if((b=c.indexOf("Version"))!=-1){e=c.substring(b+8)}}else{if((b=c.indexOf("Firefox"))!=-1){cgsgCurrentExplorer=cgsgExplorerParams.FIREFOX;e=c.substring(b+8)}else{if((a=c.lastIndexOf(" ")+1)<(b=c.lastIndexOf("/"))){d=c.substring(a,b);e=c.substring(b+1);if(d.toLowerCase()==d.toUpperCase()){d=navigator.appName}}}}}}}cgsgCurrentExplorer.fullVersion=e;cgsgCurrentExplorer.browserName=d;cgsgCurrentExplorer.webworker=typeof(Worker)!=="undefined"}var cgsgStylePaddingLeft=0;var cgsgStylePaddingTop=0;var cgsgStyleBorderLeft=0;var cgsgStyleBorderTop=0;function cgsgGetRealViewportDimension(){var c=window,b="inner";if(!("innerWidth" in window)){b="client";c=document.documentElement||document.body}return new CGSGDimension(c[b+"Width"],c[b+"Height"])}function cgsgGetDisplayedViewportDimension(){var a=cgsgGetRealViewportDimension();return new CGSGDimension(Math.round(a.width/CGSG.displayRatio.x),Math.round(a.height/CGSG.displayRatio.y))}function cgsgPointIsInRegion(b,c,a){return b.x>=(c.position.x-a)&&b.y>=(c.position.y-a)&&b.x<=(c.position.x+c.dimension.width+a)&&b.y<=(c.position.y+c.dimension.height+a)}function cgsgRegionIsInRegion(c,b,a){return c.position.x>=(b.position.x-a)&&c.position.y>=(b.position.y-a)&&(c.position.x+c.dimension.width)<=(b.position.x+b.dimension.width+a)&&(c.position.y+c.dimension.height)<=(b.position.y+b.dimension.height+a)}function cgsgGetCursorPositions(a,b){var f=b,j=0,d=0,g=[];if(f.offsetParent){do{j+=f.offsetLeft;d+=f.offsetTop}while((f=f.offsetParent))}j+=cgsgStylePaddingLeft;d+=cgsgStylePaddingTop;j+=cgsgStyleBorderLeft;d+=cgsgStyleBorderTop;var e=a;if(a.targetTouches){var h=(typeof a.targetTouches!=="undefined")?a.targetTouches:[a];for(var c=0;c<h.length;c++){e=h[c];g.push(new CGSGPosition((e.pageX-j)/CGSG.displayRatio.x,(e.pageY-d)/CGSG.displayRatio.y))}}else{g.push(new CGSGPosition((e.pageX-j)/CGSG.displayRatio.x,(e.pageY-d)/CGSG.displayRatio.y))}return g}function cgsgClearContext(a){a.setTransform(1,0,0,1,0,0);a.clearRect(0,0,CGSG.canvas.width,CGSG.canvas.height)}function cgsgIterate(d,c){var b=0,a=d.length;for(;b<a&&c(b,d[b++])!==false;){}}function cgsgIterateReverse(c,b){var a=c.length-1;for(;a>=0&&b(a,c[a--])!==false;){}}function cgsgFree(a){if(cgsgExist(a.onFreeEvent)){CGSG.eventManager.dispatch(a,cgsgEventTypes.ON_FREE,new CGSGEvent(this,null))}a=null};var CGSGMask=CGSGObject.extend({initialize:function(){this._prepareEvent=cgsgEventTypes.ON_BEFORE_RENDER;this._finalizeEvent=cgsgEventTypes.ON_AFTER_RENDER;this._keyEvents=new CGSGMap();this._bindEventAdapter=this._eventAdapter.bind(this)},apply:function(a){this._keyEvents.addOrReplace(a,{prepareKey:CGSG.eventManager.bindHandler(a,this._prepareEvent,this._bindEventAdapter),finalizeKey:CGSG.eventManager.bindHandler(a,this._finalizeEvent,this._bindEventAdapter)});this._internalApply(a)},_internalApply:function(a){},remove:function(b){var a=this._keyEvents.getValue(b);if(cgsgExist(a)){CGSG.eventManager.unbindHandler(b,this._prepareEvent,this._bindEventAdapter);CGSG.eventManager.unbindHandler(b,this._finalizeEvent,this._bindEventAdapter)}this._internalRemove(b)},_internalRemove:function(a){},_eventAdapter:function(b){switch(b.type){case this._prepareEvent:var a=this.prepare(b.observable,b.data.context);b.data.context=a;break;case this._finalizeEvent:var a=this.finalize(b.observable,b.data.context);b.data.context=a;break}},prepare:function(b,a){},finalize:function(b,a){}});var CGSGMaskClip=CGSGMask.extend({initialize:function(a){this._super();this._maskRegion=a;this._saveContext=null;this.canvas=document.createElement("canvas");this.canvas.width=10;this.canvas.height=10;this._renderContext=this.canvas.getContext("2d");this.autoRefresh=true;this.refreshOnNextFrame=false},prepare:function(o,d){this._saveContext=d;this.canDrawImage=true;if(this.autoRefresh||this.refreshOnNextFrame){this._renderContext.clearRect(0,0,this.canvas.width,this.canvas.height);this.refreshOnNextFrame=false;var a=this._maskRegion.position;var p=this._maskRegion.dimension;var l=a.x;var k=a.y;var j=o.position;var b=o.dimension;var c=b.width-l;var i=b.height-k;var m=p.width;var q=p.height;if(m>c){m=c<=0?0:c}if(q>i){q=i<=0?0:i}if(m>0&&q>0){var s=j.x+l;var r=j.y+k;var f,e,g,n;if(s<0){f=0;g=m+s}else{f=o.position.x+l;g=m}if(r<0){e=0;n=q+r}else{e=o.position.y+k;n=q}this.canvas.width=(f+g+1);this.canvas.height=(e+n+1);this.sliceX=f;this.sliceY=e;this.sliceWidth=g;this.sliceHeight=n}else{this.canDrawImage=false}this._renderContext.save();return this._renderContext}return null},finalize:function(b,a){if(this.canDrawImage){this._saveContext.drawImage(this.canvas,this.sliceX,this.sliceY,this.sliceWidth,this.sliceHeight,this.sliceX,this.sliceY,this.sliceWidth,this.sliceHeight);this._renderContext.restore()}return this._saveContext}});var CGSGMath={PI2:6.28318530718,deg2rad:function(a){return(a/180)*Math.PI},rad2deg:function(a){return a*57.29577951308232},fixedPoint:function(a){return(0.5+a)<<0},lerp:function(c,b,a){return c+(b-c)*a}};var CGSGHandleBox=CGSGObject.extend({initialize:function(c,d,g,e,b,a,f){this.fillColor=g;this.strokeColor=e;this.lineWidth=b;this.size=d;this.isVisible=true;this._parentNode=c;this._position=new CGSGPosition(a,f)},render:function(a){if(this.isVisible){a.lineWidth=this.lineWidth;a.strokeStyle=this.strokeColor;a.fillStyle=this.fillColor;if(cgsgExist(this.lineWidth)&&this.lineWidth>0){a.strokeRect(this._position.x,this._position.y,this.size/this._parentNode._absSca.x,this.size/this._parentNode._absSca.y)}a.fillRect(this._position.x,this._position.y,this.size/this._parentNode._absSca.x,this.size/this._parentNode._absSca.y)}},checkIfSelected:function(b,a){return(b.x>=this._parentNode._absPos.x+(this._position.x*this._parentNode._absSca.x)-a&&b.x<=this._parentNode._absPos.x+(this._position.x*this._parentNode._absSca.x)+this.size+a&&b.y>=this._parentNode._absPos.y+(this._position.y*this._parentNode._absSca.y)-a&&b.y<=this._parentNode._absPos.y+(this._position.y*this._parentNode._absSca.y)+this.size+a)},translateTo:function(b,a){this._position.x=b;this._position.y=a}});var CGSGNode=CGSGObject.extend({initialize:function(a,d){this.name="";this.isSelected=false;this.classType="CGSGNODE";this.handles=[];this.globalAlpha=1;this.isVisible=true;this.isProportionalResize=false;this.isProportionalResizeOnly=false;this.pickNodeMethod=CGSGPickNodeMethod.REGION;this.children=[];this.regionConstraint=null;this.nodeConstraint=null;this._followers=[];this.rotationCenter=null;this.userData={};this.isClickable=true;this.isResizable=false;this.isDraggable=false;this.needToKeepAbsoluteMatrix=true;this.selectionLineColor=null;this.selectionLineWidth=null;this.handleSize=null;this.handleColor=null;this.isMouseOver=false;this.isMoving=false;this.isResizing=false;this._id=0;this._parentNode=null;this._isCached=false;this._cacheCanvas=null;this._cacheCtx=null;this.shadowOffsetX=0;this.shadowOffsetY=0;this.shadowBlur=0;this.shadowColor="#333333";this.position=new CGSGPosition(0,0);this._absPos=new CGSGPosition(0,0);this.dimension=new CGSGDimension(0,0);this.scale=new CGSGScale(1,1);this._absSca=new CGSGScale(1,1);this.rotation=new CGSGRotation(0);this._absRot=new CGSGRotation(0);this._isDrag=false;this.isTraversable=true;this.isCollisionManaged=false;this.onMouseOver=null;this.onMouseEnter=null;this.onMouseOut=null;this.onMouseUp=null;this.onClick=null;this.onDblClick=null;this.onDrag=null;this.onDragEnd=null;this.onResize=null;this.onResizeEnd=null;this.onSelect=null;this.onDeselect=null;this.onChildRemove=null;this.onBeforeRender=null;this.onAfterRender=null;this.onAfterRenderStart=null;this.onTranslate=null;this.detectSelectionThreshold=CGSG.globalDetectSelectionThreshold;this.bkgcolors=[];this.lineColor=null;this.lineWidth=0;this.borderRadius=0;this._cls=[];this._clsBBox=null;this.setClass("cgsgnode");this.setClassBBox("cgsgnode-bbox");this.translateTo(a,d,true);this.dimension.width=0;this.dimension.height=0;this._isDimensionChanged=false;for(var c=0;c<8;c++){var b=new CGSGHandleBox(this,this.handleSize,this.handleColor,this.selectionLineColor,this.selectionLineWidth,0,0);this.handles.push(b)}this.computeAbsoluteMatrix(true)},moveLocalZIndex:function(b){var a=this.getLocalZIndex();if(!isNaN(a)){this.setLocalZIndex(this.getLocalZIndex()+b)}},setLocalZIndex:function(a){if(cgsgExist(this._parentNode)){a=Math.max(0,Math.min(CGSGMath.fixedPoint(a),this._parentNode.children.length-1));var c=this.getLocalZIndex();var b=this._parentNode;if(a!=c){b.detachChild(this);b.addChildAt(this,a)}}},setLocalZIndexToLast:function(){this.setLocalZIndex(this._parentNode.children.length-1)},getLocalZIndex:function(){if(!cgsgExist(this._parentNode)){return NaN}return this._parentNode.children.indexOf(this)},getRegion:function(){return new CGSGRegion(this.position.x,this.position.y,this.getWidth(),this.getHeight())},getAbsoluteRegion:function(){return new CGSGRegion(this.getAbsLeft(),this.getAbsTop(),this.getAbsWidth(),this.getAbsHeight())},_clearContext:function(d,a,b){d.clearRect(0,0,a,b)},setPrecomputed:function(a){this._isCached=a;this.invalidate()},invalidate:function(){if(this._isCached){this._preCompute()}},invalidateTheme:function(){var j=CGSG.cssManager.getAttrInArray(this._cls,"background");var e=CGSG.cssManager.getAttrInArray(this._cls,"border-width");var o=CGSG.cssManager.getAttrInArray(this._cls,"border-color");var m=CGSG.cssManager.getFloat(CGSG.cssManager.getAttrInArray(this._cls,"opacity"));var b=CGSG.cssManager.getNumber(CGSG.cssManager.getAttrInArray(this._cls,"border-radius"));if(cgsgExist(b)){this.borderRadius=b}var l;if(cgsgExist(j)){l=CGSGColor.fromString(j);if(cgsgExist(l.r)&&cgsgExist(l.g)&&cgsgExist(l.b)){this.bkgcolors[0]=CGSGColor.rgb2hex(l.r,l.g,l.b)}else{var i=j.substring(j.indexOf("rgb"),j.indexOf(")")+1);var g=j.substring(j.lastIndexOf("rgb"),j.lastIndexOf(")"));var h=CGSGColor.fromString(i);var f=CGSGColor.fromString(g);this.bkgcolors[0]=CGSGColor.rgb2hex(h.r,h.g,h.b);this.bkgcolors[1]=CGSGColor.rgb2hex(f.r,f.g,f.b)}}if(cgsgExist(e)){this.lineWidth=CGSG.cssManager.getNumber(e)}if(cgsgExist(o)){this.lineColor=o}if(cgsgExist(m)){this.globalAlpha=m}if(cgsgExist(this._clsBBox)){var k=CGSG.cssManager.getAttr(this._clsBBox,"background-color");var n=CGSG.cssManager.getNumber(CGSG.cssManager.getAttr(this._clsBBox,"border-width"));var c=CGSG.cssManager.getAttr(this._clsBBox,"outline-color");var d=CGSG.cssManager.getNumber(CGSG.cssManager.getAttr(this._clsBBox,"outline-width"));if(cgsgExist(k)){this.handleColor=k}if(cgsgExist(n)){this.handleSize=n}if(cgsgExist(c)){this.selectionLineColor=c}if(cgsgExist(d)){this.selectionLineWidth=d}}},setClass:function(a){this._cls=[];this._cls.push(a);this.invalidateTheme()},addClass:function(a){this._cls.push(a);this.invalidateTheme()},removeClass:function(a){this._cls=this._cls.without(a);this.invalidateTheme()},setClassBBox:function(a){this._clsBBox=a;this.invalidateTheme()},_applyShadow:function(a){if(this.shadowOffsetX!==0||this.shadowOffsetY!==0){a.shadowOffsetX=this.shadowOffsetX;a.shadowOffsetY=this.shadowOffsetY;a.shadowBlur=this.shadowBlur;a.shadowColor=this.shadowColor}},_preCompute:function(){if(!cgsgExist(this._cacheCanvas)){this._cacheCanvas=document.createElement("canvas");this._cacheCtx=this._cacheCanvas.getContext("2d")}cgsgClearContext(this._cacheCtx);this._applyShadow(this._cacheCtx);this.render(this._cacheCtx)},doRender:function(j,e){if(e){this.invalidateTheme()}var b=j;var g=new CGSGEvent(this,{context:j});if(cgsgExist(this.onBeforeRender)){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_BEFORE_RENDER,g);b=g.data.context}this.beforeRender(b);if(this.globalAlpha>0){b.globalAlpha=this.globalAlpha;if(this._isCached){b.drawImage(this._cacheCanvas,0,0)}else{if(!cgsgExist(this.bkgcolors[1])){b.fillStyle=this.bkgcolors[0]}else{var h=b.createLinearGradient(0,0,0,this.dimension.height);for(var d=0,a=this.bkgcolors.length;d<a;d++){h.addColorStop(d,this.bkgcolors[d])}b.fillStyle=h}if(this.lineWidth>0){b.strokeStyle=this.lineColor;b.lineWidth=this.lineWidth}this._applyShadow(b);this.render(b)}}if(!CGSG.isBoundingBoxOnTop&&this.isSelected){this.renderBoundingBox(b)}var f=new CGSGEvent(this,{context:b});this.afterRender(f.data.context,e);if(cgsgExist(this.onAfterRender)){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_AFTER_RENDER,f);b=f.data.context}},render:function(a){},doRenderGhost:function(a){this.beforeRenderGhost(a);if(this.globalAlpha>0){if(this._isCached){a.drawImage(this._cacheCanvas,0,0)}else{a.fillStyle=this.bkgcolors[0];if(this.lineWidth>0){a.strokeStyle=this.lineColor;a.lineWidth=this.lineWidth}this.renderGhost(a)}}this.afterRenderGhost(a)},renderGhost:function(a){this.render(a)},renderBoundingBox:function(g){var a=this.getWidth(),d=this.getHeight();if(cgsgExist(this.selectionLineWidth)&&this.selectionLineWidth>0){g.strokeStyle=this.selectionLineColor;g.lineWidth=this.selectionLineWidth/this._absSca.y;g.beginPath();g.moveTo(0,0);g.lineTo(a,0);g.moveTo(0,d);g.lineTo(a,d);g.stroke();g.closePath();g.lineWidth=this.selectionLineWidth/this._absSca.x;g.beginPath();g.moveTo(0,0);g.lineTo(0,d);g.moveTo(a,0);g.lineTo(a,d);g.stroke();g.closePath()}if(this.isResizable){var f=this.handleSize/(2*this._absSca.x);var e=this.handleSize/(2*this._absSca.y);this.handles[0].translateTo(-f,-e);this.handles[1].translateTo(a/2-f,-e);this.handles[2].translateTo(a-f,-e);this.handles[3].translateTo(-f,d/2-e);this.handles[4].translateTo(a-f,d/2-e);this.handles[6].translateTo(a/2-f,d-e);this.handles[5].translateTo(-f,d-e);this.handles[7].translateTo(a-f,d-e);if(this.isProportionalResizeOnly){this.handles[1].isVisible=false;this.handles[3].isVisible=false;this.handles[4].isVisible=false;this.handles[6].isVisible=false}var b;for(b=0;b<8;b++){this.handles[b].size=this.handleSize;this.handles[b].fillColor=this.handleColor;this.handles[b].strokeColor=this.selectionLineColor;this.handles[b].lineWidth=this.selectionLineWidth;this.handles[b].render(g)}}},beforeRender:function(a){a.save();a.translate(this.position.x,this.position.y);a.scale(this.scale.x,this.scale.y);if(cgsgExist(this.rotationCenter)){a.translate(this.dimension.width*this.rotationCenter.x,this.dimension.height*this.rotationCenter.y);a.rotate(this.rotation.angle);a.translate(-this.dimension.width*this.rotationCenter.x,-this.dimension.height*this.rotationCenter.y)}else{a.rotate(this.rotation.angle)}if(this.onBeforeRenderEnd){CGSG.eventManager.dispatch(this,cgsgEventTypes.BEFORE_RENDER_END,new CGSGEvent(this,{c:a}))}},afterRender:function(f,e){if(cgsgExist(this.onAfterRenderStart)){CGSG.eventManager.dispatch(this,cgsgEventTypes.AFTER_RENDER_START,new CGSGEvent(this,{context:f}))}if(!this.isALeaf()){for(var d=0,a=this.children.length;d<a;++d){var b=this.children[d];if(b.isVisible){b.doRender(f,e)}}}f.restore()},beforeRenderGhost:function(a){a.save();a.translate(this._absPos.x,this._absPos.y);a.rotate(this._absRot.angle);a.scale(this._absSca.x,this._absSca.y)},afterRenderGhost:function(a){a.restore()},setSelected:function(a){this.isSelected=a;this._isDrag=true;if(a&&this.onSelect!==null){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_SELECT,new CGSGEvent(this,{node:this}))}else{if(this.onDeselect!==null){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_DESELECT,new CGSGEvent(this,{node:this}))}}},getCompleteRegion:function(){return new CGSGRegion(this.getMinAbsoluteLeft(),this.getMinAbsoluteTop(),this.getMaxAbsoluteRight(),this.getMaxAbsoluteBottom())},getCompletePosition:function(){return new CGSGPosition(this.getMinAbsoluteLeft(),this.getMinAbsoluteTop())},getCompleteDimension:function(){return new CGSGDimension(this.getMaxAbsoluteRight(),this.getMaxAbsoluteBottom())},detectSelection:function(e,d,a){if(this.pickNodeMethod==CGSGPickNodeMethod.REGION){if(e.x>=this._absPos.x-this.detectSelectionThreshold&&e.x<this._absPos.x+this.detectSelectionThreshold+this.getWidth()*a.x&&e.y>=this._absPos.y-this.detectSelectionThreshold&&e.y<this._absPos.y+this.detectSelectionThreshold+this.getHeight()*a.y){return this}}else{this.doRenderGhost(d);var b=d.getImageData(e.x,e.y,1,1);cgsgClearContext(d);if(b.data[0]!=0||b.data[1]!=0||b.data[2]!=0){return this}}return null},detectSelectionInRegion:function(a,d){var b=this.getAbsoluteRegion();if(cgsgRegionIsInRegion(b,a,0)){return this}return null},pickNode:function(m,k,l,n,d){var g=null;var b=null;if(cgsgExist(k)){b=k.multiply(this.scale)}else{b=this.getAbsoluteScale(false)}if(this.isTraversable&&(this.isClickable||this.isResizable||this.isDraggable)){if(!cgsgExist(d)||d(this)===true){this.computeAbsoluteMatrix(false);if(this.isSelected&&this.isResizable){for(var f=0;f<8;f++){var j=this.handles[f];if(j.checkIfSelected(m,CGSG.resizeHandleThreshold)){return this}}}g=this.detectSelection(m,l,b)}}if(this.isTraversable&&n&&!this.isALeaf()){for(var e=this.children.length-1;e>=0;--e){var a=this.children[e];var o=a.pickNode(m,b,l,n,d);if(cgsgExist(o)){g=o;break}}b=null}return g},pickNodes:function(h,l,c,j,d){var k=[];if(h.isEmpty()){return k}var b=null;if(cgsgExist(l)){b=l.multiply(this.scale)}else{b=this.getAbsoluteScale(false)}if(this.isTraversable&&(this.isResizable||this.isDraggable)){if(!cgsgExist(d)||d(this)===true){this.computeAbsoluteMatrix(false);var e=this.detectSelectionInRegion(h,c);if(cgsgExist(e)){k.push(e)}}}if(this.isTraversable&&j&&!this.isALeaf()){for(var f=this.children.length-1;f>=0;--f){var a=this.children[f];var g=a.pickNodes(h,b,c,j,d);if(g!==null&&g!==undefined){k=k.concat(g)}}b=null}return k},isALeaf:function(){return this.children.length<=0},_applyContraintsToFollowers:function(){cgsgIterate(this._followers,(function(c,e){var b=e.getAbsLeft()-this.getAbsLeft();if(b<0){e.translateWith(-b,0,true)}var d=e.getAbsTop()-this.getAbsTop();if(d<0){e.translateWith(0,-d,true)}var f=this.getAbsRight()-e.getAbsRight();if(f<0){b=e.getAbsWidth()-this.getAbsWidth();if(b>0){e.resizeWith(-b,0)}else{e.translateWith(f,0,true)}}var a=this.getAbsBottom()-e.getAbsBottom();if(a<0){f=e.getAbsHeight()-this.getAbsHeight();if(f>0){e.resizeTo(this.getAbsWidth(),e.getHeight())}else{e.translateWith(0,a,true)}}}).bind(this))},translateTo:function(a,c,b){this.position.translateTo(a,c);if(this.needToKeepAbsoluteMatrix&&b!==false){this._absPos=this.getAbsolutePosition(true)}this._applyContraintsToFollowers();if(cgsgExist(this.onTranslate)){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_TRANSLATE,new CGSGEvent(this,null))}},translateWith:function(a,c,b){this.position.translateWith(a,c);if(this.needToKeepAbsoluteMatrix&&b!==false){this._absPos=this.getAbsolutePosition(true)}this._applyContraintsToFollowers();if(cgsgExist(this.onTranslate)){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_TRANSLATE,new CGSGEvent(this,null))}},translateBy:function(a,c,b){this.position.translateBy(a,c);if(this.needToKeepAbsoluteMatrix&&b!==false){this._absPos=this.getAbsolutePosition(true)}this._applyContraintsToFollowers();if(cgsgExist(this.onTranslate)){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_TRANSLATE,new CGSGEvent(this,null))}},resizeTo:function(a,b){this.dimension.resizeTo(a,b);this._applyContraintsToFollowers();this._endResize()},resizeBy:function(a,b){this.dimension.resizeBy(a,b);this._applyContraintsToFollowers();this._endResize()},resizeWith:function(a,b){this.dimension.resizeWith(a,b);this._applyContraintsToFollowers();this._endResize()},_endResize:function(){this._isDimensionChanged=true;this.invalidate();if(cgsgExist(this.onResize)){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_RESIZE,new CGSGEvent(this,{node:this}))}},scaleTo:function(c,b,a){this.scale.x=c;this.scale.y=b;if(this.needToKeepAbsoluteMatrix&&a!==false){this._absSca=this.getAbsoluteScale(true)}this._applyContraintsToFollowers();if(cgsgExist(this.onScale)){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_SCALE,new CGSGEvent(this,{node:this}))}},scaleBy:function(c,b,a){this.scale.x*=c;this.scale.y*=b;if(this.needToKeepAbsoluteMatrix&&a!==false){this._absSca=this.getAbsoluteScale(true)}this._applyContraintsToFollowers();if(cgsgExist(this.onScale)){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_SCALE,new CGSGEvent(this,{node:this}))}},scaleWith:function(a,c,b){this.scale.x+=a;this.scale.y+=c;if(this.needToKeepAbsoluteMatrix&&b!==false){this._absSca=this.getAbsoluteScale(true)}this._applyContraintsToFollowers();if(cgsgExist(this.onScale)){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_SCALE,new CGSGEvent(this,{node:this}))}},rotateTo:function(b,c){this.rotation.rotateTo(b);if(this.needToKeepAbsoluteMatrix&&c!==false){this._absRot=this.getAbsoluteRotation(true)}this._applyContraintsToFollowers();if(cgsgExist(this.onRotate)){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_ROTATE,new CGSGEvent(this,{node:this}))}},rotateBy:function(a,b){this.rotation.rotateBy(a);if(this.needToKeepAbsoluteMatrix&&b!==false){this._absRot=this.getAbsoluteRotation(true)}this._applyContraintsToFollowers();if(cgsgExist(this.onRotate)){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_ROTATE,new CGSGEvent(this,{node:this}))}},rotateWith:function(b,c){this.rotation.rotateWith(b);if(this.needToKeepAbsoluteMatrix&&c!==false){this._absRot=this.getAbsoluteRotation(true)}this._applyContraintsToFollowers();if(cgsgExist(this.onRotate)){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_ROTATE,new CGSGEvent(this,{node:this}))}},addChild:function(a){a._parentNode=this;this.children[this.children.length]=a},addChildAt:function(c,b){if(b>this.children.length){b=this.children.length}for(var a=this.children.length;a>=b;--a){this.children[a]=this.children[a-1]}c._parentNode=this;this.children[b]=c;if(cgsgExist(this.onChildAdd)){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_CHILD_ADD,new CGSGEvent(this,{node:this}))}},removeChild:function(f,b){var c=this.children.indexOf(f);if(c>=0){this.children.without(f);if(cgsgExist(this.onChildRemove)){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_CHILD_REMOVED,new CGSGEvent(this,{node:this}))}f.free();return true}if(b){for(var e=0,a=this.children.length;e<a;++e){var d=this.children[e];if(d.removeChild(f,true)){return true}}}return false},removeAll:function(){this.free()},detachChildAt:function(a){if(a>=0&&a<this.children.length){this.detachChild(this.children[a])}},detachChild:function(a){if(cgsgExist(a)){a._parentNode=null;this.children.without(a)}},evalSet:function(a,v){var rgb;if(a=="position.x"){this.translateTo(v,this.position.y,this.needToKeepAbsoluteMatrix)}else{if(a=="position.y"){this.translateTo(this.position.x,v,this.needToKeepAbsoluteMatrix)}else{if(a=="dimension.width"){this.resizeTo(v,this.dimension.height)}else{if(a=="dimension.height"){this.resizeTo(this.dimension.width,v)}else{if(a=="scale.x"){this.scaleTo(v,this.scale.y,this.needToKeepAbsoluteMatrix)}else{if(a=="scale.y"){this.scaleTo(this.scale.x,v,this.needToKeepAbsoluteMatrix)}else{if(a=="rotation"||a=="rotation.angle"){this.rotateTo(v,this.needToKeepAbsoluteMatrix)}else{if(a=="globalAlpha"||a=="opacity"){this.globalAlpha=v;this.invalidate()}else{if(a=="isVisible"){this.isVisible=v}else{if(a=="rotationCenter.x"){this.rotationCenter.x=v}else{if(a=="rotationCenter.y"){this.rotationCenter.y=v}else{if(a=="bkgcolors[0].r"){rgb=CGSGColor.hex2rgb(this.bkgcolors[0]);this.bkgcolors[0]=CGSGColor.rgb2hex(v,rgb.g,rgb.b);this.invalidate()}else{if(a=="bkgcolors[0].g"){rgb=CGSGColor.hex2rgb(this.bkgcolors[0]);this.bkgcolors[0]=CGSGColor.rgb2hex(rgb.r,v,rgb.b);this.invalidate()}else{if(a=="bkgcolors[0].b"){rgb=CGSGColor.hex2rgb(this.bkgcolors[0]);this.bkgcolors[0]=CGSGColor.rgb2hex(rgb.r,rgb.g,v);this.invalidate()}else{if(a=="fillStyle.r"){this.fillStyle.r=v;this.invalidate()}else{if(a=="fillStyle.g"){this.fillStyle.g=v;this.invalidate()}else{if(a=="fillStyle.b"){this.fillStyle.b=v;this.invalidate()}else{eval("this."+a+"="+v);this.invalidate()}}}}}}}}}}}}}}}}}},setRegionConstraint:function(a){this.setNodeRegionConstraint(null);this.regionConstraint=a},setNodeRegionConstraint:function(a){this.regionConstraint=null;if(cgsgExist(a)){if(!a._followers.contains(this)){a._followers.push(this)}}else{if(cgsgExist(this.nodeConstraint)){this.nodeConstraint._followers.without(this)}}this.nodeConstraint=a},getAbsolutePosition:function(a){var e=this;var d=this.position.copy();while(e._parentNode!==null){d.multiplyEquals(e._parentNode.scale);e=e._parentNode}if(this._parentNode!==null){d.addEquals(this._parentNode.getAbsolutePosition(false))}if(a!==false){for(var b=0;b<this.children.length;b++){if(cgsgExist(this.children[b])){this.children[b]._absPos=this.children[b].getAbsolutePosition(a)}}}return d},getAbsoluteScale:function(a){var e=this;var b=this.scale.copy();while(e._parentNode!==null){b.multiplyEquals(e._parentNode.scale);e=e._parentNode}if(a!==false){for(var d=0;d<this.children.length;d++){if(cgsgExist(this.children[d])){this.children[d]._absSca=this.children[d].getAbsoluteScale(a)}}}return b},getAbsoluteRotation:function(a){var e=this;var b=this.rotation.copy();while(e._parentNode!==null){b.addEquals(e._parentNode.rotation.angle);e=e._parentNode}if(a!==false){for(var d=0;d<this.children.length;d++){if(cgsgExist(this.children[d])){this.children[d]._absRot=this.children[d].getAbsoluteRotation(a)}}}return b},computeAbsoluteMatrix:function(a){this._absPos=this.getAbsolutePosition(false);this._absSca=this.getAbsoluteScale(false);this._absRot=this.getAbsoluteRotation(false);if(a!==false){cgsgIterate(this.children,(function(b,c){if(cgsgExist(c)){c.computeAbsoluteMatrix(a)}}).bind(this))}},getMinAbsoluteLeft:function(){var a=this._absPos.x;if(this.children.length>0){cgsgIterate(this.children.length,(function(b,c){if(a<c._absPos.x){a=c._absPos.x}}).bind(this))}return a},getMaxAbsoluteRight:function(){var a=this._absPos.x+(this.getWidth()*this._absSca.x);if(this.children.length>0){cgsgIterate(this.children.length,(function(b,d){var c=this._absPos.x+(this.getWidth()*this._absSca.x);if(a<c){a=c}}).bind(this))}return a},getMinAbsoluteTop:function(){var a=this._absPos.y;if(this.children.length>0){cgsgIterate(this.children.length,(function(b,c){if(a<c._absPos.y){a=c._absPos.y}}).bind(this))}return a},getMaxAbsoluteBottom:function(){var a=this._absPos.y+(this.getHeight()*this._absSca.y);if(this.children.length>0){cgsgIterate(this.children.length,(function(b,d){var c=this._absPos.y+(this.getHeight()*this._absSca.y);if(a<c){a=c}}).bind(this))}return a},getAbsLeft:function(){return this._absPos.x},getAbsRight:function(){return this._absPos.x+this.getAbsWidth()},getAbsTop:function(){return this._absPos.y},getAbsBottom:function(){return this._absPos.y+this.getAbsHeight()},getAbsWidth:function(){return this.getWidth()*this._absSca.x},getAbsHeight:function(){return this.getHeight()*this._absSca.y},getWidth:function(){return this.dimension.width},getHeight:function(){return this.dimension.height},getCenter:function(){var a=this.position.x+(this.getWidth()/2);var b=this.position.y+(this.getHeight()/2);return new CGSGPosition(a,b)},isColliding:function(b,a){return CGSG.collisionManager.isColliding(this,b,a)},getListOfCollidingBrothers:function(a){var c=[];var b=null;cgsgIterate(this._parentNode.children,(function(e,d){if(d!==this&&this.isColliding(d,a)){c.push(d)}}).bind(this));return c},isCollidingABrother:function(a){var b=false;cgsgIterate(this._parentNode.children,(function(d,c){if(c!==this&&this.isColliding(c,a)){b=true;return b}return false}).bind(this));return b},copy:function(a){if(a===null||a===undefined){a=new CGSGNode(this.position.x,this.position.y);a.resizeTo(this.dimension.width,this.dimension.height)}a.classType=this.classType;a.name=this.name;a.globalAlpha=this.globalAlpha;a.bkgcolors=this.bkgcolors;a.lineColor=this.lineColor;a.lineWidth=this.lineWidth;a.isVisible=this.isVisible;a.isProportionalResize=this.isProportionalResize;a.pickNodeMethod=this.pickNodeMethod;a.needToKeepAbsoluteMatrix=this.needToKeepAbsoluteMatrix;if(this.regionConstraint!==null){a.regionConstraint=this.regionConstraint.copy()}a.nodeConstraint=this.nodeConstraint;a.userData=this.userData;a.isClickable=this.isClickable;a.isResizable=this.isResizable;a.isDraggable=this.isDraggable;a.isTraversable=this.isTraversable;a.selectionLineColor=this.selectionLineColor;a.selectionLineWidth=this.selectionLineWidth;a.handleSize=this.handleSize;a.handleColor=this.handleColor;a._id=this._id;a.translateTo(this.position.x,this.position.y);a.resizeTo(this.dimension.width,this.dimension.height);a.scaleTo(this.scale.x,this.scale.y);a.rotateTo(this.rotation.angle);a.selectableZone=new CGSGRegion(a.position.x,a.position.y,a.dimension.width,a.dimension.height);a.onMouseOver=this.onMouseOver;a.onMouseOut=this.onMouseOut;a.onClick=this.onClick;a.onDblClick=this.onDblClick;a.onDrag=this.onDrag;a.onDragEnd=this.onDragEnd;a.onResize=this.onResize;a.onResizeEnd=this.onResizeEnd;a.onSelect=this.onSelect;a.onDeselect=this.onDeselect;a.computeAbsoluteMatrix(true);return a},free:function(){for(var a=this.children.length-1;a>=0;a--){this.children[a].free()}this.children.clear();cgsgFree(this)}});"use strict";var CGSGNodeDomElement=CGSGNode.extend({initialize:function(b,e,d,a,c){this._super(b,e);this.resizeTo(CGSGMath.fixedPoint(d),CGSGMath.fixedPoint(a));this.threshold=20;this.classType="CGSGNodeDomElement";this._htmlElement=c;this._htmlElement.style.position="absolute";this.updateCssRegion()},updateCssRegion:function(){if(cgsgExist(this._htmlElement)){this._htmlElement.style.left=(this.getAbsLeft()+this.threshold)+"px";this._htmlElement.style.top=(this.getAbsTop()+this.threshold)+"px";this._htmlElement.style.width=(this.getAbsWidth()-this.threshold*2)+"px";this._htmlElement.style.height=(this.getAbsHeight()-this.threshold*2)+"px"}},render:function(a){a.fillRect(0,0,this.getWidth(),this.getHeight());if(this.lineWidth>0){a.strokeRect(0,0,this.getWidth(),this.getHeight())}this.updateCssRegion()},copy:function(){var a=new CGSGNodeDomElement(this.position.x,this.position.y,this.dimension.width,this.dimension.height,this._htmlElement);a=this._super(a);a.threshold=this.threshold;return a}});var CGSGNodeLine=CGSGNode.extend({initialize:function(a){this._pts=a.copy();this._nbPts=this._pts.length;this._minX=0;this._minY=0;this._maxX=0;this._maxY=0;this.updateMinMax();this._super(this._minX,this._minY,this._maxX-this._minX,this._maxY-this._minY);this.resizeTo(this._maxX-this._minX,this._maxY-this._minY);this.pickNodeMethod=CGSGPickNodeMethod.REGION;this.classType="CGSGNodeLine"},render:function(b){b.beginPath();b.moveTo(this._pts[0].x-this._minX,this._pts[0].y-this._minY);for(var a=1;a<this._nbPts;a++){b.lineTo(this._pts[a].x-this._minX,this._pts[a].y-this._minY)}if(this.lineWidth>0){b.lineWidth=this.lineWidth;b.strokeStyle=this.lineColor;b.stroke()}},resizeTo:function(a,b){this.dimension.resizeTo(a,b);this._computeResizedPoints()},resizeBy:function(a,b){this.dimension.resizeBy(a,b);this._computeResizedPoints()},resizeWith:function(a,b){this.dimension.resizeWith(a,b);this._computeResizedPoints()},_computeResizedPoints:function(){var e=this.getWidth()/(this._maxX-this._minX);var b=this.getHeight()/(this._maxY-this._minY);var d=this.getCenter();if(this.getWidth()>0&&this.getHeight()>0){for(var a=0;a<this._nbPts;a++){this._pts[a].x=(e*(this._pts[a].x-d.x))+d.x;this._pts[a].y=(b*(this._pts[a].y-d.y))+d.y}this.updateMinMax()}},getCenter:function(){return new CGSGPosition((this._maxX-this._minX)/2,(this._maxY-this._minY)/2)},getMaxX:function(){var a=this._pts[0].copy().x,c;for(var b=1;b<this._nbPts;b++){c=this._pts[b].copy().x;if(a<=c){a=c}}return a},getMinX:function(){var a=this._pts[0].copy().x,c=0;for(var b=1;b<this._nbPts;b++){c=this._pts[b].copy().x;if(a>=c){a=c}}return a},getMaxY:function(){var c=this._pts[0].copy().y,b=0;for(var a=1;a<this._nbPts;a++){b=this._pts[a].copy().y;if(c<=b){c=b}}return c},getMinY:function(){var c=this._pts[0].copy().y,b=0;for(var a=1;a<this._nbPts;a++){b=this._pts[a].copy().y;if(c>=b){c=b}}return c},updateMinMax:function(){this._maxY=this.getMaxY();this._minY=this.getMinY();this._maxX=this.getMaxX();this._minX=this.getMinX()},setPoints:function(a){this._pts=a.copy();this._nbPts=this._pts.length;this.updateMinMax();this.dimension.resizeTo(this._maxX-this._minX,this._maxY-this._minY);this.translateTo(this._minX,this._minY)},getPoints:function(){return this._pts.copy()},getPoint:function(a){if(a<this._nbPts&&a>=0){return this._pts.slice(a,a+1).copy()}return this._pts.slice(0,1).copy()},copy:function(){var a=new CGSGNodeLine(this._pts);return this._super(a)}});var CGSGNodeCurveTCB=CGSGNode.extend({initialize:function(a,b){this._super(a,b);this.resizeTo(300,300);this._interpolator=new CGSGInterpolatorTCB();this._keys=[];this._nbKeys=0;this._values=[];this._nbValues=0;this._steps=[];this.classType="CGSGNodeCurveTCB"},addKey:function(d,i,f,h,a){var e=new CGSGKeyFrame(this._nbKeys,{x:d,y:i});e.userData={t:f,c:h,b:a};this._keys.push(e);this._nbKeys++;if(this._nbKeys>1){this._steps.push(20)}var g=new CGSGNodeSquare(d-2,i-2,4,4);g.isDraggable=true;g.userData=e;g.onDrag=this._moveKey.bind(this);this.addChild(g);return e},_moveKey:function(a){a.data.node.userData.value.x=a.data.positions[0].x;a.data.node.userData.value.y=a.data.positions[0].y;this.compute()},compute:function(){var a=this._interpolator.compute(this._keys,this._steps);this._values=a.copy();this._nbValues=this._values.length},render:function(b){if(this._nbValues>0){b.beginPath();b.moveTo(this._values[0].x,this._values[0].y);for(var a=1;a<this._nbValues;a++){b.lineTo(this._values[a].x,this._values[a].y)}if(this.lineWidth>0){b.stroke()}}},copy:function(){var c=new CGSGNodeCurveTCB(this.position.x,this.position.y);c=this._super(c);var a;for(var b=0;b<this._nbKeys;b++){a=this._keys[b];c.addKey(a.value.x,a.value.y,a.userData.t,a.userData.c,a.userData.b)}c.compute();return c}});var CGSGNodeColorPicker=CGSGNode.extend({initialize:function(a,e,b,c){this._super(a,e);this.resizeTo(b,c);this._imgData=null;var d=this;this.onMouseOver=function(f){d._onMouseOverHandler(f)};this.onMouseUp=function(f){d._onClickHandler(f)};this.onClick=function(f){d._onClickHandler(f)};this.onOverColor=null;this.onClickColor=null;this.classType="CGSGNodeColorPicker";this.setPrecomputed(true)},_onMouseOverHandler:function(b){if(cgsgExist(this.onOverColor)){var a=this.getColorAt(b.data.positions[0]);this.onOverColor(a)}},_onClickHandler:function(b){if(cgsgExist(this.onClickColor)){var a=this.getColorAt(b.data.positions[0]);this.onClickColor(a)}},getColorAt:function(b){var c=this._absPos;var e=this.getAbsWidth();var d=this._imgData.data;var a=CGSGMath.fixedPoint((b.x-c.x));var f=CGSGMath.fixedPoint((b.y-c.y));return{r:d[((e*f)+a)*4],g:d[((e*f)+a)*4+1],b:d[((e*f)+a)*4+2]}},render:function(b){this._imgData=b.createImageData(this.getWidth(),this.getHeight());var j,i,d=1,n,c=0;var g=[255,0,0],o=0,l,k,m;var f=CGSGMath.fixedPoint(Math.min(this.getWidth()*0.1,20));var a=this.getWidth()-f;var h=[{index:1,sens:1},{index:0,sens:-1},{index:2,sens:1},{index:1,sens:-1},{index:0,sens:1},{index:2,sens:-1}];n=256/(a/6);var e=this.getHeight()/2;for(j=0;j<f;j++){for(i=0;i<this.getHeight();i++){c=(i*this.getWidth()+j)*4;d=1-(i/this.getHeight());this._imgData.data[c+0]=255*d;this._imgData.data[c+1]=255*d;this._imgData.data[c+2]=255*d;this._imgData.data[c+3]=255}}for(j=f;j<this.getWidth();j++){if(o<6){d=1;for(i=0;i<this.getHeight();i++){c=(i*this.getWidth()+j)*4;if(i<e){d=2-(i/e);m=CGSGColor.litRGB(g[0],g[1],g[2],d)}else{d=1-((i-e)/e);m=CGSGColor.darkenRGB(g[0],g[1],g[2],d)}this._imgData.data[c+0]=m.r;this._imgData.data[c+1]=m.g;this._imgData.data[c+2]=m.b;this._imgData.data[c+3]=255}l=n*h[o].sens;k=g[h[o].index]+l;g[h[o].index]=k;if(k<=0||k>=255){g[h[o].index]=Math.min(Math.max(k,0),255);o++}}}j=0;i=0;if(!this._isCached){j=this._absPos.x;i=this._absPos.y}b.putImageData(this._imgData,j,i)}});var CGSGTABHEIGHT=35;var CGSGNodeTabMenu=CGSGNode.extend({initialize:function(a,e,b){this._super(a,e);this.resizeTo(b,CGSGTABHEIGHT);this.classType="CGSGNodeTabMenu";this._buttonRadius=4;this._tabsContainer=new CGSGNode(0,0);this._tabsContainer.resizeTo(b,0);this._tabsContainer.color="#A0A0A0";this._tabsContainer.lineWidth=0;this.addChild(this._tabsContainer);var d=new CGSGNodeSquare(0,CGSGTABHEIGHT-this._buttonRadius+1,b,this._buttonRadius);d.bkgcolors[0]="white";d.lineWidth=0;this.addChild(d);var c=new CGSGNodeSquare(0,CGSGTABHEIGHT-this._buttonRadius,b,1);c.bkgcolors[0]="#A0A0A0";c.lineWidth=0;this.addChild(c);this.hideUnderline=new CGSGNodeSquare(0,CGSGTABHEIGHT-this._buttonRadius,b,1);this.hideUnderline.bkgcolors[0]="white";this.hideUnderline.lineWidth=0;this.addChild(this.hideUnderline);this._tabsBaseline=new CGSGNode(0,CGSGTABHEIGHT-this._buttonRadius+1);this._tabsBaseline.resizeTo(b,0);this.addChild(this._tabsBaseline);this.tabs=[];this.onTabChanged=null;this._selectedTab=null},addTab:function(e,a){var b=new CGSGNodeButton(0,0,e);b.setTextClasses(["custom-normal","custom-over","custom-deactivated","custom-selected"]);b.setClasses(["custom-normal","custom-over","custom-deactivated","custom-selected"]);var c={button:b,view:a};this.tabs.push(c);var d=this;b.onClick=function(f){d.selectTab(c)};this._tabsContainer.addChild(b);this._recomputeButtonsWidth();if(!cgsgExist(this._selectedTab)){this.selectTab(c)}return c},selectTab:function(b){if(cgsgExist(this._selectedTab)){if(cgsgExist(this._selectedTab.view)){this._selectedTab.view.isVisible=true;this._selectedTab.view.isTraversable=true}this._tabsBaseline.detachChild(this._selectedTab.view)}this._tabsBaseline.addChild(b.view);this._selectedTab=b;for(var a=0;a<this.tabs.length;a++){this.tabs[a].view.isVisible=false;this.tabs[a].view.isTraversable=false;this.tabs[a].button.setMode(CGSGButtonMode.NORMAL)}if(cgsgExist(b.view)){b.view.isVisible=true;b.view.isTraversable=true}b.button.setMode(CGSGButtonMode.SELECTED);this.hideUnderline.translateTo(b.button.position.x,this.hideUnderline.position.y);this.hideUnderline.resizeTo(b.button.getWidth(),1);if(cgsgExist(this.onTabChanged)){this.onTabChanged({tab:b})}return b},selectTabByIndex:function(a){return this.selectTab(this.tabs[a])},_recomputeButtonsWidth:function(){var a=0;var d;var e=0;for(d=0;d<this.tabs.length;d++){var c=this.tabs[d].button.getWidth();a+=c;e=Math.max(e,c)}if(a>this.getWidth()||this.tabs.length*e>this.getWidth()){var b=this.getWidth()/this.tabs.length;for(d=0;d<this.tabs.length;d++){this.tabs[d].button.setFixedSize(new CGSGDimension(b,CGSGTABHEIGHT));this.tabs[d].button.translateTo(d*b,0)}}else{for(d=0;d<this.tabs.length;d++){this.tabs[d].button.setFixedSize(new CGSGDimension(e,CGSGTABHEIGHT));this.tabs[d].button.translateTo(d*e,0)}}}});var CGSGWrapMode={WORD:{space:" "},LETTER:{space:""},SENTENCE:{space:"."}};var CGSGNodeText=CGSGNode.extend({initialize:function(a,d,c,b){this._super(a,d);this._text="";this._size;this._align;this._textBaseline="top";this._strokeColor;this.crossed=false;this._style="";this._typo;this._sizeT;this._variant;this._weight;this._transform;this._maxWidth=-1;this._lineHeight=this._size;this._wrapMode=CGSGWrapMode.LETTER;this._sections=[];this._tabulation="    ";this.pickNodeMethod=CGSGPickNodeMethod.GHOST;this.metrics={width:1};this._nbLines=1;this.classType="CGSGNodeText";this.setClass("cgsg-p");this.setText(c,b!==false);this.resizeTo(this.getWidth(),this.getHeight())},invalidateTheme:function(){this._super();var i=CGSG.cssManager.getAttrInArray(this._cls,"color");var a=CGSG.cssManager.getAttrInArray(this._cls,"font-style");var c=CGSG.cssManager.getAttrInArray(this._cls,"font-variant");var e=CGSG.cssManager.getAttrInArray(this._cls,"font-weight");var l=CGSG.cssManager.getAttrInArray(this._cls,"font-size");var d=CGSG.cssManager.getAttrInArray(this._cls,"font-family");var j=CGSG.cssManager.getAttrInArray(this._cls,"line-height");var f=CGSG.cssManager.getAttrInArray(this._cls,"text-align");var b=CGSG.cssManager.getAttrInArray(this._cls,"text-transform");var h=CGSG.cssManager.getAttrInArray(this._cls,"-webkit-text-stroke-width");if(!cgsgExist(h)){h=CGSG.cssManager.getAttrInArray(this._cls,"text-stroke-width")}var k=CGSG.cssManager.getAttrInArray(this._cls,"-webkit-text-stroke-color");if(!cgsgExist(k)){k=CGSG.cssManager.getAttrInArray(this._cls,"text-stroke-color")}if(cgsgExist(i)){var g=CGSGColor.fromString(i);this.color=CGSGColor.rgb2hex(g.r,g.g,g.b)}if(cgsgExist(a)){this._style=a}if(cgsgExist(c)){this._variant=c}if(cgsgExist(e)){this._weight=e}if(cgsgExist(l)){this._sizeT=l;this._size=CGSG.cssManager.getNumber(l);this._lineHeight=this._size}if(cgsgExist(d)){this._typo=d}if(cgsgExist(j)){this._lineHeight=j}if(cgsgExist(f)){this._align=f}if(cgsgExist(b)){this._transform=b}if(cgsgExist(h)){this.lineWidth=h}if(cgsgExist(k)){this.lineColor=k}this._invalidateFont()},_invalidateFont:function(){var c=(cgsgExist(this._style)&&this._style.length>0)?(this._style+" "):"";var e=(cgsgExist(this._variant)&&this._variant.length>0)?(this._variant+" "):"";var d=(cgsgExist(this._weight)&&this._weight.length>0)?(this._weight+" "):"";var b=(cgsgExist(this._sizeT))?(this._sizeT+" "):"";var a=(cgsgExist(this._typo)&&this._typo.length>0)?(this._typo+" "):"";this._fullfont=c+e+d+b+a},setWrapMode:function(b,a){this._wrapMode=b;this.invalidate();if(a!==false){this.computeRealDimension()}},setTabulationString:function(b,a){this._tabulation=b;this._text=this._text.replace(/(\t)/g,this._tabulation);this.invalidate();if(a!==false){this.computeRealDimension()}},setText:function(b,a){this._text=b;this._text=this._text.replace(/(\r\n|\n\r|\r|\n)/g,"\n");this._text=this._text.replace(/(\t)/g,this._tabulation);this._sections=this._text.split("\n");if(a!==false){this.computeRealDimension()}this.invalidate()},setTextBaseline:function(a,c){this._textBaseline=a;this.invalidate();if(c!==false){this.computeRealDimension()}},setStyle:function(b,a){this._style=b;this._invalidateFont();this.invalidate();if(a!==false){this.computeRealDimension()}},setLineHeight:function(b,a){this._lineHeight=b;this.invalidate();if(a!==false){this.computeRealDimension()}},setSize:function(b,a){this._size=b;this._invalidateFont();this.invalidate();if(a!==false){this.computeRealDimension()}},setTypo:function(b,a){this._typo=b;this._invalidateFont();this.invalidate();if(a!==false){this.computeRealDimension()}},setWeight:function(a){this._weight=a;this._invalidateFont();this.invalidate()},setVariant:function(a){this._variant=a;this._invalidateFont();this.invalidate()},setTextAlign:function(b){this._align=b;this.invalidate()},computeRealDimension:function(){this.metrics.width=0;var b=document.createElement("canvas");var a=b.getContext("2d");this._doRender(a,false);b.width=0;b.height=0;b=null},setMaxWidth:function(a,b){this._maxWidth=a;if(this._maxWidth>0){this.dimension.width=a;if(b!==false){this.computeRealDimension()}}},resizeWith:function(a,b){if(this._maxWidth+a>0){this._afterResize(this._maxWidth+a)}},_afterResize:function(a){this._maxWidth=a;this.dimension.width=a;this.computeRealDimension();this._applyContraintsToFollowers();this._endResize()},render:function(a){a.fillStyle=this.color||this.bkgcolors[0];this._doRender(a,false)},_doRender:function(d,h){d.font=this._fullfont;d.textAlign=this._align;d.textBaseline=this._textBaseline;var i=0,f=0,b=0,a=0;if(this.crossed){d.save();d.strokeStyle="grey";d.moveTo(this.getWidth(),3);d.lineTo(0,this.getHeight()+3);d.stroke();d.restore()}if(isNaN(this._maxWidth)||this._maxWidth<=0){b=this._computeDecalX(this.getWidth());for(i=0;i<this._sections.length;i++){f=d.measureText(this._sections[i]).width;this._drawText(this._sections[i],b,a,d,h,f);a+=this._lineHeight}this._nbLines=this._sections.length}else{this._nbLines=0;for(i=0;i<this._sections.length;i++){var g=this._sections[i].split(this._wrapMode.space);var c=0;var e="";a=0;f=0;if(g.length==1){f=d.measureText(e).width;a=this._nbLines*this._lineHeight;b=this._computeDecalX(this.getWidth());this._drawText(e,b,a,d,h,f);this._nbLines++}else{while(c<g.length){e=g[c];while(d.measureText(e+this._wrapMode.space+g[c+1]).width<(this._maxWidth-5)&&c<g.length-1){if(e!=""){e+=this._wrapMode.space}e+=g[++c]}f=d.measureText(e).width;a=this._nbLines*this._lineHeight;b=this._computeDecalX(this.getWidth());this._drawText(e,b,a,d,h,f);this._nbLines++;++c}}}}},_drawText:function(f,a,g,c,e,d){if(cgsgExist(this._transform)){if(this._transform==="capitalize"){f=f.capitalize()}if(this._transform==="lowercase"){f=f.toLowerCase()}if(this._transform==="uppercase"){f=f.toUpperCase()}}if(e){this._drawSquare(a,g,d,c);return}if(cgsgExist(this.lineWidth)&&this.lineWidth>0){c.strokeText(f,a,g)}if(cgsgExist(this.bkgcolors[0])&&this.globalAlpha>0){c.fillText(f,a,g)}var b=c.measureText(f);if(b.width>this.metrics.width){this.metrics.width=b.width}},_drawSquare:function(a,d,c,b){b.fillRect(a-this._computeDecalX(c),d+this._computeDecalY(),c,this._size)},getHeight:function(){if(this._nbLines==0){return this._nbLines}return((this._nbLines-1)*this._lineHeight)+this._size},getWidth:function(){return this.metrics.width},getAbsWidth:function(){return this.dimension.width*this._absSca.x},_computeDecalX:function(b){var a=0;if(this._align=="start"||this._align=="left"){a=0}else{if(this._align=="center"){a=b/2}else{if(this._align=="end"||this._align=="right"){a=b}}}return a},_computeDecalY:function(){var a=0;if(this._textBaseline=="top"||this._textBaseline=="hanging"){a=this._size/cgsgCurrentExplorer.textDecalYTop}else{if(this._textBaseline=="middle"){a=-this._size/cgsgCurrentExplorer.textDecalYMiddle}else{if(this._textBaseline=="alphabetic"||this._textBaseline=="ideographic"){a=-this._size*cgsgCurrentExplorer.textDecalYAlpha}else{if(this._textBaseline=="bottom"){a=-this._size*cgsgCurrentExplorer.textDecalYBottom}}}}return a},doRenderGhost:function(a){this.beforeRenderGhost(a);if(this.globalAlpha>0){this.renderGhost(a);a.fillStyle=CGSG.ghostColor;this._doRender(a,true)}this.afterRenderGhost(a)},renderBoundingBox:function(j){var h=0;var e=this._computeDecalY();var a=this.getHeight();var g=this.getWidth();if(cgsgExist(this.selectionLineWidth)&&this.selectionLineWidth>0){j.strokeStyle=this.selectionLineColor;j.lineWidth=this.selectionLineWidth/this._absSca.y;j.beginPath();j.moveTo(h,e);j.lineTo(g,e);j.moveTo(h,e+a);j.lineTo(g,e+a);j.stroke();j.closePath();j.lineWidth=this.selectionLineWidth/this._absSca.x;j.beginPath();j.moveTo(h,e);j.lineTo(h,e+a);j.moveTo(h+g,e);j.lineTo(h+g,e+a);j.stroke();j.closePath()}if(this.isResizable){var f=this.handleSize/(2*this._absSca.x);var d=this.handleSize/(2*this._absSca.y);this.handles[0].translateTo(-f,-d+e);this.handles[1].translateTo(g/2-f,-d+e);this.handles[2].translateTo(g-f,-d+e);this.handles[3].translateTo(-f,a/2-d+e);this.handles[4].translateTo(g-f,a/2-d+e);this.handles[6].translateTo(g/2-f,a-d+e);this.handles[5].translateTo(-f,a-d+e);this.handles[7].translateTo(g-f,a-d+e);for(var b=0;b<8;b++){this.handles[b].size=this.handleSize;this.handles[b].fillColor=this.handleColor;this.handles[b].strokeColor=this.selectionLineColor;this.handles[b].lineWidth=this.selectionLineWidth;this.handles[b].render(j)}}},copy:function(){var a=new CGSGNodeText(this.position.x,this.position.y,this._text);a=this._super(a);a.setSize(this._size,false);a.setTextAlign(this._align,false);a.setTextBaseline(this._textBaseline,false);a.setStroke(this.lineWidth,false);a.setTypo(this._typo,false);a.setMaxWidth(this._maxWidth,false);a.setLineHeight(this._lineHeight,false);a.setWrapMode(this._wrapMode,false);a.setTabulationString(this._tabulation,false);a.pickNodeMethod=this.pickNodeMethod;this.setText(this._text,true);this.resizeTo(this.getWidth(),this.getHeight());return a}});var CGSGWEBVIEWMODE={LIVE:0,PREVIEW:1};var CGSGNodeWebview=CGSGNodeDomElement.extend({initialize:function(b,e,d,a,c){this._super(b,e,d,a,document.createElement("iframe"));this.resizeTo(CGSGMath.fixedPoint(d),CGSGMath.fixedPoint(a));this.threshold=20;this.classType="CGSGNodeWebview";this._previewContainer=null;this._url=c;this._previewURL=null;this._createLiveContainer();this._createPreviewContainer();this.switchMode(CGSGWEBVIEWMODE.LIVE)},_initLiveContainer:function(){if(!cgsgExist(this._htmlElement)){this._createLiveContainer()}document.body.appendChild(this._htmlElement)},_initPreviewContainer:function(){if(!cgsgExist(this._previewContainer)){this._createPreviewContainer()}this.addChild(this._previewContainer)},_createLiveContainer:function(){var a="";if(cgsgExist(this._url)){a=this._url}this._htmlElement.style.position="absolute";this._htmlElement.setAttribute("src",a)},_createPreviewContainer:function(){this._previewContainer=new CGSGNodeImage(0,0,this._previewURL);this._previewContainer.isTraversable=false},setURL:function(a){this._url=a;if(cgsgExist(this._htmlElement)){this._htmlElement.setAttribute("src",this._url)}},getURL:function(){return this._url},setPreviewURL:function(a){this._previewURL=a;this._previewContainer.setURL(this._previewURL)},switchMode:function(a){if(a===CGSGWEBVIEWMODE.LIVE){this.detachChild(this._previewContainer);this._initLiveContainer()}else{if(this._mode===CGSGWEBVIEWMODE.LIVE){document.body.removeChild(this._htmlElement)}this._initPreviewContainer()}this._mode=a},getCurrentMode:function(){return this._mode},render:function(a){if(this._mode===CGSGWEBVIEWMODE.LIVE){a.fillRect(0,0,this.dimension.width,this.dimension.height);a.strokeRect(0,0,this.dimension.width,this.dimension.height);a.strokeRect(this.threshold-2,this.threshold-2,8+this.dimension.width-this.threshold*2,8+this.dimension.height-this.threshold*2);if(cgsgExist(this._htmlElement)){this._htmlElement.style.left=(this.getAbsLeft()+this.threshold)+"px";this._htmlElement.style.top=(this.getAbsTop()+this.threshold)+"px";this._htmlElement.style.width=(this.getAbsWidth()-this.threshold*2)+"px";this._htmlElement.style.height=(this.getAbsHeight()-this.threshold*2)+"px"}}else{this._previewContainer.resizeTo(this.getWidth(),this.getHeight());a.fillRect(0,0,this.getWidth(),this.getHeight())}},free:function(){if(cgsgExist(this._htmlElement)){CGSG.canvas.removeChild(this._htmlElement);delete (this._htmlElement)}this._super()},copy:function(){var a=new CGSGNodeWebview(this.position.x,this.position.y,this.dimension.width,this.dimension.height,this.url);a=this._super(a);a.threshold=this.threshold;a.switchMode(this.mode);return a}});var CGSGNodeSquare=CGSGNode.extend({initialize:function(b,d,c,a){this._super(b,d);this.resizeTo(c,a);this.classType="CGSGNodeSquare"},render:function(g){if(!cgsgExist(this.radius)||this.radius<=0){g.fillRect(0,0,this.dimension.width,this.dimension.height);if(this.lineWidth>0){g.strokeRect(0,0,this.dimension.width,this.dimension.height)}}else{g.save();var e=this.radius;var a=this.dimension.width;var d=this.dimension.height;var f=e+a;var b=e+d;g.translate(-e,-e);g.beginPath();g.moveTo(2*e,e);g.lineTo(a,e);g.quadraticCurveTo(f,e,f,e+e);g.lineTo(f,d);g.quadraticCurveTo(f,b,a,b);g.lineTo(e+e,b);g.quadraticCurveTo(e,b,e,d);g.lineTo(e,e+e);g.quadraticCurveTo(e,e,e+e,e);g.closePath();g.fill();if(this.lineWidth>0){g.stroke()}g.restore()}},copy:function(){var a=new CGSGNodeSquare(this.position.x,this.position.y,this.dimension.width,this.dimension.height);return this._super(a)}});var CGSGNodeSliderHandle=CGSGNode.extend({initialize:function(a){this._super(0,0);this.resizeTo(a,a);this.rotationCenter=new CGSGPosition(0.5,0.5);this.handleWidth=a;this.isDraggable=true;this.onDrag=this.onSlide},getParentSlider:function(){return this._parentNode},onSlide:function(){this.handleWidth=Math.min(this._parentNode.getHeight(),this._parentNode.getWidth())*2;var c=this.handleWidth/2;var a=this.position.x;if(a<-c){a=-c}else{if(a>this._parentNode.getWidth()-c){a=this._parentNode.getWidth()-c}}this.translateTo(a,-this.handleWidth/4);var b=this._parentNode.max-this._parentNode.min;this._parentNode.value=(this.position.x+c)*(b/this._parentNode.getWidth())+this._parentNode.min},render:function(d){this.handleWidth=Math.min(this._parentNode.getHeight(),this._parentNode.getWidth())*2;var a=this.handleWidth/10;d.lineWidth=2;d.strokeStyle=CGSGColor.darkenHex(this.bkgcolors[0],0.7);var b=d.createLinearGradient(this.handleWidth,0,this.handleWidth,this.handleWidth);b.addColorStop(0.3,this.bkgcolors[0]);b.addColorStop(1,CGSGColor.darkenHex(this.bkgcolors[0],0.7));d.fillStyle=b;d.beginPath();d.arc(a,a,a,Math.PI,-Math.PI/2,false);d.lineTo(this.handleWidth-a,0);d.arc(this.handleWidth-a,a,a,-Math.PI/2,0,false);d.lineTo(this.handleWidth,this.handleWidth-a);d.arc(this.handleWidth-a,this.handleWidth-a,a,0,Math.PI/2,false);d.lineTo(a,this.handleWidth);d.arc(a,this.handleWidth-a,a,Math.PI/2,Math.PI,false);d.closePath();d.fill();d.stroke()}});var CGSGNodeSlider=CGSGNode.extend({initialize:function(b,d,c,a){this._super(b,d);this.resizeTo(c,a);this.backgroundColor="#EEEEEE";this.valueColor="#50479E";this.min=-10;this.max=10;this.value=5;this.rotationCenter=new CGSGPosition(0.5,0.5);this.onResize=this.updateSliderHandle;this.setHandle()},render:function(a){a.save();this.outlineShape(a);this.renderBackground(a);this.renderValue(a);a.restore()},outlineShape:function(d){var a=Math.min(this.getWidth(),this.getHeight())/2;var b=this.getWidth();d.beginPath();d.arc(a,a,a,Math.PI/2,-Math.PI/2,false);d.lineTo(b-a,0);d.arc(b-a,a,a,-Math.PI/2,Math.PI/2,false);d.lineTo(a,a*2);d.closePath();d.clip()},renderBackground:function(d){d.fillStyle=this.backgroundColor;d.strokeStyle=CGSGColor.darkenHex(this.backgroundColor,0.8);d.lineWidth=4;var a=Math.min(this.getWidth(),this.getHeight())/2;var b=this.getWidth();d.beginPath();d.arc(a,a,a,Math.PI/2,-Math.PI/2,false);d.lineTo(b-a,0);d.arc(b-a,a,a,-Math.PI/2,Math.PI/2,false);d.lineTo(a,a*2);d.closePath();d.fill();d.stroke();d.shadowColor="black";d.shadowBlur=15;d.shadowOffsetX=0;d.shadowOffsetY=0;d.beginPath();d.rect(0,-this.getHeight(),this.getWidth(),this.getHeight());d.closePath();d.fill()},renderValue:function(d){var a=this.getWidth()/Math.abs(this.max-this.min)*Math.abs(this.value-this.min);var b=d.createLinearGradient(a,0,a,this.getHeight());b.addColorStop(0.7,CGSGColor.darkenHex(this.valueColor,1.5));b.addColorStop(1,this.valueColor);d.fillStyle=b;d.beginPath();d.rect(0,0,a,this.getHeight());d.closePath();d.fill()},updateSliderHandle:function(){var a=Math.min(this.getWidth(),this.getHeight())*2;var b=this.getWidth()/Math.abs(this.max-this.min)*Math.abs(this.value-this.min);this.handle.resizeTo(a,a);this.handle.translateTo(b-a/2,-a/4)},setHandle:function(b){this.handle=b;var a=Math.min(this.getWidth(),this.getHeight())*2;if(b==undefined){this.handle=new CGSGNodeSliderHandle(a);this.handle.color=this.backgroundColor}this.addChild(this.handle);var c=this.getWidth()/Math.abs(this.max-this.min)*Math.abs(this.value-this.min);this.handle.translateTo(c-a/4,-a/4)},getHandle:function(){return this.handle},setMin:function(a){if(a!=null&&a!=this.min&&a<this.max){this.min=a;this.updateSliderHandle()}},setMax:function(a){if(a!=null&&a!=this.max&&a>this.min){this.max=a;this.updateSliderHandle()}},setValue:function(a){if(a>=this.min&&a<=this.max){this.value=a;this.updateSliderHandle()}},getValueAsRangeRatio:function(){return 1-Math.abs((this.value+this.min)/(this.max-this.min))}});var CGSGNodeCircle=CGSGNode.extend({initialize:function(c,b,a){this.classType="CGSGNodeCircle";this.radius=a;this._center=new CGSGPosition(c,b);this._super(0,0);this.resizeTo(a*2,a*2);this.isProportionalResizeOnly=true;this.translateTo(c-a,b-a)},render:function(a){a.beginPath();a.arc(this.radius,this.radius,this.radius,0,2*Math.PI,false);a.fill();if(this.lineWidth>0){a.stroke()}},_resize:function(){this.radius=CGSGMath.fixedPoint(this.dimension.width/2);this._isDimensionChanged=true;this.invalidate();if(cgsgExist(this.onResize)){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_RESIZE,new CGSGEvent(this,{node:this}))}},resizeTo:function(a,b){var c=Math.min(a,b);this.dimension.resizeTo(c,c);this._resize()},resizeBy:function(a,c){var e=a*this.dimension.width;var b=c*this.dimension.height;var d=(e<b)?a:c;this.dimension.resizeBy(d,d);this._resize()},resizeWith:function(a,c){var e=a+this.dimension.width;var b=c+this.dimension.height;var d=(e<b)?a:c;this.dimension.resizeWith(d,d);this._resize()},copy:function(){var a=new CGSGNodeCircle(this.position.x,this.position.y,this.radius);return this._super(a)}});var CGSGNodeEllipse=CGSGNode.extend({initialize:function(b,d,c,a){this._super(b,d);this.resizeTo(c,a);this._f=1.16666666;this._mf=1-this._f;this._w=0;this._mw=0;this._computeWmW();this.classType="CGSGNodeEllipse";this.pickNodeMethod=CGSGPickNodeMethod.GHOST},render:function(b){var a=this.dimension.width/2;b.beginPath();b.moveTo(a,0);b.bezierCurveTo(this._w,0,this._w,this.dimension.height,a,this.dimension.height);b.bezierCurveTo(this._mw,this.dimension.height,this._mw,0,a,0);b.fill();if(this.lineWidth>0){b.stroke()}b.closePath()},_computeWmW:function(){this._w=this.dimension.width*this._f;this._mw=this.dimension.width*this._mf},resizeTo:function(a,b){this._super(a,b);this._computeWmW()},resizeBy:function(a,b){this._super(a,b);this._computeWmW()},resizeWith:function(a,b){this._super(a,b);this._computeWmW()},copy:function(){var a=new CGSGNodeEllipse(this.position.x,this.position.y,this.dimension.width,this.dimension.height);return this._super(a)}});var CGSGNodeImage=CGSGNode.extend({initialize:function(a,c,b){this._super(a,c);this.classType="CGSGNodeImage";this.effect=null;this._urlImage=b;this.isProportionalResize=true;this._img=new Image();this.slice=new CGSGRegion(0,0,0,0);this.isLoaded=false;this.onLoadEnd=null;this.onLoadError=null;this.onLoadAbort=null;if(cgsgExist(this._urlImage)&&this._urlImage!=""){this.setURL(b)}},_createDelegate:function(a,b){return function(){return b.call(a)}},_onImageLoaded:function(a){this.checkDimension();this.isLoaded=true;if(cgsgExist(a)){cgsgImgManager.set(this._urlImage,this.img)}if(cgsgExist(this.onLoadEnd)){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_LOAD_END,new CGSGEvent(this,{node:this}))}this.invalidate()},_onImageError:function(a){if(this.onLoadError!==null){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_LOAD_ERROR,new CGSGEvent(this,{node:this}))}},_onImageAbort:function(a){if(this.onLoadAbort!==null){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_LOAD_ABORT,new CGSGEvent(this,{node:this}))}},checkDimension:function(){if(!this._isDimensionChanged){if(this.dimension.width<=0&&this.dimension.height<=0){this.dimension.width=this._img.width;this.dimension.height=this._img.height}}if(this.slice.dimension.width<=0||this.slice.dimension.height<=0){this.slice.dimension.width=this._img.width;this.slice.dimension.height=this._img.height}},setSlice:function(a,e,b,c,d){this.slice.position.x=a;this.slice.position.y=e;this.slice.dimension.width=b;this.slice.dimension.height=c;if(d){this.resizeTo(b,c)}this.invalidate()},setImage:function(a){this._img=a;if(cgsgExist(this._img)){this._setUrl(this._img.src)}else{this._urlImage=null;this.isLoaded=false;this.invalidate()}},setURL:function(a){this._urlImage=a;this._img=cgsgImgManager.get(a);if(cgsgExist(this._img)){this._onImageLoaded(null)}else{delete (this._img);this.isLoaded=false;this._img=new Image();this._img.onload=this._createDelegate(this,this._onImageLoaded);this._img.onerror=this._createDelegate(this,this._onImageError);this._img.onabort=this._createDelegate(this,this._onImageAbort);this._img.src=this._urlImage}},_setUrl:function(a){this._urlImage=a;this.isLoaded=true;this.checkDimension();this.invalidate()},getImage:function(){return this._img},render:function(a){if(this.isLoaded&&this._img.src!=""&&!this.slice.isEmpty()){a.drawImage(this._img,this.slice.position.x,this.slice.position.y,this.slice.dimension.width,this.slice.dimension.height,0,0,this.getWidth(),this.getHeight())}},setEffect:function(a){this.effect=a},copy:function(a){if(!cgsgExist(a)){a=new CGSGNodeImage(this.position.x,this.position.y,null)}a=this._super(a);a._urlImage=this._urlImage;a.effect=this.effect;a.isProportionalResize=this.isProportionalResize;a._isLoaded=this.isLoaded;a.setImage(this._img);a.setSlice(this.slice.position.x,this.slice.position.y,this.slice.dimension.width,this.slice.dimension.height,true);a.resizeTo(this.dimension.width,this.dimension.height);a.onLoadEnd=this.onLoadEnd;return a}});var CGSGNodeSprite=CGSGNode.extend({initialize:function(a,c,b){this._super(a,c);this.classType="CGSGNodeSprite";this.listAnimations=[];this.currentAnimation=null;this.isProportionalResize=true;this._currentFrame=0;this._isPlaying=false;this._numberOfLoops=1;this._currentLoop=0;this._urlImage=b;this._img=new Image();this._isLoaded=false;this.onLoadEnd=null;this.onAnimationEnd=null;this.onAnimationStart=null;if(this._urlImage!==null&&this._urlImage!=""){this._img.onload=this._createDelegate(this,this._onImageLoaded);this._img.src=this._urlImage}},_createDelegate:function(a,b){return function(){return b.call(a)}},_onImageLoaded:function(){this.checkDimension();this._isLoaded=true;if(this.onLoadEnd!==null){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_LOAD_END,new CGSGEvent(this,{node:this}))}this.invalidate()},_onImageError:function(){console.log("Error while loading image : "+this._urlImage)},checkDimension:function(){if(this.dimension.width<=0&&this.dimension.height<=0){this.dimension.width=this._img.width;this.dimension.height=this._img.height}},setImage:function(a){this._img=a;if(cgsgExist(this._img)){this._urlImage=this._img.src;this._isLoaded=true;this.invalidate()}},goToNextFrame:function(){this._currentFrame+=1/this.currentAnimation.speed;var a=false;if(this._currentFrame>=this.currentAnimation.frames){a=true}if(a){if(this._numberOfLoops<0||this._currentLoop<this._numberOfLoops){this._currentLoop++;this.goToFirstFrame()}else{this.goToLastFrame();this.stop()}}this.invalidate()},goToPreviousFrame:function(){this._currentFrame-=this.currentAnimation.speed;var a=false;if(this._currentFrame<0){a=true}if(a){if(this._numberOfLoops<=0||this._currentLoop>=0){this._currentLoop--;this.goToLastFrame()}else{this.goToFirstFrame();this.stop()}}this.invalidate()},goToFirstFrame:function(){this._currentFrame=0;this.invalidate()},goToLastFrame:function(){this._currentFrame=this.currentAnimation.frames-1;this.invalidate()},render:function(b){if(this._isLoaded&&this._img.src!=""){if(cgsgExist(this.currentAnimation)){b.globalAlpha=this.globalAlpha;var a=this.currentAnimation.slices[Math.floor(this._currentFrame)];b.drawImage(this._img,a.x,a.y,this.currentAnimation.width,this.currentAnimation.height,0,0,this.dimension.width,this.dimension.height);if(this.lineWidth>0){b.stroke()}if(this._isPlaying){this.goToNextFrame();this.invalidate()}}}},_getSlice:function(e,d){var c=e%d.framesPerLine;var b=Math.floor(e/d.framesPerLine);var a=d.sliceX+c*d.width;var f=d.sliceY+b*d.height;return{x:a,y:f}},addAnimation:function(b,d,i,a,k,c,j,e){var g={name:b,speed:d,frames:i,sliceX:a,sliceY:k,width:c,height:j,framesPerLine:e,slices:[]};for(var h=0;h<i;h++){g.slices.push(this._getSlice(h,g))}this.listAnimations.push(g);if(this.listAnimations.length==1){this.currentAnimation=g}this.dimension.width=c;this.dimension.height=j},play:function(c,a){if(a===undefined||a===null){a=-1}this.currentAnimation=null;for(var b=0;b<this.listAnimations.length;b++){if(this.listAnimations[b].name===c){this.currentAnimation=this.listAnimations[b];this.dimension.width=this.currentAnimation.width;this.dimension.height=this.currentAnimation.height;this.reset();this._numberOfLoops=a;this._isPlaying=true;this.resizeTo(this.currentAnimation.width,this.currentAnimation.height);if(this.onAnimationStart!==null){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_ANIMATION_START,new CGSGEvent(this,{node:this,animationName:c,loop:a}))}return true}}return false},stop:function(){this._isPlaying=false;if(this.onAnimationEnd!==null){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_ANIMATION_END,new CGSGEvent(this,{node:this,animationName:this.currentAnimation.name,loop:this._currentLoop,frame:this._currentFrame}));this.onAnimationEnd({animationName:this.currentAnimation.name,loop:this._currentLoop,frame:this._currentFrame})}this.invalidate()},reset:function(){this._currentFrame=0;this._currentLoop=1;this.invalidate()},copy:function(){var c=new CGSGNodeSprite(this.position.x,this.position.y,this._urlImage);c=this._super(c);c.listAnimations=[];for(var b=0;b<this.listAnimations.length;b++){c.addAnimation(this.listAnimations[b].name,this.listAnimations[b].speed,this.listAnimations[b].frames,this.listAnimations[b].sliceX,this.listAnimations[b].sliceY,this.listAnimations[b].width,this.listAnimations[b].height,this.listAnimations[b].framesPerLine)}c.currentAnimation=this.currentAnimation;c.isProportionalResize=this.isProportionalResize;c._currentFrame=this._currentFrame;c._isPlaying=this._isPlaying;c._numberOfLoops=this._numberOfLoops;c._currentLoop=this._currentLoop;c._img=this._img;c._isLoaded=this._isLoaded;c.onLoadEnd=this.onLoadEnd;c.onAnimationEnd=this.onAnimationEnd;c.onAnimationStart=this.onAnimationStart;if(this._urlImage!==null&&this._urlImage!=""){c._img.onload=c._createDelegate(c,c._onImageLoaded,c.context);c._img.src=c._urlImage}return c}});var CGSGNodeButtonProps=CGSGObject.extend({initialize:function(){this.cls=[];this.firstColor="";this.lastColor="";this.shadowColor="";this.radius=0;this.lineWidth=0;this.lineColor="";this.paddingV=10;this.paddingH=10;this.txtNode=new CGSGNodeText(0,0,"");this.slice=null;this.icon=null;this.dimension=new CGSGDimension(10,10);this._invalSize=true}});var CGSGButtonMode={NORMAL:{id:0,isClickable:true},OVER:{id:1,isClickable:true},DEACTIVATED:{id:2,isClickable:false},SELECTED:{id:3,isClickable:true}};var CGSGPositionMode={TOP:{index:0,decalX:0,decalY:-1,dt:1,dy:1,computeWidth:function(b,a){return Math.max(b,a)},computeHeight:function(b,a){return 0}},BOTTOM:{index:1,decalX:0,decalY:1,dt:0,dy:1,computeWidth:function(b,a){return Math.max(b,a)},computeHeight:function(b,a){return 0}},LEFT:{index:2,decalX:-1,decalY:0,dt:0,dy:0,computeWidth:function(b,a){return 0},computeHeight:function(b,a){return Math.max(b,a)}},RIGHT:{index:3,decalX:1,decalY:0,dt:1,dy:0,computeWidth:function(b,a){return 0},computeHeight:function(b,a){return Math.max(b,a)}}};var CGSGNodeButton=CGSGNode.extend({initialize:function(a,d,c){this._props=[new CGSGNodeButtonProps(),new CGSGNodeButtonProps(),new CGSGNodeButtonProps(),new CGSGNodeButtonProps()];this._super(a,d);this._needRedraw=false;this._pictoPosition=CGSGPositionMode.LEFT;this._distancePictoText=10;this._tmpCanvases=[document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas")];this.classType="CGSGNodeButton";this._currentMode=CGSGButtonMode.NORMAL;this.setMode(this._currentMode);this.setClassFor("cgsg-button",CGSGButtonMode.NORMAL);this.setClassFor("cgsg-button-over",CGSGButtonMode.OVER);this.setClassFor("cgsg-button-deactivated",CGSGButtonMode.DEACTIVATED);this.setClassFor("cgsg-button-selected",CGSGButtonMode.SELECTED);this._props[0].txtNode.addClass("cgsg-button-text");this._props[1].txtNode.addClass("cgsg-button-over-text");this._props[2].txtNode.addClass("cgsg-button-deactivated-text");this._props[3].txtNode.addClass("cgsg-button-selected-text");this.setTexts(c);var b=this;this.onMouseOver=function(f){if(b.getMode()==CGSGButtonMode.NORMAL){b.setMode(CGSGButtonMode.OVER)}};this.onMouseOut=function(f){if(b.getMode()==CGSGButtonMode.OVER){b.setMode(CGSGButtonMode.NORMAL)}};this._isInitialized=true},setPictoPosition:function(a){this._pictoPosition=a;this.forceRedraw()},setClassFor:function(a,b){this._props[b.id].cls=[];this._props[b.id].cls.push(a);this._props[b.id]._invalSize=false;this._needRedraw=false;this._loadAttrs(b);this._initShape(b)},setClass:function(a){this._clearAllCls();this._props[CGSGButtonMode.NORMAL.id].cls.push(a);this._props[CGSGButtonMode.OVER.id].cls.push(a);this._props[CGSGButtonMode.DEACTIVATED.id].cls.push(a);this._props[CGSGButtonMode.SELECTED.id].cls.push(a);this.invalidateTheme()},setClasses:function(a){this._clearAllCls();this._props[CGSGButtonMode.NORMAL.id].cls.push(a[0]);this._props[CGSGButtonMode.OVER.id].cls.push(a[1]);this._props[CGSGButtonMode.DEACTIVATED.id].cls.push(a[2]);this._props[CGSGButtonMode.SELECTED.id].cls.push(a[3]);this.invalidateTheme()},_clearAllCls:function(){this._props[CGSGButtonMode.NORMAL.id].cls=[];this._props[CGSGButtonMode.OVER.id].cls=[];this._props[CGSGButtonMode.DEACTIVATED.id].cls=[];this._props[CGSGButtonMode.SELECTED.id].cls=[]},addClassFor:function(a,b){this._props[b.id].cls.push(a);this._props[b.id]._invalSize=false;this._needRedraw=false;this._loadAttrs(b);this._initShape(b)},addClass:function(a){this._props[CGSGButtonMode.NORMAL.id].cls.push(a);this._props[CGSGButtonMode.OVER.id].cls.push(a);this._props[CGSGButtonMode.DEACTIVATED.id].cls.push(a);this._props[CGSGButtonMode.SELECTED.id].cls.push(a);this.invalidateTheme()},addClasses:function(a){this._props[CGSGButtonMode.NORMAL.id].cls.push(a[0]);this._props[CGSGButtonMode.OVER.id].cls.push(a[1]);this._props[CGSGButtonMode.DEACTIVATED.id].cls.push(a[2]);this._props[CGSGButtonMode.SELECTED.id].cls.push(a[3]);this.invalidateTheme()},removeClassFor:function(a,b){this._props[b.id].cls=this._props[b.id].cls.without(a);this.forceRedraw();this._loadAttrs(b);this._initShape(b)},removeClass:function(a){this._props[CGSGButtonMode.NORMAL.id].cls=this._props[CGSGButtonMode.NORMAL.id].without(a);this._props[CGSGButtonMode.OVER.id].cls=this._props[CGSGButtonMode.OVER.id].without(a);this._props[CGSGButtonMode.DEACTIVATED.id].cls=this._props[CGSGButtonMode.DEACTIVATED.id].without(a);this._props[CGSGButtonMode.SELECTED.id].cls=this._props[CGSGButtonMode.SELECTED.id].without(a);this.invalidateTheme()},setImageFor:function(a,b){this._props[b.id].icon.setImage(a)},setImage:function(a){this._checkIcon();this.setImageFor(a,CGSGButtonMode.NORMAL);this.setImageFor(a,CGSGButtonMode.OVER);this.setImageFor(a,CGSGButtonMode.DEACTIVATED);this.setImageFor(a,CGSGButtonMode.SELECTED);this._needRedraw=true},setImageURL:function(a){this._checkIcon();this._props[CGSGButtonMode.NORMAL.id].icon.onLoadEnd=this._onLoadImageEndAll.bind(this);this._props[CGSGButtonMode.NORMAL.id].icon.setURL(a)},setImageURLFor:function(a,b){this._props[b.id].icon.onLoadEnd=this._onLoadImageEndFor.bind(this);this._props[b.id].icon.setURL(a)},_onLoadImageEndFor:function(){this.forceRedraw()},_onLoadImageEndAll:function(){var a=this._props[CGSGButtonMode.NORMAL.id].icon.getImage();this._props[CGSGButtonMode.OVER.id].icon.setImage(a);this._props[CGSGButtonMode.DEACTIVATED.id].icon.setImage(a);this._props[CGSGButtonMode.SELECTED.id].icon.setImage(a);this.forceRedraw()},_checkIcon:function(){this._checkIconFor(CGSGButtonMode.NORMAL);this._checkIconFor(CGSGButtonMode.OVER);this._checkIconFor(CGSGButtonMode.DEACTIVATED);this._checkIconFor(CGSGButtonMode.SELECTED)},_checkIconFor:function(a){if(!cgsgExist(this._props[a.id].icon)){this._props[a.id].icon=new CGSGNodeImage(0,0,null)}},getTexts:function(){return[CGSGButtonMode.NORMAL.props.txtNode._text,CGSGButtonMode.OVER.props.txtNode._text,CGSGButtonMode.DEACTIVATED.props.txtNode._text,CGSGButtonMode.SELECTED.props.txtNode._text]},forceRedraw:function(){this._needRedraw=true;this._props[CGSGButtonMode.NORMAL.id]._invalSize=true;this._props[CGSGButtonMode.OVER.id]._invalSize=true;this._props[CGSGButtonMode.DEACTIVATED.id]._invalSize=true;this._props[CGSGButtonMode.SELECTED.id]._invalSize=true},setTexts:function(b){if(!cgsgIsArray(b)){var a=b.toString();b=[a,a,a,a]}this._props[CGSGButtonMode.NORMAL.id].txtNode.setText(b[0],true);this._props[CGSGButtonMode.OVER.id].txtNode.setText(b[1],true);this._props[CGSGButtonMode.DEACTIVATED.id].txtNode.setText(b[2],true);this._props[CGSGButtonMode.SELECTED.id].txtNode.setText(b[3],true);this.forceRedraw()},setTextClass:function(a){this._props[CGSGButtonMode.NORMAL.id].txtNode.setClass(a);this._props[CGSGButtonMode.OVER.id].txtNode.setClass(a);this._props[CGSGButtonMode.DEACTIVATED.id].txtNode.setClass(a);this._props[CGSGButtonMode.SELECTED.id].txtNode.setClass(a);this.invalidate()},setTextClasses:function(a){this._props[CGSGButtonMode.NORMAL.id].txtNode.setClass(a[0]);this._props[CGSGButtonMode.OVER.id].txtNode.setClass(a[1]);this._props[CGSGButtonMode.DEACTIVATED.id].txtNode.setClass(a[2]);this._props[CGSGButtonMode.SELECTED.id].txtNode.setClass(a[3]);this.invalidate()},setTextClassFor:function(a,b){this._props[b.id].txtNode.setClass(a);this.invalidate()},setFixedSize:function(a){this._props[CGSGButtonMode.NORMAL.id].dimension=a;this._props[CGSGButtonMode.OVER.id].dimension=a;this._props[CGSGButtonMode.DEACTIVATED.id].dimension=a;this._props[CGSGButtonMode.SELECTED.id].dimension=a;this._fixedSize=cgsgExist(a);this.forceRedraw()},setSlices:function(a){this._props[CGSGButtonMode.NORMAL.id].slice=a[0];this._props[CGSGButtonMode.OVER.id].slice=a[1];this._props[CGSGButtonMode.DEACTIVATED.id].slice=a[2];this._props[CGSGButtonMode.SELECTED.id].slice=a[3];this.forceRedraw()},setSliceFor:function(b,a){this._props[a.id].slice=b;this._props[a.id]._invalSize=true;this._initShape(a)},invalidateTheme:function(){this._super();this._props[CGSGButtonMode.NORMAL.id].txtNode.invalidateTheme();this._props[CGSGButtonMode.OVER.id].txtNode.invalidateTheme();this._props[CGSGButtonMode.DEACTIVATED.id].txtNode.invalidateTheme();this._props[CGSGButtonMode.SELECTED.id].txtNode.invalidateTheme();this._loadAttrs(CGSGButtonMode.NORMAL);this._loadAttrs(CGSGButtonMode.OVER);this._loadAttrs(CGSGButtonMode.DEACTIVATED);this._loadAttrs(CGSGButtonMode.SELECTED);this.invalidate()},invalidate:function(){if(cgsgExist(this._isInitialized)&&this._isInitialized===true){this._initShapes()}},_loadAttrs:function(i){var o=this._props[i.id].cls;var c=i.id;var b=this._props[c];var n=CGSG.cssManager.getAttrInArray(o,"background");var j=CGSG.cssManager.getAttrInArray(o,"border-width");var m=CGSG.cssManager.getAttrInArray(o,"border-color");var h=CGSG.cssManager.getAttrInArray(o,"padding-top");var a=CGSG.cssManager.getAttrInArray(o,"padding-left");var k=CGSG.cssManager.getAttrInArray(o,"border-radius");var l=CGSG.cssManager.getAttrInArray(o,"icon");if(!cgsgExist(l)){l=CGSG.cssManager.getAttrInArray(o,"list-style-image")}if(cgsgExist(n)){var g=n.substring(n.indexOf("rgb"),n.indexOf(")")+1);var e=n.substring(n.lastIndexOf("rgb"),n.lastIndexOf(")"));var f=CGSGColor.fromString(g);var d=CGSGColor.fromString(e);b.firstColor=CGSGColor.rgb2hex(f.r,f.g,f.b);b.lastColor=CGSGColor.rgb2hex(d.r,d.g,d.b)}if(cgsgExist(m)){b.lineColor=m}if(cgsgExist(k)){b.radius=CGSG.cssManager.getNumber(k)}if(cgsgExist(j)){b.lineWidth=CGSG.cssManager.getNumber(j)}if(cgsgExist(m)){b.lineColor=m}if(cgsgExist(h)){b.paddingV=CGSG.cssManager.getNumber(h)}if(cgsgExist(a)){b.paddingH=CGSG.cssManager.getNumber(a)}if(cgsgExist(l)){this._checkIconFor(i);this.setImageURLFor(CGSG.cssManager.getURL(l),i)}},resizeWith:function(b,a){this._needRedraw=true;this._super(b,a)},_initShapes:function(){this._initShape(CGSGButtonMode.NORMAL);this._initShape(CGSGButtonMode.OVER);this._initShape(CGSGButtonMode.DEACTIVATED);this._initShape(CGSGButtonMode.SELECTED);this._needRedraw=false},_initShape:function(l){var c=l.id;var b=this._props[c];var d=b.txtNode;var q=d.getWidth(),m=d.getHeight();var e=this._distancePictoText;if(b.text===""){e=0}var o=0,n=0;var j=0;var g=0;if(cgsgExist(b.icon)&&b.icon.isLoaded){if(cgsgExist(b.slice)){b.icon.setSlice(b.slice.position.x,b.slice.position.y,b.slice.dimension.width,b.slice.dimension.height,true)}j=b.icon.slice.dimension.width;g=b.icon.slice.dimension.height;o=(j+e)*Math.abs(this._pictoPosition.decalX);n=(g+e)*Math.abs(this._pictoPosition.decalY)}if(b._invalSize){if(this._fixedSize){this.dimension.resizeTo(b.dimension.width,b.dimension.height)}else{this.dimension.resizeTo((2*b.paddingH)+o+q*Math.abs(this._pictoPosition.decalX)+this._pictoPosition.computeWidth(q,j),(2*b.paddingV)+n+m*Math.abs(this._pictoPosition.decalY)+this._pictoPosition.computeHeight(m,g))}b._invalSize=false;this._isDimensionChanged=true}b.dimension=this.dimension.copy();this._tmpCanvases[c].width=this.dimension.width+2*b.radius;this._tmpCanvases[c].height=this.dimension.height+2*b.radius;var h=this._tmpCanvases[c].getContext("2d");cgsgClearContext(h);h.save();var a=b.radius;h.translate(-a,-a);h.beginPath();h.moveTo(2*a,a);h.lineTo(a+this.dimension.width-a,a);h.quadraticCurveTo(a+this.dimension.width,a,a+this.dimension.width,a+a);h.lineTo(a+this.dimension.width,a+this.dimension.height-a);h.quadraticCurveTo(a+this.dimension.width,a+this.dimension.height,a+this.dimension.width-a,a+this.dimension.height);h.lineTo(a+a,a+this.dimension.height);h.quadraticCurveTo(a,a+this.dimension.height,a,a+this.dimension.height-a);h.lineTo(a,a+a);h.quadraticCurveTo(a,a,a+a,a);h.closePath();if(!cgsgExist(b.lastColor)){h.fillStyle=b.firstColor}else{var p=h.createLinearGradient(0,0,0,this.dimension.height);p.addColorStop(0,b.firstColor);p.addColorStop(1,b.lastColor);h.fillStyle=p}if(cgsgExist(b.shadowColor)){h.shadowColor=b.shadowColor;h.shadowBlur=10;h.shadowOffsetX=0;h.shadowOffsetY=0}h.fill();if(cgsgExist(b.lineColor)&&b.lineColor>0){h.strokeStyle=b.lineColor;h.lineWidth=b.lineWidth;h.stroke()}h.restore();var k=(-this._pictoPosition.decalX*o+this.getWidth()-q)/2;var i=(-this._pictoPosition.decalY*n+this.getHeight()-m)/2;if(cgsgExist(b.icon)&&b.icon.isLoaded){var f=q/2;b.icon.translateTo(k+f+this._pictoPosition.decalX*(f+e+(1-this._pictoPosition.dt)*j)-this._pictoPosition.dy*j/2,(1-this._pictoPosition.dy)*(i+(m-g)/2)+this._pictoPosition.dy*(i-d._size/2-this._pictoPosition.dt*(e+g)+(1-this._pictoPosition.dt)*(m+e)));b.icon.doRender(h)}d.translateTo(k,i,false);d.doRender(h)},setMode:function(a){this._currentMode=a;this.isClickable=a.isClickable;this.dimension.resizeTo(this._props[a.id].dimension.width,this._props[a.id].dimension.height);this._isDimensionChanged=true},getMode:function(){return this._currentMode},render:function(a){if(this._needRedraw){this._initShapes()}a.drawImage(this._tmpCanvases[this._currentMode.id],0,0)},copy:function(){var a=new CGSGNodeSquare(this.position.x,this.position.y,this.dimension.width,this.dimension.height);a=this._super(a);a.bkgcolors=this.bkgcolors;a.lineColor=this.lineColor;a.lineWidth=this.lineWidth;return a}});"use strict";var CGSGParticle=CGSGObject.extend({initialize:function(a){this.node=a;this.node.isClickable=false;this.node.isResizable=false;this.node.isDraggable=false;this.userData=null;this.init()},init:function(){this.position=new CGSGPosition(0,0);this.mass=1000;this.initVelocity(new CGSGVector2D(1,1));this.checkCTL=null;this.isAlive=true;this.age=0;this._acceleration=new CGSGVector2D(0,0);this.speedThreshold=0},initPosition:function(a,b){this.position.x=a;this.position.y=b;this.node.translateTo(a,b)},initVelocity:function(a){this.velocity=a.copy();this.velocity.normalize()},initSpeedThreshold:function(a){this.speedThreshold=a},updatePosition:function(a,b){if(isNaN(a)){a=1}a+=this.speedThreshold;this._acceleration.x=b.x/this.mass;this._acceleration.y=b.y/this.mass;this.velocity.x+=this._acceleration.x*a;this.velocity.y+=this._acceleration.y*a;this.position.x+=this.velocity.x*a;this.position.y+=this.velocity.y*a;if(this.node!==null){this.node.translateTo(this.position.x,this.position.y)}this.age+=a;if(cgsgExist(this.checkCTL)){this.isAlive=this.checkCTL(this)}return this.isAlive}});var CGSGParticleEmitter=CGSGNode.extend({initialize:function(a,g,b,e,h,f,c,d){this._super(g.position.x,g.position.y);this.resizeTo(g.dimension.width,g.dimension.height);this.classType="CGSGParticleEmitter";this._nodeContructor=a;this.region=g;this.nbParticlesMax=b;this.velocity=new CGSGVector2D(0,0);if(cgsgExist(e)){this.velocity=e}this.angle=Math.PI/5;if(cgsgExist(h)){this.angle=h}this.speed=1;if(cgsgExist(f)){this.speed=f}this.speedThreshold=1;if(cgsgExist(c)){this.speedThreshold=c}this.outflow=0;if(cgsgExist(d)){this.outflow=d}this._currentFrame=this.outflow;this._particles=[];this._isPlaying=false;this._forces=[];this._acceleration=new CGSGVector2D(0,0);this.gravity=this.addForce(new CGSGVector2D(0,9.81),null);this.onUpdateParticleEnd=null;this.onInitParticle=null;this.onInitParticlesEnd=null},start:function(){this._isPlaying=true},stop:function(){this._isPlaying=false},reset:function(){var a;this._currentFrame=0;for(a=this._particles.length-1;a>=0;a--){this.removeChild(this._particles[a].node,true);delete (this._particles[a])}this._particles.clear()},render:function(a){var b,c;this.beforeRender(a);this._acceleration.initialize(0,0);for(b=this._forces.length-1;b>=0;b--){this._acceleration.x+=this._forces[b].vector.x;this._acceleration.y+=this._forces[b].vector.y;if(this._forces[b].ctl!==null){this._forces[b].age++;if(this._forces[b].age>=this._forces[b].ctl){this.removeForce(this._forces[b])}}}for(c=0;c<this._particles.length;c++){if(this._isPlaying){if(!this._particles[c].isAlive||!this.updateParticle(this._particles[c])){this.initParticle(this._particles[c],c)}}this._particles[c].node.render(a)}if(this._particles.length<this.nbParticlesMax){this._currentFrame++;if(this._currentFrame>=this.outflow){this._currentFrame=0;this._createParticle(this._particles.length)}}a.restore()},_createParticle:function(a){var b=this._nodeContructor();var c=new CGSGParticle(b);this.initParticle(c,a);this.addChild(c.node);this._particles.push(c)},initParticle:function(d,b){d.init();d.initPosition(Math.random()*this.region.dimension.width,Math.random()*this.region.dimension.height);var c=this.velocity.copy();var a=this.angle/2;c.rotate(-a+Math.random()*this.angle);d.initVelocity(c);d.initSpeedThreshold(-this.speedThreshold+Math.random()*this.speedThreshold*2);if(this.onInitParticle!==null){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_INIT_PARTICLE,new CGSGEvent(this,{index:b,particle:d}))}},updateParticle:function(b){var a=b.updatePosition(this.speed,this._acceleration);this.onUpdateParticleEnd&&CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_UPDATE_PARTICLE_END,new CGSGEvent(this,{particle:b}));return a},addForce:function(b,a){var c={vector:b,ctl:a,age:0};this._forces.push(c);return c},removeForce:function(a){this._forces.without(a)}});var CGSGParticleSystem=CGSGNode.extend({initialize:function(a,b){this._super(a,b);this.classType="CGSGParticleSystem";this.emitters=[];this.attractors=[];this.repulsors=[];this.isClickable=false;this.isResizable=false;this.isDraggable=false;this.isTraversable=false},addForce:function(a){for(var b=0;b<this.emitters.length;b++){this.emitters[b].addForce(a)}},addEmitter:function(f,i,b,h,g,e,d,c){var a=new CGSGParticleEmitter(f,i,b,h,g,e,d,c);this.addChild(a);this.emitters.push(a);return a},removeEmitter:function(a){this.emitters.without(a);this.removeChild(a,true)},addAttractor:function(a,c,d){var b={position:a,strength:c,distance:d};this.attractors.push(b);return b},removeAttractor:function(a){this.attractors.without(a)},addRepulsor:function(a,c,d){var b={position:a,strength:c,distance:d};this.repulsors.push(b);return b},removeRepulsor:function(a){this.repulsors.without(a)},pickNode:function(e,b,a,c,d){return null},copy:function(){var a=new CGSGParticleSystem();a=this._super(a);return a}});var CGSGSceneGraph=CGSGObject.extend({initialize:function(a,b){this.root=null;this.context=b;this._nextNodeID=1;this.ghostCanvas=document.createElement("canvas");this.initializeGhost(a.width,a.height);CGSG.canvas.onselectstart=function(){return false}},initializeGhost:function(a,b){this.ghostCanvas.height=b;this.ghostCanvas.width=a;CGSG.ghostContext=this.ghostCanvas.getContext("2d")},invalidateTheme:function(){this._invalidateThemeRecursive(this.root)},_invalidateThemeRecursive:function(c){if(cgsgExist(c)){c.invalidateTheme();for(var b=0,a=c.children.length;b<a;++b){this._invalidateThemeRecursive(c.children[b])}}},render:function(){cgsgClearContext(this.context);if(cgsgExist(this.root)){var f=null;var e,a;var d=null;if(CGSG.animationManager.listTimelines.length>0){f=null;var g,b;for(e=CGSG.animationManager.listTimelines.length-1;e>=0;--e){b=CGSG.animationManager.listTimelines[e];f=b.parentNode;if(f.isVisible){g=b.getValue(CGSG.currentFrame);if(g!==undefined){f.evalSet(b.attribute,g);if(b.onAnimate!==null){CGSG.eventManager.dispatch(b,cgsgEventTypes.ON_ANIMATE,new CGSGEvent(this,{node:f,attribute:b.attribute,value:g}))}}d=b.getFirstKey();if(d!==null&&d.frame==CGSG.currentFrame&&b.onAnimationStart!==null){a=new CGSGEvent(this,{node:f});a.node=f;CGSG.eventManager.dispatch(b,cgsgEventTypes.ON_ANIMATION_START,a)}d=b.getLastKey();if(d!==null&&d.frame==CGSG.currentFrame){b.removeAll();if(b.onAnimationEnd!==null){a=new CGSGEvent(this,{node:f});a.node=f;a.attribute=b.attribute;CGSG.eventManager.dispatch(b,cgsgEventTypes.ON_ANIMATION_END,a)}}}}}this.context.save();this.context.scale(CGSG.displayRatio.x,CGSG.displayRatio.y);if(this.root.isVisible){this.root.doRender(this.context)}this.context.restore()}if(CGSG.isBoundingBoxOnTop&&CGSG.selectedNodes.length>0){for(e=CGSG.selectedNodes.length-1;e>=0;e--){f=CGSG.selectedNodes[e];if(f.isVisible){f.computeAbsoluteMatrix(true);this.context.save();this.context.scale(CGSG.displayRatio.x,CGSG.displayRatio.y);var h=f;var c=h.getAbsolutePosition();this.context.translate(c.x,c.y);if(cgsgExist(f.rotationCenter)){this.context.translate(f.dimension.width*f.rotationCenter.x,f.dimension.height*f.rotationCenter.y);this.context.rotate(f.rotation.angle);this.context.translate(-f.dimension.width*f.rotationCenter.x,-f.dimension.height*f.rotationCenter.y)}else{this.context.rotate(f.rotation.angle)}this.context.scale(f._absSca.x,f._absSca.y);f.renderBoundingBox(this.context);this.context.restore()}}}CGSG.currentFrame++},setCanvasDimension:function(a){this.initializeGhost(a.width,a.height)},selectNode:function(a){if(!a.isSelected){a.setSelected(true);a.computeAbsoluteMatrix(false);CGSG.selectedNodes[CGSG.selectedNodes.length]=a}},deselectNode:function(a){a.setSelected(false);CGSG.selectedNodes.without(a)},deselectAll:function(b){var c=null;for(var a=CGSG.selectedNodes.length-1;a>=0;a--){c=CGSG.selectedNodes[a];if(!cgsgExist(b)||!b.contains(c)){this.deselectNode(c)}}CGSG.selectedNodes.clear()},pickNode:function(b,a){cgsgClearContext(CGSG.ghostContext);if(!cgsgExist(this.root)){return null}else{return this.root.pickNode(b.copy(),new CGSGScale(1,1),CGSG.ghostContext,true,a)}},pickNodes:function(a,b){cgsgClearContext(CGSG.ghostContext);if(!cgsgExist(this.root)){return null}else{return this.root.pickNodes(a.copy(),new CGSGScale(1,1),CGSG.ghostContext,true,b)}},removeNode:function(a){if(cgsgExist(a)){this.deselectNode(a);if(this.root!==null){return this.root.removeChild(a,true)}}return false},addNode:function(b,a){b._id=this._nextNodeID++;if(this.root===null){this.root=b}else{if(a===null){a=this.root}a.addChild(b)}}});"use strict";var cgsgGlobalRenderingTimer=null;(function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!window.requestAnimationFrame;++a){window.requestAnimationFrame=window[c[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[c[a]+"CancelAnimationFrame"]||window[c[a]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(g,e){var d=new Date().getTime();var f=Math.max(0,17-(d-b));cgsgGlobalRenderingTimer=window.setTimeout(function(){g(d+f)},f);b=d+f}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(d){clearTimeout(d)}}}());var CGSGView=CGSGObject.extend({initialize:function(a){cgsgDetectCurrentExplorer();if(typeof a.style.msTouchAction!="undefined"){a.style.msTouchAction="none"}CGSG.canvas=a;CGSG.context=CGSG.canvas.getContext("2d");this.allowMultiSelect=true;this.dragSelectFillColor=null;this.dragSelectStrokeColor=null;this.dragSelectStrokeWidth=null;this.dragSelectAlpha=CGSG_DEFAULT_DRAG_SELECT_ALPHA;this.dblBuffer=true;if(this.dblBuffer){this._updateDblBuffer();CGSG.sceneGraph=new CGSGSceneGraph(CGSG.canvas,this._cacheCtx)}else{CGSG.sceneGraph=new CGSGSceneGraph(CGSG.canvas,CGSG.context)}this._isRunning=false;this._needRedraw=true;this._frameContainer=null;this._keyDownedCtrl=false;this._timerDblTouch=null;this.dblTouchDelay=CGSG_DEFAULT_DBLTOUCH_DELAY;this._mousePos=[];this._mouseOldPosition=[];this._dragStartPos=[];this._dragEndPos=[];this._isDrag=false;this._isResizeDrag=false;this._isDragSelect=false;this._resizingDirection=-1;this._isDblClick=false;this._mouseUpCount=0;this._timeoutDblClick=null;this._isPressing=false;this._listCursors=["nw-resize","n-resize","ne-resize","w-resize","e-resize","sw-resize","s-resize","se-resize"];this._offsetX=0;this._offsetY=0;this._selectedNode=null;var b=this;CGSG.canvas.onmouseout=function(c){b.onMouseOutHandler(c)};CGSG.canvas.onmousedown=function(c){b.onMouseDown(c)};CGSG.canvas.onmouseup=function(c){b.onMouseUp(c)};CGSG.canvas.ondblclick=function(c){b.onMouseDblClick(c)};CGSG.canvas.onmousemove=function(c){b.onMouseMove(c)};document.onkeydown=function(c){b.onKeyDownHandler(c)};document.onkeyup=function(c){b.onKeyUpHandler(c)};CGSG.canvas.addEventListener("touchstart",function(c){b.onTouchStart(c)},false);CGSG.canvas.addEventListener("touchmove",function(c){b.onTouchMove(c)},false);CGSG.canvas.addEventListener("touchend",function(c){b.onTouchEnd(c)},false);CGSG.canvas.addEventListener("MSPointerDown",function(c){b.onTouchStart(c)},false);CGSG.canvas.addEventListener("MSPointerMove",function(c){b.onTouchMove(c)},false);CGSG.canvas.addEventListener("MSPointerUp",function(c){b.onTouchEnd(c)},false);this._lastUpdate=new Date().getTime();this._nodeMouseOver=null;this.onSceneClickStart=null;this.onSceneClickEnd=null;this.onSceneDblClickStart=null;this.onSceneDblClickEnd=null;this.onRenderStart=null;this.onRenderEnd=null;this.onSceneAverageFpsChanged=null;CGSG.currentFrame=0;this._fpss=null;this._r={x:0,y:0};this._d={dW:0,dH:0};this.invalidateTheme()},_updateDblBuffer:function(){if(!cgsgExist(this._cacheCanvas)){this._cacheCanvas=document.createElement("canvas");this._cacheCtx=this._cacheCanvas.getContext("2d")}this._cacheCanvas.width=CGSG.canvas.width;this._cacheCanvas.height=CGSG.canvas.height;cgsgClearContext(this._cacheCtx)},setCanvasDimension:function(a){CGSG.canvas.width=a.width;CGSG.canvas.height=a.height;CGSG.sceneGraph.setCanvasDimension(a);this._updateDblBuffer()},deleteSelected:function(){if(CGSG.selectedNodes.length>0){cgsgIterateReverse(CGSG.selectedNodes,(function(a,b){this._selectedNode=CGSG.selectedNodes[a];CGSG.sceneGraph.removeNode(this._selectedNode,true)}).bind(this))}},deselectAll:function(a){this._isDrag=false;this._isResizeDrag=false;this._resizingDirection=-1;CGSG.sceneGraph.deselectAll(a);this.invalidateTransformation()},render:function(){if(this._isRunning&&this._needRedraw){if(this.onRenderStart!==null){var b=new CGSGEvent(this,null);CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_RENDER_START,b)}if(this.dblBuffer){cgsgClearContext(CGSG.context);CGSG.context.drawImage(this._cacheCanvas,0,0)}CGSG.sceneGraph.render();if(this._dragStartPos.length>0&&this._dragEndPos.length>0){var e=this._dragStartPos[0];var d=this._dragEndPos[0];var c=d.x-e.x,a=d.y-e.y;CGSG.sceneGraph.context.save();CGSG.sceneGraph.context.scale(CGSG.displayRatio.x,CGSG.displayRatio.y);CGSG.sceneGraph.context.strokeStyle=this.dragSelectStrokeColor;CGSG.sceneGraph.context.fillStyle=this.dragSelectFillColor;CGSG.sceneGraph.context.lineWidth=this.dragSelectStrokeWidth;CGSG.sceneGraph.context.globalAlpha=this.dragSelectAlpha;CGSG.sceneGraph.context.fillRect(e.x,e.y,c,a);CGSG.sceneGraph.context.strokeRect(e.x,e.y,c,a);CGSG.sceneGraph.context.restore()}if(this.onRenderEnd!==null){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_RENDER_END,new CGSGEvent(this,null))}}this._updateFramerate();this._updateFramerateContainer()},startPlaying:function(){var a=this.startPlaying.bind(this);window.requestAnimationFrame(a);this._isRunning=true;this.render()},stopPlaying:function(){window.cancelAnimationFrame(cgsgGlobalRenderingTimer);this._isRunning=false},invalidateTransformation:function(){this._needRedraw=true},invalidateTheme:function(){CGSG.cssManager.invalidateCache();this.dragSelectFillColor=CGSG.cssManager.getAttr("cgsg-selectionBox","background-color");this.dragSelectStrokeColor=CGSG.cssManager.getAttr("cgsg-selectionBox","border-color");this.dragSelectStrokeWidth=CGSG.cssManager.getAttr("cgsg-selectionBox","border-width");this.dragSelectAlpha=CGSG.cssManager.getAttr("cgsg-selectionBox","opacity");CGSG.sceneGraph.invalidateTheme()},_updateFramerate:function(){if(!cgsgExist(this._fpss)){this._fpss=[];this.currentFps=0}var a=new Date().getTime();var b=(a-this._lastUpdate);if(!isNaN(CGSG.maxFramerate)){while((1000/b)>CGSG.maxFramerate){a=new Date().getTime();b=(a-this._lastUpdate)}}this._fpss[this.currentFps++]=1000/b;if(this.currentFps==CGSG.framerateDelay){this.currentFps=0;CGSG.fps=this._fpss.average();if(this.onSceneAverageFpsChanged!==null){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_SCENE_AVERAGE_FPS_CHANGED,new CGSGEvent(this,{fps:CGSG.fps}))}}this._lastUpdate=a},_updateFramerateContainer:function(){if(this._frameContainer!==null){this._frameContainer.innerHTML=Math.round(CGSG.fps)}},showFPS:function(a){this._frameContainer=a},setDisplayRatio:function(a){CGSG.displayRatio=a;CGSG.sceneGraph.initializeGhost(CGSG.canvas.width/CGSG.displayRatio.x,CGSG.canvas.height/CGSG.displayRatio.y)},onMouseOutHandler:function(a){this._isPressing=false},onMouseDown:function(a){this.onTouchStart(a)},onTouchStart:function(a){this._isPressing=true;if(cgsgExist(this._mousePos)){this._mouseOldPosition=this._mousePos.copy()}this._mousePos=cgsgGetCursorPositions(a,CGSG.canvas);this._selectedNode=CGSG.sceneGraph.pickNode(this._mousePos[0],null);if(cgsgExist(this._selectedNode)){if(this._selectedNode.onClickStart){CGSG.eventManager.dispatch(this._selectedNode,cgsgEventTypes.ON_CLICK_START,new CGSGEvent(this,{nativeEvent:a,position:this._mousePos}))}this._mouseOldPosition=this._mousePos.copy()}this._updateSelection(a)},_updateSelection:function(d){var b=cgsgExist(this._selectedNode)&&(this._selectedNode.isClickable||this._selectedNode.isDraggable||this._selectedNode.isResizable);if(b){if(this._selectedNode.isDraggable||this._selectedNode.isResizable){if(this.allowMultiSelect&&this._keyDownedCtrl){if(!this._selectedNode.isSelected){CGSG.sceneGraph.selectNode(this._selectedNode)}else{CGSG.sceneGraph.deselectNode(this._selectedNode)}}else{if(!this._selectedNode.isSelected){this.deselectAll(null);CGSG.sceneGraph.selectNode(this._selectedNode)}}this._isDrag=!this._detectResizeMode(this._mousePos[0]);this.invalidateTransformation()}}else{this.deselectAll(null)}var a=this._canStartDragSelection(d);if(!cgsgExist(a)){a=!b}if(this.allowMultiSelect&&a){var c=cgsgGetCursorPositions(d,CGSG.canvas);this._isDragSelect=true;this._dragStartPos=c;this._dragEndPos=c;this.deselectAll(null)}},_canStartDragSelection:function(a){},_dispatchClick:function(a){if(cgsgExist(this._selectedNode)&&this._selectedNode.isClickable){if(!this._isDblClick&&cgsgExist(this._selectedNode.onClick)){a.data.node=this._selectedNode;a.data.positions=this._mousePos.copy();CGSG.eventManager.dispatch(this._selectedNode,cgsgEventTypes.ON_CLICK,a)}if(this._selectedNode.isDraggable===false&&this._selectedNode.isResizable===false){this.deselectAll([this._selectedNode])}}},_clickOnScene:function(a,b){this._mousePos=cgsgGetCursorPositions(a.data.nativeEvent,CGSG.canvas);if(this.onSceneClickStart!==null){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_SCENE_CLICK_START,new CGSGEvent(this,{nativeEvent:a,positions:this._mousePos}))}if(b){this._selectedNode=CGSG.sceneGraph.pickNode(this._mousePos[0],function(c){return(c.isTraversable===true&&(c.isClickable===true||c.isDraggable===true||c.isResizable===true))})}this._dispatchClick(a);if(this.onSceneClickEnd!==null){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_SCENE_CLICK_END,new CGSGEvent(this,{nativeEvent:a,positions:this._mousePos}))}},onMouseMove:function(a){this._moveOnScene(a)},onTouchMove:function(a){if(a.preventManipulation){a.preventManipulation()}a.preventDefault();a.stopPropagation();this._moveOnScene(a)},_moveOnScene:function(f){var d,j,h;this._mousePos=cgsgGetCursorPositions(f,CGSG.canvas);var k=this._selectedNode;this._selectedNode=null;if(this._isPressing&&this._isDrag){if(CGSG.selectedNodes.length>0){var b=this._mousePos[0];var c=this._mouseOldPosition[0];this._offsetX=b.x-c.x;this._offsetY=b.y-c.y;for(d=CGSG.selectedNodes.length-1;d>=0;d--){this._selectedNode=CGSG.selectedNodes[d];if(this._selectedNode!==null&&this._selectedNode.isDraggable){this._selectedNode.isMoving=true;j=this._offsetX/(this._selectedNode._absSca.x/this._selectedNode.scale.x);h=this._offsetY/(this._selectedNode._absSca.y/this._selectedNode.scale.y);if(this._canMove(this._selectedNode,j,h,0,0)){this._selectedNode.translateWith(j,h);if(this._selectedNode.onDrag!==null){var g=new CGSGEvent(this,{node:this._selectedNode,positions:this._mousePos.copy(),nativeEvent:f});CGSG.eventManager.dispatch(this._selectedNode,cgsgEventTypes.ON_DRAG,g)}}}}this._mouseOldPosition=this._mousePos.copy();this.invalidateTransformation()}}else{if(this._isPressing&&this._isResizeDrag){if(CGSG.selectedNodes.length>0){var b=this._mousePos[0];var c=this._mouseOldPosition[0];this._offsetX=b.x-c.x;this._offsetY=b.y-c.y;cgsgIterateReverse(CGSG.selectedNodes,(function(n,o){this._selectedNode=o;if(this._selectedNode.isResizable){this._selectedNode.isResizing=true;j=this._offsetX/this._selectedNode._absSca.x;h=this._offsetY/this._selectedNode._absSca.y;var p=Math.max(j,h);if(p==0){p=Math.min(j,h)}var m=this._selectedNode.dimension.width*this._selectedNode._absSca.x;var l=this._selectedNode.dimension.height*this._selectedNode._absSca.y;switch(this._resizingDirection){case 0:if(this._selectedNode.isProportionalResize){this._d=this._getDeltaOnMove(p,j,h,m,l,-1,-1);this._r.x=this._d.dW;this._r.y=this._d.dH;this._d.dW=-this._d.dW;this._d.dH=-this._d.dH}else{this._d.dW=j*this._selectedNode.scale.x;this._d.dH=h*this._selectedNode.scale.y;this._r.x=-j;this._r.y=-h}break;case 1:this._d.dW=0;this._d.dH=h*this._selectedNode.scale.y;this._r.x=0;this._r.y=-h;break;case 2:if(this._selectedNode.isProportionalResize){this._d=this._getDeltaOnMove(p,j,h,m,l,1,-1);this._r.x=this._d.dW;this._r.y=this._d.dH;this._d.dW=0;this._d.dH=-this._d.dH}else{this._d.dW=0;this._d.dH=h*this._selectedNode.scale.y;this._r.x=j;this._r.y=-h}break;case 3:this._d.dW=j*this._selectedNode.scale.x;this._d.dH=0;this._r.x=-j;this._r.y=0;break;case 4:this._d.dW=0;this._d.dH=0;this._r.x=j;this._r.y=0;break;case 5:if(this._selectedNode.isProportionalResize){this._d=this._getDeltaOnMove(p,j,h,m,l,1,-1);this._r.x=-this._d.dW;this._r.y=-this._d.dH;this._d.dH=0}else{this._d.dW=j*this._selectedNode.scale.x;this._d.dH=0;this._r.x=-j;this._r.y=h}break;case 6:this._d.dW=0;this._d.dH=0;this._r.x=0;this._r.y=h;break;case 7:if(this._selectedNode.isProportionalResize){this._d=this._getDeltaOnMove(p,j,h,m,l,1,1);this._r.x=this._d.dW;this._r.y=this._d.dH;this._d.dW=0;this._d.dH=0}else{this._d.dW=0;this._d.dH=0;this._r.x=j;this._r.y=h}break}if(this._canMove(this._selectedNode,this._d.dW,this._d.dH,this._r.x,this._r.y)){this._selectedNode.translateWith(this._d.dW,this._d.dH,false);this._selectedNode.resizeWith(this._r.x,this._r.y,false);this._selectedNode.computeAbsoluteMatrix(false);if(this._selectedNode.onResize!==null){var e=new CGSGEvent(this,{node:this._selectedNode,positions:this._mousePos.copy(),e:f});CGSG.eventManager.dispatch(this._selectedNode,cgsgEventTypes.ON_RESIZE,e)}}}}).bind(this))}this._mouseOldPosition=this._mousePos.copy();this.invalidateTransformation()}else{if(CGSG.selectedNodes.length>0){if(this._detectResizeMode(this._mousePos[0])){return}else{this._resizingDirection=-1;CGSG.canvas.style.cursor="auto";this.invalidateTransformation()}}else{if(this._isDragSelect){this._dragEndPos=this._mousePos.copy();this.invalidateTransformation()}}}}if(!this._isDrag&&!this._isResizeDrag){var a=null;if(cgsgExist(this._nodeMouseOver)){a=this._nodeMouseOver.pickNode(this._mousePos[0],null,CGSG.ghostContext,false,null);if(a===null){this._nodeMouseOver.isMouseOver=false;if(cgsgExist(this._nodeMouseOver.onMouseOut)){var g=new CGSGEvent(this,{node:this._nodeMouseOver,positions:this._mousePos.copy(),e:f});CGSG.eventManager.dispatch(this._nodeMouseOver,cgsgEventTypes.ON_MOUSE_OUT,g)}this._nodeMouseOver=null}else{if(a===this._nodeMouseOver){if(cgsgExist(this._nodeMouseOver.onMouseOver)){var g=new CGSGEvent(this,{node:this._nodeMouseOver,positions:this._mousePos.copy(),e:f});CGSG.eventManager.dispatch(this._nodeMouseOver,cgsgEventTypes.ON_MOUSE_OVER,g)}}}}if(a===null){if((a=CGSG.sceneGraph.pickNode(this._mousePos[0],function(e){return(e.onMouseEnter!==null||e.onMouseOver!==null)}))!==null){a.isMouseOver=true;this._nodeMouseOver=a;this._nodeMouseOver.isMouseOver=true;if(cgsgExist(this._nodeMouseOver.onMouseEnter)){var g=new CGSGEvent(this,{node:this._nodeMouseOver,positions:this._mousePos.copy(),e:f});CGSG.eventManager.dispatch(this._nodeMouseOver,cgsgEventTypes.ON_MOUSE_ENTER,g)}}}}this._selectedNode=k},_canMove:function(g,b,a,d,f){var c;if(g.nodeConstraint!==null){c=g.nodeConstraint.getAbsoluteRegion()}else{c=g.regionConstraint}if(c!==null){var e=g.getAbsoluteRegion();e.position.x+=b;e.position.y+=a;e.dimension.width+=d;e.dimension.height+=f;if(!cgsgRegionIsInRegion(e,c,0)){return false}}return true},_detectResizeMode:function(b){var a=this._selectedNode;cgsgIterateReverse(CGSG.selectedNodes,(function(c,e){this._selectedNode=e;if(this._selectedNode.isResizable){for(var d=0;d<8;d++){if(e.isProportionalResizeOnly&&(d==1||d==3||d==4||d==6)){continue}var f=this._selectedNode.handles[d];this._isResizeDrag=f.checkIfSelected(b,CGSG.resizeHandleThreshold);if(this._isResizeDrag){this._resizingDirection=d;CGSG.canvas.style.cursor=this._listCursors[d];return false}}}}).bind(this));this._selectedNode=a;return this._isResizeDrag},_getDeltaOnMove:function(i,k,j,g,f,d,c){var e=k,b=j;var a=1;if(i==k){a=(g+d*i)/g;e=d*i;b=(a-1)*f}else{a=(f+c*i)/f;b=c*i;e=(a-1)*g}return{dW:e,dH:b}},onMouseUp:function(a){this.onTouchEnd(a)},onTouchEnd:function(a){if(a.preventManipulation){a.preventManipulation()}a.preventDefault();a.stopPropagation();this._isPressing=false;this._mouseUpCount++;if(cgsgExist(this._selectedNode)&&cgsgExist(this._selectedNode.onDblClick)){if(this._mouseUpCount>1){clearTimeout(this._timeoutDblClick);this._upAndDblClick(a)}else{this._timeoutDblClick=setTimeout((function(){this._upAndClick(a)}).bind(this),this.dblTouchDelay)}}else{this._upAndClick(a)}},_upAndClick:function(b){this._mouseUpCount=0;var a=this._upOnScene(b);a.nativeEvent=b;this._clickOnScene(new CGSGEvent(this,a),false)},_upAndDblClick:function(b){this._mouseUpCount=0;var a=this._upOnScene(b);a.nativeEvent=b;this._dblClickOnScene(new CGSGEvent(this,a),false)},_upOnScene:function(g){var f=this._selectedNode;var c=0;var b={};b.nativeEvent=g;var d=cgsgExist(f);b.hasMoved=d&&f.isMoving;b.hasResize=d&&f.isResizing;if(this._isDrag){cgsgIterateReverse(CGSG.selectedNodes,(function(h,j){this._selectedNode=j;if(this._selectedNode.isMoving){this._selectedNode.isMoving=false;this._selectedNode.computeAbsoluteMatrix(true);if(this._selectedNode.onDragEnd!==null){var e=new CGSGEvent(this,{node:this._selectedNode,positions:this._mousePos.copy(),nativeEvent:g});CGSG.eventManager.dispatch(this._selectedNode,cgsgEventTypes.ON_DRAG_END,e)}}}).bind(this));this._isDrag=false}else{if(this._isResizeDrag){cgsgIterateReverse(CGSG.selectedNodes,(function(h,j){this._selectedNode=j;if(this._selectedNode.isResizing){this._selectedNode.isResizing=false;this._selectedNode.computeAbsoluteMatrix(true);if(this._selectedNode.onResizeEnd!==null){var e=new CGSGEvent(this,{node:this._selectedNode,positions:this._mousePos.copy(),nativeEvent:g});CGSG.eventManager.dispatch(this._selectedNode,cgsgEventTypes.ON_RESIZE_END,e)}}}).bind(this));this._isResizeDrag=false}else{if(this._isDragSelect){this._isDragSelect=false;this._doDragSelect();this._dragStartPos=[];this._dragEndPos=[];this.invalidateTransformation()}else{this._selectedNode=CGSG.selectedNodes[CGSG.selectedNodes.length-1];if(cgsgExist(this._selectedNode)&&this._selectedNode.onMouseUp!==null){var a=new CGSGEvent(this,{node:this._selectedNode,positions:this._mousePos.copy(),e:g});CGSG.eventManager.dispatch(this._selectedNode,cgsgEventTypes.ON_MOUSE_UP,a)}}}}this._resizingDirection=-1;this._selectedNode=f;return b},_doDragSelect:function(){var h=this._dragStartPos[0];var g=this._dragEndPos[0];var d=g.x-h.x,c=g.y-h.y;if(d<0){d=Math.abs(d);h.x-=d}if(c<0){c=Math.abs(c);h.y-=c}var f=new CGSGRegion(h.x,h.y,d,c);var b=CGSG.sceneGraph.pickNodes(f,function(i){return(i.isTraversable===true&&(i.isDraggable===true||i.isResizable===true))});for(var e=0,a=b.length;e<a;++e){CGSG.sceneGraph.selectNode(b[e])}},onMouseDblClick:function(a){a.preventDefault();a.stopPropagation()},_dblClickOnScene:function(b,a){if(this.onSceneDblClickStart!==null){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_SCENE_DBL_CLICK_START,b)}if(a){this._selectedNode=CGSG.sceneGraph.pickNode(this._mousePos[0],function(c){return true})}if(cgsgExist(this._selectedNode)&&this._selectedNode.onDblClick!==null){b.data.node=this._selectedNode;b.data.positions=this._mousePos.copy();CGSG.eventManager.dispatch(this._selectedNode,cgsgEventTypes.ON_DBL_CLICK,b)}else{if(this.onSceneDblClickEnd!==null){CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_SCENE_DBL_CLICK_END,b)}}return this._selectedNode},onKeyDownHandler:function(a){var b=(window.e)?a.keyCode:a.which;switch(b){case 17:this._keyDownedCtrl=true;break}return b},onKeyUpHandler:function(a){var b=(window.e)?a.keyCode:a.which;switch(b){case 17:this._keyDownedCtrl=false;break}return b}});