"use strict";"use script";function cgsgIsArray(a){return"[object Array]"===Object.prototype.toString.call(a)}function cgsgExist(a){return"number"==typeof a?!isNaN(a)&&isFinite(a):null!==a&&void 0!==a}function cgsgDetectCurrentExplorer(){cgsgCurrentExplorer=cgsgExplorerParams.UNKNOWN;var a,b,c=navigator.userAgent,d=navigator.appName,e=""+parseFloat(navigator.appVersion);-1!==(b=c.indexOf("Opera"))?(cgsgCurrentExplorer=cgsgExplorerParams.OPERA,e=c.substring(b+6),-1!==(b=c.indexOf("Version"))&&(e=c.substring(b+8))):-1!==(b=c.indexOf("MSIE"))?(d="Microsoft Internet Explorer",cgsgCurrentExplorer=cgsgExplorerParams.IE9,e=c.substring(b+5),parseInt(e)>=10&&(cgsgCurrentExplorer=cgsgExplorerParams.IE10)):-1!==(b=c.indexOf("Chrome"))?(cgsgCurrentExplorer=cgsgExplorerParams.CHROME,e=c.substring(b+7)):-1!==(b=c.indexOf("Safari"))?(cgsgCurrentExplorer=cgsgExplorerParams.SAFARI,e=c.substring(b+7),-1!==(b=c.indexOf("Version"))&&(e=c.substring(b+8))):-1!==(b=c.indexOf("Firefox"))?(cgsgCurrentExplorer=cgsgExplorerParams.FIREFOX,e=c.substring(b+8)):(a=c.lastIndexOf(" ")+1)<(b=c.lastIndexOf("/"))&&(d=c.substring(a,b),e=c.substring(b+1),d.toLowerCase()===d.toUpperCase()&&(d=navigator.appName)),cgsgCurrentExplorer.fullVersion=e,cgsgCurrentExplorer.browserName=d,cgsgCurrentExplorer.webworker="undefined"!=typeof Worker}function cgsgGetRealViewportDimension(){var a=window,b="inner";return"innerWidth"in window||(b="client",a=document.documentElement||document.body),new CGSGDimension(a[b+"Width"],a[b+"Height"])}function cgsgGetDisplayedViewportDimension(){var a=cgsgGetRealViewportDimension();return new CGSGDimension(Math.round(a.width/CGSG.displayRatio.x),Math.round(a.height/CGSG.displayRatio.y))}function cgsgPointIsInRegion(a,b,c){return a.x>=b.position.x-c&&a.y>=b.position.y-c&&a.x<=b.position.x+b.dimension.width+c&&a.y<=b.position.y+b.dimension.height+c}function cgsgRegionIsInRegion(a,b,c){return a.position.x>=b.position.x-c&&a.position.y>=b.position.y-c&&a.position.x+a.dimension.width<=b.position.x+b.dimension.width+c&&a.position.y+a.dimension.height<=b.position.y+b.dimension.height+c}function cgsgGetCursorPositions(a,b){var c=b,d=0,e=0,f=[];if(c.offsetParent)do d+=c.offsetLeft,e+=c.offsetTop;while(c=c.offsetParent);d+=cgsgStylePaddingLeft,e+=cgsgStylePaddingTop,d+=cgsgStyleBorderLeft,e+=cgsgStyleBorderTop;var g=a;if(a.targetTouches)for(var h="undefined"!=typeof a.targetTouches?a.targetTouches:[a],i=0;i<h.length;i++)g=h[i],f.push(new CGSGPosition((g.pageX-d)/CGSG.displayRatio.x,(g.pageY-e)/CGSG.displayRatio.y));else f.push(new CGSGPosition((g.pageX-d)/CGSG.displayRatio.x,(g.pageY-e)/CGSG.displayRatio.y));return f}function cgsgClearContext(a){a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,CGSG.canvas.width,CGSG.canvas.height)}function cgsgIterate(a,b){for(var c=0,d=a.length;d>c&&b(c,a[c++])!==!1;);}function cgsgIterateReverse(a,b){for(var c=a.length-1;c>=0&&b(c,a[c--])!==!1;);}function cgsgFree(a){cgsgExist(a.onFreeEvent)&&CGSG.eventManager.dispatch(a,cgsgEventTypes.ON_FREE,new CGSGEvent(this,null)),a=null}Array.prototype.first=function(){return this.length>0?this[0]:null},Array.prototype.last=function(){return this.length>0?this[this.length-1]:null},Array.prototype.without=function(a){for(var b=0;b<this.length;b++)this[b]===a&&this.splice(b,1)},Array.prototype.pop=function(){this.splice(this.length-1,1)},Array.prototype.clear=function(){this.length=0},Array.prototype.isEmpty=function(){return 0===this.length},Array.prototype.clone=function(){return this.slice(0)},Array.prototype.copy=function(){for(var a=[],b=0;b<this.length;b++)a.push(this[b].copy?this[b].copy():this[b]);return a},Array.prototype.contains=function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return!0;return!1},Array.prototype.unique=function(){var a,b=[];for(this.sort(),a=0;a<this.length;a++)this[a]!==this[a+1]&&(b[b.length]=this[a]);return b},Array.prototype.sum=function(){for(var a=0,b=0;b<this.length;b++)a+=parseInt(this[b]);return a},Array.prototype.average=function(){return this.sum()/this.length},String.prototype.without=function(a){return this.replace(a,"")},String.prototype.collapse=function(){for(var a=this.split("-"),b=a[0],c=1,d=a.length;d>c;c++)b+=a[c].capitalize();return b},String.prototype.addFirstDot=function(){return 0!==this.indexOf(".")?"."+this:this},String.prototype.capitalize=function(a){return(a?this.toLowerCase():this).replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase()})},function(){this.CGSGObject=null,this.CGSGObject=function(){};var a=!1,b=/xyz/.test(function(){})?/\b_super\b/:/.*/;CGSGObject.extend=function(c){function d(){!a&&this.initialize&&this.initialize.apply(this,arguments)}var e=this.prototype;a=!0;var f=new this;a=!1;for(var g in c)f[g]="function"==typeof c[g]&&"function"==typeof e[g]&&b.test(c[g])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);return this._super=c,d}}(g,c[g]):c[g];return d.prototype=f,d.prototype.constructor=d,d.extend=arguments.callee,d}}();var CGSGMap=CGSGObject.extend({initialize:function(){this._map={},this._map.keys=[],this._map.values=[]},getAt:function(a){return{key:this._map.keys[a],value:this._map.values[a]}},getValue:function(a){var b=this.getKeyIndex(a);return 0>b?null:this._map.values[b]},getValues:function(){return this._map.values.copy()},addOrReplace:function(a,b){var c=this.getKeyIndex(a);return c>=0?this._map.values[c]=b:(this._map.keys.push(a),this._map.values.push(b),c=this.getLength()),c},remove:function(a){if(this.containsKey(a)){var b=this.getKeyIndex(a);this._map.keys.splice(b,1),this._map.values.splice(b,1)}},removeAll:function(){this._map.keys.clear(),this._map.values.clear()},clone:function(){var a=new CGSGMap;return a._map.keys=this._map.keys.clone(),a._map.values=this._map.value.clone(),a},containsKey:function(a){return this._map.keys.contains(a)},getLength:function(){return this._map.keys.length},getKeyIndex:function(a){var b;for(b=0;b<this.getLength();b++)if(this._map.keys[b]===a)return b;return-1}}),CGSGColor={rgb2hex:function(a,b,c){return"#"+this._toHex(a)+this._toHex(b)+this._toHex(c)},hex2rgb:function(a){return a=this._withoutSharp(a),{r:parseInt(a.substring(0,2),16),g:parseInt(a.substring(2,4),16),b:parseInt(a.substring(4,6),16)}},_withoutSharp:function(a){return cgsgExist(a)?"#"===a.charAt(0)?a.substring(1,a.length):a:"000000"},_toHex:function(a){var b=parseInt(a,10);return isNaN(b)?"00":(b=Math.max(0,Math.min(b,255)),"0123456789ABCDEF".charAt((b-b%16)/16)+"0123456789ABCDEF".charAt(b%16))},fromString:function(a){var b=a.indexOf("(")+1,c=a.lastIndexOf(")"),d=a.substring(b,c),e=d.split(",");return{r:parseInt(e[0]),g:parseInt(e[1]),b:parseInt(e[2])}},lerp:function(a,b,c){var d=this.hex2rgb(a),e=this.hex2rgb(b),f=[];return f[0]=d.r+(e.r-d.r)*c,f[1]=d.g+(e.g-d.g)*c,f[2]=d.b+(e.b-d.b)*c,this.rgb2hex(f[0],f[1],f[2])},darkenHex:function(a,b){var c=this.hex2rgb(a);return c.r=this.multiplyComponent(c.r,b),c.g=this.multiplyComponent(c.g,b),c.b=this.multiplyComponent(c.b,b),this.rgb2hex(c.r,c.g,c.b)},darkenRGB:function(a,b,c,d){return{r:this.multiplyComponent(a,d),g:this.multiplyComponent(b,d),b:this.multiplyComponent(c,d)}},litRGB:function(a,b,c,d){var e=this.rgb2hsl(a,b,c);return e.l*=d,this.hsl2rgb(e.h,e.s,e.l)},multiplyComponent:function(a,b){return Math.max(Math.min(255,a*b),0)},rgb2hsv:function(a,b,c){var d,e;if(a/=255,b/=255,c/=255,d=Math.min(c,Math.min(a,b)),e=Math.max(c,Math.max(a,b)),e===d)return{h:0,s:0,v:d};var f=a===d?b-c:c===d?a-b:c-a,g=a===d?3:c===d?1:5,h=e-d;return{h:60*(g-f/h),s:h/e,v:e}},rgb2hsl:function(a,b,c){a/=255,b/=255,c/=255;var d,e,f=Math.max(a,b,c),g=Math.min(a,b,c),h=(f+g)/2;if(f===g)d=e=0;else{var i=f-g;switch(e=h>.5?i/(2-f-g):i/(f+g),f){case a:d=(b-c)/i+(c>b?6:0);break;case b:d=(c-a)/i+2;break;case c:d=(a-b)/i+4}d/=6}return{h:d,s:e,l:h}},hsl2rgb:function(a,b,c){var d,e,f;if(0===b)d=e=f=c;else{var g=.5>c?c*(1+b):c+b-c*b,h=2*c-g;d=this.hue2rgb(h,g,a+1/3),e=this.hue2rgb(h,g,a),f=this.hue2rgb(h,g,a-1/3)}return{r:255*d,g:255*e,b:255*f}},hue2rgb:function(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a},hsv2rgb:function(a,b,c){var d,e,f,g=Math.floor(6*a),h=6*a-g,i=c*(1-b),j=c*(1-h*b),k=c*(1-(1-h)*b);switch(g%6){case 0:d=c,e=k,f=i;break;case 1:d=j,e=c,f=i;break;case 2:d=i,e=c,f=k;break;case 3:d=i,e=j,f=c;break;case 4:d=k,e=i,f=c;break;case 5:d=c,e=i,f=j}return{r:255*d,g:255*e,b:255*f}}},CGSGVector2D=CGSGObject.extend({initialize:function(a,b){this.x=a,this.y=b},copy:function(){return new CGSGVector2D(this.x,this.y)},add:function(a){return new CGSGVector2D(this.x+a.x,this.y+a.y)},addEquals:function(a){this.x+=a.x,this.y+=a.y},subtract:function(a){return new CGSGVector2D(this.x-a.x,this.y-a.y)},subtractEquals:function(a){this.x-=a.x,this.y-=a.y},multiply:function(a){return new CGSGVector2D(this.x*a.x,this.y*a.y)},multiplyEquals:function(a){this.x*=a.x,this.y*=a.y},divide:function(a){return new CGSGVector2D(this.x/a.x,this.y/a.y)},divideEquals:function(a){this.x/=a.x,this.y/=a.y},multiplyByFloat:function(a){return new CGSGVector2D(this.x*a,this.y*a)},multiplyByFloatEquals:function(a){this.x*=a,this.y*=a},divideByFloat:function(a){return new CGSGVector2D(this.x/a,this.y/a)},divideByFloatEquals:function(a){this.x/=a,this.y/=a},getDistance:function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))},rotate:function(a){var b=Math.cos(a),c=Math.sin(a);this.x=this.x*b+this.y*c,this.y=this.x*c-this.y*b},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},getSquaredLength:function(){return this.x*this.x+this.y*this.y},normalize:function(){var a,b=this.getLength();1!==b&&0!==b&&(a=1/b,this.x*=a,this.y*=a)},sign:function(a){var b=this.perp();return b.dot(a)<0?-1:1},dot:function(a){return this.x*a.x+this.y*a.y},cross:function(a){return this.x*a.y-this.y*a.x},unit:function(){return this.divide(this.getLength())},unitFast:function(){var a=Math.abs(this.x),b=Math.abs(this.y),c=1/Math.max(a,b);return c*=1.29289-(a+b)*c*.29289,this.multiplyByFloat(c)},unitEquals:function(){this.divideEquals(this.getLength())},perp:function(){return new CGSGVector2D(-this.y,this.x)},perpendicular:function(a){return this.subtract(this.project(a))},project:function(a){var b=this.dot(a)/a.dot(a);return a.multiply(b)},toString:function(){return this.x+","+this.y}}),CGSGPosition=CGSGVector2D.extend({initialize:function(a,b){this._super(a,b)},equalsTo:function(a){return cgsgExist(a)&&a.x===this.x&&a.y===this.y},copy:function(){return new CGSGPosition(this.x,this.y)},translateTo:function(a,b){this.x=a,this.y=b},translateWith:function(a,b){this.x+=a,this.y+=b},translateBy:function(a,b){this.x*=a,this.y*=b},isNegative:function(){return this.x<0||this.y<0}}),CGSGScale=CGSGPosition.extend({initialize:function(a,b){this._super(a,b)}}),CGSGRotation=CGSGObject.extend({initialize:function(a){this.angle=a},copy:function(){return new CGSGRotation(this.angle)},rotateTo:function(a){this.angle=a},rotateBy:function(a){this.multiplyEquals(a)},rotateWith:function(a){this.addEquals(a)},addEquals:function(a){this.angle+=a},subtractEquals:function(a){this.angle-=a},multiplyEquals:function(a){this.angle*=a}}),CGSGDimension=CGSGVector2D.extend({initialize:function(a,b){this._super(a,b),this.width=this.x,this.height=this.y},copy:function(){return new CGSGDimension(this.width,this.height)},resizeTo:function(a,b){a>=0&&(this.width=a),b>=0&&(this.height=b)},resizeBy:function(a,b){a>=0&&(this.width*=a),b>=0&&(this.height*=b)},resizeWith:function(a,b){this.width+a>=0&&(this.width+=a),this.height+b>=0&&(this.height+=b)},isEmpty:function(){return this.width<=0||this.height<=0}}),CGSGRegion=CGSGObject.extend({initialize:function(a,b,c,d){this.position=new CGSGPosition(a,b),this.dimension=new CGSGDimension(c,d)},copy:function(){return new CGSGRegion(this.position.x,this.position.y,this.dimension.width,this.dimension.height)},addEquals:function(a){this.position.translateWith(a.position.x,a.position.y),this.dimension.resizeWith(a.dimension.width,a.dimension.height)},subtractEquals:function(a){this.position.translateWith(-a.position.x,-a.position.y),this.dimension.resizeWith(-a.dimension.width,-a.dimension.height)},isEmpty:function(){return this.dimension.isEmpty()},isNegative:function(){return this.isEmpty()||this.position.isNegative()}}),CGSG_DEFAULT_DISPLAYRATIO=new CGSGScale(1,1),CGSG_DEFAULT_DRAG_SELECT_FILL_COLOR="#C0C0C0",CGSG_DEFAULT_DRAG_SELECT_STROKE_COLOR="#808080",CGSG_DEFAULT_DRAG_SELECT_ALPHA=.6,CGSG_DEFAULT_SELECTED_RESIZEHANDLE_THRESHOLD=3,CGSG_DEFAULT_FRAMERATE_DELAY=20,CGSG_DEFAULT_MAX_FRAMERATE=0/0,CGSG_DEFAULT_DBLTOUCH_DELAY=250,CGSGTraverser=CGSGObject.extend({initialize:function(){this.lastResults=[]},traverse:function(a,b,c){return this.lastResults.clear(),cgsgExist(b)&&this._check(a,b,c),this.lastResults},_check:function(a,b,c){if(a.isTraversable===!0){var d=cgsgExist(c)&&c.length>0;d&&c.contains(a)||b(a)!==!0||this.lastResults.push(a);for(var e=a.children.length-1;e>=0;--e){var f=a.children[e];this._check(f,b,c)}}}}),CGSGImgManager=CGSGObject.extend({initialize:function(){this._mapURL=new CGSGMap},get:function(a){return this._mapURL.getValue(a)},set:function(a,b){this._mapURL.addOrReplace(a,b)}}),cgsgImgManager=new CGSGImgManager,CGSGEvent=CGSGObject.extend({initialize:function(a,b){this.trigger=a,this.data=b,this.observable=null,this.type=null,this.propagate=!0}}),CGSGBindEntry=CGSGObject.extend({initialize:function(a,b,c){this._observable=a,this._attributeName=b,this._isAdditional=c}}),CGSGEventManager=CGSGObject.extend({initialize:function(){this._handlerPropertyPrefix="cgsgEventManager_"+(new Date).getTime()+"_",this._table=new CGSGMap},replaceHandler:function(a,b){var c=a._observable;if(a._isAdditional){var d=this._table.getValue(a),e=c[a._attributeName].indexOf(d);-1!==e&&(c[a._attributeName][e]=b)}else c[a._attributeName]=b;this._table.addOrReplace(a,b)},bindHandler:function(a,b,c){var d,e=cgsgExist(a[b]);e?(d=this._getHandlerPropertyName(b),cgsgExist(a[d])?a[d].push(c):a[d]=[c]):(d=b,a[b]=c);var f=new CGSGBindEntry(a,d,e);return this._table.addOrReplace(f,c),f},dispatch:function(a,b,c){if(c.observable=a,c.type=b,cgsgExist(a[b])||console.log(b),a[b](c),c.propagate){var d=this._getHandlerPropertyName(b),e=a[d];cgsgExist(e)&&cgsgIterate(e,function(a,b){return b(c),c.propagate})}},unbindHandler:function(a,b,c){var d,e,f;if(a[b]===c)a[b]=null;else{var g=this._getHandlerPropertyName(b);d=a[g].indexOf(c),-1!==d&&a[g].slice(d,1)}for(d=0,e=this._table.getLength();e>d;d++)if(f=this._table.getAt(d),f.value===c){this._table.remove(f.key);break}},unbindAll:function(a,b){a[b]=null;var c=this._getHandlerPropertyName(b);cgsgExist(a[c])&&a[c].splice(0,a[c].length-1)},_getHandlerPropertyName:function(a){return this._handlerPropertyPrefix+a}}),CGSGCSSManager=CGSGObject.extend({initialize:function(){this.isLoaded=!1,this.onLoadEnd=null,this.onLoadError=null,this.onLoadAbort=null,this._classes=new CGSGMap,this._blacklist=[]},getAttr:function(a,b){a=a.addFirstDot();var c=this._classes.getValue(a);if(cgsgExist(c)){var d=c[b.collapse()];if(cgsgExist(d)&&d.length>0)return d}return null},getAttrInArray:function(a,b){var c,d,e,f=a.length;for(c=f-1;c>=0;--c)if(d=a[c],e=this.getAttr(d,b),cgsgExist(e))return e;return null},getCls:function(a){return a=a.addFirstDot(),this._classes.getValue(a)},getURL:function(a){if(!cgsgExist(a)||0===a.length)return null;var b=a.without("url(");return b=b.without(")")},getNumber:function(a){return cgsgExist(a)&&0!==a.length?(a=this._cleanAttr(a),parseInt(a)):0/0},getFloat:function(a){return cgsgExist(a)&&0!==a.length?(a=this._cleanAttr(a),parseFloat(a)):null},_cleanAttr:function(a){var b=/px|pt/gi;return a=a.replace(b,""),a.trim(),a},invalidateCache:function(){this._classes.removeAll();for(var a,b,c=document.styleSheets.length,d=0;c>d;d++)if(!this._blacklist.contains(document.styleSheets[d].href)){var e=document.styleSheets[d].rules||document.styleSheets[d].cssRules;if(cgsgExist(e))for(b=0,a=e.length;a>b;b++)this._classes.addOrReplace(e[b].selectorText,e[b].style);else console.log("WARNING: '"+document.styleSheets[d].href+"' file without class. Be sure application is running under a web server and CSS file is correctly loaded.")}},loadCSSFile:function(a){this.isLoaded=!1,this._url=a;var b=document.getElementsByTagName("head")[0],c=document.createElement("link");c.onload=this._createDelegate(this,this._onFileLoaded),c.onerror=this._createDelegate(this,this._onFileError),c.onabort=this._createDelegate(this,this._onFileAbort),c.type="text/css",c.rel="stylesheet",c.media="screen",c.href=a,b.appendChild(c)},unloadCSSFile:function(a){for(var b="href",c=document.getElementsByTagName("link"),d=c.length;d>=0;d--)c[d]&&null!==c[d].getAttribute(b)&&-1!==c[d].getAttribute(b).indexOf(a)&&c[d].parentNode.removeChild(c[d])},ignoreCSSFile:function(a){this._blacklist.push(a)},_createDelegate:function(a,b){return function(){return b.call(a)}},_onFileLoaded:function(a){this.invalidateCache(),this.isLoaded=!0,null!==this.onLoadEnd&&this.onLoadEnd({event:a})},_onFileError:function(a){null!==this.onLoadError&&this.onLoadError({event:a})},_onFileAbort:function(a){null!==this.onLoadAbort&&this.onLoadAbort({event:a})}}),CGSGKeyFrame=CGSGObject.extend({initialize:function(a,b){this.frame=a,this.value=b,this.inTangent=new CGSGVector2D(0,0),this.outTangent=new CGSGVector2D(0,0),this.userData=null}}),CGSGInterpolator=CGSGObject.extend({initialize:function(){},compute:function(){},getLengths:function(){}}),CGSGInterpolatorLinear=CGSGInterpolator.extend({initialize:function(){},compute:function(a,b){var c,d,e,f,g,h,i,j,k=a.length,l=[];for(c=0;k-1>c;c++)for(g=a[c],h=a[c+1],e=b[c],i=(h.value.x-g.value.x)/b[c],j=(h.value.y-g.value.y)/b[c],d=0;e>d;d++)f=d,l.push(f===g.frame?{x:g.value.x,y:g.value.y}:f===h.frame?{x:h.value.x,y:h.value.y}:{x:a[c].value.x+d*i,y:a[c].value.y+d*j});var m=a[k-1];return l.push({x:m.value.x,y:m.value.y}),l}}),CGSGInterpolatorTCB=CGSGInterpolator.extend({initialize:function(){},compute:function(a,b){var c=a.length-1,d=new CGSGKeyFrame(c,{x:a[c].value.x,y:a[c].value.y});d.userData={t:0,c:0,b:0},a.push(d),c=a.length;var e,f=[];for(e=0;c-1>e;e++)f=f.concat(0===e?this._interpolate(a[e],a[e],a[e+1],a[e+2],a[e].userData.t,a[e].userData.c,a[e].userData.b,b[e]):c>e+2?this._interpolate(a[e-1],a[e],a[e+1],a[e+2],a[e].userData.t,a[e].userData.c,a[e].userData.b,b[e]):c>e+1?this._interpolate(a[e-1],a[e],a[e+1],a[0],a[e].userData.t,a[e].userData.c,a[e].userData.b,b[e]):this._interpolate(a[e-1],a[e],a[0],a[1],a[e].userData.t,a[e].userData.c,a[e].userData.b,b[e]));var g=a[c-2];return f.push({x:g.value.x,y:g.value.y}),a.pop(),f},_interpolate:function(a,b,c,d,e,f,g,h){for(var i,j,k,l,m,n,o,p,q,r,s,t=new CGSGVector2D(a.value.x,a.value.y),u=new CGSGVector2D(b.value.x,b.value.y),v=new CGSGVector2D(c.value.x,c.value.y),w=new CGSGVector2D(d.value.x,d.value.y),x=b.value.x,y=b.value.y,z=[],A=0;h>A;A++)i=A/h,j=2*Math.pow(i,3)-3*Math.pow(i,2)+1,k=-2*Math.pow(i,3)+3*Math.pow(i,2),l=Math.pow(i,3)-2*Math.pow(i,2)+i,m=Math.pow(i,3)-Math.pow(i,2),n=(1-e)*(1+f)*(1+g)*(u.x-t.x)/2+(1-e)*(1-f)*(1-g)*(v.x-u.x)/2,o=(1-e)*(1+f)*(1+g)*(u.y-t.y)/2+(1-e)*(1-f)*(1-g)*(v.y-u.y)/2,p=(1-e)*(1-f)*(1+g)*(v.x-u.x)/2+(1-e)*(1+f)*(1-g)*(w.x-v.x)/2,q=(1-e)*(1-f)*(1+g)*(v.y-u.y)/2+(1-e)*(1+f)*(1-g)*(w.y-v.y)/2,r=j*u.x+k*v.x+l*n+m*p,s=j*u.y+k*v.y+l*o+m*q,z.push({x:r,y:s}),x=r,y=s;return z}}),CGSGTimeline=CGSGObject.extend({initialize:function(a,b){this.parentNode=a,this.attribute=b,this._method=CGSGAnimationMethod.LINEAR,this.listValues=[],this._listKeys=[],this._numberOfFrameBetweenKeys=[],this._listErpKeys=[],this.onAnimationStart=null,this.onAnimationEnd=null,this.onAnimate=null},addKey:function(a,b){this._listKeys.push(new CGSGKeyFrame(a,{x:b,y:0})),this.sortByFrame(this._listKeys),this.listValues.clear(),this.addInterpolationKey(a,b)},removeKey:function(a){this._removeKeyToList(a,this._listKeys),this._removeKeyToList(a,this._listErpKeys),this.getNbKeys()>1&&this._computeNumberOfFrameBetweenKeys(),this.listValues.clear()},removeKeysBetween:function(a,b){var c;for(c=this._listKeys.length-1;c>=0;c--)this._listKeys[c].frame>=a&&this._listKeys[c].frame<=b&&this._listKeys.without(this._listKeys[c]);for(c=this._listErpKeys.length-1;c>=0;c--)this._listErpKeys[c].frame>=a&&this._listErpKeys[c].frame<=b&&this._listErpKeys.without(this._listErpKeys[c]);this.listValues.clear()},addInterpolationKey:function(a,b){this._removeKeyToList(a,this._listErpKeys),this._listErpKeys.push(new CGSGKeyFrame(a,{x:b,y:0})),this.sortByFrame(this._listErpKeys)},removeInterpolationKey:function(a){this._removeKeyToList(a,this._listErpKeys)},_removeKeyToList:function(a,b){var c=null,d=0;for(d;d<b.length-1;d++)if(b[d].frame===a){c=b[d];break}b.without(c)},removeAll:function(){this.listValues.clear(),this._listKeys.clear(),this._listErpKeys.clear(),this._numberOfFrameBetweenKeys.clear()},_computeNumberOfFrameBetweenKeys:function(){this._numberOfFrameBetweenKeys.clear();var a=0,b=0;for(b;b<this._listErpKeys.length-1;b++)a=this._listErpKeys[b+1].frame-this._listErpKeys[b].frame,this._numberOfFrameBetweenKeys.push(a)},getNbKeys:function(){return this._listKeys.length},sortByFrame:function(a){a.sort(function(a,b){return a.frame-b.frame})},compute:function(){this.listValues.clear(),this.getNbKeys()<1||(this._computeNumberOfFrameBetweenKeys(),this.listValues=this._method.compute(this._listErpKeys,this._numberOfFrameBetweenKeys))},getFirstKey:function(){return 0===this.getNbKeys()?null:this._listKeys[0]},getLastKey:function(){return 0===this.getNbKeys()?null:this._listKeys[this.getNbKeys()-1]},getValue:function(a){var b=this.getNbKeys();return 0===b&&this.listValues.isEmpty()?void 0:this.listValues.isEmpty()?a<this._listKeys[0].frame?void 0:this.compute():a<this._listKeys[0].frame?void 0:a>=this._listKeys[this._listKeys.length-1].frame?this.listValues[this.listValues.length-1].x:this.listValues[a-this._listKeys[0].frame].x},exportValues:function(){0===this.listValues.length&&this.compute();var a,b=[];for(a=0;a<this.listValues.length;a++)b.push(this.listValues[a]);return b},importValues:function(a,b){this.addKey(b,a[0]),this.addKey(b+a.length-1,a[a.length-1]);var c;for(c=0;c<a.length;c++)this.listValues.push(a[c])}}),CGSGAnimationMethod={LINEAR:new CGSGInterpolatorLinear,CUBIC_SPLINE:new CGSGInterpolatorTCB},CGSGAnimationManager=CGSGObject.extend({initialize:function(){this.listTimelines=[]},addAnimationKey:function(a,b,c){a.addKey(CGSGMath.fixedPoint(b),c)},removeAnimationKey:function(a,b){a.removeKey(CGSGMath.fixedPoint(b))},animate:function(a,b,c,d,e,f){var g=this.getTimeline(a,b),h=CGSG.currentFrame+CGSGMath.fixedPoint(f),i=CGSG.currentFrame+CGSGMath.fixedPoint(f+c);return g.removeKeysBetween(h,i),this.addAnimationKey(g,h,d),this.addAnimationKey(g,i,e),this.compute(g),g},compute:function(a){a.compute()},stillHaveAnimation:function(){if(0===this.listTimelines.length)return!1;for(var a=0,b=this.listTimelines.length;b>a;++a)if(null!==this.listTimelines[a].getLastKey()&&this.listTimelines[a].getLastKey().frame<=CGSG.currentFrame)return!0;return!1},getTimeline:function(a,b){for(var c=0,d=this.listTimelines.length;d>c;++c)if(this.listTimelines[c].parentNode===a&&this.listTimelines[c].attribute===b)return this.listTimelines[c];return this._createTimeline(a,b)},_createTimeline:function(a,b){var c=new CGSGTimeline(a,b);return this.listTimelines.push(c),c}}),CGSGCollisionMethod={GHOSTONDEMAND:"ghostOnDemand",REGION:"region"},CGSGCollisionRegionTester=CGSGObject.extend({initialize:function(){this.classType="CGSGCollisionRegionTester"},isColliding:function(a,b,c){null===c&&(c=0);var d=a.getAbsLeft(),e=a.getAbsRight(),f=a.getAbsBottom(),g=b.getAbsLeft(),h=b.getAbsRight(),i=b.getAbsBottom();return(h+c>=d&&e>=g-c||e>=g-c&&h+c>=d)&&a.getAbsTop()<=i+c&&f>=b.getAbsTop()-c?!0:!1}}),CGSGCollisionGhostOnDemandTester=CGSGObject.extend({initialize:function(){this.classType="CGSGCollisionGhostOnDemandTester"},isColliding:function(a,b){var c=b.getAbsLeft()-a.getAbsLeft(),d=b.getAbsTop()-a.getAbsTop(),e=c>=0?Math.min(a.getAbsWidth()-c,b.getAbsWidth()):Math.min(b.getAbsWidth()+c,a.getAbsWidth()),f=d>=0?Math.min(a.getAbsHeight()-d,b.getAbsHeight()):Math.min(b.getAbsHeight()+d,a.getAbsHeight());if(0>=e||0>=f)return!1;var g=c>=0?c:0,h=d>=0?d:0,i=document.createElement("canvas");i.width=a.getAbsWidth(),i.height=a.getAbsHeight();var j=i.getContext("2d");j.scale(a._absSca.x,a._absSca.y);var k=a.position;a.position=new CGSGPosition(0,0),a.render(j),a.position=k;var l=document.createElement("canvas");l.width=b.getAbsWidth(),l.height=b.getAbsHeight();var m=l.getContext("2d");k=b.position,b.position=new CGSGPosition(0,0),b.render(m),b.position=k,j.globalCompositeOperation="destination-in",j.drawImage(l,c/a._absSca.x,d/a._absSca.y);for(var n=j.getImageData(g,h,e,f),o=0;o<n.width;o++)for(var p=0;p<n.height;p++){var q=4*(o+p*n.width);if(n.data[q+3]>0)return!0}return!1}}),CGSGCollisionTesterFactory=CGSGObject.extend({initialize:function(){this.collisionTesters=new CGSGMap,this.collisionTesters.addOrReplace(CGSGCollisionMethod.REGION,new CGSGCollisionRegionTester),this.collisionTesters.addOrReplace(CGSGCollisionMethod.GHOSTONDEMAND,new CGSGCollisionGhostOnDemandTester)},getCollisionTester:function(a){return this.collisionTesters.getValue(a)}}),CGSGCollisionManager=CGSGObject.extend({initialize:function(){},isColliding:function(a,b,c){return a.isCollisionManaged&&b.isCollisionManaged&&cgsgExist(CGSG.performanceKeys)?CGSG.performanceKeys.collisionTester.isColliding(a,b,c):!1},manageNode:function(a){a.isCollisionManaged=!0},unManageNode:function(a){a.isCollisionManaged=!1}}),CGSGPickNodeMethod={GHOST:"ghost",REGION:"region"},cgsgExplorerParams={IE10:{name:"IE 10 or above",browserName:"",fullVersion:"",textDecalYTop:4.3,textDecalYBottom:1.26,textDecalYMiddle:1.87,textDecalYAlpha:.983,webworker:!1},IE9:{name:"IE 9",browserName:"",fullVersion:"",textDecalYTop:4.3,textDecalYBottom:1.26,textDecalYMiddle:1.87,textDecalYAlpha:.983,webworker:!1},SAFARI:{name:"Safari",browserName:"",fullVersion:"",textDecalYTop:4,textDecalYBottom:1.27,textDecalYMiddle:1.77,textDecalYAlpha:.983,webworker:!1},CHROME:{name:"Chrome",browserName:"",fullVersion:"",textDecalYTop:3.3,textDecalYBottom:1.268,textDecalYMiddle:2.09,textDecalYAlpha:.983,webworker:!1},OPERA:{name:"Opera",browserName:"",fullVersion:"",textDecalYTop:3.5,textDecalYBottom:1.28,textDecalYMiddle:2,textDecalYAlpha:.995,webworker:!1},FIREFOX:{name:"Firefox",browserName:"",fullVersion:"",textDecalYTop:10,textDecalYBottom:1.23,textDecalYMiddle:1.77,textDecalYAlpha:.983,webworker:!1},KONQUEROR:{name:"Konqueror",browserName:"",fullVersion:"",textDecalYTop:10,textDecalYBottom:1.23,textDecalYMiddle:1.77,textDecalYAlpha:.983,webworker:!1},UNKNOWN:{name:"Unknown",browserName:"",fullVersion:"",textDecalYTop:10,textDecalYBottom:1.23,textDecalYMiddle:1.77,textDecalYAlpha:.983,webworker:!1}},cgsgCurrentExplorer=cgsgExplorerParams.UNKNOWN,CGSG={version:"2.2.0",sceneGraph:null,displayRatio:CGSG_DEFAULT_DISPLAYRATIO,resizeHandleThreshold:CGSG_DEFAULT_SELECTED_RESIZEHANDLE_THRESHOLD,currentFrame:0,canvas:null,context:null,ghostContext:null,ghostColor:"#FF0000",selectedNodes:[],listTimelines:[],framerateDelay:CGSG_DEFAULT_FRAMERATE_DELAY,maxFramerate:CGSG_DEFAULT_MAX_FRAMERATE,fps:0,isBoundingBoxOnTop:!0,collisionManager:new CGSGCollisionManager,cssManager:new CGSGCSSManager,performanceKeys:{_collisionMethod:CGSGCollisionMethod.REGION,_cgsgCollisionTesterFactory:new CGSGCollisionTesterFactory,collisionTester:new CGSGCollisionRegionTester,setCollisionMethod:function(a){this._collisionMethod=a,this.collisionTester=this._cgsgCollisionTesterFactory.getCollisionTester(this._collisionMethod)}},animationManager:new CGSGAnimationManager,eventManager:new CGSGEventManager,globalDetectSelectionThreshold:0},cgsgEventTypes={ON_BEFORE_RENDER:"onBeforeRender",ON_AFTER_RENDER:"onAfterRender",BEFORE_RENDER_END:"onBeforeRenderEnd",AFTER_RENDER_START:"onAfterRenderStart",ON_TRANSLATE:"onTranslate",ON_ROTATE:"onRotate",ON_SCALE:"onScale",ON_RESIZE:"onResize",ON_RESIZE_END:"onResizeEnd",ON_MOUSE_UP:"onMouseUp",ON_MOUSE_OVER:"onMouseOver",ON_MOUSE_OUT:"onMouseOut",ON_MOUSE_ENTER:"onMouseEnter",ON_CLICK:"onClick",ON_CLICK_START:"onClickStart",ON_DBL_CLICK:"onDblClick",ON_DRAG:"onDrag",ON_DRAG_END:"onDragEnd",ON_CHILD_ADD:"onChildAdd",ON_CHILD_REMOVED:"onChildRemove",ON_SELECT:"onSelect",ON_DESELECT:"onDeselect",ON_FREE:"onFreeEvent",ON_LOAD_END:"onLoadEnd",ON_LOAD_ERROR:"onLoadError",ON_LOAD_ABORT:"onLoadAbort",ON_RENDER_START:"onRenderStart",ON_RENDER_END:"onRenderEnd",ON_SCENE_DBL_CLICK_START:"onSceneDblClickStart",ON_SCENE_DBL_CLICK_END:"onSceneDblClickEnd",ON_SCENE_CLICK_START:"onSceneClickStart",ON_SCENE_CLICK_END:"onSceneClickEnd",ON_SCENE_AVERAGE_FPS_CHANGED:"onSceneAverageFpsChanged",ON_ANIMATE:"onAnimate",ON_ANIMATION_START:"onAnimationStart",ON_ANIMATION_END:"onAnimationEnd",ON_UPDATE_PARTICLE_END:"onUpdateParticleEnd",ON_INIT_PARTICLE:"onInitParticle",ON_TAB_CHANGED:"onTabChanged"},cgsgStylePaddingLeft=0,cgsgStylePaddingTop=0,cgsgStyleBorderLeft=0,cgsgStyleBorderTop=0,CGSGMask=CGSGObject.extend({initialize:function(){this._prepareEvent=cgsgEventTypes.ON_BEFORE_RENDER,this._finalizeEvent=cgsgEventTypes.ON_AFTER_RENDER,this._keyEvents=new CGSGMap,this._bindEventAdapter=this._eventAdapter.bind(this)},apply:function(a){this._keyEvents.addOrReplace(a,{prepareKey:CGSG.eventManager.bindHandler(a,this._prepareEvent,this._bindEventAdapter),finalizeKey:CGSG.eventManager.bindHandler(a,this._finalizeEvent,this._bindEventAdapter)}),this._internalApply(a)},_internalApply:function(){},remove:function(a){var b=this._keyEvents.getValue(a);cgsgExist(b)&&(CGSG.eventManager.unbindHandler(a,this._prepareEvent,this._bindEventAdapter),CGSG.eventManager.unbindHandler(a,this._finalizeEvent,this._bindEventAdapter)),this._internalRemove(a)},_internalRemove:function(){},_eventAdapter:function(a){var b;switch(a.type){case this._prepareEvent:b=this.prepare(a.observable,a.data.context),a.data.context=b;break;case this._finalizeEvent:b=this.finalize(a.observable,a.data.context),a.data.context=b}},prepare:function(){},finalize:function(){}}),CGSGMaskClip=CGSGMask.extend({initialize:function(a){this._super(),this._maskRegion=a,this._saveContext=null,this.canvas=document.createElement("canvas"),this.canvas.width=10,this.canvas.height=10,this._renderContext=this.canvas.getContext("2d"),this.autoRefresh=!0,this.refreshOnNextFrame=!1},prepare:function(a,b){if(this._saveContext=b,this.canDrawImage=!0,this.autoRefresh||this.refreshOnNextFrame){this._renderContext.clearRect(0,0,this.canvas.width,this.canvas.height),this.refreshOnNextFrame=!1;var c=this._maskRegion.position,d=this._maskRegion.dimension,e=c.x,f=c.y,g=a.position,h=a.dimension,i=h.width-e,j=h.height-f,k=d.width,l=d.height;if(k>i&&(k=0>=i?0:i),l>j&&(l=0>=j?0:j),k>0&&l>0){var m,n,o,p,q=g.x+e,r=g.y+f;0>q?(m=0,o=k+q):(m=a.position.x+e,o=k),0>r?(n=0,p=l+r):(n=a.position.y+f,p=l),this.canvas.width=m+o+1,this.canvas.height=n+p+1,this.sliceX=m,this.sliceY=n,this.sliceWidth=o,this.sliceHeight=p}else this.canDrawImage=!1;return this._renderContext.save(),this._renderContext}return null},finalize:function(){return this.canDrawImage&&(this._saveContext.drawImage(this.canvas,this.sliceX,this.sliceY,this.sliceWidth,this.sliceHeight,this.sliceX,this.sliceY,this.sliceWidth,this.sliceHeight),this._renderContext.restore()),this._saveContext}}),CGSGMath={PI2:6.28318530718,deg2rad:function(a){return a/180*Math.PI},rad2deg:function(a){return 57.29577951308232*a},fixedPoint:function(a){return.5+a<<0},lerp:function(a,b,c){return a+(b-a)*c}},CGSGHandleBox=CGSGObject.extend({initialize:function(a,b,c,d,e,f,g){this.fillColor=c,this.strokeColor=d,this.lineWidth=e,this.size=b,this.isVisible=!0,this._parentNode=a,this._position=new CGSGPosition(f,g)},render:function(a){this.isVisible&&(a.lineWidth=this.lineWidth,a.strokeStyle=this.strokeColor,a.fillStyle=this.fillColor,cgsgExist(this.lineWidth)&&this.lineWidth>0&&a.strokeRect(this._position.x,this._position.y,this.size/this._parentNode._absSca.x,this.size/this._parentNode._absSca.y),a.fillRect(this._position.x,this._position.y,this.size/this._parentNode._absSca.x,this.size/this._parentNode._absSca.y))
},checkIfSelected:function(a,b){return a.x>=this._parentNode._absPos.x+this._position.x*this._parentNode._absSca.x-b&&a.x<=this._parentNode._absPos.x+this._position.x*this._parentNode._absSca.x+this.size+b&&a.y>=this._parentNode._absPos.y+this._position.y*this._parentNode._absSca.y-b&&a.y<=this._parentNode._absPos.y+this._position.y*this._parentNode._absSca.y+this.size+b},translateTo:function(a,b){this._position.x=a,this._position.y=b}}),CGSGNode=CGSGObject.extend({initialize:function(a,b){this.name="",this.isSelected=!1,this.classType="CGSGNODE",this.handles=[],this.globalAlpha=1,this.isVisible=!0,this.isProportionalResize=!1,this.isProportionalResizeOnly=!1,this.pickNodeMethod=CGSGPickNodeMethod.REGION,this.children=[],this.regionConstraint=null,this.nodeConstraint=null,this._followers=[],this.rotationCenter=new CGSGPosition(.5,.5),this.userData={},this.isClickable=!0,this.isResizable=!1,this.isDraggable=!1,this.needToKeepAbsoluteMatrix=!0,this.selectionLineColor=null,this.selectionLineWidth=null,this.handleSize=null,this.handleColor=null,this.isMouseOver=!1,this.isMoving=!1,this.isResizing=!1,this._id=0,this._parentNode=null,this._isCached=!1,this._cacheCanvas=null,this._cacheCtx=null,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0,this.shadowColor="#333333",this.position=new CGSGPosition(0,0),this._absPos=new CGSGPosition(0,0),this.dimension=new CGSGDimension(0,0),this.scale=new CGSGScale(1,1),this._absSca=new CGSGScale(1,1),this.rotation=new CGSGRotation(0),this._absRot=new CGSGRotation(0),this._isDrag=!1,this.isTraversable=!0,this.isCollisionManaged=!1,this.onMouseOver=null,this.onMouseEnter=null,this.onMouseOut=null,this.onMouseUp=null,this.onClick=null,this.onDblClick=null,this.onDrag=null,this.onDragEnd=null,this.onResize=null,this.onResizeEnd=null,this.onSelect=null,this.onDeselect=null,this.onChildRemove=null,this.onBeforeRender=null,this.onAfterRender=null,this.onAfterRenderStart=null,this.onTranslate=null,this.detectSelectionThreshold=CGSG.globalDetectSelectionThreshold,this.bkgcolors=[],this.lineColor=null,this.lineWidth=0,this.borderRadius=0,this._cls=[],this._clsBBox=null,this.setClass("cgsgnode"),this.setClassBBox("cgsgnode-bbox"),this.translateTo(a,b,!0),this.dimension.width=0,this.dimension.height=0,this._isDimensionChanged=!1;for(var c=0;8>c;c++){var d=new CGSGHandleBox(this,this.handleSize,this.handleColor,this.selectionLineColor,this.selectionLineWidth,0,0);this.handles.push(d)}this.computeAbsoluteMatrix(!0)},moveLocalZIndex:function(a){var b=this.getLocalZIndex();isNaN(b)||this.setLocalZIndex(this.getLocalZIndex()+a)},setLocalZIndex:function(a){if(cgsgExist(this._parentNode)){a=Math.max(0,Math.min(CGSGMath.fixedPoint(a),this._parentNode.children.length-1));var b=this.getLocalZIndex(),c=this._parentNode;a!==b&&(c.detachChild(this),c.addChildAt(this,a))}},setLocalZIndexToLast:function(){this.setLocalZIndex(this._parentNode.children.length-1)},getLocalZIndex:function(){return cgsgExist(this._parentNode)?this._parentNode.children.indexOf(this):0/0},getRegion:function(){return new CGSGRegion(this.position.x,this.position.y,this.getWidth(),this.getHeight())},getAbsoluteRegion:function(){return new CGSGRegion(this.getAbsLeft(),this.getAbsTop(),this.getAbsWidth(),this.getAbsHeight())},_clearContext:function(a,b,c){a.clearRect(0,0,b,c)},setPrecomputed:function(a){this._isCached=a,this.invalidate()},invalidate:function(){this._isCached&&this._preCompute()},invalidateTheme:function(){var a=CGSG.cssManager.getAttrInArray(this._cls,"background"),b=CGSG.cssManager.getAttrInArray(this._cls,"border-width"),c=CGSG.cssManager.getAttrInArray(this._cls,"border-color"),d=CGSG.cssManager.getFloat(CGSG.cssManager.getAttrInArray(this._cls,"opacity")),e=CGSG.cssManager.getNumber(CGSG.cssManager.getAttrInArray(this._cls,"border-radius"));cgsgExist(e)&&(this.borderRadius=e);var f;if(cgsgExist(a))if(f=CGSGColor.fromString(a),cgsgExist(f.r)&&cgsgExist(f.g)&&cgsgExist(f.b))this.bkgcolors[0]=CGSGColor.rgb2hex(f.r,f.g,f.b);else{var g=a.substring(a.indexOf("rgb"),a.indexOf(")")+1),h=a.substring(a.lastIndexOf("rgb"),a.lastIndexOf(")")),i=CGSGColor.fromString(g),j=CGSGColor.fromString(h);this.bkgcolors[0]=CGSGColor.rgb2hex(i.r,i.g,i.b),this.bkgcolors[1]=CGSGColor.rgb2hex(j.r,j.g,j.b)}if(cgsgExist(b)&&(this.lineWidth=CGSG.cssManager.getNumber(b)),cgsgExist(c)&&(this.lineColor=c),cgsgExist(d)&&(this.globalAlpha=d),cgsgExist(this._clsBBox)){var k=CGSG.cssManager.getAttr(this._clsBBox,"background-color"),l=CGSG.cssManager.getNumber(CGSG.cssManager.getAttr(this._clsBBox,"border-width")),m=CGSG.cssManager.getAttr(this._clsBBox,"outline-color"),n=CGSG.cssManager.getNumber(CGSG.cssManager.getAttr(this._clsBBox,"outline-width"));cgsgExist(k)&&(this.handleColor=k),cgsgExist(l)&&(this.handleSize=l),cgsgExist(m)&&(this.selectionLineColor=m),cgsgExist(n)&&(this.selectionLineWidth=n)}},setClass:function(a){this._cls=[],this._cls.push(a),this.invalidateTheme()},addClass:function(a){this._cls.push(a),this.invalidateTheme()},removeClass:function(a){this._cls=this._cls.without(a),this.invalidateTheme()},setClassBBox:function(a){this._clsBBox=a,this.invalidateTheme()},_applyShadow:function(a){(0!==this.shadowOffsetX||0!==this.shadowOffsetY)&&(a.shadowOffsetX=this.shadowOffsetX,a.shadowOffsetY=this.shadowOffsetY,a.shadowBlur=this.shadowBlur,a.shadowColor=this.shadowColor)},_preCompute:function(){cgsgExist(this._cacheCanvas)||(this._cacheCanvas=document.createElement("canvas"),this._cacheCtx=this._cacheCanvas.getContext("2d")),cgsgClearContext(this._cacheCtx),this._applyShadow(this._cacheCtx),this.render(this._cacheCtx)},doRender:function(a,b){b&&this.invalidateTheme();var c=a,d=new CGSGEvent(this,{context:a,node:this});if(cgsgExist(this.onBeforeRender)&&(CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_BEFORE_RENDER,d),c=d.data.context),this.beforeRender(c),this.globalAlpha>0)if(c.globalAlpha=this.globalAlpha,this._isCached)c.drawImage(this._cacheCanvas,0,0);else{if(cgsgExist(this.bkgcolors[1])){for(var e=c.createLinearGradient(0,0,0,this.dimension.height),f=0,g=this.bkgcolors.length;g>f;f++)e.addColorStop(f,this.bkgcolors[f]);c.fillStyle=e}else c.fillStyle=this.bkgcolors[0];this.lineWidth>0&&(c.strokeStyle=this.lineColor,c.lineWidth=this.lineWidth),this._applyShadow(c),this.render(c)}!CGSG.isBoundingBoxOnTop&&this.isSelected&&this.renderBoundingBox(c);var h=new CGSGEvent(this,{context:c,node:this});this.afterRender(h.data.context,b),cgsgExist(this.onAfterRender)&&(CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_AFTER_RENDER,h),c=h.data.context)},render:function(){},doRenderGhost:function(a){this.beforeRenderGhost(a),this.globalAlpha>0&&(this._isCached?a.drawImage(this._cacheCanvas,0,0):(a.fillStyle="#FF0000",this.lineWidth>0&&(a.strokeStyle="#FF0000",a.lineWidth=this.lineWidth),this.renderGhost(a))),this.afterRenderGhost(a)},renderGhost:function(a){this.render(a)},renderBoundingBox:function(a){var b=this.getWidth(),c=this.getHeight();if(cgsgExist(this.selectionLineWidth)&&this.selectionLineWidth>0&&(a.strokeStyle=this.selectionLineColor,a.lineWidth=this.selectionLineWidth/this._absSca.y,a.beginPath(),a.moveTo(0,0),a.lineTo(b,0),a.moveTo(0,c),a.lineTo(b,c),a.stroke(),a.closePath(),a.lineWidth=this.selectionLineWidth/this._absSca.x,a.beginPath(),a.moveTo(0,0),a.lineTo(0,c),a.moveTo(b,0),a.lineTo(b,c),a.stroke(),a.closePath()),this.isResizable){var d=this.handleSize/(2*this._absSca.x),e=this.handleSize/(2*this._absSca.y);this.handles[0].translateTo(-d,-e),this.handles[1].translateTo(b/2-d,-e),this.handles[2].translateTo(b-d,-e),this.handles[3].translateTo(-d,c/2-e),this.handles[4].translateTo(b-d,c/2-e),this.handles[6].translateTo(b/2-d,c-e),this.handles[5].translateTo(-d,c-e),this.handles[7].translateTo(b-d,c-e),this.isProportionalResizeOnly&&(this.handles[1].isVisible=!1,this.handles[3].isVisible=!1,this.handles[4].isVisible=!1,this.handles[6].isVisible=!1);var f;for(f=0;8>f;f++)this.handles[f].size=this.handleSize,this.handles[f].fillColor=this.handleColor,this.handles[f].strokeColor=this.selectionLineColor,this.handles[f].lineWidth=this.selectionLineWidth,this.handles[f].render(a)}},beforeRender:function(a){a.save(),a.translate(this.position.x,this.position.y),a.scale(this.scale.x,this.scale.y),cgsgExist(this.rotationCenter)?(a.translate(this.dimension.width*this.rotationCenter.x,this.dimension.height*this.rotationCenter.y),a.rotate(this.rotation.angle),a.translate(-this.dimension.width*this.rotationCenter.x,-this.dimension.height*this.rotationCenter.y)):a.rotate(this.rotation.angle),this.onBeforeRenderEnd&&CGSG.eventManager.dispatch(this,cgsgEventTypes.BEFORE_RENDER_END,new CGSGEvent(this,{c:a,node:this}))},afterRender:function(a,b){if(cgsgExist(this.onAfterRenderStart)&&CGSG.eventManager.dispatch(this,cgsgEventTypes.AFTER_RENDER_START,new CGSGEvent(this,{context:a,node:this})),!this.isALeaf())for(var c=0,d=this.children.length;d>c;++c){var e=this.children[c];e.isVisible&&e.doRender(a,b)}a.restore()},beforeRenderGhost:function(a){a.save(),a.translate(this._absPos.x,this._absPos.y),a.scale(this._absSca.x,this._absSca.y),cgsgExist(this.rotationCenter)?(a.translate(this.dimension.width*this.rotationCenter.x,this.dimension.height*this.rotationCenter.y),a.rotate(this._absRot.angle),a.translate(-this.dimension.width*this.rotationCenter.x,-this.dimension.height*this.rotationCenter.y)):a.rotate(this._absRot.angle)},afterRenderGhost:function(a){a.restore()},setSelected:function(a){this.isSelected=a,this._isDrag=!0,a&&null!==this.onSelect?CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_SELECT,new CGSGEvent(this,{node:this})):null!==this.onDeselect&&CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_DESELECT,new CGSGEvent(this,{node:this}))},getCompleteRegion:function(){return new CGSGRegion(this.getMinAbsoluteLeft(),this.getMinAbsoluteTop(),this.getMaxAbsoluteRight(),this.getMaxAbsoluteBottom())},getCompletePosition:function(){return new CGSGPosition(this.getMinAbsoluteLeft(),this.getMinAbsoluteTop())},getCompleteDimension:function(){return new CGSGDimension(this.getMaxAbsoluteRight(),this.getMaxAbsoluteBottom())},detectSelection:function(a,b,c){if(this.pickNodeMethod===CGSGPickNodeMethod.REGION){if(a.x>=this._absPos.x-this.detectSelectionThreshold&&a.x<this._absPos.x+this.detectSelectionThreshold+this.getWidth()*c.x&&a.y>=this._absPos.y-this.detectSelectionThreshold&&a.y<this._absPos.y+this.detectSelectionThreshold+this.getHeight()*c.y)return this}else{this.doRenderGhost(b);var d=b.getImageData(a.x,a.y,1,1);if(cgsgClearContext(b),0!==d.data[0]||0!==d.data[1]||0!==d.data[2])return this}return null},detectSelectionInRegion:function(a){var b=this.getAbsoluteRegion();return cgsgRegionIsInRegion(b,a,0)?this:null},pickNode:function(a,b,c,d,e){var f=null,g=null;if(g=cgsgExist(b)?b.multiply(this.scale):this.getAbsScale(!1),this.isTraversable&&(this.isClickable||this.isResizable||this.isDraggable)&&(!cgsgExist(e)||e(this)===!0)){if(this.computeAbsoluteMatrix(!1),this.isSelected&&this.isResizable)for(var h=0;8>h;h++){var i=this.handles[h];if(i.checkIfSelected(a,CGSG.resizeHandleThreshold))return this}f=this.detectSelection(a,c,g)}if(this.isTraversable&&d&&!this.isALeaf()){for(var j=this.children.length-1;j>=0;--j){var k=this.children[j],l=k.pickNode(a,g,c,d,e);if(cgsgExist(l)){f=l;break}}g=null}return f},pickNodes:function(a,b,c,d,e){var f=[];if(a.isEmpty())return f;var g=null;if(g=cgsgExist(b)?b.multiply(this.scale):this.getAbsScale(!1),this.isTraversable&&(this.isResizable||this.isDraggable)&&(!cgsgExist(e)||e(this)===!0)){this.computeAbsoluteMatrix(!1);var h=this.detectSelectionInRegion(a,c);cgsgExist(h)&&f.push(h)}if(this.isTraversable&&d&&!this.isALeaf()){for(var i=this.children.length-1;i>=0;--i){var j=this.children[i],k=j.pickNodes(a,g,c,d,e);null!==k&&void 0!==k&&(f=f.concat(k))}g=null}return f},isALeaf:function(){return this.children.length<=0},_applyContraintsToFollowers:function(){cgsgIterate(this._followers,function(a,b){var c=b.getAbsLeft()-this.getAbsLeft();0>c&&b.translateWith(-c,0,!0);var d=b.getAbsTop()-this.getAbsTop();0>d&&b.translateWith(0,-d,!0);var e=this.getAbsRight()-b.getAbsRight();0>e&&(c=b.getAbsWidth()-this.getAbsWidth(),c>0?b.resizeWith(-c,0):b.translateWith(e,0,!0));var f=this.getAbsBottom()-b.getAbsBottom();0>f&&(e=b.getAbsHeight()-this.getAbsHeight(),e>0?b.resizeTo(this.getAbsWidth(),b.getHeight()):b.translateWith(0,f,!0))}.bind(this))},translateTo:function(a,b,c){this.position.translateTo(a,b),this.needToKeepAbsoluteMatrix&&c!==!1&&(this._absPos=this.getAbsPosition(!0)),this._applyContraintsToFollowers(),cgsgExist(this.onTranslate)&&CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_TRANSLATE,new CGSGEvent(this,{node:this}))},translateWith:function(a,b,c){this.position.translateWith(a,b),this.needToKeepAbsoluteMatrix&&c!==!1&&(this._absPos=this.getAbsPosition(!0)),this._applyContraintsToFollowers(),cgsgExist(this.onTranslate)&&CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_TRANSLATE,new CGSGEvent(this,{node:this}))},translateBy:function(a,b,c){this.position.translateBy(a,b),this.needToKeepAbsoluteMatrix&&c!==!1&&(this._absPos=this.getAbsPosition(!0)),this._applyContraintsToFollowers(),cgsgExist(this.onTranslate)&&CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_TRANSLATE,new CGSGEvent(this,{node:this}))},resizeTo:function(a,b){this.dimension.resizeTo(a,b),this._applyContraintsToFollowers(),this._endResize()},resizeBy:function(a,b){this.dimension.resizeBy(a,b),this._applyContraintsToFollowers(),this._endResize()},resizeWith:function(a,b){this.dimension.resizeWith(a,b),this._applyContraintsToFollowers(),this._endResize()},_endResize:function(){this._isDimensionChanged=!0,this.invalidate(),cgsgExist(this.onResize)&&CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_RESIZE,new CGSGEvent(this,{node:this}))},scaleTo:function(a,b,c){this.scale.x=a,this.scale.y=b,this.needToKeepAbsoluteMatrix&&c!==!1&&(this._absSca=this.getAbsScale(!0)),this._applyContraintsToFollowers(),cgsgExist(this.onScale)&&CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_SCALE,new CGSGEvent(this,{node:this}))},scaleBy:function(a,b,c){this.scale.x*=a,this.scale.y*=b,this.needToKeepAbsoluteMatrix&&c!==!1&&(this._absSca=this.getAbsScale(!0)),this._applyContraintsToFollowers(),cgsgExist(this.onScale)&&CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_SCALE,new CGSGEvent(this,{node:this}))},scaleWith:function(a,b,c){this.scale.x+=a,this.scale.y+=b,this.needToKeepAbsoluteMatrix&&c!==!1&&(this._absSca=this.getAbsScale(!0)),this._applyContraintsToFollowers(),cgsgExist(this.onScale)&&CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_SCALE,new CGSGEvent(this,{node:this}))},rotateTo:function(a,b){this.rotation.rotateTo(a),this.needToKeepAbsoluteMatrix&&b!==!1&&(this._absRot=this.getAbsRotation(!0)),this._applyContraintsToFollowers(),cgsgExist(this.onRotate)&&CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_ROTATE,new CGSGEvent(this,{node:this}))},rotateBy:function(a,b){this.rotation.rotateBy(a),this.needToKeepAbsoluteMatrix&&b!==!1&&(this._absRot=this.getAbsRotation(!0)),this._applyContraintsToFollowers(),cgsgExist(this.onRotate)&&CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_ROTATE,new CGSGEvent(this,{node:this}))},rotateWith:function(a,b){this.rotation.rotateWith(a),this.needToKeepAbsoluteMatrix&&b!==!1&&(this._absRot=this.getAbsRotation(!0)),this._applyContraintsToFollowers(),cgsgExist(this.onRotate)&&CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_ROTATE,new CGSGEvent(this,{node:this}))},addChild:function(a){a._parentNode=this,this.children[this.children.length]=a},addChildAt:function(a,b){b>this.children.length&&(b=this.children.length);for(var c=this.children.length;c>=b;--c)this.children[c]=this.children[c-1];a._parentNode=this,this.children[b]=a,cgsgExist(this.onChildAdd)&&CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_CHILD_ADD,new CGSGEvent(this,{node:this}))},removeChild:function(a,b){var c=this.children.indexOf(a);if(c>=0)return this.children.without(a),cgsgExist(this.onChildRemove)&&CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_CHILD_REMOVED,new CGSGEvent(this,{node:this})),a.free(),!0;if(b)for(var d=0,e=this.children.length;e>d;++d){var f=this.children[d];if(f.removeChild(a,!0))return!0}return!1},removeAll:function(){this.free()},detachChildAt:function(a){a>=0&&a<this.children.length&&this.detachChild(this.children[a])},detachChild:function(a){cgsgExist(a)&&(a._parentNode=null,this.children.without(a))},evalSet:function(a,v){var rgb;"position.x"===a?this.translateTo(v,this.position.y,this.needToKeepAbsoluteMatrix):"position.y"===a?this.translateTo(this.position.x,v,this.needToKeepAbsoluteMatrix):"dimension.width"===a?this.resizeTo(v,this.dimension.height):"dimension.height"===a?this.resizeTo(this.dimension.width,v):"scale.x"===a?this.scaleTo(v,this.scale.y,this.needToKeepAbsoluteMatrix):"scale.y"===a?this.scaleTo(this.scale.x,v,this.needToKeepAbsoluteMatrix):"rotation"===a||"rotation.angle"===a?this.rotateTo(v,this.needToKeepAbsoluteMatrix):"globalAlpha"===a||"opacity"===a?(this.globalAlpha=v,this.invalidate()):"isVisible"===a?this.isVisible=v:"rotationCenter.x"===a?this.rotationCenter.x=v:"rotationCenter.y"===a?this.rotationCenter.y=v:"bkgcolors[0].r"===a?(rgb=CGSGColor.hex2rgb(this.bkgcolors[0]),this.bkgcolors[0]=CGSGColor.rgb2hex(v,rgb.g,rgb.b),this.invalidate()):"bkgcolors[0].g"===a?(rgb=CGSGColor.hex2rgb(this.bkgcolors[0]),this.bkgcolors[0]=CGSGColor.rgb2hex(rgb.r,v,rgb.b),this.invalidate()):"bkgcolors[0].b"===a?(rgb=CGSGColor.hex2rgb(this.bkgcolors[0]),this.bkgcolors[0]=CGSGColor.rgb2hex(rgb.r,rgb.g,v),this.invalidate()):"fillStyle.r"===a?(this.fillStyle.r=v,this.invalidate()):"fillStyle.g"===a?(this.fillStyle.g=v,this.invalidate()):"fillStyle.b"===a?(this.fillStyle.b=v,this.invalidate()):(eval("this."+a+"="+v),this.invalidate())},setRegionConstraint:function(a){this.setNodeRegionConstraint(null),this.regionConstraint=a},setNodeRegionConstraint:function(a){this.regionConstraint=null,cgsgExist(a)?a._followers.contains(this)||a._followers.push(this):cgsgExist(this.nodeConstraint)&&this.nodeConstraint._followers.without(this),this.nodeConstraint=a},getAbsPosition:function(a){for(var b=this,c=this.position.copy();null!==b._parentNode;)c.multiplyEquals(b._parentNode.scale),b=b._parentNode;if(null!==this._parentNode&&c.addEquals(this._parentNode.getAbsPosition(!1)),a!==!1)for(var d=0;d<this.children.length;d++)cgsgExist(this.children[d])&&(this.children[d]._absPos=this.children[d].getAbsPosition(a));return c},getAbsScale:function(a){for(var b=this,c=this.scale.copy();null!==b._parentNode;)c.multiplyEquals(b._parentNode.scale),b=b._parentNode;if(a!==!1)for(var d=0;d<this.children.length;d++)cgsgExist(this.children[d])&&(this.children[d]._absSca=this.children[d].getAbsScale(a));return c},getAbsRotation:function(a){for(var b=this,c=this.rotation.copy();null!==b._parentNode;)c.addEquals(b._parentNode.rotation.angle),b=b._parentNode;if(a!==!1)for(var d=0;d<this.children.length;d++)cgsgExist(this.children[d])&&(this.children[d]._absRot=this.children[d].getAbsRotation(a));return c},computeAbsoluteMatrix:function(a){this._absPos=this.getAbsPosition(!1),this._absSca=this.getAbsScale(!1),this._absRot=this.getAbsRotation(!1),a!==!1&&cgsgIterate(this.children,function(b,c){cgsgExist(c)&&c.computeAbsoluteMatrix(a)}.bind(this))},getMinAbsoluteLeft:function(){var a=this._absPos.x;return this.children.length>0&&cgsgIterate(this.children.length,function(b,c){a<c._absPos.x&&(a=c._absPos.x)}.bind(this)),a},getMaxAbsoluteRight:function(){var a=this._absPos.x+this.getWidth()*this._absSca.x;return this.children.length>0&&cgsgIterate(this.children.length,function(){var b=this._absPos.x+this.getWidth()*this._absSca.x;b>a&&(a=b)}.bind(this)),a},getMinAbsoluteTop:function(){var a=this._absPos.y;return this.children.length>0&&cgsgIterate(this.children.length,function(b,c){a<c._absPos.y&&(a=c._absPos.y)}.bind(this)),a},getMaxAbsoluteBottom:function(){var a=this._absPos.y+this.getHeight()*this._absSca.y;return this.children.length>0&&cgsgIterate(this.children.length,function(){var b=this._absPos.y+this.getHeight()*this._absSca.y;b>a&&(a=b)}.bind(this)),a},getAbsLeft:function(){return this._absPos.x},getAbsRight:function(){return this._absPos.x+this.getAbsWidth()},getAbsTop:function(){return this._absPos.y},getAbsBottom:function(){return this._absPos.y+this.getAbsHeight()},getAbsWidth:function(){return this.getWidth()*this._absSca.x},getAbsHeight:function(){return this.getHeight()*this._absSca.y},getWidth:function(){return this.dimension.width},getHeight:function(){return this.dimension.height},getCenter:function(){var a=this.position.x+this.getWidth()/2,b=this.position.y+this.getHeight()/2;return new CGSGPosition(a,b)},isColliding:function(a,b){return CGSG.collisionManager.isColliding(this,a,b)},getListOfCollidingBrothers:function(a){var b=[];return cgsgIterate(this._parentNode.children,function(c,d){d!==this&&this.isColliding(d,a)&&b.push(d)}.bind(this)),b},isCollidingABrother:function(a){var b=!1;return cgsgIterate(this._parentNode.children,function(c,d){return d!==this&&this.isColliding(d,a)?b=!0:!1}.bind(this)),b},copy:function(a){return(null===a||void 0===a)&&(a=new CGSGNode(this.position.x,this.position.y),a.resizeTo(this.dimension.width,this.dimension.height)),a.classType=this.classType,a.name=this.name,a.globalAlpha=this.globalAlpha,a.bkgcolors=this.bkgcolors,a.lineColor=this.lineColor,a.lineWidth=this.lineWidth,a.isVisible=this.isVisible,a.isProportionalResize=this.isProportionalResize,a.pickNodeMethod=this.pickNodeMethod,a.needToKeepAbsoluteMatrix=this.needToKeepAbsoluteMatrix,null!==this.regionConstraint&&(a.regionConstraint=this.regionConstraint.copy()),a.nodeConstraint=this.nodeConstraint,a.userData=this.userData,a.isClickable=this.isClickable,a.isResizable=this.isResizable,a.isDraggable=this.isDraggable,a.isTraversable=this.isTraversable,a.selectionLineColor=this.selectionLineColor,a.selectionLineWidth=this.selectionLineWidth,a.handleSize=this.handleSize,a.handleColor=this.handleColor,a._id=this._id,a.translateTo(this.position.x,this.position.y),a.resizeTo(this.dimension.width,this.dimension.height),a.scaleTo(this.scale.x,this.scale.y),a.rotateTo(this.rotation.angle),a.onMouseOver=this.onMouseOver,a.onMouseOut=this.onMouseOut,a.onClick=this.onClick,a.onDblClick=this.onDblClick,a.onDrag=this.onDrag,a.onDragEnd=this.onDragEnd,a.onResize=this.onResize,a.onResizeEnd=this.onResizeEnd,a.onSelect=this.onSelect,a.onDeselect=this.onDeselect,a.computeAbsoluteMatrix(!0),a},free:function(){for(var a=this.children.length-1;a>=0;a--)this.children[a].free();this.children.clear(),cgsgFree(this)}}),CGSGNodeDomElement=CGSGNode.extend({initialize:function(a,b,c,d,e){this._super(a,b),this.resizeTo(CGSGMath.fixedPoint(c),CGSGMath.fixedPoint(d)),this.threshold=20,this.classType="CGSGNodeDomElement",this._htmlElement=e,this._htmlElement.style.position="absolute",this.updateCssRegion()},updateCssRegion:function(){cgsgExist(this._htmlElement)&&(this._htmlElement.style.left=this.getAbsLeft()+this.threshold+"px",this._htmlElement.style.top=this.getAbsTop()+this.threshold+"px",this._htmlElement.style.width=this.getAbsWidth()-2*this.threshold+"px",this._htmlElement.style.height=this.getAbsHeight()-2*this.threshold+"px")},render:function(a){a.fillRect(0,0,this.getWidth(),this.getHeight()),this.lineWidth>0&&a.strokeRect(0,0,this.getWidth(),this.getHeight()),this.updateCssRegion()},copy:function(){var a=new CGSGNodeDomElement(this.position.x,this.position.y,this.dimension.width,this.dimension.height,this._htmlElement);return a=this._super(a),a.threshold=this.threshold,a}}),CGSGNodeLine=CGSGNode.extend({initialize:function(a){this._pts=a.copy(),this._nbPts=this._pts.length,this._minX=0,this._minY=0,this._maxX=0,this._maxY=0,this.updateMinMax(),this._super(this._minX,this._minY,this._maxX-this._minX,this._maxY-this._minY),this.resizeTo(this._maxX-this._minX,this._maxY-this._minY),this.pickNodeMethod=CGSGPickNodeMethod.REGION,this.classType="CGSGNodeLine"},render:function(a){a.beginPath(),a.moveTo(this._pts[0].x-this._minX,this._pts[0].y-this._minY);for(var b=1;b<this._nbPts;b++)a.lineTo(this._pts[b].x-this._minX,this._pts[b].y-this._minY);this.lineWidth>0&&(a.lineWidth=this.lineWidth,a.strokeStyle=this.lineColor,a.stroke())},resizeTo:function(a,b){this.dimension.resizeTo(a,b),this._computeResizedPoints()},resizeBy:function(a,b){this.dimension.resizeBy(a,b),this._computeResizedPoints()},resizeWith:function(a,b){this.dimension.resizeWith(a,b),this._computeResizedPoints()},_computeResizedPoints:function(){var a=this.getWidth()/(this._maxX-this._minX),b=this.getHeight()/(this._maxY-this._minY),c=this.getCenter();if(this.getWidth()>0&&this.getHeight()>0){for(var d=0;d<this._nbPts;d++)this._pts[d].x=a*(this._pts[d].x-c.x)+c.x,this._pts[d].y=b*(this._pts[d].y-c.y)+c.y;this.updateMinMax()}},getCenter:function(){return new CGSGPosition((this._maxX-this._minX)/2,(this._maxY-this._minY)/2)},getMaxX:function(){for(var a,b=this._pts[0].copy().x,c=1;c<this._nbPts;c++)a=this._pts[c].copy().x,a>=b&&(b=a);return b},getMinX:function(){for(var a=this._pts[0].copy().x,b=0,c=1;c<this._nbPts;c++)b=this._pts[c].copy().x,a>=b&&(a=b);return a},getMaxY:function(){for(var a=this._pts[0].copy().y,b=0,c=1;c<this._nbPts;c++)b=this._pts[c].copy().y,b>=a&&(a=b);return a},getMinY:function(){for(var a=this._pts[0].copy().y,b=0,c=1;c<this._nbPts;c++)b=this._pts[c].copy().y,a>=b&&(a=b);return a},updateMinMax:function(){this._maxY=this.getMaxY(),this._minY=this.getMinY(),this._maxX=this.getMaxX(),this._minX=this.getMinX()},setPoints:function(a){this._pts=a.copy(),this._nbPts=this._pts.length,this.updateMinMax(),this.dimension.resizeTo(this._maxX-this._minX,this._maxY-this._minY),this.translateTo(this._minX,this._minY)},getPoints:function(){return this._pts.copy()},getPoint:function(a){return a<this._nbPts&&a>=0?this._pts.slice(a,a+1).copy():this._pts.slice(0,1).copy()},copy:function(){var a=new CGSGNodeLine(this._pts);return this._super(a)}}),CGSGNodeCurveTCB=CGSGNode.extend({initialize:function(a,b){this._super(a,b),this.resizeTo(300,300),this._interpolator=new CGSGInterpolatorTCB,this._keys=[],this._nbKeys=0,this._values=[],this._nbValues=0,this._steps=[],this.classType="CGSGNodeCurveTCB"},addKey:function(a,b,c,d,e){var f=new CGSGKeyFrame(this._nbKeys,{x:a,y:b});f.userData={t:c,c:d,b:e},this._keys.push(f),this._nbKeys++,this._nbKeys>1&&this._steps.push(20);var g=new CGSGNodeSquare(a-2,b-2,4,4);return g.isDraggable=!0,g.userData=f,g.onDrag=this._moveKey.bind(this),this.addChild(g),f},_moveKey:function(a){a.data.node.userData.value.x=a.data.positions[0].x,a.data.node.userData.value.y=a.data.positions[0].y,this.compute()},compute:function(){var a=this._interpolator.compute(this._keys,this._steps);this._values=a.copy(),this._nbValues=this._values.length},render:function(a){if(this._nbValues>0){a.beginPath(),a.moveTo(this._values[0].x,this._values[0].y);for(var b=1;b<this._nbValues;b++)a.lineTo(this._values[b].x,this._values[b].y);this.lineWidth>0&&a.stroke()}},copy:function(){var a=new CGSGNodeCurveTCB(this.position.x,this.position.y);a=this._super(a);for(var b,c=0;c<this._nbKeys;c++)b=this._keys[c],a.addKey(b.value.x,b.value.y,b.userData.t,b.userData.c,b.userData.b);return a.compute(),a}}),CGSGNodeColorPicker=CGSGNode.extend({initialize:function(a,b,c,d){this._super(a,b),this.resizeTo(c,d),this._imgData=null;var e=this;this.onMouseOver=function(a){e._onMouseOverHandler(a)},this.onMouseUp=function(a){e._onClickHandler(a)},this.onClick=function(a){e._onClickHandler(a)},this.onOverColor=null,this.onClickColor=null,this.classType="CGSGNodeColorPicker",this.setPrecomputed(!0)},_onMouseOverHandler:function(a){if(cgsgExist(this.onOverColor)){var b=this.getColorAt(a.data.positions[0]);this.onOverColor(b)}},_onClickHandler:function(a){if(cgsgExist(this.onClickColor)){var b=this.getColorAt(a.data.positions[0]);this.onClickColor(b)}},getColorAt:function(a){var b=this._absPos,c=this.getAbsWidth(),d=this._imgData.data,e=CGSGMath.fixedPoint(a.x-b.x),f=CGSGMath.fixedPoint(a.y-b.y);return{r:d[4*(c*f+e)],g:d[4*(c*f+e)+1],b:d[4*(c*f+e)+2]}},render:function(a){this._imgData=a.createImageData(this.getWidth(),this.getHeight());var b,c,d,e,f,g,h=1,i=0,j=[255,0,0],k=0,l=CGSGMath.fixedPoint(Math.min(.1*this.getWidth(),20)),m=this.getWidth()-l,n=[{index:1,sens:1},{index:0,sens:-1},{index:2,sens:1},{index:1,sens:-1},{index:0,sens:1},{index:2,sens:-1}];d=256/(m/6);var o=this.getHeight()/2;for(b=0;l>b;b++)for(c=0;c<this.getHeight();c++)i=4*(c*this.getWidth()+b),h=1-c/this.getHeight(),this._imgData.data[i+0]=255*h,this._imgData.data[i+1]=255*h,this._imgData.data[i+2]=255*h,this._imgData.data[i+3]=255;for(b=l;b<this.getWidth();b++)if(6>k){for(h=1,c=0;c<this.getHeight();c++)i=4*(c*this.getWidth()+b),o>c?(h=2-c/o,g=CGSGColor.litRGB(j[0],j[1],j[2],h)):(h=1-(c-o)/o,g=CGSGColor.darkenRGB(j[0],j[1],j[2],h)),this._imgData.data[i+0]=g.r,this._imgData.data[i+1]=g.g,this._imgData.data[i+2]=g.b,this._imgData.data[i+3]=255;e=d*n[k].sens,f=j[n[k].index]+e,j[n[k].index]=f,(0>=f||f>=255)&&(j[n[k].index]=Math.min(Math.max(f,0),255),k++)}b=0,c=0,this._isCached||(b=this._absPos.x,c=this._absPos.y),a.putImageData(this._imgData,b,c)}}),CGSGTABHEIGHT=35,CGSGNodeTabMenu=CGSGNode.extend({initialize:function(a,b,c){this._super(a,b),this.resizeTo(c,CGSGTABHEIGHT),this.classType="CGSGNodeTabMenu",this._buttonRadius=4,this._tabsContainer=new CGSGNode(0,0),this._tabsContainer.resizeTo(c,0),this._tabsContainer.color="#A0A0A0",this._tabsContainer.lineWidth=0,this.addChild(this._tabsContainer);var d=new CGSGNodeSquare(0,CGSGTABHEIGHT-this._buttonRadius+1,c,this._buttonRadius);d.bkgcolors[0]="white",d.lineWidth=0,this.addChild(d);var e=new CGSGNodeSquare(0,CGSGTABHEIGHT-this._buttonRadius,c,1);e.bkgcolors[0]="#A0A0A0",e.lineWidth=0,this.addChild(e),this.hideUnderline=new CGSGNodeSquare(0,CGSGTABHEIGHT-this._buttonRadius,c,1),this.hideUnderline.bkgcolors[0]="white",this.hideUnderline.lineWidth=0,this.addChild(this.hideUnderline),this._tabsBaseline=new CGSGNode(0,CGSGTABHEIGHT-this._buttonRadius+1),this._tabsBaseline.resizeTo(c,0),this.addChild(this._tabsBaseline),this.tabs=[],this.onTabChanged=null,this._selectedTab=null},addTab:function(a,b){var c=new CGSGNodeButton(0,0,a);c.setTextClasses(["custom-normal","custom-over","custom-deactivated","custom-selected"]),c.setClasses(["custom-normal","custom-over","custom-deactivated","custom-selected"]);var d={button:c,view:b};this.tabs.push(d);var e=this;return c.onClick=function(){e.selectTab(d)},this._tabsContainer.addChild(c),this._recomputeButtonsWidth(),cgsgExist(this._selectedTab)||this.selectTab(d),d},selectTab:function(a){cgsgExist(this._selectedTab)&&(cgsgExist(this._selectedTab.view)&&(this._selectedTab.view.isVisible=!0,this._selectedTab.view.isTraversable=!0),this._tabsBaseline.detachChild(this._selectedTab.view)),this._tabsBaseline.addChild(a.view),this._selectedTab=a;for(var b=0;b<this.tabs.length;b++)this.tabs[b].view.isVisible=!1,this.tabs[b].view.isTraversable=!1,this.tabs[b].button.setMode(CGSGButtonMode.NORMAL);return cgsgExist(a.view)&&(a.view.isVisible=!0,a.view.isTraversable=!0),a.button.setMode(CGSGButtonMode.SELECTED),this.hideUnderline.translateTo(a.button.position.x,this.hideUnderline.position.y),this.hideUnderline.resizeTo(a.button.getWidth(),1),cgsgExist(this.onTabChanged)&&this.onTabChanged({tab:a}),a},selectTabByIndex:function(a){return this.selectTab(this.tabs[a])},_recomputeButtonsWidth:function(){var a,b=0,c=0;for(a=0;a<this.tabs.length;a++){var d=this.tabs[a].button.getWidth();b+=d,c=Math.max(c,d)}if(b>this.getWidth()||this.tabs.length*c>this.getWidth()){var e=this.getWidth()/this.tabs.length;for(a=0;a<this.tabs.length;a++)this.tabs[a].button.setFixedSize(new CGSGDimension(e,CGSGTABHEIGHT)),this.tabs[a].button.translateTo(a*e,0)}else for(a=0;a<this.tabs.length;a++)this.tabs[a].button.setFixedSize(new CGSGDimension(c,CGSGTABHEIGHT)),this.tabs[a].button.translateTo(a*c,0)}}),CGSGWrapMode={WORD:{space:" "},LETTER:{space:""},SENTENCE:{space:"."}},CGSGNodeText=CGSGNode.extend({initialize:function(a,b,c,d){this._super(a,b),this._text="",this._size=0,this._align=null,this._textBaseline="top",this._strokeColor=null,this.crossed=!1,this._style="",this._typo=null,this._sizeT=0/0,this._variant=null,this._weight=0/0,this._transform=null,this._maxWidth=-1,this._lineHeight=this._size,this._userModifMaxW=!1,this._wrapMode=CGSGWrapMode.LETTER,this._sections=[],this._tabulation="    ",this.pickNodeMethod=CGSGPickNodeMethod.GHOST,this.metrics={width:1},this._nbLines=1,this.classType="CGSGNodeText",this.setText(c,d!==!1),this.setClass("cgsg-p"),this.resizeTo(this.getWidth(),this.getHeight())
},invalidateTheme:function(){this._super();var a=CGSG.cssManager.getAttrInArray(this._cls,"color"),b=CGSG.cssManager.getAttrInArray(this._cls,"font-style"),c=CGSG.cssManager.getAttrInArray(this._cls,"font-variant"),d=CGSG.cssManager.getAttrInArray(this._cls,"font-weight"),e=CGSG.cssManager.getAttrInArray(this._cls,"font-size"),f=CGSG.cssManager.getAttrInArray(this._cls,"font-family"),g=CGSG.cssManager.getAttrInArray(this._cls,"line-height"),h=CGSG.cssManager.getAttrInArray(this._cls,"text-align"),i=CGSG.cssManager.getAttrInArray(this._cls,"text-transform"),j=CGSG.cssManager.getAttrInArray(this._cls,"-webkit-text-stroke-width");cgsgExist(j)||(j=CGSG.cssManager.getAttrInArray(this._cls,"text-stroke-width"));var k=CGSG.cssManager.getAttrInArray(this._cls,"-webkit-text-stroke-color");if(cgsgExist(k)||(k=CGSG.cssManager.getAttrInArray(this._cls,"text-stroke-color")),cgsgExist(a)){var l=CGSGColor.fromString(a);this.color=CGSGColor.rgb2hex(l.r,l.g,l.b)}cgsgExist(b)&&(this._style=b),cgsgExist(c)&&(this._variant=c),cgsgExist(d)&&(this._weight=d),cgsgExist(e)&&(this._sizeT=e,this._size=CGSG.cssManager.getNumber(e),this._lineHeight=this._size),cgsgExist(f)&&(this._typo=f),cgsgExist(g)&&(this._lineHeight=g),cgsgExist(h)&&(this._align=h),cgsgExist(i)&&(this._transform=i),cgsgExist(j)&&(this.lineWidth=j),cgsgExist(k)&&(this.lineColor=k),this._invalidateFont(),!this._userModifMaxW&&cgsgExist(this.metrics)&&(this._maxWidth=0/0,this.computeRealDimension())},setPrecomputed:function(){},_invalidateFont:function(){var a=cgsgExist(this._style)&&this._style.length>0?this._style+" ":"",b=cgsgExist(this._variant)&&this._variant.length>0?this._variant+" ":"",c=cgsgExist(this._weight)&&this._weight.length>0?this._weight+" ":"",d=cgsgExist(this._sizeT)?this._sizeT+" ":"",e=cgsgExist(this._typo)&&this._typo.length>0?this._typo+" ":"";this._fullfont=a+b+c+d+e},setWrapMode:function(a,b){this._wrapMode=a,this.invalidate(),b!==!1&&this.computeRealDimension()},setTabulationString:function(a,b){this._tabulation=a,this._text=this._text.replace(/(\t)/g,this._tabulation),this.invalidate(),b!==!1&&this.computeRealDimension()},setText:function(a,b){this._text=a,this._text=this._text.replace(/(\r\n|\n\r|\r|\n)/g,"\n"),this._text=this._text.replace(/(\t)/g,this._tabulation),this._sections=this._text.split("\n"),b!==!1&&this.computeRealDimension(),this._userModifMaxW||(this._maxWidth=0/0),this.invalidate()},setTextBaseline:function(a,b){this._textBaseline=a,this.invalidate(),b!==!1&&this.computeRealDimension()},setStyle:function(a,b){this._style=a,this._invalidateFont(),this.invalidate(),b!==!1&&this.computeRealDimension()},setLineHeight:function(a,b){this._lineHeight=a,this.invalidate(),b!==!1&&this.computeRealDimension()},setSize:function(a,b){this._size=a,this._invalidateFont(),this.invalidate(),b!==!1&&this.computeRealDimension()},setTypo:function(a,b){this._typo=a,this._invalidateFont(),this.invalidate(),b!==!1&&this.computeRealDimension()},setWeight:function(a){this._weight=a,this._invalidateFont(),this.invalidate()},setVariant:function(a){this._variant=a,this._invalidateFont(),this.invalidate()},setTextAlign:function(a){this._align=a,this.invalidate()},computeRealDimension:function(){this.metrics.width=0;var a=document.createElement("canvas"),b=a.getContext("2d");this._doRender(b,!1),a.width=0,a.height=0,a=null},_setMaxW:function(a,b){this._maxWidth=a,this._maxWidth>0&&(this.dimension.width=a,b!==!1&&this.computeRealDimension())},setMaxWidth:function(a,b){this._userModifMaxW=!0,this._setMaxW(a,b)},resizeWith:function(a){this._maxWidth+a>0&&this._afterResize(this._maxWidth+a)},_afterResize:function(a){var b=this.getWidth();this._maxWidth=a,this.computeRealDimension(),1===this._nbLines&&this.getWidth()<=b&&(this._maxWidth=this.getWidth()+1),this._applyContraintsToFollowers(),this._endResize()},render:function(a){a.fillStyle=this.color||this.bkgcolors[0],this._doRender(a,!1)},_doRender:function(a,b){a.font=this._fullfont,a.textAlign=this._align,a.textBaseline=this._textBaseline;var c,d=0,e=0,f=0,g=0;if(this.crossed&&(a.save(),a.strokeStyle="grey",a.moveTo(this.getWidth(),3),a.lineTo(0,this.getHeight()+3),a.stroke(),a.restore()),!cgsgExist(this._maxWidth)||this._maxWidth<=0){for(f=this._computeDecalX(this.getWidth()),d=0;d<this._sections.length;d++)e=a.measureText(this._sections[d]).width,this._drawText(this._sections[d],f,g,a,b,e),g+=this._lineHeight;this._nbLines=this._sections.length}else for(this._nbLines=0,d=0;d<this._sections.length;d++){var h=this._sections[d].split(this._wrapMode.space),i=0,j="";if(g=0,e=0,1===h.length)e=a.measureText(j).width,g=this._nbLines*this._lineHeight,f=this._computeDecalX(this.getWidth()),this._drawText(j,f,g,a,b,e),this._nbLines++;else for(;i<h.length;){for(j=h[i],c=a.measureText(j+this._wrapMode.space+h[i+1]);c.width<this._maxWidth&&i<h.length-1;)""!==j&&(j+=this._wrapMode.space),j+=h[++i],c=a.measureText(j+this._wrapMode.space+h[i+1]);e=a.measureText(j).width,g=this._nbLines*this._lineHeight,f=this._computeDecalX(this.getWidth()),this._drawText(j,f,g,a,b,e),this._nbLines++,++i}}var k;if(k=null!==this.nodeConstraint?this.nodeConstraint.getAbsoluteRegion():this.regionConstraint,null!==k){var l=(this.getAbsoluteRegion(),this.getAbsBottom()-(k.position.x+k.dimension.height));l>0&&this.translateWith(0,-l)}},_drawText:function(a,b,c,d,e,f){if(cgsgExist(this._transform)&&("capitalize"===this._transform&&(a=a.capitalize()),"lowercase"===this._transform&&(a=a.toLowerCase()),"uppercase"===this._transform&&(a=a.toUpperCase())),e)return void this._drawSquare(b,c,f,d);cgsgExist(this.lineWidth)&&this.lineWidth>0&&d.strokeText(a,b,c),cgsgExist(d.fillStyle)&&this.globalAlpha>0&&d.fillText(a,b,c);var g=d.measureText(a);g.width>this.metrics.width&&(this.metrics.width=g.width)},_drawSquare:function(a,b,c,d){d.fillRect(a-this._computeDecalX(c),b+this._computeDecalY(),c,this._size)},getHeight:function(){return 0===this._nbLines?this._nbLines:(this._nbLines-1)*this._lineHeight+this._size},getWidth:function(){return this.metrics.width},_computeDecalX:function(a){var b=0;return"start"===this._align||"left"===this._align?b=0:"center"===this._align?b=a/2:("end"===this._align||"right"===this._align)&&(b=a),b},_computeDecalY:function(){var a=0;return"top"===this._textBaseline||"hanging"===this._textBaseline?a=this._size/cgsgCurrentExplorer.textDecalYTop:"middle"===this._textBaseline?a=-this._size/cgsgCurrentExplorer.textDecalYMiddle:"alphabetic"===this._textBaseline||"ideographic"===this._textBaseline?a=-this._size*cgsgCurrentExplorer.textDecalYAlpha:"bottom"===this._textBaseline&&(a=-this._size*cgsgCurrentExplorer.textDecalYBottom),a},doRenderGhost:function(a){this.beforeRenderGhost(a),this.globalAlpha>0&&(this.renderGhost(a),a.fillStyle=CGSG.ghostColor,this._doRender(a,!0)),this.afterRenderGhost(a)},renderBoundingBox:function(a){var b=0,c=this._computeDecalY(),d=this.getHeight(),e=this.getWidth();if(cgsgExist(this.selectionLineWidth)&&this.selectionLineWidth>0&&(a.strokeStyle=this.selectionLineColor,a.lineWidth=this.selectionLineWidth/this._absSca.y,a.beginPath(),a.moveTo(b,c),a.lineTo(e,c),a.moveTo(b,c+d),a.lineTo(e,c+d),a.stroke(),a.closePath(),a.lineWidth=this.selectionLineWidth/this._absSca.x,a.beginPath(),a.moveTo(b,c),a.lineTo(b,c+d),a.moveTo(b+e,c),a.lineTo(b+e,c+d),a.stroke(),a.closePath()),this.isResizable){var f=this.handleSize/(2*this._absSca.x),g=this.handleSize/(2*this._absSca.y);this.handles[0].translateTo(-f,-g+c),this.handles[1].translateTo(e/2-f,-g+c),this.handles[2].translateTo(e-f,-g+c),this.handles[3].translateTo(-f,d/2-g+c),this.handles[4].translateTo(e-f,d/2-g+c),this.handles[6].translateTo(e/2-f,d-g+c),this.handles[5].translateTo(-f,d-g+c),this.handles[7].translateTo(e-f,d-g+c);for(var h=0;8>h;h++)this.handles[h].size=this.handleSize,this.handles[h].fillColor=this.handleColor,this.handles[h].strokeColor=this.selectionLineColor,this.handles[h].lineWidth=this.selectionLineWidth,this.handles[h].render(a)}},copy:function(){var a=new CGSGNodeText(this.position.x,this.position.y,this._text);return a=this._super(a),a.setSize(this._size,!1),a.setTextAlign(this._align,!1),a.setTextBaseline(this._textBaseline,!1),a.setStroke(this.lineWidth,!1),a.setTypo(this._typo,!1),a._setMaxW(this._maxWidth,!1),a.setLineHeight(this._lineHeight,!1),a.setWrapMode(this._wrapMode,!1),a.setTabulationString(this._tabulation,!1),a.pickNodeMethod=this.pickNodeMethod,this.setText(this._text,!0),this.resizeTo(this.getWidth(),this.getHeight()),a}}),CGSGWEBVIEWMODE={LIVE:0,PREVIEW:1},CGSGNodeWebview=CGSGNodeDomElement.extend({initialize:function(a,b,c,d,e){this._super(a,b,c,d,document.createElement("iframe")),this.resizeTo(CGSGMath.fixedPoint(c),CGSGMath.fixedPoint(d)),this.threshold=20,this.classType="CGSGNodeWebview",this._previewContainer=null,this._url=e,this._previewURL=null,this._createLiveContainer(),this._createPreviewContainer(),this.switchMode(CGSGWEBVIEWMODE.LIVE)},_initLiveContainer:function(){cgsgExist(this._htmlElement)||this._createLiveContainer(),document.body.appendChild(this._htmlElement)},_initPreviewContainer:function(){cgsgExist(this._previewContainer)||this._createPreviewContainer(),this.addChild(this._previewContainer)},_createLiveContainer:function(){var a="";cgsgExist(this._url)&&(a=this._url),this._htmlElement.style.position="absolute",this._htmlElement.setAttribute("src",a)},_createPreviewContainer:function(){this._previewContainer=new CGSGNodeImage(0,0,this._previewURL),this._previewContainer.isTraversable=!1},setURL:function(a){this._url=a,cgsgExist(this._htmlElement)&&this._htmlElement.setAttribute("src",this._url)},getURL:function(){return this._url},setPreviewURL:function(a){this._previewURL=a,this._previewContainer.setURL(this._previewURL)},switchMode:function(a){a===CGSGWEBVIEWMODE.LIVE?(this.detachChild(this._previewContainer),this._initLiveContainer()):(this._mode===CGSGWEBVIEWMODE.LIVE&&document.body.removeChild(this._htmlElement),this._initPreviewContainer()),this._mode=a},getCurrentMode:function(){return this._mode},render:function(a){this._mode===CGSGWEBVIEWMODE.LIVE?(a.fillRect(0,0,this.dimension.width,this.dimension.height),a.strokeRect(0,0,this.dimension.width,this.dimension.height),a.strokeRect(this.threshold-2,this.threshold-2,8+this.dimension.width-2*this.threshold,8+this.dimension.height-2*this.threshold),cgsgExist(this._htmlElement)&&(this._htmlElement.style.left=this.getAbsLeft()+this.threshold+"px",this._htmlElement.style.top=this.getAbsTop()+this.threshold+"px",this._htmlElement.style.width=this.getAbsWidth()-2*this.threshold+"px",this._htmlElement.style.height=this.getAbsHeight()-2*this.threshold+"px")):(this._previewContainer.resizeTo(this.getWidth(),this.getHeight()),a.fillRect(0,0,this.getWidth(),this.getHeight()))},free:function(){cgsgExist(this._htmlElement)&&(CGSG.canvas.removeChild(this._htmlElement),delete this._htmlElement),this._super()},copy:function(){var a=new CGSGNodeWebview(this.position.x,this.position.y,this.dimension.width,this.dimension.height,this.url);return a=this._super(a),a.threshold=this.threshold,a.switchMode(this.mode),a}}),CGSGNodeSquare=CGSGNode.extend({initialize:function(a,b,c,d){this._super(a,b),this.resizeTo(c,d),this.classType="CGSGNodeSquare"},render:function(a){if(!cgsgExist(this.borderRadius)||this.borderRadius<=0)a.fillRect(0,0,this.dimension.width,this.dimension.height),this.lineWidth>0&&a.strokeRect(0,0,this.dimension.width,this.dimension.height);else{a.save();var b=this.borderRadius,c=this.dimension.width,d=this.dimension.height,e=b+c,f=b+d;a.translate(-b,-b),a.beginPath(),a.moveTo(2*b,b),a.lineTo(c,b),a.quadraticCurveTo(e,b,e,b+b),a.lineTo(e,d),a.quadraticCurveTo(e,f,c,f),a.lineTo(b+b,f),a.quadraticCurveTo(b,f,b,d),a.lineTo(b,b+b),a.quadraticCurveTo(b,b,b+b,b),a.closePath(),a.fill(),this.lineWidth>0&&a.stroke(),a.restore()}},copy:function(){var a=new CGSGNodeSquare(this.position.x,this.position.y,this.dimension.width,this.dimension.height);return this._super(a)}}),CGSGNodeSliderHandle=CGSGNode.extend({initialize:function(a){this._super(0,0),this.resizeTo(a,a),this.bkgcolors=["#CCCCCC"],this.rotationCenter=new CGSGPosition(.5,.5),this.handleWidth=a,this.isDraggable=!0,this.onDrag=this.onSlide},getParentSlider:function(){return this._parentNode},onSlide:function(){this.handleWidth=2*Math.min(this._parentNode.getHeight(),this._parentNode.getWidth());var a=this.handleWidth/2,b=this.position.x;-a>b?b=-a:b>this._parentNode.getWidth()-a&&(b=this._parentNode.getWidth()-a),this.translateTo(b,-this.handleWidth/4);var c=this._parentNode.max-this._parentNode.min;this._parentNode.value=(this.position.x+a)*(c/this._parentNode.getWidth())+this._parentNode.min},render:function(a){this.handleWidth=2*Math.min(this._parentNode.getHeight(),this._parentNode.getWidth());var b=this.handleWidth/10;a.lineWidth=2,a.strokeStyle=CGSGColor.darkenHex(this.bkgcolors[0],.7);var c=a.createLinearGradient(this.handleWidth,0,this.handleWidth,this.handleWidth);c.addColorStop(.3,this.bkgcolors[0]),c.addColorStop(1,CGSGColor.darkenHex(this.bkgcolors[0],.7)),a.fillStyle=c,a.beginPath(),a.arc(b,b,b,Math.PI,-Math.PI/2,!1),a.lineTo(this.handleWidth-b,0),a.arc(this.handleWidth-b,b,b,-Math.PI/2,0,!1),a.lineTo(this.handleWidth,this.handleWidth-b),a.arc(this.handleWidth-b,this.handleWidth-b,b,0,Math.PI/2,!1),a.lineTo(b,this.handleWidth),a.arc(b,this.handleWidth-b,b,Math.PI/2,Math.PI,!1),a.closePath(),a.fill(),a.stroke()}}),CGSGNodeSlider=CGSGNode.extend({initialize:function(a,b,c,d){this._super(a,b),this.resizeTo(c,d),this.backgroundColor="#EEEEEE",this.valueColor="#50479E",this.min=-10,this.max=10,this.value=5,this.rotationCenter=new CGSGPosition(.5,.5),this.onResize=this.updateSliderHandle,this.setHandle()},render:function(a){a.save(),this.outlineShape(a),this.renderBackground(a),this.renderValue(a),a.restore()},outlineShape:function(a){var b=Math.min(this.getWidth(),this.getHeight())/2,c=this.getWidth();a.beginPath(),a.arc(b,b,b,Math.PI/2,-Math.PI/2,!1),a.lineTo(c-b,0),a.arc(c-b,b,b,-Math.PI/2,Math.PI/2,!1),a.lineTo(b,2*b),a.closePath(),a.clip()},renderBackground:function(a){a.fillStyle=this.backgroundColor,a.strokeStyle=CGSGColor.darkenHex(this.backgroundColor,.8),a.lineWidth=4;var b=Math.min(this.getWidth(),this.getHeight())/2,c=this.getWidth();a.beginPath(),a.arc(b,b,b,Math.PI/2,-Math.PI/2,!1),a.lineTo(c-b,0),a.arc(c-b,b,b,-Math.PI/2,Math.PI/2,!1),a.lineTo(b,2*b),a.closePath(),a.fill(),a.stroke(),a.shadowColor="black",a.shadowBlur=15,a.shadowOffsetX=0,a.shadowOffsetY=0,a.beginPath(),a.rect(0,-this.getHeight(),this.getWidth(),this.getHeight()),a.closePath(),a.fill()},renderValue:function(a){var b=this.getWidth()/Math.abs(this.max-this.min)*Math.abs(this.value-this.min),c=a.createLinearGradient(b,0,b,this.getHeight());c.addColorStop(.7,CGSGColor.darkenHex(this.valueColor,1.5)),c.addColorStop(1,this.valueColor),a.fillStyle=c,a.beginPath(),a.rect(0,0,b,this.getHeight()),a.closePath(),a.fill()},updateSliderHandle:function(){var a=2*Math.min(this.getWidth(),this.getHeight()),b=this.getWidth()/Math.abs(this.max-this.min)*Math.abs(this.value-this.min);this.handle.resizeTo(a,a),this.handle.translateTo(b-a/2,-a/4)},setHandle:function(a){this.handle=a;var b=2*Math.min(this.getWidth(),this.getHeight());void 0===a&&(this.handle=new CGSGNodeSliderHandle(b),this.handle.color=this.backgroundColor),this.addChild(this.handle);var c=this.getWidth()/Math.abs(this.max-this.min)*Math.abs(this.value-this.min);this.handle.translateTo(c-b/4,-b/4)},getHandle:function(){return this.handle},setMin:function(a){null!==a&&a!==this.min&&a<this.max&&(this.min=a,this.updateSliderHandle())},setMax:function(a){null!==a&&a!==this.max&&a>this.min&&(this.max=a,this.updateSliderHandle())},setValue:function(a){a>=this.min&&a<=this.max&&(this.value=a,this.updateSliderHandle())},getValueAsRangeRatio:function(){return 1-Math.abs((this.value+this.min)/(this.max-this.min))}}),CGSGNodeCircle=CGSGNode.extend({initialize:function(a,b,c){this.classType="CGSGNodeCircle",this.radius=c,this._center=new CGSGPosition(a+c,b+c),this._super(a,b),this.resizeTo(2*c,2*c),this.isProportionalResizeOnly=!0},render:function(a){a.save(),a.beginPath(),a.arc(this.radius,this.radius,this.radius,0,2*Math.PI,!1),a.fill(),this.lineWidth>0&&a.stroke(),a.restore()},_resize:function(){this.radius=CGSGMath.fixedPoint(this.dimension.width/2),this._isDimensionChanged=!0,this.invalidate(),cgsgExist(this.onResize)&&CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_RESIZE,new CGSGEvent(this,{node:this}))},resizeTo:function(a,b){var c=Math.min(a,b);this.dimension.resizeTo(c,c),this._resize()},resizeBy:function(a,b){var c=a*this.dimension.width,d=b*this.dimension.height,e=d>c?a:b;this.dimension.resizeBy(e,e),this._resize()},resizeWith:function(a,b){var c=a+this.dimension.width,d=b+this.dimension.height,e=d>c?a:b;this.dimension.resizeWith(e,e),this._resize()},copy:function(){var a=new CGSGNodeCircle(this.position.x,this.position.y,this.radius);return this._super(a)}}),CGSGNodeEllipse=CGSGNode.extend({initialize:function(a,b,c,d){this._super(a,b),this.resizeTo(c,d),this._f=1.16666666,this._mf=1-this._f,this._w=0,this._mw=0,this._computeWmW(),this.classType="CGSGNodeEllipse",this.pickNodeMethod=CGSGPickNodeMethod.GHOST},render:function(a){var b=this.dimension.width/2;a.beginPath(),a.moveTo(b,0),a.bezierCurveTo(this._w,0,this._w,this.dimension.height,b,this.dimension.height),a.bezierCurveTo(this._mw,this.dimension.height,this._mw,0,b,0),a.fill(),this.lineWidth>0&&a.stroke(),a.closePath()},_computeWmW:function(){this._w=this.dimension.width*this._f,this._mw=this.dimension.width*this._mf},resizeTo:function(a,b){this._super(a,b),this._computeWmW()},resizeBy:function(a,b){this._super(a,b),this._computeWmW()},resizeWith:function(a,b){this._super(a,b),this._computeWmW()},copy:function(){var a=new CGSGNodeEllipse(this.position.x,this.position.y,this.dimension.width,this.dimension.height);return this._super(a)}}),CGSGNodeImage=CGSGNode.extend({initialize:function(a,b,c){this._super(a,b),this.classType="CGSGNodeImage",this.effect=null,this._urlImage=c,this.isProportionalResize=!0,this._img=new Image,this.slice=new CGSGRegion(0,0,0,0),this.isLoaded=!1,this.onLoadEnd=null,this.onLoadError=null,this.onLoadAbort=null,cgsgExist(this._urlImage)&&""!==this._urlImage&&this.setURL(c)},_createDelegate:function(a,b){return function(){return b.call(a)}},_onImageLoaded:function(a){this.checkDimension(),this.isLoaded=!0,cgsgExist(a)&&cgsgImgManager.set(this._urlImage,this.img),cgsgExist(this.onLoadEnd)&&CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_LOAD_END,new CGSGEvent(this,{node:this})),this.invalidate()},_onImageError:function(){null!==this.onLoadError&&CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_LOAD_ERROR,new CGSGEvent(this,{node:this}))},_onImageAbort:function(){null!==this.onLoadAbort&&CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_LOAD_ABORT,new CGSGEvent(this,{node:this}))},checkDimension:function(){this._isDimensionChanged||this.dimension.width<=0&&this.dimension.height<=0&&(this.dimension.width=this._img.width,this.dimension.height=this._img.height),(this.slice.dimension.width<=0||this.slice.dimension.height<=0)&&(this.slice.dimension.width=this._img.width,this.slice.dimension.height=this._img.height)},setSlice:function(a,b,c,d,e){this.slice.position.x=a,this.slice.position.y=b,this.slice.dimension.width=c,this.slice.dimension.height=d,e&&this.resizeTo(c,d),this.invalidate()},setImage:function(a){this._img=a,cgsgExist(this._img)?this._setUrl(this._img.src):(this._urlImage=null,this.isLoaded=!1,this.invalidate())},setURL:function(a){this._urlImage=a,this._img=cgsgImgManager.get(a),cgsgExist(this._img)?this._onImageLoaded(null):(delete this._img,this.isLoaded=!1,this._img=new Image,this._img.onload=this._createDelegate(this,this._onImageLoaded),this._img.onerror=this._createDelegate(this,this._onImageError),this._img.onabort=this._createDelegate(this,this._onImageAbort),this._img.src=this._urlImage)},_setUrl:function(a){this._urlImage=a,this.isLoaded=!0,this.checkDimension(),this.invalidate()},getImage:function(){return this._img},render:function(a){this.isLoaded&&""!==this._img.src&&!this.slice.isEmpty()&&a.drawImage(this._img,this.slice.position.x,this.slice.position.y,this.slice.dimension.width,this.slice.dimension.height,0,0,this.getWidth(),this.getHeight())},setEffect:function(a){this.effect=a},copy:function(a){return cgsgExist(a)||(a=new CGSGNodeImage(this.position.x,this.position.y,null)),a=this._super(a),a._urlImage=this._urlImage,a.effect=this.effect,a.isProportionalResize=this.isProportionalResize,a._isLoaded=this.isLoaded,a.setImage(this._img),a.setSlice(this.slice.position.x,this.slice.position.y,this.slice.dimension.width,this.slice.dimension.height,!0),a.resizeTo(this.dimension.width,this.dimension.height),a.onLoadEnd=this.onLoadEnd,a}}),CGSGNodeSprite=CGSGNode.extend({initialize:function(a,b,c){this._super(a,b),this.classType="CGSGNodeSprite",this.listAnimations=[],this.currentAnimation=null,this.isProportionalResize=!0,this._currentFrame=0,this._isPlaying=!1,this._numberOfLoops=1,this._currentLoop=0,this._urlImage=c,this._img=new Image,this._isLoaded=!1,this.onLoadEnd=null,this.onAnimationEnd=null,this.onAnimationStart=null,null!==this._urlImage&&""!==this._urlImage&&(this._img.onload=this._createDelegate(this,this._onImageLoaded),this._img.src=this._urlImage)},_createDelegate:function(a,b){return function(){return b.call(a)}},_onImageLoaded:function(){this.checkDimension(),this._isLoaded=!0,null!==this.onLoadEnd&&CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_LOAD_END,new CGSGEvent(this,{node:this})),this.invalidate()},_onImageError:function(){console.log("Error while loading image : "+this._urlImage)},checkDimension:function(){this.dimension.width<=0&&this.dimension.height<=0&&(this.dimension.width=this._img.width,this.dimension.height=this._img.height)},setImage:function(a){this._img=a,cgsgExist(this._img)&&(this._urlImage=this._img.src,this._isLoaded=!0,this.invalidate())},goToNextFrame:function(){this._currentFrame+=1/this.currentAnimation.speed;var a=!1;this._currentFrame>=this.currentAnimation.frames&&(a=!0),a&&(this._numberOfLoops<0||this._currentLoop<this._numberOfLoops?(this._currentLoop++,this.goToFirstFrame()):(this.goToLastFrame(),this.stop())),this.invalidate()},goToPreviousFrame:function(){this._currentFrame-=this.currentAnimation.speed;var a=!1;this._currentFrame<0&&(a=!0),a&&(this._numberOfLoops<=0||this._currentLoop>=0?(this._currentLoop--,this.goToLastFrame()):(this.goToFirstFrame(),this.stop())),this.invalidate()},goToFirstFrame:function(){this._currentFrame=0,this.invalidate()},goToLastFrame:function(){this._currentFrame=this.currentAnimation.frames-1,this.invalidate()},render:function(a){if(this._isLoaded&&""!==this._img.src&&cgsgExist(this.currentAnimation)){a.globalAlpha=this.globalAlpha;var b=this.currentAnimation.slices[Math.floor(this._currentFrame)];a.drawImage(this._img,b.x,b.y,this.currentAnimation.width,this.currentAnimation.height,0,0,this.dimension.width,this.dimension.height),this.lineWidth>0&&a.stroke(),this._isPlaying&&(this.goToNextFrame(),this.invalidate())}},_getSlice:function(a,b){var c=a%b.framesPerLine,d=Math.floor(a/b.framesPerLine),e=b.sliceX+c*b.width,f=b.sliceY+d*b.height;return{x:e,y:f}},addAnimation:function(a,b,c,d,e,f,g,h){for(var i={name:a,speed:b,frames:c,sliceX:d,sliceY:e,width:f,height:g,framesPerLine:h,slices:[]},j=0;c>j;j++)i.slices.push(this._getSlice(j,i));this.listAnimations.push(i),1===this.listAnimations.length&&(this.currentAnimation=i),this.dimension.width=f,this.dimension.height=g},play:function(a,b){(void 0===b||null===b)&&(b=-1),this.currentAnimation=null;for(var c=0;c<this.listAnimations.length;c++)if(this.listAnimations[c].name===a)return this.currentAnimation=this.listAnimations[c],this.dimension.width=this.currentAnimation.width,this.dimension.height=this.currentAnimation.height,this.reset(),this._numberOfLoops=b,this._isPlaying=!0,this.resizeTo(this.currentAnimation.width,this.currentAnimation.height),null!==this.onAnimationStart&&CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_ANIMATION_START,new CGSGEvent(this,{node:this,animationName:a,loop:b})),!0;return!1},stop:function(){this._isPlaying=!1,null!==this.onAnimationEnd&&(CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_ANIMATION_END,new CGSGEvent(this,{node:this,animationName:this.currentAnimation.name,loop:this._currentLoop,frame:this._currentFrame})),this.onAnimationEnd({animationName:this.currentAnimation.name,loop:this._currentLoop,frame:this._currentFrame})),this.invalidate()},reset:function(){this._currentFrame=0,this._currentLoop=1,this.invalidate()},copy:function(){var a=new CGSGNodeSprite(this.position.x,this.position.y,this._urlImage);a=this._super(a),a.listAnimations=[];for(var b=0;b<this.listAnimations.length;b++)a.addAnimation(this.listAnimations[b].name,this.listAnimations[b].speed,this.listAnimations[b].frames,this.listAnimations[b].sliceX,this.listAnimations[b].sliceY,this.listAnimations[b].width,this.listAnimations[b].height,this.listAnimations[b].framesPerLine);return a.currentAnimation=this.currentAnimation,a.isProportionalResize=this.isProportionalResize,a._currentFrame=this._currentFrame,a._isPlaying=this._isPlaying,a._numberOfLoops=this._numberOfLoops,a._currentLoop=this._currentLoop,a._img=this._img,a._isLoaded=this._isLoaded,a.onLoadEnd=this.onLoadEnd,a.onAnimationEnd=this.onAnimationEnd,a.onAnimationStart=this.onAnimationStart,null!==this._urlImage&&""!==this._urlImage&&(a._img.onload=a._createDelegate(a,a._onImageLoaded,a.context),a._img.src=a._urlImage),a}}),CGSGNodeButtonProps=CGSGObject.extend({initialize:function(){this.cls=[],this.firstColor="",this.lastColor="",this.shadowColor="",this.radius=0,this.lineWidth=0,this.lineColor="",this.paddingV=10,this.paddingH=10,this.txtNode=new CGSGNodeText(0,0,""),this.slice=null,this.icon=null,this.dimension=new CGSGDimension(10,10),this._invalSize=!0}}),CGSGButtonMode={NORMAL:{id:0,isClickable:!0},OVER:{id:1,isClickable:!0},DEACTIVATED:{id:2,isClickable:!1},SELECTED:{id:3,isClickable:!0}},CGSGPositionMode={TOP:{index:0,decalX:0,decalY:-1,dt:1,dy:1,computeWidth:function(a,b){return Math.max(a,b)},computeHeight:function(){return 0}},BOTTOM:{index:1,decalX:0,decalY:1,dt:0,dy:1,computeWidth:function(a,b){return Math.max(a,b)},computeHeight:function(){return 0}},LEFT:{index:2,decalX:-1,decalY:0,dt:0,dy:0,computeWidth:function(){return 0},computeHeight:function(a,b){return Math.max(a,b)}},RIGHT:{index:3,decalX:1,decalY:0,dt:1,dy:0,computeWidth:function(){return 0},computeHeight:function(a,b){return Math.max(a,b)}}},CGSGNodeButton=CGSGNode.extend({initialize:function(a,b,c){this._props=[new CGSGNodeButtonProps,new CGSGNodeButtonProps,new CGSGNodeButtonProps,new CGSGNodeButtonProps],this._super(a,b),this._needRedraw=!1,this._pictoPosition=CGSGPositionMode.LEFT,this._distancePictoText=10,this._tmpCanvases=[document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas")],this.classType="CGSGNodeButton",this._currentMode=CGSGButtonMode.NORMAL,this.setMode(this._currentMode),this.setClassFor("cgsg-button",CGSGButtonMode.NORMAL),this.setClassFor("cgsg-button-over",CGSGButtonMode.OVER),this.setClassFor("cgsg-button-deactivated",CGSGButtonMode.DEACTIVATED),this.setClassFor("cgsg-button-selected",CGSGButtonMode.SELECTED),this._props[0].txtNode.addClass("cgsg-button-text"),this._props[1].txtNode.addClass("cgsg-button-over-text"),this._props[2].txtNode.addClass("cgsg-button-deactivated-text"),this._props[3].txtNode.addClass("cgsg-button-selected-text"),this.setTexts(c);var d=this;this.onMouseOver=function(){d.getMode()===CGSGButtonMode.NORMAL&&d.setMode(CGSGButtonMode.OVER)},this.onMouseOut=function(){d.getMode()===CGSGButtonMode.OVER&&d.setMode(CGSGButtonMode.NORMAL)},this._isInitialized=!0},setPictoPosition:function(a){this._pictoPosition=a,this.forceRedraw()},setClassFor:function(a,b){this._props[b.id].cls=[],this._props[b.id].cls.push(a),this._props[b.id]._invalSize=!1,this._needRedraw=!1,this._loadAttrs(b),this._initShape(b)},setClass:function(a){this._clearAllCls(),this._props[CGSGButtonMode.NORMAL.id].cls.push(a),this._props[CGSGButtonMode.OVER.id].cls.push(a),this._props[CGSGButtonMode.DEACTIVATED.id].cls.push(a),this._props[CGSGButtonMode.SELECTED.id].cls.push(a),this.invalidateTheme()},setClasses:function(a){this._clearAllCls(),this._props[CGSGButtonMode.NORMAL.id].cls.push(a[0]),this._props[CGSGButtonMode.OVER.id].cls.push(a[1]),this._props[CGSGButtonMode.DEACTIVATED.id].cls.push(a[2]),this._props[CGSGButtonMode.SELECTED.id].cls.push(a[3]),this.invalidateTheme()},_clearAllCls:function(){this._props[CGSGButtonMode.NORMAL.id].cls=[],this._props[CGSGButtonMode.OVER.id].cls=[],this._props[CGSGButtonMode.DEACTIVATED.id].cls=[],this._props[CGSGButtonMode.SELECTED.id].cls=[]},addClassFor:function(a,b){this._props[b.id].cls.push(a),this._props[b.id]._invalSize=!1,this._needRedraw=!1,this._loadAttrs(b),this._initShape(b)},addClass:function(a){this._props[CGSGButtonMode.NORMAL.id].cls.push(a),this._props[CGSGButtonMode.OVER.id].cls.push(a),this._props[CGSGButtonMode.DEACTIVATED.id].cls.push(a),this._props[CGSGButtonMode.SELECTED.id].cls.push(a),this.invalidateTheme()},addClasses:function(a){this._props[CGSGButtonMode.NORMAL.id].cls.push(a[0]),this._props[CGSGButtonMode.OVER.id].cls.push(a[1]),this._props[CGSGButtonMode.DEACTIVATED.id].cls.push(a[2]),this._props[CGSGButtonMode.SELECTED.id].cls.push(a[3]),this.invalidateTheme()},removeClassFor:function(a,b){this._props[b.id].cls=this._props[b.id].cls.without(a),this.forceRedraw(),this._loadAttrs(b),this._initShape(b)},removeClass:function(a){this._props[CGSGButtonMode.NORMAL.id].cls=this._props[CGSGButtonMode.NORMAL.id].without(a),this._props[CGSGButtonMode.OVER.id].cls=this._props[CGSGButtonMode.OVER.id].without(a),this._props[CGSGButtonMode.DEACTIVATED.id].cls=this._props[CGSGButtonMode.DEACTIVATED.id].without(a),this._props[CGSGButtonMode.SELECTED.id].cls=this._props[CGSGButtonMode.SELECTED.id].without(a),this.invalidateTheme()},setImageFor:function(a,b){this._props[b.id].icon.setImage(a)},setImage:function(a){this._checkIcon(),this.setImageFor(a,CGSGButtonMode.NORMAL),this.setImageFor(a,CGSGButtonMode.OVER),this.setImageFor(a,CGSGButtonMode.DEACTIVATED),this.setImageFor(a,CGSGButtonMode.SELECTED),this._needRedraw=!0},setImageURL:function(a){this._checkIcon(),this._props[CGSGButtonMode.NORMAL.id].icon.onLoadEnd=this._onLoadImageEndAll.bind(this),this._props[CGSGButtonMode.NORMAL.id].icon.setURL(a)},setImageURLFor:function(a,b){this._props[b.id].icon.onLoadEnd=this._onLoadImageEndFor.bind(this),this._props[b.id].icon.setURL(a)},_onLoadImageEndFor:function(){this.forceRedraw()},_onLoadImageEndAll:function(){var a=this._props[CGSGButtonMode.NORMAL.id].icon.getImage();this._props[CGSGButtonMode.OVER.id].icon.setImage(a),this._props[CGSGButtonMode.DEACTIVATED.id].icon.setImage(a),this._props[CGSGButtonMode.SELECTED.id].icon.setImage(a),this.forceRedraw()},_checkIcon:function(){this._checkIconFor(CGSGButtonMode.NORMAL),this._checkIconFor(CGSGButtonMode.OVER),this._checkIconFor(CGSGButtonMode.DEACTIVATED),this._checkIconFor(CGSGButtonMode.SELECTED)},_checkIconFor:function(a){cgsgExist(this._props[a.id].icon)||(this._props[a.id].icon=new CGSGNodeImage(0,0,null))},getTexts:function(){return[CGSGButtonMode.NORMAL.props.txtNode._text,CGSGButtonMode.OVER.props.txtNode._text,CGSGButtonMode.DEACTIVATED.props.txtNode._text,CGSGButtonMode.SELECTED.props.txtNode._text]},forceRedraw:function(){this._needRedraw=!0,this._props[CGSGButtonMode.NORMAL.id]._invalSize=!0,this._props[CGSGButtonMode.OVER.id]._invalSize=!0,this._props[CGSGButtonMode.DEACTIVATED.id]._invalSize=!0,this._props[CGSGButtonMode.SELECTED.id]._invalSize=!0},setTexts:function(a){if(!cgsgIsArray(a)){var b=a.toString();a=[b,b,b,b]}this._props[CGSGButtonMode.NORMAL.id].txtNode.setText(a[0],!0),this._props[CGSGButtonMode.OVER.id].txtNode.setText(a[1],!0),this._props[CGSGButtonMode.DEACTIVATED.id].txtNode.setText(a[2],!0),this._props[CGSGButtonMode.SELECTED.id].txtNode.setText(a[3],!0),this.forceRedraw()
},setTextClass:function(a){this._props[CGSGButtonMode.NORMAL.id].txtNode.setClass(a),this._props[CGSGButtonMode.OVER.id].txtNode.setClass(a),this._props[CGSGButtonMode.DEACTIVATED.id].txtNode.setClass(a),this._props[CGSGButtonMode.SELECTED.id].txtNode.setClass(a),this.invalidate()},setTextClasses:function(a){this._props[CGSGButtonMode.NORMAL.id].txtNode.setClass(a[0]),this._props[CGSGButtonMode.OVER.id].txtNode.setClass(a[1]),this._props[CGSGButtonMode.DEACTIVATED.id].txtNode.setClass(a[2]),this._props[CGSGButtonMode.SELECTED.id].txtNode.setClass(a[3]),this.invalidate()},setTextClassFor:function(a,b){this._props[b.id].txtNode.setClass(a),this.invalidate()},setFixedSize:function(a){this._props[CGSGButtonMode.NORMAL.id].dimension=a,this._props[CGSGButtonMode.OVER.id].dimension=a,this._props[CGSGButtonMode.DEACTIVATED.id].dimension=a,this._props[CGSGButtonMode.SELECTED.id].dimension=a,this._fixedSize=cgsgExist(a),this.forceRedraw()},setSlices:function(a){this._props[CGSGButtonMode.NORMAL.id].slice=a[0],this._props[CGSGButtonMode.OVER.id].slice=a[1],this._props[CGSGButtonMode.DEACTIVATED.id].slice=a[2],this._props[CGSGButtonMode.SELECTED.id].slice=a[3],this.forceRedraw()},setSliceFor:function(a,b){this._props[b.id].slice=a,this._props[b.id]._invalSize=!0,this._initShape(b)},invalidateTheme:function(){this._super(),this._props[CGSGButtonMode.NORMAL.id].txtNode.invalidateTheme(),this._props[CGSGButtonMode.OVER.id].txtNode.invalidateTheme(),this._props[CGSGButtonMode.DEACTIVATED.id].txtNode.invalidateTheme(),this._props[CGSGButtonMode.SELECTED.id].txtNode.invalidateTheme(),this._loadAttrs(CGSGButtonMode.NORMAL),this._loadAttrs(CGSGButtonMode.OVER),this._loadAttrs(CGSGButtonMode.DEACTIVATED),this._loadAttrs(CGSGButtonMode.SELECTED),this.invalidate()},invalidate:function(){cgsgExist(this._isInitialized)&&this._isInitialized===!0&&this._initShapes()},_loadAttrs:function(a){var b=this._props[a.id].cls,c=a.id,d=this._props[c],e=CGSG.cssManager.getAttrInArray(b,"background"),f=CGSG.cssManager.getAttrInArray(b,"border-width"),g=CGSG.cssManager.getAttrInArray(b,"border-color"),h=CGSG.cssManager.getAttrInArray(b,"padding-top"),i=CGSG.cssManager.getAttrInArray(b,"padding-left"),j=CGSG.cssManager.getAttrInArray(b,"border-radius"),k=CGSG.cssManager.getAttrInArray(b,"icon");if(cgsgExist(k)||(k=CGSG.cssManager.getAttrInArray(b,"list-style-image")),cgsgExist(e)){var l=e.substring(e.indexOf("rgb"),e.indexOf(")")+1),m=e.substring(e.lastIndexOf("rgb"),e.lastIndexOf(")")),n=CGSGColor.fromString(l),o=CGSGColor.fromString(m);d.firstColor=CGSGColor.rgb2hex(n.r,n.g,n.b),d.lastColor=CGSGColor.rgb2hex(o.r,o.g,o.b)}cgsgExist(g)&&(d.lineColor=g),cgsgExist(j)&&(d.radius=CGSG.cssManager.getNumber(j)),cgsgExist(f)&&(d.lineWidth=CGSG.cssManager.getNumber(f)),cgsgExist(g)&&(d.lineColor=g),cgsgExist(h)&&(d.paddingV=CGSG.cssManager.getNumber(h)),cgsgExist(i)&&(d.paddingH=CGSG.cssManager.getNumber(i)),cgsgExist(k)&&(this._checkIconFor(a),this.setImageURLFor(CGSG.cssManager.getURL(k),a))},resizeWith:function(a,b){this._needRedraw=!0,this._super(a,b)},_initShapes:function(){this._initShape(CGSGButtonMode.NORMAL),this._initShape(CGSGButtonMode.OVER),this._initShape(CGSGButtonMode.DEACTIVATED),this._initShape(CGSGButtonMode.SELECTED),this._needRedraw=!1},_initShape:function(a){var b=a.id,c=this._props[b],d=c.txtNode,e=d.getWidth(),f=d.getHeight(),g=this._distancePictoText;""===c.text&&(g=0);var h=0,i=0,j=0,k=0;cgsgExist(c.icon)&&c.icon.isLoaded&&(cgsgExist(c.slice)&&c.icon.setSlice(c.slice.position.x,c.slice.position.y,c.slice.dimension.width,c.slice.dimension.height,!0),j=c.icon.slice.dimension.width,k=c.icon.slice.dimension.height,h=(j+g)*Math.abs(this._pictoPosition.decalX),i=(k+g)*Math.abs(this._pictoPosition.decalY)),c._invalSize&&(this._fixedSize?this.dimension.resizeTo(c.dimension.width,c.dimension.height):this.dimension.resizeTo(2*c.paddingH+h+e*Math.abs(this._pictoPosition.decalX)+this._pictoPosition.computeWidth(e,j),2*c.paddingV+i+f*Math.abs(this._pictoPosition.decalY)+this._pictoPosition.computeHeight(f,k)),c._invalSize=!1,this._isDimensionChanged=!0),c.dimension=this.dimension.copy(),this._tmpCanvases[b].width=this.dimension.width+2*c.radius,this._tmpCanvases[b].height=this.dimension.height+2*c.radius;var l=this._tmpCanvases[b].getContext("2d");cgsgClearContext(l),l.save();var m=c.radius;if(l.translate(-m,-m),l.beginPath(),l.moveTo(2*m,m),l.lineTo(m+this.dimension.width-m,m),l.quadraticCurveTo(m+this.dimension.width,m,m+this.dimension.width,m+m),l.lineTo(m+this.dimension.width,m+this.dimension.height-m),l.quadraticCurveTo(m+this.dimension.width,m+this.dimension.height,m+this.dimension.width-m,m+this.dimension.height),l.lineTo(m+m,m+this.dimension.height),l.quadraticCurveTo(m,m+this.dimension.height,m,m+this.dimension.height-m),l.lineTo(m,m+m),l.quadraticCurveTo(m,m,m+m,m),l.closePath(),cgsgExist(c.lastColor)){var n=l.createLinearGradient(0,0,0,this.dimension.height);n.addColorStop(0,c.firstColor),n.addColorStop(1,c.lastColor),l.fillStyle=n}else l.fillStyle=c.firstColor;cgsgExist(c.shadowColor)&&(l.shadowColor=c.shadowColor,l.shadowBlur=10,l.shadowOffsetX=0,l.shadowOffsetY=0),l.fill(),cgsgExist(c.lineColor)&&c.lineColor>0&&(l.strokeStyle=c.lineColor,l.lineWidth=c.lineWidth,l.stroke()),l.restore();var o=(-this._pictoPosition.decalX*h+this.getWidth()-e)/2,p=(-this._pictoPosition.decalY*i+this.getHeight()-f)/2;if(cgsgExist(c.icon)&&c.icon.isLoaded){var q=e/2;c.icon.translateTo(o+q+this._pictoPosition.decalX*(q+g+(1-this._pictoPosition.dt)*j)-this._pictoPosition.dy*j/2,(1-this._pictoPosition.dy)*(p+(f-k)/2)+this._pictoPosition.dy*(p-d._size/2-this._pictoPosition.dt*(g+k)+(1-this._pictoPosition.dt)*(f+g))),c.icon.doRender(l)}d.translateTo(o,p,!1),d.doRender(l)},setMode:function(a){this._currentMode=a,this.isClickable=a.isClickable,this.dimension.resizeTo(this._props[a.id].dimension.width,this._props[a.id].dimension.height),this._isDimensionChanged=!0},getMode:function(){return this._currentMode},render:function(a){this._needRedraw&&this._initShapes(),a.drawImage(this._tmpCanvases[this._currentMode.id],0,0)},copy:function(){var a=new CGSGNodeSquare(this.position.x,this.position.y,this.dimension.width,this.dimension.height);return a=this._super(a),a.bkgcolors=this.bkgcolors,a.lineColor=this.lineColor,a.lineWidth=this.lineWidth,a}}),CGSGParticle=CGSGObject.extend({initialize:function(a){this.node=a,this.node.isClickable=!1,this.node.isResizable=!1,this.node.isDraggable=!1,this.userData=null,this.init()},init:function(){this.position=new CGSGPosition(0,0),this.mass=1e3,this.initVelocity(new CGSGVector2D(1,1)),this.checkCTL=null,this.isAlive=!0,this.age=0,this._acceleration=new CGSGVector2D(0,0),this.speedThreshold=0},initPosition:function(a,b){this.position.x=a,this.position.y=b,this.node.translateTo(a,b)},initVelocity:function(a){this.velocity=a.copy(),this.velocity.normalize()},initSpeedThreshold:function(a){this.speedThreshold=a},updatePosition:function(a,b){return isNaN(a)&&(a=1),a+=this.speedThreshold,this._acceleration.x=b.x/this.mass,this._acceleration.y=b.y/this.mass,this.velocity.x+=this._acceleration.x*a,this.velocity.y+=this._acceleration.y*a,this.position.x+=this.velocity.x*a,this.position.y+=this.velocity.y*a,null!==this.node&&this.node.translateTo(this.position.x,this.position.y),this.age+=a,cgsgExist(this.checkCTL)&&(this.isAlive=this.checkCTL(this)),this.isAlive}}),CGSGParticleEmitter=CGSGNode.extend({initialize:function(a,b,c,d,e,f,g,h){this._super(b.position.x,b.position.y),this.resizeTo(b.dimension.width,b.dimension.height),this.classType="CGSGParticleEmitter",this._nodeContructor=a,this.region=b,this.nbParticlesMax=c,this.velocity=new CGSGVector2D(0,0),cgsgExist(d)&&(this.velocity=d),this.angle=Math.PI/5,cgsgExist(e)&&(this.angle=e),this.speed=1,cgsgExist(f)&&(this.speed=f),this.speedThreshold=1,cgsgExist(g)&&(this.speedThreshold=g),this.outflow=0,cgsgExist(h)&&(this.outflow=h),this._currentFrame=this.outflow,this._particles=[],this._isPlaying=!1,this._forces=[],this._acceleration=new CGSGVector2D(0,0),this.gravity=this.addForce(new CGSGVector2D(0,9.81),null),this.onUpdateParticleEnd=null,this.onInitParticle=null,this.onInitParticlesEnd=null},start:function(){this._isPlaying=!0},stop:function(){this._isPlaying=!1},reset:function(){var a;for(this._currentFrame=0,a=this._particles.length-1;a>=0;a--)this.removeChild(this._particles[a].node,!0),delete this._particles[a];this._particles.clear()},render:function(a){var b,c;for(this.beforeRender(a),this._acceleration.initialize(0,0),b=this._forces.length-1;b>=0;b--)this._acceleration.x+=this._forces[b].vector.x,this._acceleration.y+=this._forces[b].vector.y,null!==this._forces[b].ctl&&(this._forces[b].age++,this._forces[b].age>=this._forces[b].ctl&&this.removeForce(this._forces[b]));for(c=0;c<this._particles.length;c++)this._isPlaying&&(this._particles[c].isAlive&&this.updateParticle(this._particles[c])||this.initParticle(this._particles[c],c)),this._particles[c].node.render(a);this._particles.length<this.nbParticlesMax&&(this._currentFrame++,this._currentFrame>=this.outflow&&(this._currentFrame=0,this._createParticle(this._particles.length))),a.restore()},_createParticle:function(a){var b=this._nodeContructor(),c=new CGSGParticle(b);this.initParticle(c,a),this.addChild(c.node),this._particles.push(c)},initParticle:function(a,b){a.init(),a.initPosition(Math.random()*this.region.dimension.width,Math.random()*this.region.dimension.height);var c=this.velocity.copy(),d=this.angle/2;c.rotate(-d+Math.random()*this.angle),a.initVelocity(c),a.initSpeedThreshold(-this.speedThreshold+Math.random()*this.speedThreshold*2),null!==this.onInitParticle&&CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_INIT_PARTICLE,new CGSGEvent(this,{index:b,particle:a}))},updateParticle:function(a){var b=a.updatePosition(this.speed,this._acceleration);return this.onUpdateParticleEnd&&CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_UPDATE_PARTICLE_END,new CGSGEvent(this,{particle:a})),b},addForce:function(a,b){var c={vector:a,ctl:b,age:0};return this._forces.push(c),c},removeForce:function(a){this._forces.without(a)}}),CGSGParticleSystem=CGSGNode.extend({initialize:function(a,b){this._super(a,b),this.classType="CGSGParticleSystem",this.emitters=[],this.attractors=[],this.repulsors=[],this.isClickable=!1,this.isResizable=!1,this.isDraggable=!1,this.isTraversable=!1},addForce:function(a){for(var b=0;b<this.emitters.length;b++)this.emitters[b].addForce(a)},addEmitter:function(a,b,c,d,e,f,g,h){var i=new CGSGParticleEmitter(a,b,c,d,e,f,g,h);return this.addChild(i),this.emitters.push(i),i},removeEmitter:function(a){this.emitters.without(a),this.removeChild(a,!0)},addAttractor:function(a,b,c){var d={position:a,strength:b,distance:c};return this.attractors.push(d),d},removeAttractor:function(a){this.attractors.without(a)},addRepulsor:function(a,b,c){var d={position:a,strength:b,distance:c};return this.repulsors.push(d),d},removeRepulsor:function(a){this.repulsors.without(a)},pickNode:function(){return null},copy:function(){var a=new CGSGParticleSystem;return a=this._super(a)}}),CGSGSceneGraph=CGSGObject.extend({initialize:function(a,b){this.root=null,this.context=b,this._nextNodeID=1,this.ghostCanvas=document.createElement("canvas"),this.initializeGhost(a.width,a.height),CGSG.canvas.onselectstart=function(){return!1}},initializeGhost:function(a,b){this.ghostCanvas.height=b,this.ghostCanvas.width=a,CGSG.ghostContext=this.ghostCanvas.getContext("2d")},invalidateTheme:function(){this._invalidateThemeRecursive(this.root)},_invalidateThemeRecursive:function(a){if(cgsgExist(a)){a.invalidateTheme();for(var b=0,c=a.children.length;c>b;++b)this._invalidateThemeRecursive(a.children[b])}},render:function(){cgsgClearContext(this.context);var a,b;if(cgsgExist(this.root)){var c,d=null;if(CGSG.animationManager.listTimelines.length>0){b=null;var e,f;for(a=CGSG.animationManager.listTimelines.length-1;a>=0;--a)f=CGSG.animationManager.listTimelines[a],b=f.parentNode,b.isVisible&&(e=f.getValue(CGSG.currentFrame),void 0!==e&&(b.evalSet(f.attribute,e),null!==f.onAnimate&&CGSG.eventManager.dispatch(f,cgsgEventTypes.ON_ANIMATE,new CGSGEvent(this,{node:b,attribute:f.attribute,value:e}))),d=f.getFirstKey(),null!==d&&d.frame===CGSG.currentFrame&&null!==f.onAnimationStart&&(c=new CGSGEvent(this,{node:b}),c.node=b,CGSG.eventManager.dispatch(f,cgsgEventTypes.ON_ANIMATION_START,c)),d=f.getLastKey(),null!==d&&d.frame===CGSG.currentFrame&&(f.removeAll(),null!==f.onAnimationEnd&&(c=new CGSGEvent(this,{node:b}),c.node=b,c.attribute=f.attribute,CGSG.eventManager.dispatch(f,cgsgEventTypes.ON_ANIMATION_END,c))))}this.context.save(),this.context.scale(CGSG.displayRatio.x,CGSG.displayRatio.y),this.root.isVisible&&this.root.doRender(this.context),this.context.restore()}if(CGSG.isBoundingBoxOnTop&&CGSG.selectedNodes.length>0)for(a=CGSG.selectedNodes.length-1;a>=0;a--)if(b=CGSG.selectedNodes[a],b.isVisible){b.computeAbsoluteMatrix(!0),this.context.save(),this.context.scale(CGSG.displayRatio.x,CGSG.displayRatio.y);var g=b.getAbsPosition();this.context.translate(g.x,g.y),cgsgExist(b.rotationCenter)?(this.context.translate(b.dimension.width*b.rotationCenter.x,b.dimension.height*b.rotationCenter.y),this.context.rotate(b.rotation.angle),this.context.translate(-b.dimension.width*b.rotationCenter.x,-b.dimension.height*b.rotationCenter.y)):this.context.rotate(b.rotation.angle),this.context.scale(b._absSca.x,b._absSca.y),b.renderBoundingBox(this.context),this.context.restore()}CGSG.currentFrame++},setCanvasDimension:function(a){this.initializeGhost(a.width,a.height)},selectNode:function(a){a.isSelected||(a.setSelected(!0),a.computeAbsoluteMatrix(!1),CGSG.selectedNodes[CGSG.selectedNodes.length]=a)},deselectNode:function(a){a.setSelected(!1),CGSG.selectedNodes.without(a)},deselectAll:function(a){for(var b=null,c=CGSG.selectedNodes.length-1;c>=0;c--)b=CGSG.selectedNodes[c],cgsgExist(a)&&a.contains(b)||this.deselectNode(b);CGSG.selectedNodes.clear()},pickNode:function(a,b){return cgsgClearContext(CGSG.ghostContext),cgsgExist(this.root)?this.root.pickNode(a.copy(),new CGSGScale(1,1),CGSG.ghostContext,!0,b):null},pickNodes:function(a,b){return cgsgClearContext(CGSG.ghostContext),cgsgExist(this.root)?this.root.pickNodes(a.copy(),new CGSGScale(1,1),CGSG.ghostContext,!0,b):null},removeNode:function(a){return cgsgExist(a)&&(this.deselectNode(a),null!==this.root)?this.root.removeChild(a,!0):!1},addNode:function(a,b){a._id=this._nextNodeID++,null===this.root?this.root=a:(null===b&&(b=this.root),b.addChild(a))}}),cgsgGlobalRenderingTimer=null;!function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,17-(c-a));cgsgGlobalRenderingTimer=window.setTimeout(function(){b(c+d)},d),a=c+d}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}();var CGSGView=CGSGObject.extend({initialize:function(a){cgsgDetectCurrentExplorer(),"undefined"!=typeof a.style.msTouchAction&&(a.style.msTouchAction="none"),CGSG.canvas=a,CGSG.context=CGSG.canvas.getContext("2d"),this.allowMultiSelect=!0,this.dragSelectFillColor=null,this.dragSelectStrokeColor=null,this.dragSelectStrokeWidth=null,this.dragSelectAlpha=CGSG_DEFAULT_DRAG_SELECT_ALPHA,this.dblBuffer=!0,this.dblBuffer?(this._updateDblBuffer(),CGSG.sceneGraph=new CGSGSceneGraph(CGSG.canvas,this._cacheCtx)):CGSG.sceneGraph=new CGSGSceneGraph(CGSG.canvas,CGSG.context),this._isRunning=!1,this._needRedraw=!0,this._frameContainer=null,this._keyDownedCtrl=!1,this._timerDblTouch=null,this.dblTouchDelay=CGSG_DEFAULT_DBLTOUCH_DELAY,this._mousePos=[],this._mouseOldPosition=[],this._dragStartPos=[],this._dragEndPos=[],this._isDrag=!1,this._isResizeDrag=!1,this._isDragSelect=!1,this._resizingDirection=-1,this._isDblClick=!1,this._mouseUpCount=0,this._timeoutDblClick=null,this._isPressing=!1,this._listCursors=["nw-resize","n-resize","ne-resize","w-resize","e-resize","sw-resize","s-resize","se-resize"],this._offsetX=0,this._offsetY=0,this._selectedNode=null;var b=this;CGSG.canvas.onmouseout=function(a){b.onMouseOutHandler(a)},CGSG.canvas.onmousedown=function(a){b.onMouseDown(a)},CGSG.canvas.onmouseup=function(a){b.onMouseUp(a)},CGSG.canvas.ondblclick=function(a){b.onMouseDblClick(a)},CGSG.canvas.onmousemove=function(a){b.onMouseMove(a)},document.onkeydown=function(a){b.onKeyDownHandler(a)},document.onkeyup=function(a){b.onKeyUpHandler(a)},CGSG.canvas.addEventListener("touchstart",function(a){b.onTouchStart(a)},!1),CGSG.canvas.addEventListener("touchmove",function(a){b.onTouchMove(a)},!1),CGSG.canvas.addEventListener("touchend",function(a){b.onTouchEnd(a)},!1),CGSG.canvas.addEventListener("MSPointerDown",function(a){b.onTouchStart(a)},!1),CGSG.canvas.addEventListener("MSPointerMove",function(a){b.onTouchMove(a)},!1),CGSG.canvas.addEventListener("MSPointerUp",function(a){b.onTouchEnd(a)},!1),this._lastUpdate=(new Date).getTime(),this._nodeMouseOver=null,this.onSceneClickStart=null,this.onSceneClickEnd=null,this.onSceneDblClickStart=null,this.onSceneDblClickEnd=null,this.onRenderStart=null,this.onRenderEnd=null,this.onSceneAverageFpsChanged=null,CGSG.currentFrame=0,this._fpss=null,this._r={x:0,y:0},this._d={dW:0,dH:0},this.invalidateTheme()},_updateDblBuffer:function(){cgsgExist(this._cacheCanvas)||(this._cacheCanvas=document.createElement("canvas"),this._cacheCtx=this._cacheCanvas.getContext("2d")),this._cacheCanvas.width=CGSG.canvas.width,this._cacheCanvas.height=CGSG.canvas.height,cgsgClearContext(this._cacheCtx)},setCanvasDimension:function(a){CGSG.canvas.width=a.width,CGSG.canvas.height=a.height,CGSG.sceneGraph.setCanvasDimension(a),this._updateDblBuffer()},deleteSelected:function(){CGSG.selectedNodes.length>0&&cgsgIterateReverse(CGSG.selectedNodes,function(a){this._selectedNode=CGSG.selectedNodes[a],CGSG.sceneGraph.removeNode(this._selectedNode,!0)}.bind(this))},deselectAll:function(a){this._isDrag=!1,this._isResizeDrag=!1,this._resizingDirection=-1,CGSG.sceneGraph.deselectAll(a),this.invalidateTransformation()},render:function(){if(this._isRunning&&this._needRedraw){if(null!==this.onRenderStart){var a=new CGSGEvent(this,null);CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_RENDER_START,a)}if(this.dblBuffer&&(cgsgClearContext(CGSG.context),CGSG.context.drawImage(this._cacheCanvas,0,0)),CGSG.sceneGraph.render(),this._dragStartPos.length>0&&this._dragEndPos.length>0){var b=this._dragStartPos[0],c=this._dragEndPos[0],d=c.x-b.x,e=c.y-b.y;CGSG.sceneGraph.context.save(),CGSG.sceneGraph.context.scale(CGSG.displayRatio.x,CGSG.displayRatio.y),CGSG.sceneGraph.context.strokeStyle=this.dragSelectStrokeColor,CGSG.sceneGraph.context.fillStyle=this.dragSelectFillColor,CGSG.sceneGraph.context.lineWidth=this.dragSelectStrokeWidth,CGSG.sceneGraph.context.globalAlpha=this.dragSelectAlpha,CGSG.sceneGraph.context.fillRect(b.x,b.y,d,e),CGSG.sceneGraph.context.strokeRect(b.x,b.y,d,e),CGSG.sceneGraph.context.restore()}null!==this.onRenderEnd&&CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_RENDER_END,new CGSGEvent(this,null))}this._updateFramerate(),this._updateFramerateContainer()},startPlaying:function(){var a=this.startPlaying.bind(this);window.requestAnimationFrame(a),this._isRunning=!0,this.render()},stopPlaying:function(){window.cancelAnimationFrame(cgsgGlobalRenderingTimer),this._isRunning=!1},invalidateTransformation:function(){this._needRedraw=!0},invalidateTheme:function(){CGSG.cssManager.invalidateCache(),this.dragSelectFillColor=CGSG.cssManager.getAttr("cgsg-selectionBox","background-color"),this.dragSelectStrokeColor=CGSG.cssManager.getAttr("cgsg-selectionBox","border-color"),this.dragSelectStrokeWidth=CGSG.cssManager.getAttr("cgsg-selectionBox","border-width"),this.dragSelectAlpha=CGSG.cssManager.getAttr("cgsg-selectionBox","opacity"),CGSG.sceneGraph.invalidateTheme()},_updateFramerate:function(){cgsgExist(this._fpss)||(this._fpss=[],this.currentFps=0);var a=(new Date).getTime(),b=a-this._lastUpdate;if(!isNaN(CGSG.maxFramerate))for(;1e3/b>CGSG.maxFramerate;)a=(new Date).getTime(),b=a-this._lastUpdate;this._fpss[this.currentFps++]=1e3/b,this.currentFps===CGSG.framerateDelay&&(this.currentFps=0,CGSG.fps=this._fpss.average(),null!==this.onSceneAverageFpsChanged&&CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_SCENE_AVERAGE_FPS_CHANGED,new CGSGEvent(this,{fps:CGSG.fps}))),this._lastUpdate=a},_updateFramerateContainer:function(){null!==this._frameContainer&&(this._frameContainer.innerHTML=Math.round(CGSG.fps))},showFPS:function(a){this._frameContainer=a},setDisplayRatio:function(a){CGSG.displayRatio=a,CGSG.sceneGraph.initializeGhost(CGSG.canvas.width/CGSG.displayRatio.x,CGSG.canvas.height/CGSG.displayRatio.y)},onMouseOutHandler:function(){this._isPressing=!1},onMouseDown:function(a){this.onTouchStart(a)},onTouchStart:function(a){this._isPressing=!0,cgsgExist(this._mousePos)&&(this._mouseOldPosition=this._mousePos.copy()),this._mousePos=cgsgGetCursorPositions(a,CGSG.canvas),this._selectedNode=CGSG.sceneGraph.pickNode(this._mousePos[0],null),cgsgExist(this._selectedNode)&&(this._selectedNode.onClickStart&&CGSG.eventManager.dispatch(this._selectedNode,cgsgEventTypes.ON_CLICK_START,new CGSGEvent(this,{nativeEvent:a,position:this._mousePos})),this._mouseOldPosition=this._mousePos.copy()),this._updateSelection(a)},_updateSelection:function(a){var b=cgsgExist(this._selectedNode)&&(this._selectedNode.isClickable||this._selectedNode.isDraggable||this._selectedNode.isResizable);b?(this._selectedNode.isDraggable||this._selectedNode.isResizable)&&(this.allowMultiSelect&&this._keyDownedCtrl?this._selectedNode.isSelected?CGSG.sceneGraph.deselectNode(this._selectedNode):CGSG.sceneGraph.selectNode(this._selectedNode):this._selectedNode.isSelected||(this.deselectAll(null),CGSG.sceneGraph.selectNode(this._selectedNode)),this._isDrag=!this._detectResizeMode(this._mousePos[0]),this.invalidateTransformation()):this.deselectAll(null);var c=this._canStartDragSelection(a);if(cgsgExist(c)||(c=!b),this.allowMultiSelect&&c){var d=cgsgGetCursorPositions(a,CGSG.canvas);this._isDragSelect=!0,this._dragStartPos=d,this._dragEndPos=d,this.deselectAll(null)}},_canStartDragSelection:function(){},_dispatchClick:function(a){cgsgExist(this._selectedNode)&&this._selectedNode.isClickable&&(!this._isDblClick&&cgsgExist(this._selectedNode.onClick)&&(a.data.node=this._selectedNode,a.data.positions=this._mousePos.copy(),CGSG.eventManager.dispatch(this._selectedNode,cgsgEventTypes.ON_CLICK,a)),this._selectedNode.isDraggable===!1&&this._selectedNode.isResizable===!1&&this.deselectAll([this._selectedNode]))},_clickOnScene:function(a,b){this._mousePos=cgsgGetCursorPositions(a.data.nativeEvent,CGSG.canvas),null!==this.onSceneClickStart&&CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_SCENE_CLICK_START,new CGSGEvent(this,{nativeEvent:a,positions:this._mousePos})),b&&(this._selectedNode=CGSG.sceneGraph.pickNode(this._mousePos[0],function(a){return a.isTraversable===!0&&(a.isClickable===!0||a.isDraggable===!0||a.isResizable===!0)})),this._dispatchClick(a),null!==this.onSceneClickEnd&&CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_SCENE_CLICK_END,new CGSGEvent(this,{nativeEvent:a,positions:this._mousePos}))},onMouseMove:function(a){this._moveOnScene(a)},onTouchMove:function(a){a.preventManipulation&&a.preventManipulation(),a.preventDefault(),a.stopPropagation(),this._moveOnScene(a)},_moveOnScene:function(a){var b,c,d,e,f,g;this._mousePos=cgsgGetCursorPositions(a,CGSG.canvas);var h=this._selectedNode;if(this._selectedNode=null,this._isPressing&&this._isDrag){if(CGSG.selectedNodes.length>0){for(f=this._mousePos[0],g=this._mouseOldPosition[0],this._offsetX=f.x-g.x,this._offsetY=f.y-g.y,b=CGSG.selectedNodes.length-1;b>=0;b--)this._selectedNode=CGSG.selectedNodes[b],null!==this._selectedNode&&this._selectedNode.isDraggable&&(this._selectedNode.isMoving=!0,c=this._offsetX/(this._selectedNode._absSca.x/this._selectedNode.scale.x),d=this._offsetY/(this._selectedNode._absSca.y/this._selectedNode.scale.y),this._canMove(this._selectedNode,c,d,0,0)&&(this._selectedNode.translateWith(c,d),null!==this._selectedNode.onDrag&&(e=new CGSGEvent(this,{node:this._selectedNode,positions:this._mousePos.copy(),nativeEvent:a}),CGSG.eventManager.dispatch(this._selectedNode,cgsgEventTypes.ON_DRAG,e))));this._mouseOldPosition=this._mousePos.copy(),this.invalidateTransformation()}}else if(this._isPressing&&this._isResizeDrag)CGSG.selectedNodes.length>0&&(f=this._mousePos[0],g=this._mouseOldPosition[0],this._offsetX=f.x-g.x,this._offsetY=f.y-g.y,cgsgIterateReverse(CGSG.selectedNodes,function(b,e){if(this._selectedNode=e,this._selectedNode.isResizable){this._selectedNode.isResizing=!0,c=this._offsetX/this._selectedNode._absSca.x,d=this._offsetY/this._selectedNode._absSca.y;var f=Math.max(c,d);0===f&&(f=Math.min(c,d));var g=this._selectedNode.getWidth()*this._selectedNode._absSca.x,h=this._selectedNode.getHeight()*this._selectedNode._absSca.y;switch(this._resizingDirection){case 0:this._selectedNode.isProportionalResize?(this._d=this._getDeltaOnMove(f,c,d,g,h,-1,-1),this._r.x=this._d.dW,this._r.y=this._d.dH,this._d.dW=-this._d.dW,this._d.dH=-this._d.dH):(this._d.dW=c*this._selectedNode.scale.x,this._d.dH=d*this._selectedNode.scale.y,this._r.x=-c,this._r.y=-d);break;case 1:this._d.dW=0,this._d.dH=d*this._selectedNode.scale.y,this._r.x=0,this._r.y=-d;break;case 2:this._selectedNode.isProportionalResize?(this._d=this._getDeltaOnMove(f,c,d,g,h,1,-1),this._r.x=this._d.dW,this._r.y=this._d.dH,this._d.dW=0,this._d.dH=-this._d.dH):(this._d.dW=0,this._d.dH=d*this._selectedNode.scale.y,this._r.x=c,this._r.y=-d);break;case 3:this._d.dW=c*this._selectedNode.scale.x,this._d.dH=0,this._r.x=-c,this._r.y=0;break;case 4:this._d.dW=0,this._d.dH=0,this._r.x=c,this._r.y=0;break;case 5:this._selectedNode.isProportionalResize?(this._d=this._getDeltaOnMove(f,c,d,g,h,1,-1),this._r.x=-this._d.dW,this._r.y=-this._d.dH,this._d.dH=0):(this._d.dW=c*this._selectedNode.scale.x,this._d.dH=0,this._r.x=-c,this._r.y=d);break;case 6:this._d.dW=0,this._d.dH=0,this._r.x=0,this._r.y=d;break;case 7:this._selectedNode.isProportionalResize?(this._d=this._getDeltaOnMove(f,c,d,g,h,1,1),this._r.x=this._d.dW,this._r.y=this._d.dH,this._d.dW=0,this._d.dH=0):(this._d.dW=0,this._d.dH=0,this._r.x=c,this._r.y=d)}if(this._canMove(this._selectedNode,this._d.dW,this._d.dH,this._r.x,this._r.y)&&(this._selectedNode.translateWith(this._d.dW,this._d.dH,!1),this._selectedNode.resizeWith(this._r.x,this._r.y,!1),this._selectedNode.computeAbsoluteMatrix(!1),null!==this._selectedNode.onResize)){var i=new CGSGEvent(this,{node:this._selectedNode,positions:this._mousePos.copy(),e:a});CGSG.eventManager.dispatch(this._selectedNode,cgsgEventTypes.ON_RESIZE,i)}}}.bind(this))),this._mouseOldPosition=this._mousePos.copy(),this.invalidateTransformation();else if(CGSG.selectedNodes.length>0){if(this._detectResizeMode(this._mousePos[0]))return;this._resizingDirection=-1,CGSG.canvas.style.cursor="auto",this.invalidateTransformation()}else this._isDragSelect&&(this._dragEndPos=this._mousePos.copy(),this.invalidateTransformation());if(!this._isDrag&&!this._isResizeDrag){var i=null;cgsgExist(this._nodeMouseOver)&&(i=this._nodeMouseOver.pickNode(this._mousePos[0],null,CGSG.ghostContext,!1,null),null===i?(this._nodeMouseOver.isMouseOver=!1,cgsgExist(this._nodeMouseOver.onMouseOut)&&(e=new CGSGEvent(this,{node:this._nodeMouseOver,positions:this._mousePos.copy(),e:a}),CGSG.eventManager.dispatch(this._nodeMouseOver,cgsgEventTypes.ON_MOUSE_OUT,e)),this._nodeMouseOver=null):i===this._nodeMouseOver&&cgsgExist(this._nodeMouseOver.onMouseOver)&&(e=new CGSGEvent(this,{node:this._nodeMouseOver,positions:this._mousePos.copy(),e:a}),CGSG.eventManager.dispatch(this._nodeMouseOver,cgsgEventTypes.ON_MOUSE_OVER,e))),null===i&&null!==(i=CGSG.sceneGraph.pickNode(this._mousePos[0],function(a){return null!==a.onMouseEnter||null!==a.onMouseOver}))&&(i.isMouseOver=!0,this._nodeMouseOver=i,this._nodeMouseOver.isMouseOver=!0,cgsgExist(this._nodeMouseOver.onMouseEnter)&&(e=new CGSGEvent(this,{node:this._nodeMouseOver,positions:this._mousePos.copy(),e:a}),CGSG.eventManager.dispatch(this._nodeMouseOver,cgsgEventTypes.ON_MOUSE_ENTER,e)))}this._selectedNode=h},_canMove:function(a,b,c,d,e){var f;if(f=null!==a.nodeConstraint?a.nodeConstraint.getAbsoluteRegion():a.regionConstraint,null!==f){var g=a.getAbsoluteRegion();if(g.position.x+=b,g.position.y+=c,g.dimension.width+=d,g.dimension.height+=e,!cgsgRegionIsInRegion(g,f,0))return!1}return!0},_detectResizeMode:function(a){var b=this._selectedNode;return cgsgIterateReverse(CGSG.selectedNodes,function(b,c){if(this._selectedNode=c,this._selectedNode.isResizable)for(var d=0;8>d;d++)if(!c.isProportionalResizeOnly||1!==d&&3!==d&&4!==d&&6!==d){var e=this._selectedNode.handles[d];if(this._isResizeDrag=e.checkIfSelected(a,CGSG.resizeHandleThreshold),this._isResizeDrag)return this._resizingDirection=d,CGSG.canvas.style.cursor=this._listCursors[d],!1}}.bind(this)),this._selectedNode=b,this._isResizeDrag},_getDeltaOnMove:function(a,b,c,d,e,f,g){var h=b,i=c,j=1;return a===b?(j=(d+f*a)/d,h=f*a,i=(j-1)*e):(j=(e+g*a)/e,i=g*a,h=(j-1)*d),{dW:h,dH:i}},onMouseUp:function(a){this.onTouchEnd(a)},onTouchEnd:function(a){a.preventManipulation&&a.preventManipulation(),a.preventDefault(),a.stopPropagation(),this._isPressing=!1,this._mouseUpCount++,cgsgExist(this._selectedNode)&&cgsgExist(this._selectedNode.onDblClick)?this._mouseUpCount>1?(clearTimeout(this._timeoutDblClick),this._upAndDblClick(a)):this._timeoutDblClick=setTimeout(function(){this._upAndClick(a)}.bind(this),this.dblTouchDelay):this._upAndClick(a)},_upAndClick:function(a){this._mouseUpCount=0;var b=this._upOnScene(a);b.nativeEvent=a,this._clickOnScene(new CGSGEvent(this,b),!1)},_upAndDblClick:function(a){this._mouseUpCount=0;var b=this._upOnScene(a);b.nativeEvent=a,this._dblClickOnScene(new CGSGEvent(this,b),!1)},_upOnScene:function(a){var b=this._selectedNode,c={};c.nativeEvent=a;var d=cgsgExist(b);if(c.hasMoved=d&&b.isMoving,c.hasResize=d&&b.isResizing,this._isDrag)cgsgIterateReverse(CGSG.selectedNodes,function(b,c){if(this._selectedNode=c,this._selectedNode.isMoving&&(this._selectedNode.isMoving=!1,this._selectedNode.computeAbsoluteMatrix(!0),null!==this._selectedNode.onDragEnd)){var d=new CGSGEvent(this,{node:this._selectedNode,positions:this._mousePos.copy(),nativeEvent:a});CGSG.eventManager.dispatch(this._selectedNode,cgsgEventTypes.ON_DRAG_END,d)}}.bind(this)),this._isDrag=!1;else if(this._isResizeDrag)cgsgIterateReverse(CGSG.selectedNodes,function(b,c){if(this._selectedNode=c,this._selectedNode.isResizing&&(this._selectedNode.isResizing=!1,this._selectedNode.computeAbsoluteMatrix(!0),null!==this._selectedNode.onResizeEnd)){var d=new CGSGEvent(this,{node:this._selectedNode,positions:this._mousePos.copy(),nativeEvent:a});CGSG.eventManager.dispatch(this._selectedNode,cgsgEventTypes.ON_RESIZE_END,d)}}.bind(this)),this._isResizeDrag=!1;else if(this._isDragSelect)this._isDragSelect=!1,this._doDragSelect(),this._dragStartPos=[],this._dragEndPos=[],this.invalidateTransformation();else if(this._selectedNode=CGSG.selectedNodes[CGSG.selectedNodes.length-1],cgsgExist(this._selectedNode)&&null!==this._selectedNode.onMouseUp){var e=new CGSGEvent(this,{node:this._selectedNode,positions:this._mousePos.copy(),e:a});CGSG.eventManager.dispatch(this._selectedNode,cgsgEventTypes.ON_MOUSE_UP,e)}return this._resizingDirection=-1,this._selectedNode=b,c},_doDragSelect:function(){var a=this._dragStartPos[0],b=this._dragEndPos[0],c=b.x-a.x,d=b.y-a.y;0>c&&(c=Math.abs(c),a.x-=c),0>d&&(d=Math.abs(d),a.y-=d);for(var e=new CGSGRegion(a.x,a.y,c,d),f=CGSG.sceneGraph.pickNodes(e,function(a){return a.isTraversable===!0&&(a.isDraggable===!0||a.isResizable===!0)}),g=0,h=f.length;h>g;++g)CGSG.sceneGraph.selectNode(f[g])},onMouseDblClick:function(a){a.preventDefault(),a.stopPropagation()
},_dblClickOnScene:function(a,b){return null!==this.onSceneDblClickStart&&CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_SCENE_DBL_CLICK_START,a),b&&(this._selectedNode=CGSG.sceneGraph.pickNode(this._mousePos[0],function(){return!0})),cgsgExist(this._selectedNode)&&null!==this._selectedNode.onDblClick?(a.data.node=this._selectedNode,a.data.positions=this._mousePos.copy(),CGSG.eventManager.dispatch(this._selectedNode,cgsgEventTypes.ON_DBL_CLICK,a)):null!==this.onSceneDblClickEnd&&CGSG.eventManager.dispatch(this,cgsgEventTypes.ON_SCENE_DBL_CLICK_END,a),this._selectedNode},onKeyDownHandler:function(a){var b=window.e?a.keyCode:a.which;switch(b){case 17:this._keyDownedCtrl=!0}return b},onKeyUpHandler:function(a){var b=window.e?a.keyCode:a.which;switch(b){case 17:this._keyDownedCtrl=!1}return b}});
//# sourceMappingURL=scenegraph_2.2.0.map